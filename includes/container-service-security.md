# <a name="securing-docker-containers-in-azure-container-service"></a><span data-ttu-id="05048-101">Azure Container Service에서 Docker 컨테이너 보안</span><span class="sxs-lookup"><span data-stu-id="05048-101">Securing Docker containers in Azure Container Service</span></span>

<span data-ttu-id="05048-102">이 문서에서는 Azure Container Service에 배포된 Docker 컨테이너 보호를 위한 고려 사항과 권장 사항을 소개합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-102">This article introduces considerations and recommendations for securing Docker containers deployed in Azure Container Service.</span></span> <span data-ttu-id="05048-103">여기에 나와 있는 고려 사항은 대부분 Azure 또는 다른 환경에 배포된 Docker 컨테이너에 일반적으로 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="05048-103">Many of these considerations apply generally to Docker containers deployed in Azure or other environments.</span></span> 

## <a name="image-security"></a><span data-ttu-id="05048-104">이미지 보안</span><span class="sxs-lookup"><span data-stu-id="05048-104">Image security</span></span>

<span data-ttu-id="05048-105">컨테이너는 하나 이상의 리포지토리에 저장된 이미지에서 작성됩니다.</span><span class="sxs-lookup"><span data-stu-id="05048-105">Containers are built from images that are stored in one or more repositories.</span></span> <span data-ttu-id="05048-106">이러한 리포지토리는 공용 또는 개인 컨테이너 레지스트리에 속할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-106">These repositories can belong to public or private container registries.</span></span> <span data-ttu-id="05048-107">공용 레지스트리의 예는 [Docker 허브](https://hub.docker.com/)입니다.</span><span class="sxs-lookup"><span data-stu-id="05048-107">An example of a public registry is [Docker Hub](https://hub.docker.com/).</span></span> <span data-ttu-id="05048-108">개인 레지스트리의 예는 [Docker Trusted Registry](https://docs.docker.com/datacenter/dtr/2.0/)이며 온-프레미스 또는 가상 사설 클라우드에 설치할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-108">An example of a private registry is the [Docker Trusted Registry](https://docs.docker.com/datacenter/dtr/2.0/), which can be installed on-premises or in a virtual private cloud.</span></span> <span data-ttu-id="05048-109">[Azure Container Registry](../articles/container-registry/container-registry-intro.md)를 포함한 클라우드 기반 개인 컨테이너 레지스트리 서비스도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-109">There are also cloud-based private container registry services including [Azure Container Registry](../articles/container-registry/container-registry-intro.md).</span></span>

### <a name="public-and-private-images"></a><span data-ttu-id="05048-110">공용 및 개인 이미지</span><span class="sxs-lookup"><span data-stu-id="05048-110">Public and private images</span></span>
<span data-ttu-id="05048-111">일반적으로, 공개적으로 게시된 소프트웨어 패키지와 마찬가지로 공개적으로 사용 가능한 컨테이너 이미지는 보안을 보장하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-111">In general, as with any publicly published software package, a publicly available container image does not guarantee security.</span></span> <span data-ttu-id="05048-112">컨테이너 이미지는 여러 소프트웨어 계층으로 구성되며 각 소프트웨어 계층은 취약점이 있을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-112">Container images consist of multiple software layers, and each software layer could have vulnerabilities.</span></span> <span data-ttu-id="05048-113">이미지의 소유자(신뢰할 수 있는 출처인지 여부를 결정하기 위해), 구성되는 소프트웨어 계층 및 소프트웨어 버전을 포함하여 컨테이너 이미지의 출처를 이해하는 것이 중요합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-113">It is key to understand the origin of the container image, including the owner of the image (to determine if it is a reliable source or not), the software layers it consists of, and the software versions.</span></span> 

<span data-ttu-id="05048-114">예를 들어 Docker 허브에서 공식적인 [nginx 리포지토리](https://hub.docker.com/_/nginx/)로 이동하고 **태그** 탭을 탐색하면 각 이미지에 색으로 지정된 취약성이 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="05048-114">For example, if you go to the official [nginx repository](https://hub.docker.com/_/nginx/) in Docker Hub and navigate to the **Tags** tab, you see color-coded vulnerabilities in each image.</span></span> <span data-ttu-id="05048-115">각 색상은 이미지의 소프트웨어 계층에서 취약성을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="05048-115">Each color depicts the vulnerability of a software layer of the image.</span></span> <span data-ttu-id="05048-116">Docker 허브에서 취약성 검색에 대한 자세한 내용은 [Docker 허브에서 공식적 리포지토리 이해](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="05048-116">For more about vulnerability scanning in Docker Hub, see [Understanding official repos on Docker Hub](https://blog.docker.com/2015/06/understanding-official-repos-docker-hub/).</span></span>

![Docker 허브에서 Nginx 이미지](./media/container-service-security/docker-hub-nginx.png)

<span data-ttu-id="05048-118">기업은 Azure Container Registry 또는 Docker Trusted Registry와 같은 개인 레지스트리에서 이미지를 저장 및 검색하는 보안 공격으로부터 스스로를 보호하기 위해 보안을 깊이 고려합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-118">Enterprises care deeply about security, and to protect themselves from security attack should store and retrieve images from a private registry, such as Azure Container Registry or Docker Trusted Registry.</span></span> <span data-ttu-id="05048-119">관리되는 개인 레지스트리를 제공하는 것 외에도, Azure Container Registry는 읽기 전용, 쓰기 및 소유자 권한에 대한 역할 기반 액세스를 포함하여 기본 인증 흐름에 대해 Azure Active Directory를 통한 [서비스 주체 기반 인증](../articles/container-registry/container-registry-authentication.md)을 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-119">In addition to providing a managed private registry, Azure Container Registry supports [service principal-based authentication](../articles/container-registry/container-registry-authentication.md) through Azure Active Directory for basic authentication flows, including role-based access for read-only, write, and owner permissions.</span></span>

### <a name="image-security-scanning"></a><span data-ttu-id="05048-120">이미지 보안 검색</span><span class="sxs-lookup"><span data-stu-id="05048-120">Image security scanning</span></span>

<span data-ttu-id="05048-121">개인 레지스트리를 사용하는 경우에도 추가 보안 유효성 검사를 위해 이미지 검색 솔루션을 사용하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-121">Even when using a private registry, it is a good idea to use image scanning solutions for additional security validation.</span></span> <span data-ttu-id="05048-122">컨테이너 이미지의 각 소프트웨어 계층은 컨테이너 이미지의 다른 계층과 관계없이 잠재적으로 취약성이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-122">Each software layer in a container image is potentially prone to vulnerabilities independent of other layers in the container image.</span></span> <span data-ttu-id="05048-123">점점 더 많은 기업들이 컨테이너 기술을 기반으로 프로덕션 워크로드 배포를 시작함에 따라 조직에 대한 보안 위협을 방지하기 위해 이미지 검색이 더욱 중요해지고 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-123">As increasingly companies start deploying their production workloads based on container technologies, image scanning becomes important to ensure prevention of security threats against their organizations.</span></span> 

<span data-ttu-id="05048-124">[Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry) 및 [Aqua Security](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry) 등과 같은 보안 모니터링 및 검색 솔루션을 사용하여 개인 레지스트리에서 컨테이너 이미지를 검색하여 잠재적인 취약성을 식별할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-124">Security monitoring and scanning solutions such as [Twistlock](https://www.twistlock.com/2016/11/07/twistlock-supports-azure-container-registry) and [Aqua Security](http://blog.aquasec.com/image-vulnerability-scanning-in-azure-container-registry), among others, can be used to scan container images in a private registry and identify potential vulnerabilities.</span></span> <span data-ttu-id="05048-125">다양한 솔루션이 제공하는 검색 깊이를 파악하는 것이 중요합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-125">It is important to understand the depth of scanning that the different solutions provide.</span></span> <span data-ttu-id="05048-126">예를 들어, 일부 솔루션은 알려진 취약성에 대해서만 이미지 계층을 교차 검증할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-126">For example, some solutions might only cross-verify image layers against known vulnerabilities.</span></span> <span data-ttu-id="05048-127">이러한 솔루션은 특정 패키지 관리자 소프트웨어를 통해 빌드된 이미지 계층 소프트웨어는 검증하지 못할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-127">These solutions might not be able to verify image-layer software built through certain package manager software.</span></span> <span data-ttu-id="05048-128">다른 솔루션은 보다 심도 있는 검색 통합 기능을 포함하며 모든 패키지된 소프트웨어에서 취약성을 발견할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-128">Other solutions have deeper scanning integration and can find vulnerabilities in any packaged software.</span></span>

### <a name="production-deployment-rules-and-audit"></a><span data-ttu-id="05048-129">프로덕션 배포 규칙 및 감사</span><span class="sxs-lookup"><span data-stu-id="05048-129">Production deployment rules and audit</span></span>
<span data-ttu-id="05048-130">응용 프로그램을 프로덕션에 배포한 후에는 프로덕션 환경에 사용된 이미지가 안전하고 취약성이 없는지 확인하기 위해 몇 가지 규칙을 설정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-130">Once an application is deployed in production, it is essential to set a few rules to ensure that images used in production environments are secure and contain no vulnerabilities.</span></span>

* <span data-ttu-id="05048-131">일반적으로 부분적으로라도 취약한 이미지는 프로덕션 환경에서 실행해서는 안됩니다.</span><span class="sxs-lookup"><span data-stu-id="05048-131">As a rule, images with vulnerabilities, even minor, should not be allowed to run in a production environment.</span></span> <span data-ttu-id="05048-132">또한 프로덕션에 배포된 모든 이미지는 이상적으로 소수의 사용자만 액세스할 수 있는 개인 레지스트리에 저장해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-132">In addition, all images deployed in production should ideally be saved in a private registry accessible to a select few.</span></span> <span data-ttu-id="05048-133">또한 효과적으로 관리할 수 있도록 프로덕션 이미지 수를 적게 유지하는 것도 중요합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-133">It is also important to keep the number of production images small to ensure that they can be managed effectively.</span></span>

* <span data-ttu-id="05048-134">공개적으로 사용 가능한 컨테이너 이미지에서 소프트웨어의 출처를 찾아내는 것은 어렵기 때문에 원본에서 이미지를 작성하여 계층의 출처를 파악하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-134">Since it is hard to pinpoint the origin of software from a publicly available container image, it is a good practice to build images from source to ensure knowledge of the origin of the layer.</span></span> <span data-ttu-id="05048-135">자체 구축된 컨테이너 이미지에 취약성이 있을 경우 고객은 보다 신속하게 해결 방법을 찾을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-135">When a vulnerability surfaces in a self-built container image, customers can find a quicker path to a resolution.</span></span> <span data-ttu-id="05048-136">공용 이미지가 있는 고객은 공용 이미지의 루트를 찾아 수정하거나 게시자로부터 다른 보안 이미지를 얻어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-136">With a public image, customers would need to find the root of a public image to fix it or obtain another secure image from the publisher.</span></span>

* <span data-ttu-id="05048-137">프로덕션에 배포된 철저하게 검색된 이미지는 응용 프로그램의 수명 동안 최신 상태가 보장되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-137">A thoroughly scanned image deployed in production is not guaranteed to be up to date for the lifetime of the application.</span></span> <span data-ttu-id="05048-138">보안 취약성은 이전에 알려지지 않았거나 프로덕션 배포 후에 도입 된 이미지 계층에 대해 보고될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-138">Security vulnerabilities might be reported for layers of the image that were not previously known or were introduced after the production deployment.</span></span> <span data-ttu-id="05048-139">최신 상태가 아니거나 잠시 동안 업데이트되지 않은 이미지를 식별하려면 프로덕션 환경에 배포된 이미지를 주기적으로 감사해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-139">Periodic auditing of images deployed in production is necessary to identify images that are out of date or have not been updated in a while.</span></span> <span data-ttu-id="05048-140">청록색 배포 방법론과 롤링 업그레이드 메커니즘을 사용하여 가동 중지 시간 없이 컨테이너 이미지를 업데이트할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-140">One might use blue-green deployment methodologies and rolling upgrade mechanisms to update container images without downtime.</span></span> <span data-ttu-id="05048-141">이미지 검색은 이전 섹션에서 설명한 도구를 사용하여 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-141">Image scanning can be done with tools described in the preceding section.</span></span> 

* <span data-ttu-id="05048-142">이미지를 빌드하는 연속 통합(CI) 파이프라인 및 통합 보안 검색을 통해 보안 컨테이너 이미지로 안전한 개인 레지스트리를 유지 관리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-142">A continuous integration (CI) pipeline to build images and integrated security scanning can help maintain secure private registries with secure container images.</span></span> <span data-ttu-id="05048-143">CI 솔루션에 기본 제공된 취약성 검색은 모든 테스트를 통과한 이미지가 프로덕션 워크로드가 배포된 개인 레지스트리에 푸시되는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-143">The vulnerability scanning built into the CI solution ensures that images that pass all the tests are pushed to the private registry from which production workloads are deployed.</span></span> <span data-ttu-id="05048-144">CI 파이프라인 오류는 취약한 이미지가 프로덕션 워크로드 배포에 사용되는 개인 레지스트리에 푸시되지 않도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-144">A CI pipeline failure ensures that vulnerable images are not pushed into the private registry used for production workload deployments.</span></span> <span data-ttu-id="05048-145">또한 이미지 수가 많은 경우에는 이미지 보안 검색을 자동화합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-145">It also automates image security scanning if there are a significant number of images.</span></span> <span data-ttu-id="05048-146">그렇지 않고 이미지에서 보안 취약성을 수동으로 감사하는 것은 매우 번거롭고 오류가 발생하기 쉽습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-146">Otherwise, manually auditing images for security vulnerabilities can be painstakingly lengthy and error prone.</span></span>

## <a name="host-level-container-isolation"></a><span data-ttu-id="05048-147">호스트 수준 컨테이너 격리</span><span class="sxs-lookup"><span data-stu-id="05048-147">Host-level container isolation</span></span>
<span data-ttu-id="05048-148">고객이 Azure 리소스에 컨테이너 응용 프로그램을 배포하면 리소스 그룹의 구독 수준에서 배포되고 다중 테넌트가 아닙니다.</span><span class="sxs-lookup"><span data-stu-id="05048-148">When a customer deploys container applications on Azure resources, they are deployed at a subscription level in resource groups and are not multi-tenant.</span></span> <span data-ttu-id="05048-149">즉, 고객이 다른 사용자와 구독을 공유하는 경우 같은 구독의 두 배포간에 빌드할 수 있는 경계가 없습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-149">This means that if a customer shares a subscription with others, there are no boundaries that can be built between two deployments in the same subscription.</span></span> <span data-ttu-id="05048-150">따라서 컨테이너 수준 보안은 보장되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-150">Therefore, container-level security is not guaranteed.</span></span> 

<span data-ttu-id="05048-151">또한 컨테이너가 커널과 호스트의 리소스(Azure Container Service에서 클러스터의 Azure VM임)를 공유한다는 것을 이해하는 것이 중요합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-151">It is also critical to understand that containers share the kernel and the resources of the host (which in Azure Container Service is an Azure VM in a cluster).</span></span> <span data-ttu-id="05048-152">따라서 프로덕션에서 실행 중인 컨테이너는 권한 없는 사용자 모드로 실행되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-152">Therefore, containers running in production must be run in non-privileged user mode.</span></span> <span data-ttu-id="05048-153">루트 권한으로 컨테이너를 실행하면 전체 환경이 손상될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-153">Running a container with root privileges can compromise the entire environment.</span></span> <span data-ttu-id="05048-154">해커는 컨테이너에서 루트 수준 액세스 권한을 사용하여 호스트에서 전체 루트 권한에 대한 권한을 얻을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-154">With root-level access in a container, a hacker can gain access to the full root privileges on the host.</span></span> <span data-ttu-id="05048-155">또한 읽기 전용 파일 시스템으로 컨테이너를 실행하는 것이 중요합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-155">In addition, it is important to run containers with read-only file systems.</span></span> <span data-ttu-id="05048-156">이렇게 하면 손상된 컨테이너에 액세스할 수 있는 누군가가 파일 시스템에 악성 스크립트를 작성하고 다른 파일에 액세스하지 못하도록 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-156">This prevents someone who has access to the compromised container to write malicious scripts to the file system and gain access to other files.</span></span> <span data-ttu-id="05048-157">마찬가지로 컨테이너에 할당된 리소스(예: 메모리, CPU 및 네트워크 대역폭)를 제한하는 것이 중요합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-157">Similarly, it is important to limit the resources (such as memory, CPU, and network bandwidth) allocated to a container.</span></span> <span data-ttu-id="05048-158">이렇게 하면 해커가 리소스를 낭비하거나 신용 카드 부정 행위 또는 비트코인 마이닝과 같은 불법 활동을 시도하여 다른 컨테이너가 호스트나 클러스터에서 실행되는 것을 방지할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="05048-158">This helps prevent hackers from hogging resources and pursuing illegal activities such as credit card fraud or bitcoin mining, which could prevent other containers from running on the host or cluster.</span></span>

## <a name="orchestrator-considerations"></a><span data-ttu-id="05048-159">조정자 고려 사항</span><span class="sxs-lookup"><span data-stu-id="05048-159">Orchestrator considerations</span></span>

<span data-ttu-id="05048-160">Azure Container Service에 제공되는 각 조정자는 고유한 보안 고려 사항을 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-160">Each orchestrator available in Azure Container Service has its own security considerations.</span></span> <span data-ttu-id="05048-161">예를 들어 Container Service에서 조정자 노드에 대한 직접 SSH 액세스를 제한해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-161">For example, you should limit direct SSH access to orchestrator nodes in Container Service.</span></span> <span data-ttu-id="05048-162">대신, 각 조정자의 UI나 명령줄 도구(예: Kubernetes의 경우 `kubectl`)를 사용하여 호스트에 액세스하지 않고도 컨테이너 환경을 관리해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="05048-162">Instead, you should use each orchestrator's UI or command-line tools (such as `kubectl` for Kubernetes) to manage the container environment without accessing the hosts.</span></span> <span data-ttu-id="05048-163">자세한 내용은 [Kubernetes, DC/OS 또는 Docker Swarm 클러스터에 원격 연결](../articles/container-service/kubernetes/container-service-connect.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="05048-163">For more information, see [Make a remote connection to a Kubernetes, DC/OS, or Docker Swarm cluster](../articles/container-service/kubernetes/container-service-connect.md).</span></span>

<span data-ttu-id="05048-164">추가 조정자 관련 보안 정보는 다음 리소스를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="05048-164">For additional orchestrator-specific security information, see the following resources:</span></span>

* <span data-ttu-id="05048-165">**Kubernetes**: [Kubernetes 배포에 대한 보안 모범 사례](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html)</span><span class="sxs-lookup"><span data-stu-id="05048-165">**Kubernetes**: [Security Best Practices for Kubernetes Deployment](http://blog.kubernetes.io/2016/08/security-best-practices-kubernetes-deployment.html)</span></span>

* <span data-ttu-id="05048-166">**DC/OS**: [클러스터 보안 설정](https://dcos.io/docs/1.8/administration/securing-your-cluster/)</span><span class="sxs-lookup"><span data-stu-id="05048-166">**DC/OS**: [Securing Your Cluster](https://dcos.io/docs/1.8/administration/securing-your-cluster/)</span></span>

* <span data-ttu-id="05048-167">**Docker Swarm**: [Docker 보안](https://www.docker.com/docker-security)</span><span class="sxs-lookup"><span data-stu-id="05048-167">**Docker Swarm**: [Docker Security](https://www.docker.com/docker-security)</span></span>

## <a name="next-steps"></a><span data-ttu-id="05048-168">다음 단계</span><span class="sxs-lookup"><span data-stu-id="05048-168">Next steps</span></span>

* <span data-ttu-id="05048-169">Docker 아키텍처 및 컨테이너 보안에 대한 자세한 내용은 [컨테이너 보안 소개](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="05048-169">For more about Docker architecture and container security, see [Introduction to Container Security](https://www.docker.com/sites/default/files/WP_IntrotoContainerSecurity_08.19.2016.pdf).</span></span>

* <span data-ttu-id="05048-170">Azure 플랫폼 보안에 대한 자세한 내용은 [Azure Security Center](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="05048-170">For information about Azure platform security, see the [Azure Security Center](https://www.microsoft.com/en-us/trustcenter/cloudservices/azure).</span></span>