Azure 끝점에 대한 접근 방식은 클래식 및 리소스 관리자 배포 모델 간에 약간 다르게 작동합니다. Resource Manager 배포 모델에서는 VM 내부 및 외부로 트래픽 흐름을 제어하는 네트워크 필터를 유연하게 만들 수 있습니다. 이러한 필터를 통해 클래식 배포 모델에서 단순한 끝점 이면에 복잡한 네트워킹 환경을 만들 수 있습니다. 이 문서는 네트워크 보안 그룹과 클래식 끝점 사용 및 필터링 규칙 및 샘플 배포 시나리오 만들기와의 차이점을 간략히 설명합니다.

## <a name="overview-of-resource-manager-deployments"></a>리소스 관리자 배포 개요
클래식 배포 모델에서 끝점은 네트워크 보안 그룹 및 ACL(액세스 제어 목록) 규칙으로 대체됩니다. 네트워크 보안 그룹 ACL 규칙 구현을 위한 빠른 단계는 다음과 같습니다.

* 네트워크 보안 그룹을 만듭니다.
* 트래픽을 허용하거나 거부하려면 네트워크 보안 그룹 ACL 규칙을 정의합니다.
* 네트워크 보안 그룹을 네트워크 인터페이스나 가상 네트워크 서브넷에 할당합니다.

또한 포트 전달을 수행하려는 경우 부하 분산 장치를 VM 앞에 두고 NAT 규칙을 사용해야 합니다. 부하 분산 장치 및 NAT 규칙 구현을 위한 빠른 단계는 다음과 같습니다.

* 부하 분산 장치를 만듭니다.
* 백 엔드 풀을 만들고 VM을 풀에 추가합니다.
* 필요한 포트 전달에 대한 NAT 규칙을 정의합니다.
* NAT 규칙을 VM에 할당합니다.

## <a name="network-security-group-overview"></a>네트워크 보안 그룹 개요
네트워크 보안 그룹은 특정 포트 및 서브넷이 VM에 액세스할 수 있도록 보안 계층을 제공합니다. 일반적으로 네트워크 보안 그룹은 Vm과 외부 세계 간에 이 보안 계층을 제공합니다. 네트워크 보안 그룹을 VM에 대한 가상 네트워크 서브넷 또는 특정 네트워크 인터페이스에 적용할 수 있습니다. 이제는 끝점 ACL 규칙을 만드는 대신에 네트워크 보안 그룹 ACL 규칙을 만듭니다. 이러한 ACL 규칙은 지정된 포트를 전달하기 위해 단순히 끝점을 만드는 것보다 훨씬 더 많은 제어를 제공합니다. 자세한 내용은 [NSG(네트워크 보안 그룹)란?](../articles/virtual-network/virtual-networks-nsg.md)을 참조하세요.

> [!TIP]
> 네트워크 보안 그룹을 여러 서브넷 또는 네트워크 인터페이스에 할당할 수 있습니다. 1:1 매핑은 없습니다. 공통된 ACL 규칙으로 네트워크 보안 그룹을 만들 수 있으며 여러 서브넷 또는 네트워크 인터페이스에 적용할 수 있습니다. 또한 네트워크 보안 그룹을 구독한 리소스에 적용할 수 있습니다([역할 기반 액세스 제어](../articles/active-directory/role-based-access-control-what-is.md) 기준).

## <a name="load-balancers-overview"></a>부하 분산 장치 개요
클래식 배포 모델에서 Azure는 클라우드 서비스에서 여러분을 위해 모든 네트워크 주소 변환 (NAT) 및 포트 전달을 수행합니다. 끝점을 만들 때, 트래픽을 보내기 위해 내부 포트와 함께 노출할 외부 포트를 지정합니다. 네트워크 보안 그룹은 단독으로 이 동일한 NAT 및 포트 전달을 수행하지 않습니다. 

포트 전달에 대한 NAT 규칙을 만들 수 있도록 하려면 리소스 그룹에서 Azure Load Balancer를 만듭니다. 게다가 필요하다면 부하 분산 장치는 특정 VM에만 적용할 만큼 충분히 세부적입니다. Azure Load Balancer NAT 규칙은 클라우드 서비스 끝점을 사용하여 달성할 수 있는 것보다 훨씬 더 많은 유연성과 제어를 제공하기 위해 네트워크 보안 그룹 ACL 규칙과 함께 작동합니다. 자세한 내용은 [Azure 부하 분산 장치 개요](../articles/load-balancer/load-balancer-overview.md)를 참조하세요.

## <a name="network-security-group-acl-rules"></a>네트워크 보안 그룹 ACL 규칙
ACL 규칙을 통해 특정 포트, 포트 범위 또는 프로토콜을 기반으로 하는 VM 간에 전달될 수 있는 트래픽을 정의할 수 있습니다. 개별 VM 또는 서브넷에 이러한 규칙을 할당합니다. 다음 스크린 샷은 일반 웹 서버에 대한 ACL 규칙의 한 예입니다.

![네트워크 보안 그룹 ACL 규칙 목록](./media/virtual-machines-common-endpoints-in-resource-manager/example-acl-rules.png)

ACL 규칙은 지정한 우선 순위 메트릭(값이 높을수록 우선순위가 낮음)을 기반으로 적용됩니다. 모든 네트워크 보안 그룹에는 명시적 `DenyAllInbound`을 마지막 규칙으로 하여 Azure 네트워킹 트래픽의 흐름을 처리하도록 설계된 세 가지 기본 규칙이 있습니다  만든 규칙을 방해하지 있도록 기본 ACL 규칙에 낮은 우선 순위가 부여됩니다.

## <a name="assigning-network-security-groups"></a>네트워크 보안 그룹 지정
네트워크 보안 그룹을 서브넷 또는 네트워크 인터페이스에 할당합니다. 이 접근 방식을 사용하면 ACL 규칙을 특정 Vm에만 적용할 때 필요에 따라 세부적일 수 있거나 또는 공통된 ACL 규칙 집합을 서브넷의 모든 Vm 부분에 적용하도록 할 수 있습니다.

![네트워크 인터페이스 또는 서브넷에 NSG 적용](./media/virtual-machines-common-endpoints-in-resource-manager/apply-nsg-to-resources.png)

네트워크 보안 그룹의 동작은 서브넷 또는 네트워크 인터페이스에 할당되었는지에 따라 달라지지 않습니다. 일반적인 배포 시나리오에는 네트워크 보안 그룹이 서브넷에 할당되어 있어 해당 서브넷에 연결된 모든 VM의 규정 준수를 보장합니다. 자세한 내용은 [네트워크 보안 그룹을 리소스에 적용](../articles/virtual-network/virtual-networks-nsg.md#associating-nsgs)을 참조하세요.

## <a name="default-behavior-of-network-security-groups"></a>네트워크 보안 그룹의 기본 동작
네트워크 보안 그룹을 만든 방법 및 시기에 따라, TCP 포트 3389에 RDP 액세스를 허용하도록 Windows VM에 대한 기본 규칙을 만들 수 있습니다. Linux VM에 대한 기본 규칙은 TCP 포트 22에 대한 SSH 액세스를 허용합니다. 이러한 자동 ACL 규칙은 다음 조건에서 만들어집니다.

* 포털을 통해 Windows VM을 만들고 기본 작업을 적용하여 네트워크 보안 그룹을 만들 경우 TCP 포트 3389(RDP)를 허용하는 ACL 규칙이 만들어집니다.
* 포털을 통해 Linux VM을 만들고 기본 작업을 적용하여 네트워크 보안 그룹을 만들 경우 TCP 포트 22(SSH)를 허용하는 ACL 규칙이 만들어집니다.

기타 모든 조건에서는 이러한 기본 ACL 규칙이 만들어지지 않습니다. 적절한 ACL 규칙을 만들지 않고 VM에 연결할 수 없습니다. 이러한 조건에는 다음과 같은 일반 작업이 포함됩니다.

* VM을 만들기 위한 별도 작업으로 포털을 통해 네트워크 보안 그룹 만들기.
* PowerShell, Azure CLI, Rest Api 등을 통해 프로그래밍 방식으로 네트워크 보안 그룹 만들기.
* VM을 만들어 아직 적절한 ACL 규칙이 정의되지 않은 기존의 네트워크 보안 그룹에 할당함 

이전의 모든 경우에서 적절한 원격 관리 연결을 허용하도록 VM에 대한 ACL 규칙을 만들어야 합니다.

## <a name="default-behavior-of-a-vm-without-a-network-security-group"></a>네트워크 보안 그룹이 없는 VM의 기본 동작
네트워크 보안 그룹을 만들지 않고 VM을 만들 수 있습니다. 이러한 상황에서 어떠한 ACL 규칙도 만들지 않고 RDP 또는 SSH를 사용하여 VM에 연결할 수 있습니다. 마찬가지로, 웹 서비스를 포트 80에 설치한 경우, 해당 서비스를 원격으로 자동 액세스할 수 있습니다. Vm에서 모든 포트가 열려 있습니다.

> [!NOTE]
> 여전히 공용 IP 주소를 모든 원격 연결을 위해 VM에 할당해야 합니다. 서브넷 또는 네트워크 인터페이스에 대한 네트워크 보안 그룹이 없는 경우 Vm은 모든 외부 트래픽에 노출되지 않습니다. 포털을 통해 VM을 만들 때의 기본 작업은 새 공용 IP 만들기입니다. PowerShell, Azure CLI 또는 Resource Manager 템플릿과 같은 기타 모든 형식의 VM을 만드는 경우 명시적으로 요청하지 않으면 공용 IP를 자동으로 생성하지 않습니다. 포털을 통한 기본 작업은 네트워크 보안 그룹을 만드는 것이기도 합니다. 이 기본 작업은 노출된 VM에 네트워크 필터링이 준비되지 않은 상황에 빠지지 않아야 함을 의미합니다.

## <a name="understanding-load-balancers-and-nat-rules"></a>부하 분산 장치 및 NAT 규칙 이해
클래식 배포 모델에서 포트 전달을 또한 수행하는 끝점을 만들 수 있습니다. 클래식 배포 모델에서 VM을 만들 때 RDP 또는 SSH에 대한 ACL 규칙을 자동으로 만듭니다. 이러한 규칙은 외부에 TCP 포트 3389 또는 TCP 포트 22를 각각 노출하지 않습니다. 대신 적절한 내부 포트에 매핑되는.높은 값 TCP 포트를 노출합니다. 또한 비슷한 방식으로 TCP 포트 4280의 웹 서버를 외부 세계에 노출하라와 같은 사용자 고유의 ACL 규칙을 만들 수 있습니다. 이러한 ACL 규칙 및 포트 매핑을 클래식 포털의 다음 스크린 샷에서 확인할 수 있습니다.

![클래식 끝점을 사용하여 포트 전달](./media/virtual-machines-common-endpoints-in-resource-manager/classic-endpoints-port-forwarding.png)

네트워크 보안 그룹을 사용하는 경우 포트 전달 함수는 부하 분산 장치에서 처리합니다. 자세한 내용은 [Azure의 부하 분산 장치](../articles/load-balancer/load-balancer-overview.md)를 참조하세요. 다음 예에서는 TCP 포트 4222에서 내부 TCP 포트 22로의 포트 전달을 수행하는 NAT 규칙이 있는 부하 분산 장치를 보여 줍니다.

![포트 전달에 대한 부하 분산 장치 NAT 규칙](./media/virtual-machines-common-endpoints-in-resource-manager/load-balancer-nat-rules.png)

> [!NOTE]
> 부하 분산 장치를 구현할 때 일반적으로 VM 자체를 공용 IP 주소에 할당하지 않습니다. 대신 부하 분산 장치에는 할당된 공용 IP 주소가 있습니다. Vm의 내외부 트래픽 흐름을 정의하기 위해 네트워크 보안 그룹 및 ACL 규칙을 만들어야 합니다. 부하 분산 장치 NAT 규칙은 단지 부하 분산 장치를 통해 어떤 포트가 허용되고 백 엔드 VM에 어떻게 분산되는지 정의하기 위한 것입니다. 따라서 부하 분산 장치를 통해 흐르는 트래픽에 대해 NAT 규칙을 만들어야 합니다. 트래픽이 VM에 도달할 수 있도록 하려면 네트워크 보안 그룹 ACL 규칙을 만듭니다.
