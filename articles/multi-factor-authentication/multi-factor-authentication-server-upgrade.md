---
title: "Azure MFA 서버 업그레이드 | Microsoft Docs"
description: "Azure Multi-factor Authentication 서버를 최신 버전으로 업그레이드하는 단계 및 지침입니다."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 50bb8ac3-5559-4d8b-a96a-799a74978b14
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: 6e4e09f8539aad56f92ad9137f4a6b9eb0d82370
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 07/11/2017
---
# <a name="upgrade-to-the-latest-azure-multi-factor-authentication-server"></a><span data-ttu-id="7af39-103">최신 Azure Multi-Factor Authentication 서버로 업그레이드</span><span class="sxs-lookup"><span data-stu-id="7af39-103">Upgrade to the latest Azure Multi-Factor Authentication Server</span></span>

<span data-ttu-id="7af39-104">이 문서에서는 Azure MFA(Multi-factor Authentication) 서버 v6.0 이상을 업그레이드하는 프로세스를 단계별로 안내합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-104">This article walks you through the process of upgrading Azure Multi-Factor Authentication (MFA) Server v6.0 or higher.</span></span> <span data-ttu-id="7af39-105">이전 버전의 PhoneFactor Agent를 업그레이드해야 하는 경우 [PhoneFactor Agent를 Azure Multi-factor Authentication 서버로 업그레이드](multi-factor-authentication-get-started-server-upgrade.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="7af39-105">If you need to upgrade an old version of the PhoneFactor Agent, refer to [Upgrade the PhoneFactor Agent to Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md).</span></span>

<span data-ttu-id="7af39-106">v6.x 이상에서 v7.x 또는 최신 버전으로 업그레이드하는 경우 모든 구성 요소가 .NET 2.0에서 .NET 4.5로 변경됩니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-106">If you're upgrading from v6.x or older to v7.x or newer, all components change from .NET 2.0 to .NET 4.5.</span></span> <span data-ttu-id="7af39-107">모든 구성 요소에는 Microsoft Visual C++ 2015 재배포 가능 패키지 업데이트 1 이상이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-107">All components also require Microsoft Visual C++ 2015 Redistributable Update 1 or higher.</span></span> <span data-ttu-id="7af39-108">이러한 구성 요소의 x86 및 x64 버전이 아직 설치되지 않았으면 MFA 서버 설치 관리자가 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-108">The MFA Server installer installs both the x86 and x64 versions of these components if they aren't already installed.</span></span> <span data-ttu-id="7af39-109">사용자 포털 및 모바일 앱 웹 서비스가 별도 서버에서 실행되는 경우 해당 구성 요소를 업그레이드하기 전에 해당 패키지를 설치해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-109">If the User Portal and Mobile App Web Service run on separate servers, you need to install those packages before upgrading those components.</span></span> <span data-ttu-id="7af39-110">[Microsoft 다운로드 센터](https://www.microsoft.com/en-us/download/)에서 최신 Microsoft Visual C++ 2015 재배포 가능 패키지 업데이트를 검색할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-110">You can search for the latest Microsoft Visual C++ 2015 Redistributable update on the [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span></span> 

## <a name="install-the-latest-version-of-azure-mfa-server"></a><span data-ttu-id="7af39-111">최신 버전의 Azure MFA 서버 설치</span><span class="sxs-lookup"><span data-stu-id="7af39-111">Install the latest version of Azure MFA Server</span></span>

1. <span data-ttu-id="7af39-112">[Azure Multi-factor Authentication 서버 다운로드](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server)의 지침을 사용하여 최신 버전의 Azure MFA 서버를 다운로드합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-112">Use the instructions in [Download the Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) to get the latest version of the Azure MFA Server.</span></span>
2. <span data-ttu-id="7af39-113">C:\Program Files\multi-factor Authentication Server\Data\PhoneFactor.pfdata(기본 설치 위치로 가정)에 있는 MFA 서버 데이터 파일의 백업을 마스터 MFA 서버에 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-113">Make a backup of the MFA Server data file located at C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (assuming the default install location) on your master MFA Server.</span></span>
3. <span data-ttu-id="7af39-114">고가용성을 위해 여러 서버를 실행하는 경우 업그레이드하려는 MFA 서버에 트래픽을 더 이상 전송하지 않도록 MFA 서버에서 인증을 받는 클라이언트 시스템을 변경합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-114">If you run multiple servers for high availability, change the client systems that authenticate to the MFA Server so that they stop sending traffic to the servers that are upgrading.</span></span> <span data-ttu-id="7af39-115">부하 분산 장치를 사용하는 경우 부하 분산 장치에서 MFA 서버를 제거하고 업그레이드한 후 해당 서버를 팜에 다시 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-115">If you use a load balancer, remove a MFA Server from the load balancer, do the upgrade, and then add the server back into the farm.</span></span>
4. <span data-ttu-id="7af39-116">각 MFA 서버에서 새 설치 관리자를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-116">Run the new installer on each MFA Server.</span></span> <span data-ttu-id="7af39-117">하위 서버는 마스터에 의해 복제되는 이전 데이터 파일을 읽을 수 있으므로 먼저 업그레이드합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-117">Upgrade subordinate servers first because they can read the old data file being replicated by the master.</span></span> 

  <span data-ttu-id="7af39-118">설치 관리자를 실행하기 전에 현재 MFA 서버를 제거할 필요는 없습니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-118">You do not need to uninstall your current MFA Server before running the installer.</span></span> <span data-ttu-id="7af39-119">설치 관리자는 전체 업그레이드를 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-119">The installer performs an in-place upgrade.</span></span> <span data-ttu-id="7af39-120">설치 경로는 이전 설치의 레지스트리에서 선택되므로 동일한 위치(예: C:\Program Files\PhoneFactor)에 설치됩니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-120">The installation path is picked up from the registry from the previous installation, so it installs in the same location (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> 
  
5. <span data-ttu-id="7af39-121">Microsoft Visual C++ 2015 재배포 가능 패키지 업데이트 패키지를 설치할 것인지 묻는 메시지가 표시되면 수락합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-121">If you're prompted to install a Microsoft Visual C++ 2015 Redistributable update package, accept the prompt.</span></span> <span data-ttu-id="7af39-122">x86 및 x64 버전 패키지가 모두 설치됩니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-122">Both the x86 and x64 versions of the package are installed.</span></span>
5. <span data-ttu-id="7af39-123">웹 서비스 SDK를 사용하는 경우 새 웹 서비스 SDK를 설치하라는 메시지가 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-123">If you use the Web Service SDK, you are prompted to install the new Web Service SDK.</span></span> <span data-ttu-id="7af39-124">새 웹 서비스 SDK를 설치하면 가상 디렉터리 이름이 이전에 설치된 가상 디렉터리(예: MultiFactorAuthWebServiceSdk)와 일치하는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-124">When you install the new Web Service SDK, make sure that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuthWebServiceSdk).</span></span>
6. <span data-ttu-id="7af39-125">모든 하위 서버에서 이 단계를 반복합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-125">Repeat the steps on all subordinate servers.</span></span> <span data-ttu-id="7af39-126">하위 서버 중 하나를 새 마스터 서버로 승격한 다음 이전 마스터 서버를 업그레이드합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-126">Promote one of the subordinates to be the new master, then upgrade the old master server.</span></span> 

## <a name="upgrade-the-user-portal"></a><span data-ttu-id="7af39-127">사용자 포털 업그레이드</span><span class="sxs-lookup"><span data-stu-id="7af39-127">Upgrade the User Portal</span></span>

1. <span data-ttu-id="7af39-128">사용자 포털 설치 위치의 가상 디렉터리(예: C:\inetpub\wwwroot\MultiFactorAuth)에 있는 web.config 파일의 백업을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-128">Make a backup of the web.config file that is in the virtual directory of the User Portal installation location (for example, C:\inetpub\wwwroot\MultiFactorAuth).</span></span> <span data-ttu-id="7af39-129">기본 테마를 변경한 경우 App_Themes\Default 폴더 백업도 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-129">If any changes were made to the default theme, make a backup of the App_Themes\Default folder as well.</span></span> <span data-ttu-id="7af39-130">기본 테마를 변경하는 것보다는 기본 폴더의 복사본을 만든 후 새 테마를 만드는 것이 더 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-130">It is better to create a copy of the Default folder and create a new theme than to change the Default theme.</span></span>
2. <span data-ttu-id="7af39-131">사용자 포털이 다른 MFA 서버 구성 요소가 있는 동일한 서버에서 실행되는 경우 MFA 서버 설치는 사용자 포털을 업데이트할 것인지 묻는 메시지를 표시합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-131">If the User Portal runs on the same server as the other MFA Server components, the MFA Server installation prompts you to update the User Portal.</span></span> <span data-ttu-id="7af39-132">메시지를 수락하고 사용자 포털 업데이트를 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-132">Accept the prompt and install the User Portal update.</span></span> <span data-ttu-id="7af39-133">가상 디렉터리 이름이 이전에 설치한 가상 디렉터리(예: MultiFactorAuth)와 일치하는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-133">Check that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuth).</span></span>
3. <span data-ttu-id="7af39-134">사용자 포털이 자체 서버에 있는 경우 MFA 서버 중 하나의 설치 위치에서 MultiFactorAuthenticationUserPortalSetup64.msi 파일을 복사한 후 사용자 포털 웹 서버에 저장합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-134">If the User Portal is on its own server, copy the MultiFactorAuthenticationUserPortalSetup64.msi file from the install location of one of the MFA Servers and put it onto the User Portal web server.</span></span> <span data-ttu-id="7af39-135">설치 관리자를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-135">Run the installer.</span></span> 

  <span data-ttu-id="7af39-136">“Microsoft Visual C++ 2015 재배포 가능 패키지 업데이트 1 이상이 필요하다”는 오류가 발생하는 경우 [Microsoft 다운로드 센터](https://www.microsoft.com/download/)에서 최신 업데이트 패키지를 다운로드하여 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-136">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="7af39-137">x86 및 x64 버전을 둘 다 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-137">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="7af39-138">업데이트된 사용자 포털 소프트웨어를 설치한 후에 1단계에서 백업한 web.config 파일을 새 web.config 파일과 비교합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-138">After the updated User Portal software is installed, compare the web.config backup you made in step 1 with the new web.config file.</span></span> <span data-ttu-id="7af39-139">새 web.config에 새 특성이 없으면 백업 web.config를 가상 디렉터리에 복사하여 새 파일을 덮어씁니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-139">If no new attributes exist in the new web.config, copy your backup web.config into the virtual directory to overwrite the new one.</span></span> <span data-ttu-id="7af39-140">또 다른 옵션은 백업 파일에서 appSettings 값 및 웹 서비스 SDK URL을 복사한 후 새 web.config에 붙여 넣습니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-140">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="7af39-141">여러 서버에 사용자 포털에 있는 경우 모든 서버에서 설치를 반복합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-141">If you have the User Portal on multiple servers, repeat the installation on all of them.</span></span> 


## <a name="upgrade-the-mobile-app-web-service"></a><span data-ttu-id="7af39-142">모바일 앱 웹 서비스 업그레이드</span><span class="sxs-lookup"><span data-stu-id="7af39-142">Upgrade the Mobile App Web Service</span></span>

1. <span data-ttu-id="7af39-143">모바일 앱 웹 서비스 설치 위치의 가상 디렉터리(예: C:C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService)에 있는 web.config 파일의 백업을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-143">Make a backup of the web.config file that is in the virtual directory of the Mobile App Web Service installation location (for example, C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span></span>
2. <span data-ttu-id="7af39-144">MFA 서버의 설치 위치에서 MultiFactorAuthenticationMobileAppWebServiceSetup64.msi 파일을 복사한 후 모바일 앱 등록 웹 서버에 저장합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-144">Copy the MultiFactorAuthenticationMobileAppWebServiceSetup64.msi file from the install location of the MFA Servers and put it onto the Mobile App registration web server.</span></span>
3. <span data-ttu-id="7af39-145">설치 관리자를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-145">Run the installer.</span></span> 

  <span data-ttu-id="7af39-146">Microsoft Visual C++ 2015 재배포 가능 패키지 업데이트 1 이상이 필요하다는 오류가 발생하는 경우 [Microsoft 다운로드 센터](https://www.microsoft.com/download/)에서 최신 업데이트 패키지를 다운로드하여 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-146">If an error occurs stating that Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required, download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="7af39-147">x86 및 x64 버전을 둘 다 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-147">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="7af39-148">업데이트된 Mobile App 웹 서비스 소프트웨어를 설치한 후 1단계에서 백업한 web.config 파일을 새 web.config 파일과 비교합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-148">After the updated Mobile App Web Service software installs, compare the web.config file that was backed up in step 1 with the new web.config file.</span></span> <span data-ttu-id="7af39-149">새 web.config에 새 특성이 없으면 저장한 web.config를 가상 디렉터리에 복사하여 새 파일을 덮어쓸 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-149">If no new attributes exist in the new web.config, you can copy your saved web.config back into the virtual directory and overwrite the new one.</span></span> <span data-ttu-id="7af39-150">또 다른 옵션은 백업 파일에서 appSettings 값 및 웹 서비스 SDK URL을 복사한 후 새 web.config에 붙여 넣습니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-150">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="7af39-151">여러 서버에 모바일 앱 웹 서비스가 있는 경우 모든 서버에서 설치를 반복합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-151">If you have the Mobile App Web Service on multiple servers, repeat the installation on all of them.</span></span> 

## <a name="upgrade-the-ad-fs-adapters"></a><span data-ttu-id="7af39-152">AD FS 어댑터 업그레이드</span><span class="sxs-lookup"><span data-stu-id="7af39-152">Upgrade the AD FS Adapters</span></span>


### <a name="if-mfa-runs-on-different-servers-than-ad-fs"></a><span data-ttu-id="7af39-153">MFA가 AD FS 이외의 다른 서버에서 실행되는 경우</span><span class="sxs-lookup"><span data-stu-id="7af39-153">If MFA runs on different servers than AD FS</span></span>

<span data-ttu-id="7af39-154">다음 지침은 AD FS 서버와는 별도로 Multi-factor Authentication 서버를 실행하는 경우에만 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-154">These instructions only apply if you run Multi-Factor Authentication Server separately from your AD FS servers.</span></span> <span data-ttu-id="7af39-155">두 서비스가 동일한 서버에서 실행되는 경우 이 섹션을 건너뛰고 설치 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-155">If both services run on the same servers, skip this section and go to the installation steps.</span></span> 

1. <span data-ttu-id="7af39-156">AD FS에서 등록된 MultiFactorAuthenticationAdfsAdapter.config 파일의 복사본을 저장하거나 PowerShell 명령 `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`을 사용하여 구성을 내보냅니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-156">Save a copy of the MultiFactorAuthenticationAdfsAdapter.config file that was registered in AD FS, or export the configuration using the following PowerShell command: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span></span> <span data-ttu-id="7af39-157">어댑터 이름은 이전에 설치한 버전에 따라 "WindowsAzureMultiFactorAuthentication" 또는 "AzureMfaServerAuthentication" 중 하나입니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-157">The adapter name is either "WindowsAzureMultiFactorAuthentication" or "AzureMfaServerAuthentication" depending on the version previously installed.</span></span>
2. <span data-ttu-id="7af39-158">MFA 서버 설치 위치의 다음 파일을 AD FS 서버로 복사합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-158">Copy the following files from the MFA Server installation location to the AD FS servers:</span></span>

  - <span data-ttu-id="7af39-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="7af39-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
  - <span data-ttu-id="7af39-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="7af39-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="7af39-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="7af39-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="7af39-162">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="7af39-162">MultiFactorAuthenticationAdfsAdapter.config</span></span>

3. <span data-ttu-id="7af39-163">`Register-AdfsAuthenticationProvider` 명령의 끝에 `-ConfigurationFilePath [path]`를 추가하여 Register-MultiFactorAuthenticationAdfsAdapter.ps1 스크립트를 편집합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-163">Edit the Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding `-ConfigurationFilePath [path]` to the end of the `Register-AdfsAuthenticationProvider` command.</span></span> <span data-ttu-id="7af39-164">*[path]*를 MultiFactorAuthenticationAdfsAdapter.config 파일에 대한 전체 경로 또는 이전 단계에서 내보낸 구성 파일로 바꿉니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-164">Replace *[path]* with the full path to the MultiFactorAuthenticationAdfsAdapter.config file or the configuration file exported in the previous step.</span></span> 

  <span data-ttu-id="7af39-165">새 MultiFactorAuthenticationAdfsAdapter.config의 특성이 이전 구성 파일과 일치하는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-165">Check the attributes in the new MultiFactorAuthenticationAdfsAdapter.config to see if they match the old config file.</span></span> <span data-ttu-id="7af39-166">새 버전에서 특성이 추가되었거나 제거된 경우 이전 구성 파일에서 새 파일로 특성 값을 복사하거나 새 구성과 일치하도록 이전 구성 파일을 수정합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-166">If any attributes were added or removed in the new version, copy the attribute values from the old configuration file to the new one or modify the old configuration file to match.</span></span>

### <a name="install-new-ad-fs-adapters"></a><span data-ttu-id="7af39-167">새 AD FS 어댑터 설치</span><span class="sxs-lookup"><span data-stu-id="7af39-167">Install new AD FS adapters</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="7af39-168">사용자는 이 섹션의 3-8단계 동안 2단계 확인을 수행할 필요가 없습니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-168">Your users will not be required to perform two-step verification during steps 3-8 of this section.</span></span> <span data-ttu-id="7af39-169">여러 개의 클러스터에 AD FS가 구성되어 있으면 가동 중단을 피하기 위해 다른 클러스터와는 별도로 팜의 각 클러스터를 제거, 업그레이드 및 복원할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-169">If you have AD FS configured in multiple clusters, you can remove, upgrade, and restore each cluster in the farm independently of the other clusters to avoid downtime.</span></span>

1. <span data-ttu-id="7af39-170">팜에서 일부 AD FS 서버를 제거합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-170">Remove some AD FS servers from the farm.</span></span> <span data-ttu-id="7af39-171">다른 서버가 여전히 실행되는 동안 이러한 서버를 업데이트합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-171">Update these servers while the others are still running.</span></span>
2. <span data-ttu-id="7af39-172">AD FS 팜에서 제거된 각 서버에 새 AD FS 어댑터를 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-172">Install the new AD FS adapter on each server removed from the AD FS farm.</span></span> <span data-ttu-id="7af39-173">MFA 서버가 각 AD FS 서버에 설치된 경우 MFA 서버 관리자 UX를 통해 업데이트할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-173">If the MFA Server is installed on each AD FS server, you can update through the MFA Server admin UX.</span></span> <span data-ttu-id="7af39-174">그렇지 않으면 MultiFactorAuthenticationAdfsAdapterSetup64.msi를 실행하여 업데이트합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-174">Otherwise, update by running MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span></span> 

  <span data-ttu-id="7af39-175">“Microsoft Visual C++ 2015 재배포 가능 패키지 업데이트 1 이상이 필요하다”는 오류가 발생하는 경우 [Microsoft 다운로드 센터](https://www.microsoft.com/download/)에서 최신 업데이트 패키지를 다운로드하여 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-175">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="7af39-176">x86 및 x64 버전을 둘 다 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-176">Install both the x86 and x64 versions.</span></span>

3. <span data-ttu-id="7af39-177">**AD FS** > **인증 정책** > **전역 다단계 인증 정책 편집**으로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-177">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="7af39-178">**WindowsAzureMultiFactorAuthentication** 또는 **AzureMFAServerAuthentication**(현재 설치된 버전에 따라 다름)을 선택 취소합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-178">Uncheck **WindowsAzureMultiFactorAuthentication** or **AzureMFAServerAuthentication** (depending on the current version installed).</span></span> 

  <span data-ttu-id="7af39-179">이 단계가 완료되면 8단계를 완료할 때까지 이 AD FS 클러스터에서 MFA 서버를 통한 2단계 인증을 사용할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-179">Once this step is complete, two-step verification through MFA Server is not available in this AD FS cluster until you complete step 8.</span></span>

4. <span data-ttu-id="7af39-180">Unregister-multifactorauthenticationadfsadapter.ps1 PowerShell 스크립트를 실행하여 이전 버전의 AD FS 어댑터를 등록 취소합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-180">Unregister the older version of the AD FS adapter by running the Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="7af39-181">*-Name* 매개 변수("WindowsAzureMultiFactorAuthentication" 또는 "AzureMFAServerAuthentication")가 3단계에 표시된 이름과 일치하는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-181">Ensure that the *-Name* parameter (either “WindowsAzureMultiFactorAuthentication” or "AzureMFAServerAuthentication") matches the name that was displayed in step 3.</span></span> <span data-ttu-id="7af39-182">하나의 중앙 구성이 있으므로 동일한 AD FS 클러스터의 모든 서버도 마찬가지입니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-182">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
5. <span data-ttu-id="7af39-183">Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell 스크립트를 실행하여 새 AD FS 어댑터를 등록합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-183">Register the new AD FS adapter by running the Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="7af39-184">하나의 중앙 구성이 있으므로 동일한 AD FS 클러스터의 모든 서버도 마찬가지입니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-184">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
6. <span data-ttu-id="7af39-185">AD FS 팜에서 제거된 각 서버에서 AD FS 서비스를 다시 시작합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-185">Restart the AD FS service on each server removed from the AD FS farm.</span></span>
7. <span data-ttu-id="7af39-186">업데이트된 서버를 AD FS 팜에 다시 추가하고 팜에서 다른 서버를 제거합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-186">Add the updated servers back to the AD FS farm and remove the other servers from the farm.</span></span>
8. <span data-ttu-id="7af39-187">**AD FS** > **인증 정책** > **전역 다단계 인증 정책 편집**으로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-187">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="7af39-188">**AzureMfaServerAuthentication**을 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-188">Check **AzureMfaServerAuthentication**.</span></span>
9. <span data-ttu-id="7af39-189">2단계를 반복하여 AD FS 팜에서 제거된 서버를 업데이트하고 해당 서버에서 AD FS 서비스를 다시 시작합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-189">Repeat step 2 to update the servers now removed from the AD FS farm and restart the AD FS service on those servers.</span></span>
10. <span data-ttu-id="7af39-190">해당 서버를 AD FS 팜에 다시 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="7af39-190">Add those servers back into the AD FS farm.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7af39-191">다음 단계</span><span class="sxs-lookup"><span data-stu-id="7af39-191">Next steps</span></span>

- <span data-ttu-id="7af39-192">[Azure Multi-Factor Authentication 및 타사 VPN을 사용한 고급 시나리오](multi-factor-authentication-advanced-vpn-configurations.md) 예제 보기</span><span class="sxs-lookup"><span data-stu-id="7af39-192">Get examples of [Advanced scenarios with Azure Multi-Factor Authentication and third-party VPNs](multi-factor-authentication-advanced-vpn-configurations.md)</span></span>

- [<span data-ttu-id="7af39-193">MFA 서버를 Windows Server Active Directory와 동기화</span><span class="sxs-lookup"><span data-stu-id="7af39-193">Synchronize MFA Server with Windows Server Active Directory</span></span>](multi-factor-authentication-get-started-server-dirint.md)

- <span data-ttu-id="7af39-194">응용 프로그램에 대한 [Windows 인증 구성](multi-factor-authentication-get-started-server-windows.md)</span><span class="sxs-lookup"><span data-stu-id="7af39-194">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications</span></span>
