---
title: "모든 Azure AD 사용자에게 로그인할 수 있는 앱 작성 방법 | Microsoft Docs"
description: "모든 Azure Active Directory 테넌트로부터 사용자를 로그인할 수 있게 하는 응용 프로그램(또는 다중 테넌트 응용 프로그램으로 알려짐)을 빌드하기 위한 단계별 지침."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 35af95cb-ced3-46ad-b01d-5d2f6fd064a3
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 04/26/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: f1c79fa7e3b0e160487b5941741f6a6c677c6b81
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-sign-in-any-azure-active-directory-ad-user-using-the-multi-tenant-application-pattern"></a><span data-ttu-id="430bd-103">다중 테넌트 응용 프로그램 패턴을 사용하여 모든 Azure Active Directory (AD) 사용자를 로그인하는 방법</span><span class="sxs-lookup"><span data-stu-id="430bd-103">How to sign in any Azure Active Directory (AD) user using the multi-tenant application pattern</span></span>
<span data-ttu-id="430bd-104">소프트웨어를 서비스 응용 프로그램으로 많은 조직에 제공하는 경우, 어떠한 Azure AD 테넌트에서나 로그인을 허용하도록 응용 프로그램을 구성할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-104">If you offer a Software as a Service application to many organizations, you can configure your application to accept sign-ins from any Azure AD tenant.</span></span>  <span data-ttu-id="430bd-105">Azure AD에서는 이를 두고 다중 테넌트 응용 프로그램을 만드는 것이라고 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-105">In Azure AD this is called making your application multi-tenant.</span></span>  <span data-ttu-id="430bd-106">모든 Azure AD 테넌트의 사용자는 응용 프로그램에 계정을 사용하기로 동의한 후 응용 프로그램에 로그인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-106">Users in any Azure AD tenant will be able to sign in to your application after consenting to use their account with your application.</span></span>  

<span data-ttu-id="430bd-107">기존 응용 프로그램에 자체 계정 시스템이 있거나 다른 클라우드 공급자에서 비롯된 다른 종류의 로그인을 지원하는 경우 테넌트의 Azure AD 로그인을 간단하게 추가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-107">If you have an existing application that has its own account system, or supports other kinds of sign-in from other cloud providers, adding Azure AD sign-in from any tenant is simple.</span></span> <span data-ttu-id="430bd-108">앱을 등록하고 OAuth2, OpenID Connect 또는 SAML을 통해 로그인 코드를 추가하고 응용 프로그램에 "Microsoft를 사용하여 로그인" 단추를 배치합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-108">Just register your app, add sign-in code via OAuth2, OpenID Connect, or SAML, and put a "Sign In with Microsoft" button on your application.</span></span> <span data-ttu-id="430bd-109">다음과 같은 단추를 클릭하여 응용 프로그램을 브랜딩하는 방법에 대해 자세히 알아보세요.</span><span class="sxs-lookup"><span data-stu-id="430bd-109">Click the following button to learn more about branding your application.</span></span>

<span data-ttu-id="430bd-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="430bd-110">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="430bd-111">이 문서에서는 사용자가 Azure AD에 대한 단일 테넌트 응용 프로그램을 빌드하는 것에 이미 익숙하다고 가정합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-111">This article assumes you’re already familiar with building a single tenant application for Azure AD.</span></span>  <span data-ttu-id="430bd-112">잘 알지 못할 경우 [개발자 가이드 홈페이지][AAD-Dev-Guide]로 돌아가 빠른 시작 중 하나를 시도합니다!</span><span class="sxs-lookup"><span data-stu-id="430bd-112">If you’re not, head back up to the [developer guide homepage][AAD-Dev-Guide] and try one of our quick starts!</span></span>

<span data-ttu-id="430bd-113">다음과 같은 간단한 4 단게를 통해 응용 프로그램을 Azure AD 다중 테넌트 앱으로 변환할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-113">There are four simple steps to convert your application into an Azure AD multi-tenant app:</span></span>

1. <span data-ttu-id="430bd-114">응용 프로그램 등록을 다중 테넌트로 업데이트합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-114">Update your application registration to be multi-tenant</span></span>
2. <span data-ttu-id="430bd-115">/common 끝점에 요청을 보내도록 코드를 업데이트합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-115">Update your code to send requests to the /common endpoint</span></span> 
3. <span data-ttu-id="430bd-116">여러 발급자 값을 처리하는 코드를 업데이트합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-116">Update your code to handle multiple issuer values</span></span>
4. <span data-ttu-id="430bd-117">사용자 및 관리자 동의를 이해하고 적절한 코드 변경을 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-117">Understand user and admin consent and make appropriate code changes</span></span>

<span data-ttu-id="430bd-118">각 단계를 자세히 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-118">Let’s look at each step in detail.</span></span> <span data-ttu-id="430bd-119">또한 [이 다중 테넌트 샘플 목록][AAD-Samples-MT]으로 바로 건너뛸 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-119">You can also jump straight to [this list of multi-tenant samples][AAD-Samples-MT].</span></span>

## <a name="update-registration-to-be-multi-tenant"></a><span data-ttu-id="430bd-120">등록을 다중 테넌트로 업데이트합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-120">Update registration to be multi-tenant</span></span>
<span data-ttu-id="430bd-121">기본적으로 Azure AD에서 웹앱/API 등록은 단일 테넌트입니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-121">By default, web app/API registrations in Azure AD are single tenant.</span></span>  <span data-ttu-id="430bd-122">[Azure Portal][AZURE-portal]에 있는 응용 프로그램 등록의 속성 페이지에서 "다중 테넌트" 스위치를 찾아 "예"로 설정함으로써 등록을 다중 테넌트로 만들 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-122">You can make your registration multi-tenant by finding the “Multi-Tenanted” switch on the properties page of your application registration in the [Azure portal][AZURE-portal] and setting it to “Yes”.</span></span>

<span data-ttu-id="430bd-123">응용 프로그램을 다중 테넌트로 만들기 위해서는 먼저 응용 프로그램의 앱 ID URI이 전역적으로 고유하게 되는 것을 Azure AD에서 필요로 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-123">Also note, before an application can be made multi-tenant, Azure AD requires the App ID URI of the application to be globally unique.</span></span> <span data-ttu-id="430bd-124">앱 ID URI는 프로토콜 메시지에서 응용 프로그램을 식별하는 방법 중 하나입니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-124">The App ID URI is one of the ways an application is identified in protocol messages.</span></span>  <span data-ttu-id="430bd-125">단일 테넌트 응용 프로그램의 경우 앱 ID URI이 해당 테넌트 내에서 고유한 것으로 충분합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-125">For a single tenant application, it is sufficient for the App ID URI to be unique within that tenant.</span></span>  <span data-ttu-id="430bd-126">다중 테넌트 응용 프로그램의 경우, 앱 ID URI이 전역적으로 고유해야 Azure AD가 모든 테넌트에서 응용 프로그램을 찾을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-126">For a multi-tenant application, it must be globally unique so Azure AD can find the application across all tenants.</span></span>  <span data-ttu-id="430bd-127">앱 ID URI이 Azure AD 테넌트의 확인된 도메인과 일치하는 호스트 이름을 갖게 함으로써 전역 고유성이 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-127">Global uniqueness is enforced by requiring the App ID URI to have a host name that matches a verified domain of the Azure AD tenant.</span></span>  <span data-ttu-id="430bd-128">예를 들어, 테넌트의 이름이 contoso.onmicrosoft.com이라면 유효한 앱 ID URI은 `https://contoso.onmicrosoft.com/myapp`이 될 것입니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-128">For example, if the name of your tenant was contoso.onmicrosoft.com then a valid App ID URI would be `https://contoso.onmicrosoft.com/myapp`.</span></span>  <span data-ttu-id="430bd-129">테넌트가 확인된 도메인 `contoso.com`를 가진 경우, 유효한 앱 ID URI은 또한 `https://contoso.com/myapp`이 됩니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-129">If your tenant had a verified domain of `contoso.com`, then a valid App ID URI would also be `https://contoso.com/myapp`.</span></span>  <span data-ttu-id="430bd-130">앱 ID URI이 이 패턴을 따르지 않는다면 응용 프로그램을 다중 테넌트로 설정하는 것은 실패합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-130">Setting an application as multi-tenant will fail if the App ID URI doesn’t follow this pattern.</span></span>

<span data-ttu-id="430bd-131">기본 클라이언트 등록은 기본적으로 다중 테넌트입니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-131">Native client registrations are multi-tenant by default.</span></span>  <span data-ttu-id="430bd-132">기본 클라이언트 응용 프로그램 등록을 다중 테넌트로 만들기 위해 아무 조치도 취할 필요가 없습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-132">You don’t need to take any action to make a native client application registration multi-tenant.</span></span>

## <a name="update-your-code-to-send-requests-to-common"></a><span data-ttu-id="430bd-133">/common에 요청을 보내도록 코드를 업데이트합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-133">Update your code to send requests to /common</span></span>
<span data-ttu-id="430bd-134">단일 테넌트 응용 프로그램에서 로그인 요청은 테넌트의 로그인 끝점에 전송됩니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-134">In a single tenant application, sign-in requests are sent to the tenant’s sign-in endpoint.</span></span> <span data-ttu-id="430bd-135">예를 들어 contoso.onmicrosoft.com의 끝점은 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-135">For example, for contoso.onmicrosoft.com the endpoint would be:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="430bd-136">테넌트의 끝점에 보내진 요청은 그 테넌트에 있는 사용자 (또는 게스트)를 그 테넌트의 응용 프로그램으로 로그인하게 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-136">Requests sent to a tenant’s endpoint can sign in users (or guests) in that tenant to applications in that tenant.</span></span>  <span data-ttu-id="430bd-137">다중 테넌트 응용 프로그램을 사용할 경우, 응용 프로그램은 사용자가 어떤 테넌트에서 오는지 미리 알지 못하므로 요청을 테넌트 끝점에 보낼 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-137">With a multi-tenant application, the application doesn’t know up front what tenant the user is from, so you can’t send requests to a tenant’s endpoint.</span></span>  <span data-ttu-id="430bd-138">대신, 요청은 모든 Azure AD 테넌트 간에 멀티플렉싱하는 끝점에 전송됩니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-138">Instead, requests are sent to an endpoint that multiplexes across all Azure AD tenants:</span></span>

    https://login.microsoftonline.com/common

<span data-ttu-id="430bd-139">Azure AD는 /common 끝점에서 요청을 받을 때, 사용자를 로그인하고 그 결과 사용자가 어떤 테넌트에서 오는지 검색합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-139">When Azure AD receives a request on the /common endpoint, it signs the user in and as a consequence discovers which tenant the user is from.</span></span>  <span data-ttu-id="430bd-140">/common 끝점은 Azure AD에서 지원하는 OpenID Connect, OAuth 2.0, SAML 2.0 및 WS-Federation과 같은 모든 인증 프로토콜에서 작동합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-140">The /common endpoint works with all of the authentication protocols supported by Azure AD:  OpenID Connect, OAuth 2.0, SAML 2.0, and WS-Federation.</span></span>

<span data-ttu-id="430bd-141">그 경우 응용 프로그램에 대한 로그인 응답에는 사용자를 나타내는 토큰이 들어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-141">The sign-in response to the application then contains a token representing the user.</span></span>  <span data-ttu-id="430bd-142">응용 프로그램은 토큰에 든 발급자 값을 보고 사용자가 어떤 테넌트에서 오는지 알게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-142">The issuer value in the token tells an application what tenant the user is from.</span></span>  <span data-ttu-id="430bd-143">응답이 /Common 끝점에서 반환될 때, 토큰에 든 발급자 값이 사용자의 테넌트에 해당합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-143">When a response returns from the /common endpoint, the issuer value in the token will correspond to the user’s tenant.</span></span>  <span data-ttu-id="430bd-144">/common 끝점은 테넌트도 아니고 발급자도 아니며, 단지 멀티플렉서이라는 것을 인식하는 것이 중요합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-144">It’s important to note the /common endpoint is not a tenant and is not an issuer, it’s just a multiplexer.</span></span>  <span data-ttu-id="430bd-145">/Common을 사용할 때, 응용 프로그램에서 토큰의 유효성을 검사하는 논리는 이 점을 고려하도록 업데이트되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-145">When using /common, the logic in your application to validate tokens needs to be updated to take this into account.</span></span> 

<span data-ttu-id="430bd-146">앞서 언급한 대로, 다중 테넌트 응용 프로그램은 Azure AD 응용 프로그램 브랜딩 지침에 따라 사용자에 대한 일관된 로그인 환경도 제공해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-146">As mentioned earlier, multi-tenant applications should also provide a consistent sign-in experience for users, following the Azure AD application branding guidelines.</span></span> <span data-ttu-id="430bd-147">다음과 같은 단추를 클릭하여 응용 프로그램을 브랜딩하는 방법에 대해 자세히 알아보세요.</span><span class="sxs-lookup"><span data-stu-id="430bd-147">Click the following button to learn more about branding your application.</span></span>

<span data-ttu-id="430bd-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="430bd-148">[![Sign in button][AAD-Sign-In]][AAD-App-Branding]</span></span>

<span data-ttu-id="430bd-149">/공통된 끝점과 코드 구현 사용에 대해 자세히 알아보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-149">Let’s take a look at the use of the /common endpoint and your code implementation in more detail.</span></span>

## <a name="update-your-code-to-handle-multiple-issuer-values"></a><span data-ttu-id="430bd-150">여러 발급자 값을 처리하는 코드를 업데이트합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-150">Update your code to handle multiple issuer values</span></span>
<span data-ttu-id="430bd-151">웹 응용 프로그램 및 웹 API는 Azure AD에서 토큰을 받아 유효성을 검사합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-151">Web applications and web APIs receive and validate tokens from Azure AD.</span></span>  

> [!NOTE]
> <span data-ttu-id="430bd-152">네이티브 클라이언트 응용 프로그램은 Azure AD에 토큰을 요청하고 수신하는 동안에 API로 보내 유효성 검사를 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-152">While native client applications request and receive tokens from Azure AD, they do so to send them to APIs, where they are validated.</span></span>  <span data-ttu-id="430bd-153">네이티브 응용 프로그램은 토큰의 유효성을 검사하지 않으며 그것을 불투명한 것으로 처리해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-153">Native applications do not validate tokens and must treat them as opaque.</span></span>
> 
> 

<span data-ttu-id="430bd-154">응용 프로그램이 Azure AD에서 수신한 토큰의 유효성을 검사하는 방법을 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-154">Let’s look at how an application validates tokens it receives from Azure AD.</span></span>  <span data-ttu-id="430bd-155">단일 테넌트 응용 프로그램은 일반적으로 다음과 같은 끝점 값을 취합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-155">A single tenant application will normally take an endpoint value like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com

<span data-ttu-id="430bd-156">그리고 그것을 사용하여 다음과 같은 메타데이터 URL(이 경우에는 OpenID Connect)을 생성합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-156">and use it to construct a metadata URL (in this case, OpenID Connect) like:</span></span>

    https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration

<span data-ttu-id="430bd-157">이는 토큰의 유효성을 검사하는 데 사용할 두 가지 중요한 정보인 테넌트 서명 키와 발급자 값을 다운로드하기 위해서입니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-157">to download two critical pieces of information that are used to validate tokens:  the tenant’s signing keys and issuer value.</span></span>  <span data-ttu-id="430bd-158">각 Azure AD 테넌트에는 양식의 고유한 발급자 값이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-158">Each Azure AD tenant has a unique issuer value of the form:</span></span>

    https://sts.windows.net/31537af4-6d77-4bb9-a681-d2394888ea26/

<span data-ttu-id="430bd-159">여기서 GUID 값은 테넌트의 테넌트 ID 이름 바꾸기 안전 버전입니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-159">where the GUID value is the rename-safe version of the tenant ID of the tenant.</span></span>  <span data-ttu-id="430bd-160">`contoso.onmicrosoft.com`에 대한 이전의 메타데이터 링크를 클릭하면 문서에서 이 발급자 값을 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-160">If you click on the preceding metadata link for `contoso.onmicrosoft.com`, you can see this issuer value in the document.</span></span>

<span data-ttu-id="430bd-161">단일 테넌트 응용 프로그램이 토큰의 유효성을 검사하는 경우 메타데이터 문서에서 서명 키에 대해 토큰의 서명을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-161">When a single tenant application validates a token, it checks the signature of the token against the signing keys from the metadata document.</span></span> <span data-ttu-id="430bd-162">이렇게 하면 토큰의 발급자 값이 메타데이터 문서에서 찾은 값과 일치하는지 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-162">This allows it to make sure the issuer value in the token matches the one that was found in the metadata document.</span></span>

<span data-ttu-id="430bd-163">/common 끝점은 테넌트에 해당하지 않고 발급자가 아니기 때문에, /common에 대해 메타데이터의 발급자 값을 검토할 때 실제값 대신에 템플릿 기반 URL이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-163">Since the /common endpoint doesn’t correspond to a tenant and isn’t an issuer, when you examine the issuer value in the metadata for /common it has a templated URL instead of an actual value:</span></span>

    https://sts.windows.net/{tenantid}/

<span data-ttu-id="430bd-164">따라서 다중 테넌트 응용 프로그램은 메타데이터의 발급자 값을 토큰의 `issuer` 값과 맞춰보는 것만으로는 토큰의 유효성을 검사할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-164">Therefore, a multi-tenant application can’t validate tokens just by matching the issuer value in the metadata with the `issuer` value in the token.</span></span>  <span data-ttu-id="430bd-165">다중 테넌트 응용 프로그램은 발급자 값의 테넌트 ID 부분을 기반으로 어떤 발급자 값이 유효하고 어떤 값이 아닌지 판단할 논리를 필요로 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-165">A multi-tenant application needs logic to decide which issuer values are valid and which are not, based on the tenant ID portion of the issuer value.</span></span>  

<span data-ttu-id="430bd-166">예를 들어, 다중 테넌트 응용 프로그램이 해당 서비스에 등록한 특정 테넌트로부터의 로그인 만을 허용한다면, 테넌트가 구독자 목록에 들어 있는지 확인하기 위해 발급자 값 또는 토큰의 `tid` 클레임 값을 확인해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-166">For example, if a multi-tenant application only allows sign-in from specific tenants who have signed up for their service, then it must check either the issuer value or the `tid` claim value in the token to make sure that tenant is in their list of subscribers.</span></span>  <span data-ttu-id="430bd-167">다중 테넌트 응용 프로그램이 개인 만을 다루고 테넌트 기반으로 어떠한 액세스 결정도 하지 않는다면, 발급자 값 전체를 무시할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-167">If a multi-tenant application only deals with individuals and doesn’t make any access decisions based on tenants, then it can ignore the issuer value altogether.</span></span>

<span data-ttu-id="430bd-168">다중 테넌트 샘플에서, 이 문서의 끝에 나오는 [관련 콘텐츠](#related-content) 섹션에서 로그인하는 데 Azure AD 테넌트를 사용하도록 설정하기 위해 발급자 유효성 검사를 사용하지 않도록 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-168">In the multi-tenant samples in the [Related Content](#related-content) section at the end of this article, issuer validation is disabled to enable any Azure AD tenant to sign in.</span></span>

<span data-ttu-id="430bd-169">이제 다중 테넌트 응용 프로그램에 로그인하는 사용자를 위한 사용자 환경을 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-169">Now let’s look at the user experience for users that are signing in to multi-tenant applications.</span></span>

## <a name="understanding-user-and-admin-consent"></a><span data-ttu-id="430bd-170">사용자 및 관리자 동의 이해하기</span><span class="sxs-lookup"><span data-stu-id="430bd-170">Understanding user and admin consent</span></span>
<span data-ttu-id="430bd-171">사용자가 Azure AD에서 응용 프로그램에 로그인하려면 응용 프로그램이 사용자의 테넌트에 나타나야 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-171">For a user to sign in to an application in Azure AD, the application must be represented in the user’s tenant.</span></span>  <span data-ttu-id="430bd-172">이를 통해 조직은 사용자가 테넌트로부터 응용 프로그램에 로그인할 때 고유한 정책을 적용하는 것과 같은 작업을 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-172">This allows the organization to do things like apply unique policies when users from their tenant sign in to the application.</span></span>  <span data-ttu-id="430bd-173">단일 테넌트 응용 프로그램의 경우 이 등록은 간단합니다. [Azure Portal][AZURE-portal]에서 응용 프로그램을 등록할 때 이루어집니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-173">For a single tenant application, this registration is simple; it’s the one that happens when you register the application in the [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="430bd-174">다중 테넌트 응용 프로그램의 경우, 응용 프로그램에 대한 초기 등록은 개발자가 사용한 Azure AD 테넌트에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-174">For a multi-tenant application, the initial registration for the application lives in the Azure AD tenant used by the developer.</span></span>  <span data-ttu-id="430bd-175">다른 테넌트에서 사용자가 처음으로 응용 프로그램에 로그인할 때, Azure AD는 응용 프로그램에서 요청하는 사용 권한에 동의하는지 묻습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-175">When a user from a different tenant signs in to the application for the first time, Azure AD asks them to consent to the permissions requested by the application.</span></span>  <span data-ttu-id="430bd-176">동의한다면 *서비스 주체*라는 응용 프로그램의 표현이 사용자 테넌트에 생성되고 로그인은 계속 진행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-176">If they consent, then a representation of the application called a *service principal* is created in the user’s tenant, and sign-in can continue.</span></span> <span data-ttu-id="430bd-177">위임이 또한 사용자의 동의를 응용 프로그램에 기록하는 디렉토리에 만들어집니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-177">A delegation is also created in the directory that records the user’s consent to the application.</span></span> <span data-ttu-id="430bd-178">응용 프로그램의 Application 및 ServicePrincipal 개체와 서로 간의 관계에 대한 자세한 내용은 [응용 프로그램 개체 및 서비스 주체 개체][AAD-App-SP-Objects]를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="430bd-178">See [Application Objects and Service Principal Objects][AAD-App-SP-Objects] for details on the application's Application and ServicePrincipal objects, and how they relate to each other.</span></span>

![단일 계층 앱에 동의][Consent-Single-Tier] 

<span data-ttu-id="430bd-180">이 동의 환경이 응용 프로그램에서 요청한 사용 권한에 따른 영향을 받습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-180">This consent experience is affected by the permissions requested by the application.</span></span>  <span data-ttu-id="430bd-181">Azure AD에서는 응용 프로그램 전용과 위임이란 두 유형의 사용 권한을 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-181">Azure AD supports two kinds of permissions, app-only and delegated:</span></span>

* <span data-ttu-id="430bd-182">위임된 권한은 응용 프로그램에 사용자가 할 수 있는 작업의 하위 집합에 대해 로그인한 사용자 역할을 할 기능을 부여합니다,</span><span class="sxs-lookup"><span data-stu-id="430bd-182">A delegated permission grants an application the ability to act as a signed in user for a subset of the things the user can do.</span></span>  <span data-ttu-id="430bd-183">예를 들어 응용 프로그램에 위임된 권한을 부여하여 로그인한 사용자의 일정을 읽게 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-183">For example, you can grant an application the delegated permission to read the signed in user’s calendar.</span></span>
* <span data-ttu-id="430bd-184">응용 프로그램 전용 권한은 응용 프로그램의 id에 직접 부여됩니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-184">An app-only permission is granted directly to the identity of the application.</span></span>  <span data-ttu-id="430bd-185">예를 들어 누가 응용 프로그램에 로그인했는지에 상관없이 응용 프로그램에 응용 프로그램 전용 권한을 부여하여 테넌트의 사용자 목록을 읽게 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-185">For example, you can grant an application the app-only permission to read the list of users in a tenant, regardless of who is signed in to the application.</span></span>

<span data-ttu-id="430bd-186">일부 사용 권한은 일반 사용자가 동의할 수 있는 반면 또 다른 사용 권한은 테넌트 관리자의 동의가 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-186">Some permissions can be consented to by a regular user, while others require a tenant administrator’s consent.</span></span> 

### <a name="admin-consent"></a><span data-ttu-id="430bd-187">관리자 동의</span><span class="sxs-lookup"><span data-stu-id="430bd-187">Admin consent</span></span>
<span data-ttu-id="430bd-188">응용 프로그램 전용 권한은 테넌트 관리자의 동의를 항상 필요로 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-188">App-only permissions always require a tenant administrator’s consent.</span></span>  <span data-ttu-id="430bd-189">응용 프로그램이 응용 프로그램 전용 사용 권한을 요청하고 사용자가 응용 프로그램에 로그인을 시도하는 경우 사용자가 동의할 수 없음을 알리는 오류 메시지가 나타납니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-189">If your application requests an app-only permission and a user tries to sign in to the application, an error message will be displayed saying the user isn’t able to consent.</span></span>

<span data-ttu-id="430bd-190">위임된 특정 권한은 또한 테넌트 관리자의 동의를 필요로 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-190">Certain delegated permissions also require a tenant administrator’s consent.</span></span>  <span data-ttu-id="430bd-191">예를 들어, 로그인한 사용자로 Azure AD에 쓰기 저장 기능은 테넌트 관리자의 동의가 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-191">For example, the ability to write back to Azure AD as the signed in user requires a tenant administrator’s consent.</span></span>  <span data-ttu-id="430bd-192">응용 프로그램 전용 권한과 같이, 일반 사용자가 관리자 동의가 필요한 위임된 권한을 요청하는 응용 프로그램에 로그인하려는 경우 응용 프로그램에 오류가 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-192">Like app-only permissions, if an ordinary user tries to sign in to an application that requests a delegated permission that requires administrator consent, your application will receive an error.</span></span>  <span data-ttu-id="430bd-193">사용 권한이 관리자 동의를 필요로 하는지 여부는 리소스를 게시한 개발자에 의해 결정되며 리스스에 대한 설명서에서 찾아볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-193">Whether or not a permission requires admin consent is determined by the developer that published the resource, and can be found in the documentation for the resource.</span></span>  <span data-ttu-id="430bd-194">Azure AD Graph API 및 Microsoft Graph API에 대해 사용할 수 있는 권한을 설명하는 항목에 대한 링크는 이 문서의 [관련 콘텐츠](#related-content) 섹션에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-194">Links to topics describing the available permissions for the Azure AD Graph API and Microsoft Graph API are in the [Related Content](#related-content) section of this article.</span></span>

<span data-ttu-id="430bd-195">응용 프로그램이 관리자 동의가 필요한 권한을 사용할 경우, 관리자가 작업을 시작할 수 있도록 단추나 링크와 같은 제스처가 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-195">If your application uses permissions that require admin consent, you need to have a gesture such as a button or link where the admin can initiate the action.</span></span>  <span data-ttu-id="430bd-196">응용 프로그램에서 이 작업에 대해 보내는 요청은 일반적인 OAuth2/OpenID Connect 권한 부여 요청이지만, 또한 `prompt=admin_consent` 쿼리 문자열 매개 변수도 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-196">The request your application sends for this action is a usual OAuth2/OpenID Connect authorization request, but that also includes the `prompt=admin_consent` query string parameter.</span></span>  <span data-ttu-id="430bd-197">일단 관리자가 동의했고 서비스 주체가 고객 테넌트에 만들어졌다면 차후의 로그인 요청은 `prompt=admin_consent` 매개 변수를 필요로 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-197">Once the admin has consented and the service principal is created in the customer’s tenant, subsequent sign-in requests do not need the `prompt=admin_consent` parameter.</span></span> <span data-ttu-id="430bd-198">관리자가 요청된 권한이 허용된다고 결정했다면 테넌트의 다른 사용자들에게 그 시점 이후로 동의하라는 메시지가 표시되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-198">Since the administrator has decided the requested permissions are acceptable, no other users in the tenant will be prompted for consent from that point forward.</span></span>

<span data-ttu-id="430bd-199">관리 동의가 필요하지 않은 사용 권한을 요청하는 응용 프로그램에서 `prompt=admin_consent` 매개 변수를 사용할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-199">The `prompt=admin_consent` parameter can also be used by applications that request permissions that do not require admin consent.</span></span> <span data-ttu-id="430bd-200">응용 프로그램에 테넌트 관리자가 한 번 "등록"한 환경이 필요하고 다른 사용자에게 해당 지점에서 동의를 확인하는 메시지가 표시되지 않는 경우에 수행됩니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-200">This is done when the applicaton requires an experience where the tenant admin “signs up” one time, and no other users are prompted for consent from that point on.</span></span>

<span data-ttu-id="430bd-201">응용 프로그램에 관리 동의가 필요한 경우 관리자가 로그인해도 `prompt=admin_consent` 매개 변수가 전송되지 않습니다. 관리자는 **자신의 사용자 계정에 대해서만** 응용 프로그램에 동의할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-201">If an application requires admin consent, and an admin signs in but the `prompt=admin_consent` parameter is not sent, the admin will successfully consent to the application **only for their user account**.</span></span>  <span data-ttu-id="430bd-202">일반 사용자는 여전히 응용 프로그램에 로그인하여 동의할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-202">Regular users will still not be able to sign in and consent to the application.</span></span>  <span data-ttu-id="430bd-203">다른 사용자들에게 액세스를 허용하기 전에 응용 프로그램을 탐색하는 기능을 테넌트 관리자에게 주고자 할 때 유용합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-203">This is useful if you want to give the tenant administrator the ability to explore your application before allowing other users access.</span></span>

<span data-ttu-id="430bd-204">테넌트 관리자는 일반 사용자가 응용 프로그램에 동의하는 기능을 사용하지 않도록 설정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-204">A tenant administrator can disable the ability for regular users to consent to applications.</span></span>  <span data-ttu-id="430bd-205">이 기능을 사용하지 않도록 설정한다면, 테넌트에 응용 프로그램을 설정할 때 항상 관리자 동의가 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-205">If this capability is disabled, admin consent is always required for the application to be set up in the tenant.</span></span>  <span data-ttu-id="430bd-206">일반 사용자 동의를 사용하지 않도록 설정한 응용 프로그램을 테스트하려면 [Azure Portal][AZURE-portal]의 Azure AD 테넌트 구성 섹션에서 구성 스위치를 찾을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-206">If you want to test your application with regular user consent disabled, you can find the configuration switch in the Azure AD tenant configuration section of the [Azure portal][AZURE-portal].</span></span>

> [!NOTE]
> <span data-ttu-id="430bd-207">일부 응용 프로그램은 처음에는 일반 사용자가 동의할 수 있고 나중에는 응용 프로그램이 관리자를 참여시키고 관리자 동의가 필요한 권한을 요청할 수 있는 환경을 원합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-207">Some applications want an experience where regular users are able to consent initially, and later the application can involve the administrator and request permissions that require admin consent.</span></span>  <span data-ttu-id="430bd-208">현재 Azure AD에서 단일 응용 프로그램 등록을 이렇게 할 방법은 없습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-208">There is no way to do this with a single application registration in Azure AD today.</span></span>  <span data-ttu-id="430bd-209">앞으로 제공될 Azure AD v2 끝점은 응용 프로그램이 등록 시가 아니라 런타임 시 사용 권한을 요청할 수 있으며, 이를 통해 이 시나리오를 사용하도록 설정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-209">The upcoming Azure AD v2 endpoint will allow applications to request permissions at runtime, instead of at registration time, which will enable this scenario.</span></span>  <span data-ttu-id="430bd-210">자세한 내용은 [Azure AD 앱 모델 v2 개발자 가이드][AAD-V2-Dev-Guide]를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="430bd-210">For more information, see the [Azure AD App Model v2 Developer Guide][AAD-V2-Dev-Guide].</span></span>
> 
> 

### <a name="consent-and-multi-tier-applications"></a><span data-ttu-id="430bd-211">동의 및 다중 계층 응용 프로그램</span><span class="sxs-lookup"><span data-stu-id="430bd-211">Consent and multi-tier applications</span></span>
<span data-ttu-id="430bd-212">응용 프로그램은 여러 계층을 가질 수 있으며, 각 계층은 Azure AD에서 자체 등록에 의해 표현될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-212">Your application may have multiple tiers, each represented by its own registration in Azure AD.</span></span>  <span data-ttu-id="430bd-213">예를 들어, 웹 API를 호출하는 네이티브 응용 프로그램 또는 웹 API를 호출하는 웹 응용 프로그램.</span><span class="sxs-lookup"><span data-stu-id="430bd-213">For example, a native application that calls a web API, or a web application that calls a web API.</span></span>  <span data-ttu-id="430bd-214">두 경우 모두, 클라이언트(네이티브 앱 또는 웹앱)는 리소스(웹 API)를 호출하는 권한을 요청합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-214">In both of these cases, the client (native app or web app) requests permissions to call the resource (web API).</span></span>  <span data-ttu-id="430bd-215">클라이언트가 고객의 테넌트로 성공적으로 동의되려면 사용 권한을 요청한 모든 리소스가 고객의 테넌트에 이미 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-215">For the client to be successfully consented into a customer’s tenant, all resources to which it requests permissions must already exist in the customer’s tenant.</span></span>  <span data-ttu-id="430bd-216">이 조건이 충족되지 않으면, Azure AD는 리소스가 먼저 추가되어야 한다는 오류를 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-216">If this condition isn’t met, Azure AD will return an error that the resource must be added first.</span></span>

<span data-ttu-id="430bd-217">**단일 테넌트의 여러 계층**</span><span class="sxs-lookup"><span data-stu-id="430bd-217">**Multiple tiers in a single tenant**</span></span>

<span data-ttu-id="430bd-218">논리 응용 프로그램이 예를 들어 별도의 클라이언트와 리소스와 같은 두 개 이상의 응용 프로그램 등록으로 구성되어 있다면 이것이 문제일 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-218">This can be a problem if your logical application consists of two or more application registrations, for example a separate client and resource.</span></span>  <span data-ttu-id="430bd-219">우선 리소스를 고객 테넌트에 가져가려면 어떻게 해야 합니까?</span><span class="sxs-lookup"><span data-stu-id="430bd-219">How do you get the resource into the customer tenant first?</span></span>  <span data-ttu-id="430bd-220">Azure AD에서는 클라이언트와 리소스를 한 번에 승인하여 이 문제를 해결합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-220">Azure AD covers this case by enabling client and resource to be consented in a single step.</span></span> <span data-ttu-id="430bd-221">동의 페이지에서 클라이언트와 리소스 모두에서 요청한 전체 사용 권한을 사용자에게 표시합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-221">The user sees the sum total of the permissions requested by both the client and resource on the consent page.</span></span>  <span data-ttu-id="430bd-222">이 동작을 사용하려면 리소스의 응용 프로그램 등록은 클라이언트의 앱 ID를 응용 프로그램 매니페스트에 `knownClientApplications`로 포함해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-222">To enable this behavior, the resource’s application registration must include the client’s App ID as a `knownClientApplications` in its application manifest.</span></span>  <span data-ttu-id="430bd-223">예:</span><span class="sxs-lookup"><span data-stu-id="430bd-223">For example:</span></span>

    knownClientApplications": ["94da0930-763f-45c7-8d26-04d5938baab2"]

<span data-ttu-id="430bd-224">이 속성은 [응용 프로그램의 매니페스트][AAD-App-Manifest] 리소스를 통해 업데이트될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-224">This property can be updated via the resource [application’s manifest][AAD-App-Manifest].</span></span> <span data-ttu-id="430bd-225">이 문서의 뒷부분에 나오는 [관련 콘텐츠](#related-content) 섹션에 있는 웹 API 샘플을 호출하는 다중 계층 네이티브 클라이언트에서 보여 줄 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-225">This is demonstrated in a multi-tier native client calling web API sample in the [Related Content](#related-content) section at the end of this article.</span></span> <span data-ttu-id="430bd-226">다음 다이어그램은 단일 테넌트에 등록된 다중 계층 앱에 대한 동의 개요를 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-226">The following diagram provides an overview of consent for a multi-tier app registered in a single tenant :</span></span>

![알려진 다중 계층 클라이언트 앱에 동의][Consent-Multi-Tier-Known-Client] 

<span data-ttu-id="430bd-228">**다중 테넌트의 여러 계층**</span><span class="sxs-lookup"><span data-stu-id="430bd-228">**Multiple tiers in multiple tenants**</span></span>

<span data-ttu-id="430bd-229">응용 프로그램의 다른 계층이 다른 테넌트에 등록되어 있다면 유사한 사례가 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-229">A similar case happens if the different tiers of an application are registered in different tenants.</span></span>  <span data-ttu-id="430bd-230">예를 들어 Office 365 Exchange Online API를 호출하는 네이티브 클라이언트 응용 프로그램을 구축하는 경우를 생각해 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-230">For example, consider the case of building a native client application that calls the Office 365 Exchange Online API.</span></span>  <span data-ttu-id="430bd-231">네이티브 응용 프로그램을 개발하고, 그 후 네이티브 응용 프로그램이 고객 테넌트에서 실행되도록 하려면, Exchange Online 서비스 주체가 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-231">To develop the native application, and later for the native application to run in a customer’s tenant, the Exchange Online service principal must be present.</span></span>  <span data-ttu-id="430bd-232">이 경우에 개발자 및 고객이 자신의 테넌트에 서비스 주체가 생성되도록 하려면 Exchange Online를 구매해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-232">In this case, the developer and customer must purchase Exchange Online for the service principal to be created in their tenants.</span></span>  

<span data-ttu-id="430bd-233">Microsoft 이외의 조직에서 빌드한 API의 경우, API 개발자는 고객이 자신의 테넌트에 대한 응용 프로그램에 동의하는 방법을 제공해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-233">In the case of an API built by an organization other than Microsoft, the developer of the API needs to provide a way for their customers to consent the application into their customers' tenants.</span></span> <span data-ttu-id="430bd-234">타사 개발자에게 권장되는 디자인은 등록을 구현하는 웹 클라이언트로도 사용할 수 있도록 API를 빌드하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-234">The recommended design is for the 3rd party developer to build the API such that it can also function as a web client to implement sign-up :</span></span>

1. <span data-ttu-id="430bd-235">이전 섹션에 따라 API에서 다중 테넌트 응용 프로그램 등록/코드 요구 사항을 구현하도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-235">Follow the earlier sections to ensure the API implements the multi-tenant application registration/code requirements</span></span>
2. <span data-ttu-id="430bd-236">API의 범위/역할을 노출하는 것 외에도 등록에 "로그인 및 읽기 사용자 프로필" Azure AD 사용 권한을 포함해야 합니다(기본적으로 제공됨).</span><span class="sxs-lookup"><span data-stu-id="430bd-236">In addition to exposing the API's scopes/roles, ensure the registration includes the "Sign in and read user profile" Azure AD permission (provided by default)</span></span>
3. <span data-ttu-id="430bd-237">앞에서 설명한 [관리 동의](#admin-consent) 지침에 따라 웹 클라이언트에서 로그인/등록 페이지를 구현합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-237">Implement a sign-in/sign-up page in the web client, following the [admin consent](#admin-consent) guidance discussed earlier</span></span> 
4. <span data-ttu-id="430bd-238">사용자가 응용 프로그램에 동의한 경우 서비스 주체 및 동의 위임 링크가 해당 테넌트에 생성되며 네이티브 응용 프로그램이 API의 토큰을 가져올 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-238">Once the user consents to the application, the service principal and consent delegation links are created in their tenant, and the native application can get tokens for the API</span></span>

<span data-ttu-id="430bd-239">다음 다이어그램은 다른 테넌트에 등록된 다중 계층 앱에 대한 동의 개요를 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-239">The following diagram provides an overview of consent for a multi-tier app registered in different tenants:</span></span>

![다중 계층 다자 앱에 동의][Consent-Multi-Tier-Multi-Party] 

### <a name="revoking-consent"></a><span data-ttu-id="430bd-241">동의 취소</span><span class="sxs-lookup"><span data-stu-id="430bd-241">Revoking Consent</span></span>
<span data-ttu-id="430bd-242">사용자와 관리자는 언제든지 응용 프로그램에 대한 동의를 해지할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-242">Users and administrators can revoke consent to your application at any time:</span></span>

* <span data-ttu-id="430bd-243">사용자는 자신의 [액세스 패널 응용 프로그램][AAD-Access-Panel] 목록에서 개별 응용 프로그램을 제거하여 해당 응용 프로그램에 대한 액세스 권한을 취소합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-243">Users revoke access to individual applications by removing them from their [Access Panel Applications][AAD-Access-Panel] list.</span></span>
* <span data-ttu-id="430bd-244">관리자는 [Azure Portal][AZURE-portal]의 Azure AD 관리 섹션을 사용하여 Azure Ad에서 응용 프로그램을 제거하여 해당 응용 프로그램에 대한 액세스 권한을 취소합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-244">Administrators revoke access to applications by removing them from Azure AD using the Azure AD management section of the [Azure portal][AZURE-portal].</span></span>

<span data-ttu-id="430bd-245">관리자가 테넌트의 모든 사용자에 대해 응용 프로그램에 동의하는 경우 사용자는 개별적으로 액세스를 해지할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-245">If an administrator consents to an application for all users in a tenant, users cannot revoke access individually.</span></span>  <span data-ttu-id="430bd-246">관리자만이 액세스를 해지할 수 있으며 전체 응용 프로그램에 대해서만 해지할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-246">Only the administrator can revoke access, and only for the whole application.</span></span>

### <a name="consent-and-protocol-support"></a><span data-ttu-id="430bd-247">동의 및 프로토콜 지원</span><span class="sxs-lookup"><span data-stu-id="430bd-247">Consent and Protocol Support</span></span>
<span data-ttu-id="430bd-248">동의는 OAuth, OpenID Connect, WS-federation 및 SAML 프로토콜을 통해 Azure AD에서 지원됩니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-248">Consent is supported in Azure AD via the OAuth, OpenID Connect, WS-Federation, and SAML protocols.</span></span>  <span data-ttu-id="430bd-249">SAML 및 WS-federation 프로토콜은 `prompt=admin_consent` 매개 변수를 지원하지 않으므로, 관리자 동의는 OAuth 및 OpenID Connect 통해서만 가능합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-249">The SAML and WS-Federation protocols do not support the `prompt=admin_consent` parameter, so admin consent is only possible via OAuth and OpenID Connect.</span></span>

## <a name="multi-tenant-applications-and-caching-access-tokens"></a><span data-ttu-id="430bd-250">다중 테넌트 응용 프로그램및 액세스 토큰 캐시</span><span class="sxs-lookup"><span data-stu-id="430bd-250">Multi-Tenant Applications and Caching Access Tokens</span></span>
<span data-ttu-id="430bd-251">다중 테넌트 응용 프로그램은 또한 Azure AD로 보호되는 API를 호출하는 액세스 토큰을 가져올 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-251">Multi-tenant applications can also get access tokens to call APIs that are protected by Azure AD.</span></span>  <span data-ttu-id="430bd-252">다중 테넌트 응용 프로그램과 함께 ADAL(Active Directory 인증 라이브러리)을 사용할 경우 일반적인 오류는 먼저 /common을 사용하여 사용자에 대한 토큰을 요청하고, 응답을 받은 후, 또 다시 /common을 사용하여 같은 사용자에 대한 후속 토큰을 요청하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-252">A common error when using the Active Directory Authentication Library (ADAL) with a multi-tenant application, is to initially request a token for a user using /common, receive a response, then request a subsequent token for that same user also using /common.</span></span>  <span data-ttu-id="430bd-253">Azure AD에서 온 응답은 /common이 아닌 테넌트에서 오기 때문에, ADAL은 토큰을 테넌트로부터 온 것인양 캐시합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-253">Since the response from Azure AD comes from a tenant, not /common, ADAL caches the token as being from the tenant.</span></span> <span data-ttu-id="430bd-254">사용자에 대한 액세스 토큰을 가져오기 위한 /common에 대한 후속 호출은 캐시 항목이 누락되어, 사용자에게 다시 로그인하라는 메시지가 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-254">The subsequent call to /common to get an access token for the user misses the cache entry, and the user is prompted to sign in again.</span></span>  <span data-ttu-id="430bd-255">캐시 누락을 방지하려면 이미 로그인한 사용자에 대한 후속 호출이 테넌트의 끝점에 대해 있었는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-255">To avoid missing the cache, make sure subsequent calls for an already signed in user are made to the tenant’s endpoint.</span></span>

## <a name="next-steps"></a><span data-ttu-id="430bd-256">다음 단계</span><span class="sxs-lookup"><span data-stu-id="430bd-256">Next steps</span></span>
<span data-ttu-id="430bd-257">이 문서에서는 모든 Azure Active Directory 테넌트에서 사용자를 로그인할 수 있는 응용 프로그램을 구축하는 방법을 알아보았습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-257">In this article, you learned how to build an application that can sign in a user from any Azure Active Directory tenant.</span></span> <span data-ttu-id="430bd-258">앱 및 Azure Active Directory 간에 Single Sign-On을 사용하도록 설정하면 Office 365와 같은 Microsoft 리소스에 의해 노출되는 API에 액세스하도록 응용 프로그램을 업데이트할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-258">After enabling Single Sign-On between your app and Azure Active Directory, you can also update your application to access APIs exposed by Microsoft resources, like Office 365.</span></span> <span data-ttu-id="430bd-259">따라서 사용하는 응용 프로그램에 사용자에 맞는 컨텍스트 정보(예: 프로필 사진 또는 다음 일정 약속)를 표시하는 것과 같은 개인 설정된 환경을 제공할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-259">So you can offer a personalized experience in your application, for example showing contextual information to the users, like their profile picture or their next calendar appointment.</span></span> <span data-ttu-id="430bd-260">Azure Active Directory 및 Exchange, SharePoint, OneDrive, OneNote, Planner, Excel 등과 같은 Office 365 서비스에 대한 API 호출 방법을 자세히 알아보려면 [Microsoft Graph API][MSFT-Graph-overview]를 방문하세요.</span><span class="sxs-lookup"><span data-stu-id="430bd-260">To learn more about making API calls to Azure Active Directory and Office 365 services like Exchange, SharePoint, OneDrive, OneNote, Planner, Excel and more, visit: [Microsoft Graph API][MSFT-Graph-overview].</span></span>


## <a name="related-content"></a><span data-ttu-id="430bd-261">관련 콘텐츠</span><span class="sxs-lookup"><span data-stu-id="430bd-261">Related content</span></span>
* <span data-ttu-id="430bd-262">[다중 테넌트 응용 프로그램 샘플][AAD-Samples-MT]</span><span class="sxs-lookup"><span data-stu-id="430bd-262">[Multi-tenant application samples][AAD-Samples-MT]</span></span>
* <span data-ttu-id="430bd-263">[응용 프로그램에 대한 브랜딩 지침][AAD-App-Branding]</span><span class="sxs-lookup"><span data-stu-id="430bd-263">[Branding Guidelines for Applications][AAD-App-Branding]</span></span>
* <span data-ttu-id="430bd-264">[Azure AD 개발자 가이드][AAD-Dev-Guide]</span><span class="sxs-lookup"><span data-stu-id="430bd-264">[Azure AD Developer's Guide][AAD-Dev-Guide]</span></span>
* <span data-ttu-id="430bd-265">[응용 프로그램 개체 및 서비스 주체 개체][AAD-App-SP-Objects]</span><span class="sxs-lookup"><span data-stu-id="430bd-265">[Application Objects and Service Principal Objects][AAD-App-SP-Objects]</span></span>
* <span data-ttu-id="430bd-266">[Azure Active Directory와 응용 프로그램 통합][AAD-Integrating-Apps]</span><span class="sxs-lookup"><span data-stu-id="430bd-266">[Integrating Applications with Azure Active Directory][AAD-Integrating-Apps]</span></span>
* <span data-ttu-id="430bd-267">[동의 프레임워크 개요][AAD-Consent-Overview]</span><span class="sxs-lookup"><span data-stu-id="430bd-267">[Overview of the Consent Framework][AAD-Consent-Overview]</span></span>
* <span data-ttu-id="430bd-268">[Microsoft Graph API 권한 범위][MSFT-Graph-permision-scopes](영문)</span><span class="sxs-lookup"><span data-stu-id="430bd-268">[Microsoft Graph API Permission Scopes][MSFT-Graph-permision-scopes]</span></span>
* <span data-ttu-id="430bd-269">[Azure AD Graph API 권한 범위][AAD-Graph-Perm-Scopes]</span><span class="sxs-lookup"><span data-stu-id="430bd-269">[Azure AD Graph API Permission Scopes][AAD-Graph-Perm-Scopes]</span></span>

<span data-ttu-id="430bd-270">다음 설명 섹션을 사용하여 피드백을 제공하고 콘텐츠를 구체화하고 모양을 갖출 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="430bd-270">Please use the following comments section to provide feedback and help us refine and shape our content.</span></span>

<!--Reference style links IN USE -->
[AAD-Access-Panel]:  https://myapps.microsoft.com
[AAD-App-Branding]: ./active-directory-branding-guidelines.md
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Consent-Overview]: ./active-directory-integrating-applications.md#overview-of-the-consent-framework
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Overview]: https://azure.microsoft.com/en-us/documentation/articles/active-directory-graph-api/
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Samples-MT]: https://azure.microsoft.com/documentation/samples/?service=active-directory&term=multitenant
[AAD-Why-To-Integrate]: ./active-directory-how-to-integrate.md
[AZURE-portal]: https://portal.azure.com
[MSFT-Graph-overview]: https://graph.microsoft.io/en-us/docs/overview/overview
[MSFT-Graph-permision-scopes]: https://graph.microsoft.io/en-us/docs/authorization/permission_scopes

<!--Image references-->
[AAD-Sign-In]: ./media/active-directory-devhowto-multi-tenant-overview/sign-in-with-microsoft-light.png
[Consent-Single-Tier]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-single-tier.png
[Consent-Multi-Tier-Known-Client]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-known-clients.png
[Consent-Multi-Tier-Multi-Party]: ./media/active-directory-devhowto-multi-tenant-overview/consent-flow-multi-tier-multi-party.png

<!--Reference style links -->
[AAD-App-Manifest]: ./active-directory-application-manifest.md
[AAD-App-SP-Objects]: ./active-directory-application-objects.md
[AAD-Auth-Scenarios]: ./active-directory-authentication-scenarios.md
[AAD-Integrating-Apps]: ./active-directory-integrating-applications.md
[AAD-Dev-Guide]: ./active-directory-developers-guide.md
[AAD-Graph-Perm-Scopes]: https://msdn.microsoft.com/library/azure/ad/graph/howto/azure-ad-graph-api-permission-scopes
[AAD-Graph-App-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#application-entity
[AAD-Graph-Sp-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity
[AAD-Graph-User-Entity]: https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#user-entity
[AAD-How-To-Integrate]: ./active-directory-how-to-integrate.md
[AAD-Security-Token-Claims]: ./active-directory-authentication-scenarios/#claims-in-azure-ad-security-tokens
[AAD-Tokens-Claims]: ./active-directory-token-and-claims.md
[AAD-V2-Dev-Guide]: ../active-directory-appmodel-v2-overview.md
[AZURE-portal]: https://portal.azure.com
[Duyshant-Role-Blog]: http://www.dushyantgill.com/blog/2014/12/10/roles-based-access-control-in-cloud-applications-using-azure-ad/
[JWT]: https://tools.ietf.org/html/draft-ietf-oauth-json-web-token-32
[O365-Perm-Ref]: https://msdn.microsoft.com/en-us/office/office365/howto/application-manifest
[OAuth2-Access-Token-Scopes]: https://tools.ietf.org/html/rfc6749#section-3.3
[OAuth2-AuthZ-Code-Grant-Flow]: https://msdn.microsoft.com/library/azure/dn645542.aspx
[OAuth2-AuthZ-Grant-Types]: https://tools.ietf.org/html/rfc6749#section-1.3 
[OAuth2-Client-Types]: https://tools.ietf.org/html/rfc6749#section-2.1
[OAuth2-Role-Def]: https://tools.ietf.org/html/rfc6749#page-6
[OpenIDConnect]: http://openid.net/specs/openid-connect-core-1_0.html
[OpenIDConnect-ID-Token]: http://openid.net/specs/openid-connect-core-1_0.html#IDToken














