---
title: "Azure IoT Suite 연결된 팩터리 게이트웨이 배포 | Microsoft Docs"
description: "Windows 또는 Linux에서 게이트웨이를 배포하여 연결된 팩터리의 미리 구성된 솔루션에 대한 연결을 사용하도록 설정하는 방법"
services: 
suite: iot-suite
documentationcenter: na
author: dominicbetts
manager: timlt
editor: 
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/24/2017
ms.author: dobett
ms.openlocfilehash: b0e6ae705911d7c18643c77b7fe08fdffffa5eb1
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/03/2017
---
# <a name="deploy-a-gateway-on-windows-or-linux-for-the-connected-factory-preconfigured-solution"></a><span data-ttu-id="7a03c-103">연결된 팩터리의 미리 구성된 솔루션을 위해 Windows 또는 Linux에 게이트웨이 배포</span><span class="sxs-lookup"><span data-stu-id="7a03c-103">Deploy a gateway on Windows or Linux for the connected factory preconfigured solution</span></span>

<span data-ttu-id="7a03c-104">연결된 팩터리 미리 구성된 솔루션의 게이트웨이를 배포하는 데 필요한 소프트웨어에는 구성 요소가 두 개 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-104">The software required to deploy a gateway for the connected factory preconfigured solution has two components:</span></span>

* <span data-ttu-id="7a03c-105">*OPC 프록시*는 IoT Hub에 대한 연결을 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-105">The *OPC Proxy* establishes a connection to IoT Hub.</span></span> <span data-ttu-id="7a03c-106">*OPC 프록시*는 연결된 공장 솔루션 포털에서 실행되는 통합된 OPC 브라우저의 명령 및 제어 메시지를 기다립니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-106">The *OPC Proxy* then waits for command and control messages from the integrated OPC Browser that runs in the connected factory solution portal.</span></span>
* <span data-ttu-id="7a03c-107">*OPC 게시자*는 기존 온-프레미스 OPC UA 서버에 연결하고 해당 서버의 원격 분석 메시지를 IoT Hub에 전달합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-107">The *OPC Publisher* connects to existing on-premises OPC UA servers and forwards telemetry messages from them to IoT Hub.</span></span>

<span data-ttu-id="7a03c-108">두 구성 요소는 오픈 소스이며 GitHub의 원본 및 Docker 컨테이너로 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-108">Both components are open-source and are available as source on GitHub and as Docker containers:</span></span>

| <span data-ttu-id="7a03c-109">GitHub</span><span class="sxs-lookup"><span data-stu-id="7a03c-109">GitHub</span></span> | <span data-ttu-id="7a03c-110">DockerHub</span><span class="sxs-lookup"><span data-stu-id="7a03c-110">DockerHub</span></span> |
| ------ | --------- |
| <span data-ttu-id="7a03c-111">[OPC 게시자][lnk-publisher-github]</span><span class="sxs-lookup"><span data-stu-id="7a03c-111">[OPC Publisher][lnk-publisher-github]</span></span> | <span data-ttu-id="7a03c-112">[OPC 게시자][lnk-publisher-docker]</span><span class="sxs-lookup"><span data-stu-id="7a03c-112">[OPC Publisher][lnk-publisher-docker]</span></span> |
| <span data-ttu-id="7a03c-113">[OPC 프록시][lnk-proxy-github]</span><span class="sxs-lookup"><span data-stu-id="7a03c-113">[OPC Proxy][lnk-proxy-github]</span></span> | <span data-ttu-id="7a03c-114">[OPC 프록시][lnk-proxy-docker]</span><span class="sxs-lookup"><span data-stu-id="7a03c-114">[OPC Proxy][lnk-proxy-docker]</span></span> |

<span data-ttu-id="7a03c-115">각 구성 요소에는 게이트웨이 방화벽에 공용 IP 주소 또는 빈 영역이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-115">No public-facing IP address or holes in the gateway firewall are required for either component.</span></span> <span data-ttu-id="7a03c-116">OPC 프록시와 OPC 게시자는 443, 5671 및 8883 아웃바운드 포트만 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-116">The OPC Proxy and OPC Publisher use only outbound ports 443, 5671, and 8883.</span></span>

<span data-ttu-id="7a03c-117">이 문서의 단계에서는 [Windows](#windows-deployment) 또는 [Linux](#linux-deployment)에서 Docker를 사용하여 게이트웨이를 배포하는 방법을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-117">The steps in this article show you how to deploy a gateway using Docker on either [Windows](#windows-deployment) or [Linux](#linux-deployment).</span></span> <span data-ttu-id="7a03c-118">게이트웨이를 사용하면 연결된 팩터리의 미리 구성된 솔루션에 대한 연결을 사용하도록 설정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-118">The gateway enables connectivity to the connected factory preconfigured solution.</span></span>

> [!NOTE]
> <span data-ttu-id="7a03c-119">Docker 컨테이너에서 실행되는 게이트웨이 소프트웨어는 [Azure IoT Edge]입니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-119">The gateway software that runs in the Docker container is [Azure IoT Edge].</span></span>

## <a name="windows-deployment"></a><span data-ttu-id="7a03c-120">Windows 배포</span><span class="sxs-lookup"><span data-stu-id="7a03c-120">Windows deployment</span></span>

> [!NOTE]
> <span data-ttu-id="7a03c-121">게이트웨이 장치가 아직 없는 경우 파트너로부터 상용 게이트웨이를 구입하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-121">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="7a03c-122">[Azure IoT 장치 카탈로그]에서 연결된 팩터리 솔루션과 호환되는 게이트웨이 장치 목록을 확인하세요.</span><span class="sxs-lookup"><span data-stu-id="7a03c-122">Visit the [Azure IoT device catalog] for a list of gateway devices compatible with the connected factory solution.</span></span> <span data-ttu-id="7a03c-123">장치와 함께 제공되는 지침에 따라 게이트웨이를 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-123">Follow the instructions that come with the device to set up the gateway.</span></span> <span data-ttu-id="7a03c-124">또는 다음 지침을 사용하여 기존 게이트웨이 중 하나를 수동으로 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-124">Alternatively, use the following instructions to manually set up one of your existing gateways.</span></span>

### <a name="install-docker"></a><span data-ttu-id="7a03c-125">Docker 설치</span><span class="sxs-lookup"><span data-stu-id="7a03c-125">Install Docker</span></span>

<span data-ttu-id="7a03c-126">Windows 기반 게이트웨이 장치에 [Windows용 Docker]를 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-126">Install [Docker for Windows] on your Windows-based gateway device.</span></span> <span data-ttu-id="7a03c-127">Windows Docker 설치 동안 Docker와 공유할 호스트 컴퓨터의 드라이브를 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-127">During Windows Docker setup, select a drive on your host machine to share with Docker.</span></span> <span data-ttu-id="7a03c-128">다음 스크린샷은 Windows 시스템에서 D 드라이브를 공유 과정을 보여 합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-128">The following screenshot shows sharing the D drive on your Windows system:</span></span>

![Docker 설치][img-install-docker]

<span data-ttu-id="7a03c-130">그런 다음 공유 드라이브의 루트에 **docker**라는 폴더를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-130">Then create a folder called **docker** in the root of the shared drive.</span></span>
<span data-ttu-id="7a03c-131">또한 **설정** 메뉴에서 docker를 설치한 후 이 단계를 수행할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-131">You can also perform this step after installing docker from the **Settings** menu.</span></span>

### <a name="configure-the-gateway"></a><span data-ttu-id="7a03c-132">게이트웨이 구성</span><span class="sxs-lookup"><span data-stu-id="7a03c-132">Configure the gateway</span></span>

1. <span data-ttu-id="7a03c-133">게이트웨이 배포를 완료하려면 Azure IoT Suite 연결된 팩터리 배포의 **iothubowner** 연결 문자열이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-133">You need the **iothubowner** connection string of your Azure IoT Suite connected factory deployment to complete the gateway deployment.</span></span> <span data-ttu-id="7a03c-134">[Azure Portal]에서 연결된 팩터리 솔루션을 배포할 때 만든 리소스 그룹의 IoT Hub로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-134">In the [Azure portal], navigate to your IoT Hub in the resource group created when you deployed the connected factory solution.</span></span> <span data-ttu-id="7a03c-135">**공유 액세스 정책**을 클릭하여 **iothubowner** 연결 문자열에 액세스합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-135">Click **Shared access policies** to access the **iothubowner** connection string:</span></span>

    ![IoT Hub 연결 문자열 찾기][img-hub-connection]

    <span data-ttu-id="7a03c-137">**연결 문자열 - 기본 키** 값을 복사합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-137">Copy the **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="7a03c-138">다음을 사용하여 명령 프롬프트에서 두 게이트웨이 모듈을 **한번에** 실행하여 IoT Hub에 대한 게이트웨이를 구성합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-138">Configure the gateway for your IoT Hub by running the two gateway modules **once** from a command prompt with:</span></span>

    `docker run -it --rm -h <ApplicationName> -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="7a03c-139">**&lt;ApplicationName&gt;**은 **게시자.&lt;정규화된 도메인 이름&gt;** 형식으로 OPC UA 게시자에 지정하는 이름입니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-139">**&lt;ApplicationName&gt;** is the name to give to your OPC UA Publisher in the format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="7a03c-140">예를 들어 팩터리 네트워크 이름이 **myfactorynetwork.com**일 경우 **ApplicationName** 값은 **publisher.myfactorynetwork.com**입니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-140">For example, if your factory network is called **myfactorynetwork.com**, the **ApplicationName** value is **publisher.myfactorynetwork.com**.</span></span>
    * <span data-ttu-id="7a03c-141">**&lt;IoTHubOwnerConnectionString&gt;**은 이전 단계에서 복사한 **iothubowner** 연결 문자열입니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-141">**&lt;IoTHubOwnerConnectionString&gt;** is the **iothubowner** connection string you copied in the previous step.</span></span> <span data-ttu-id="7a03c-142">이 연결 문자열은 이 단계에서만 사용하며 다음 단계에서 다시 필요하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-142">This connection string is only used in this step, you don’t need it in the following steps:</span></span>

    <span data-ttu-id="7a03c-143">매핑된 D:\\docker 폴더(`-v` 인수)는 게이트웨이 모듈에서 사용되는 두 X.509 인증서를 유지하기 위해 나중에 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-143">You use the mapped D:\\docker folder (the `-v` argument) later to persist the two X.509 certificates that the gateway modules use.</span></span>

### <a name="run-the-gateway"></a><span data-ttu-id="7a03c-144">게이트웨이 실행</span><span class="sxs-lookup"><span data-stu-id="7a03c-144">Run the gateway</span></span>

1. <span data-ttu-id="7a03c-145">다음 명령을 사용하여 게이트웨이를 다시 시작합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-145">Restart the gateway using the following commands:</span></span>

    `docker run -it --rm -h <ApplicationName> --expose 62222 -p 62222:62222 -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/shared -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="7a03c-146">보안상의 이유로 D:\\docker 폴더에 유지되는 두 X.509 인증서는 개인 키를 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-146">For security reasons, the two X.509 certificates persisted in the D:\\docker folder contain the private key.</span></span> <span data-ttu-id="7a03c-147">이 폴더에 대한 액세스는 Docker 컨테이너를 실행하는 데 사용된 자격 증명(일반적으로 **Administrators**)으로 제한됩니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-147">Limit access to this folder to the credentials (typically **Administrators**) you use to run the Docker container.</span></span> <span data-ttu-id="7a03c-148">D:\\docker 폴더를 마우스 오른쪽 단추로 클릭하고 **속성**, **보안**, **편집**을 차례로 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-148">Right-click the D:\\docker folder, choose **Properties**, then **Security**, and then **Edit**.</span></span> <span data-ttu-id="7a03c-149">**Administrators**에 모든 권한을 제공하고 다른 모든 사용자를 제거합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-149">Give **Administrators** full control and remove everyone else:</span></span>

    ![Docker 공유에 대한 권한 부여][img-docker-share]

1. <span data-ttu-id="7a03c-151">네트워크 연결을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-151">Verify network connectivity.</span></span> <span data-ttu-id="7a03c-152">명령 프롬프트에서 명령 `ping publisher.<your fully qualified domain name>`을 입력하여 게이트웨이를 ping합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-152">From a command prompt, enter the command `ping publisher.<your fully qualified domain name>` to ping your gateway.</span></span> <span data-ttu-id="7a03c-153">대상에 연결할 수 없는 경우 게이트웨이의 호스트 파일에 게이트웨이의 IP 주소와 이름을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-153">If the destination is unreachable, add the IP address and name of your gateway to the hosts file on your gateway.</span></span> <span data-ttu-id="7a03c-154">호스트 파일은 **Windows\\System32\\drivers\\etc** 폴더에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-154">The hosts file is located in the **Windows\\System32\\drivers\\etc** folder.</span></span>

1. <span data-ttu-id="7a03c-155">다음으로 게이트웨이에서 실행되는 로컬 OPC UA 클라이언트를 사용하여 게시자에 연결하려고 합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-155">Next, try to connect to the publisher using a local OPC UA client running on the gateway.</span></span> <span data-ttu-id="7a03c-156">OPC UA 끝점 URL은 `opc.tcp://publisher.<your fully qualified domain name>:62222`입니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-156">The OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="7a03c-157">OPC UA 클라이언트가 없으면 [오픈 소스 OPC UA 클라이언트]를 다운로드하여 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-157">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="7a03c-158">이러한 로컬 테스트를 성공적으로 완료한 경우 연결된 팩터리 솔루션 포털에서 **자체 OPC UA 서버 연결** 페이지로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-158">When you have successfully completed these local tests, browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="7a03c-159">게시자 끝점 URL(`tcp://publisher.<your fully qualified domain name>:62222`)을 입력하고 **연결**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-159">Enter the publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="7a03c-160">인증서 경고가 표시되면 **계속**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-160">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="7a03c-161">다음으로 게시자가 UA 웹 클라이언트를 신뢰하지 않는다는 오류가 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-161">Next you get an error that the publisher doesn’t trust the UA Web Client.</span></span> <span data-ttu-id="7a03c-162">이 오류를 해결하려면 **D:\\docker\\Rejected Certificates\\certs** 폴더의 **UA 웹 클라이언트** 인증서를 게이트웨이의 **D:\\docker\\UA Applications\\certs** 폴더로 복사합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-162">To resolve this error, copy the **UA Web Client** certificate from the **D:\\docker\\Rejected Certificates\\certs** folder to the **D:\\docker\\UA Applications\\certs** folder on the gateway.</span></span> <span data-ttu-id="7a03c-163">게이트웨이를 다시 시작할 필요는 없습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-163">You do not need to restart of the gateway.</span></span> <span data-ttu-id="7a03c-164">이 단계를 반복합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-164">Repeat this step.</span></span> <span data-ttu-id="7a03c-165">이제 클라우드에서 게이트웨이로 연결할 수 있으며 솔루션에 OPC UA 서버를 추가할 준비가 되었습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-165">You can now connect to the gateway from the cloud, and you are ready to add OPC UA servers to the solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="7a03c-166">OPC UA 서버 추가</span><span class="sxs-lookup"><span data-stu-id="7a03c-166">Add your OPC UA servers</span></span>

1. <span data-ttu-id="7a03c-167">연결된 팩터리 솔루션 포털에서 **자체 OPC UA 서버 연결** 페이지로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-167">Browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="7a03c-168">이전 섹션과 동일한 단계를 수행하여 연결된 팩터리 포털과 OPC UA 서버 간에 트러스트를 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-168">Follow the same steps as in the preceding section to establish trust between the connected factory portal and the OPC UA server.</span></span> <span data-ttu-id="7a03c-169">이 단계를 수행하면 연결된 팩터리 포털 및 OPC UA 서버에서의 인증서 상호 트러스트가 설정되고 연결이 만들어집니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-169">This step establishes a mutual trust of the certificates from the connected factory portal and the OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="7a03c-170">OPC UA 서버의 OPC UA 노드 트리로 이동한 후 OPC 노드를 마우스 오른쪽 단추로 클릭하고 **게시**를 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-170">Browse the OPC UA nodes tree of your OPC UA server, right-click the OPC nodes, and select **publish**.</span></span> <span data-ttu-id="7a03c-171">이렇게 게시하려면 OPC UA 서버 및 게시자가 동일한 네트워크에 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-171">For publishing to work this way, the OPC UA server and the publisher must be on the same network.</span></span> <span data-ttu-id="7a03c-172">예를 들어 게시자의 정규화된 도메인 이름이 **publisher.mydomain.com**이면 OPC UA 서버의 정규화된 도메인 이름은 **myopcuaserver.mydomain.com**이어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-172">In other words, if the fully qualified domain name of the publisher is **publisher.mydomain.com** then the fully qualified domain name of the OPC UA server must be, for example, **myopcuaserver.mydomain.com**.</span></span> <span data-ttu-id="7a03c-173">설정이 다른 경우 **D:\\docker** 폴더에 있는 publishesnodes.json 파일에 수동으로 노드를 추가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-173">If your setup is different, you can manually add nodes to the publishesnodes.json file found in the **D:\\docker** folder.</span></span> <span data-ttu-id="7a03c-174">OPC 노드가 처음으로 성공적으로 게시되면 publishesnodes.json 파일이 자동으로 생성됩니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-174">The publishesnodes.json file is automatically generated on the first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="7a03c-175">이제 원격 분석이 게이트웨이 장치로 진행됩니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-175">Telemetry now flows from the gateway device.</span></span> <span data-ttu-id="7a03c-176">**새 팩터리** 아래에 있는 연결된 팩터리 포털의 **팩터리 위치** 보기에서 원격 분석을 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-176">You can view the telemetry in the **Factory Locations** view of the connected factory portal under **New Factory**.</span></span>

## <a name="linux-deployment"></a><span data-ttu-id="7a03c-177">Linux 배포</span><span class="sxs-lookup"><span data-stu-id="7a03c-177">Linux deployment</span></span>

> [!NOTE]
> <span data-ttu-id="7a03c-178">게이트웨이 장치가 아직 없는 경우 파트너로부터 상용 게이트웨이를 구입하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-178">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="7a03c-179">[Azure IoT 장치 카탈로그]에서 연결된 팩터리 솔루션과 호환되는 게이트웨이 장치 목록을 확인하세요.</span><span class="sxs-lookup"><span data-stu-id="7a03c-179">Visit the [Azure IoT device catalog] for a list of gateway devices compatible with the connected factory solution.</span></span> <span data-ttu-id="7a03c-180">장치와 함께 제공되는 지침에 따라 게이트웨이를 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-180">Follow the instructions that come with the device to set up the gateway.</span></span> <span data-ttu-id="7a03c-181">또는 다음 지침을 사용하여 기존 게이트웨이 중 하나를 수동으로 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-181">Alternatively, use the following instructions to manually set up one of your existing gateways.</span></span>

<span data-ttu-id="7a03c-182">Linux 게이트웨이 장치에서 [Docker를 설치]합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-182">[Install Docker] on your Linux gateway device.</span></span>

### <a name="configure-the-gateway"></a><span data-ttu-id="7a03c-183">게이트웨이 구성</span><span class="sxs-lookup"><span data-stu-id="7a03c-183">Configure the gateway</span></span>

1. <span data-ttu-id="7a03c-184">게이트웨이 배포를 완료하려면 Azure IoT Suite 연결된 팩터리 배포의 **iothubowner** 연결 문자열이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-184">You need the **iothubowner** connection string of your Azure IoT Suite connected factory deployment to complete the gateway deployment.</span></span> <span data-ttu-id="7a03c-185">[Azure Portal]에서 연결된 팩터리 솔루션을 배포할 때 만든 리소스 그룹의 IoT Hub로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-185">In the [Azure portal], navigate to your IoT Hub in the resource group created when you deployed the connected factory solution.</span></span> <span data-ttu-id="7a03c-186">**공유 액세스 정책**을 클릭하여 **iothubowner** 연결 문자열에 액세스합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-186">Click **Shared access policies** to access the **iothubowner** connection string:</span></span>

    ![IoT Hub 연결 문자열 찾기][img-hub-connection]

    <span data-ttu-id="7a03c-188">**연결 문자열 - 기본 키** 값을 복사합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-188">Copy the **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="7a03c-189">다음을 사용하여 셸에서 두 게이트웨이 모듈을 **한번에** 실행하여 IoT Hub에 대한 게이트웨이를 구성합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-189">Configure the gateway for your IoT Hub by running the two gateway modules **once** from a shell with:</span></span>

    `sudo docker run -it --rm -h <ApplicationName> -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/ -v /shared:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `sudo docker run --rm -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="7a03c-190">**&lt;ApplicationName&gt;** 은 게이트웨이가 **게시자.&lt;정규화된 도메인 이름&gt;** 형식으로 만드는 OPC UA 응용 프로그램의 이름입니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-190">**&lt;ApplicationName&gt;** is the name of the OPC UA application the gateway creates in the format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="7a03c-191">예를 들면 **publisher.microsoft.com**과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-191">For example, **publisher.microsoft.com**.</span></span>
    * <span data-ttu-id="7a03c-192">**&lt;IoTHubOwnerConnectionString&gt;**은 이전 단계에서 복사한 **iothubowner** 연결 문자열입니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-192">**&lt;IoTHubOwnerConnectionString&gt;** is the **iothubowner** connection string you copied in the previous step.</span></span> <span data-ttu-id="7a03c-193">이 연결 문자열은 이 단계에서만 사용하며 다음 단계에서 다시 필요하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-193">This connection string is only used in this step, you don’t need it in the following steps:</span></span>

    <span data-ttu-id="7a03c-194">**/shared** 폴더(`-v` 인수)는 게이트웨이 모듈에서 사용되는 두 X.509 인증서를 유지하기 위해 나중에 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-194">You use the **/shared** folder (the `-v` argument) later to persist the two X.509 certificates that the gateway modules use.</span></span>

### <a name="run-the-gateway"></a><span data-ttu-id="7a03c-195">게이트웨이 실행</span><span class="sxs-lookup"><span data-stu-id="7a03c-195">Run the gateway</span></span>

1. <span data-ttu-id="7a03c-196">다음 명령을 사용하여 게이트웨이를 다시 시작합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-196">Restart the gateway using the following commands:</span></span>

    `sudo docker run -it -h <ApplicationName> --expose 62222 -p 62222:62222 –-rm -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v /shared:/shared -v /shared:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `sudo docker run -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="7a03c-197">보안상의 이유로 **/shared** 폴더에 유지되는 두 X.509 인증서는 개인 키를 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-197">For security reasons, the two X.509 certificates persisted in the **/shared** folder contain the private key.</span></span> <span data-ttu-id="7a03c-198">이 폴더에 대한 액세스는 Docker 컨테이너를 실행하는 데 사용된 자격 증명으로 제한됩니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-198">Limit access to this folder to the credentials you use to run the Docker container.</span></span> <span data-ttu-id="7a03c-199">**루트**에 대해서만 사용 권한을 설정하려면 해당 폴더에 대해 `chmod` 셸 명령을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-199">To set the permissions for **root** only, use the `chmod` shell command on the folder.</span></span>

1. <span data-ttu-id="7a03c-200">네트워크 연결을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-200">Verify network connectivity.</span></span> <span data-ttu-id="7a03c-201">셸에서 명령 `ping publisher.<your fully qualified domain name>`을 입력하여 게이트웨이를 ping합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-201">From a shell, enter the command `ping publisher.<your fully qualified domain name>` to ping your gateway.</span></span> <span data-ttu-id="7a03c-202">대상에 연결할 수 없는 경우 게이트웨이의 hosts 파일에 게이트웨이의 IP 주소와 이름을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-202">If the destination is unreachable, add the IP address and name of your gateway to your hosts file on your gateway.</span></span> <span data-ttu-id="7a03c-203">호스트 파일은 **/etc** 폴더에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-203">The hosts file is located in the **/etc** folder.</span></span>

1. <span data-ttu-id="7a03c-204">다음으로 게이트웨이에서 실행되는 로컬 OPC UA 클라이언트를 사용하여 게시자에 연결하려고 합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-204">Next, try to connect to the publisher using a local OPC UA client running on the gateway.</span></span> <span data-ttu-id="7a03c-205">OPC UA 끝점 URL은 `opc.tcp://publisher.<your fully qualified domain name>:62222`입니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-205">The OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="7a03c-206">OPC UA 클라이언트가 없으면 [오픈 소스 OPC UA 클라이언트]를 다운로드하여 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-206">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="7a03c-207">이러한 로컬 테스트를 성공적으로 완료한 경우 연결된 팩터리 솔루션 포털에서 **자체 OPC UA 서버 연결** 페이지로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-207">When you have successfully completed these local tests, browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="7a03c-208">게시자 끝점 URL(`tcp://publisher.<your fully qualified domain name>:62222`)을 입력하고 **연결**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-208">Enter the publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="7a03c-209">인증서 경고가 표시되면 **계속**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-209">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="7a03c-210">다음으로 게시자가 UA 웹 클라이언트를 신뢰하지 않는다는 오류가 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-210">Next you get an error that the publisher doesn’t trust the UA Web Client.</span></span> <span data-ttu-id="7a03c-211">이 오류를 해결하려면 **/shared/Rejected Certificates/certs** 폴더의 **UA 웹 클라이언트** 인증서를 게이트웨이의 **/shared/UA Applications/certs** 폴더로 복사합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-211">To resolve this error, copy the **UA Web Client** certificate from the **/shared/Rejected Certificates/certs** folder to the **/shared/UA Applications/certs** folder on the gateway.</span></span> <span data-ttu-id="7a03c-212">게이트웨이를 다시 시작할 필요는 없습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-212">You do not need to restart of the gateway.</span></span> <span data-ttu-id="7a03c-213">이 단계를 반복합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-213">Repeat this step.</span></span> <span data-ttu-id="7a03c-214">이제 클라우드에서 게이트웨이로 연결할 수 있으며 솔루션에 OPC UA 서버를 추가할 준비가 되었습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-214">You can now connect to the gateway from the cloud, and you are ready to add OPC UA servers to the solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="7a03c-215">OPC UA 서버 추가</span><span class="sxs-lookup"><span data-stu-id="7a03c-215">Add your OPC UA servers</span></span>

1. <span data-ttu-id="7a03c-216">연결된 팩터리 솔루션 포털에서 **자체 OPC UA 서버 연결** 페이지로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-216">Browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="7a03c-217">이전 섹션과 동일한 단계를 수행하여 연결된 팩터리 포털과 OPC UA 서버 간에 트러스트를 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-217">Follow the same steps as in the preceding section to establish trust between the connected factory portal and the OPC UA server.</span></span> <span data-ttu-id="7a03c-218">이 단계를 수행하면 연결된 팩터리 포털 및 OPC UA 서버에서의 인증서 상호 트러스트가 설정되고 연결이 만들어집니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-218">This step establishes a mutual trust of the certificates from the connected factory portal and the OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="7a03c-219">OPC UA 서버의 OPC UA 노드 트리로 이동한 후 OPC 노드를 마우스 오른쪽 단추로 클릭하고 **게시**를 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-219">Browse the OPC UA nodes tree of your OPC UA server, right-click the OPC nodes, and select **publish**.</span></span> <span data-ttu-id="7a03c-220">이렇게 게시하려면 OPC UA 서버 및 게시자가 동일한 네트워크에 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-220">For publishing to work this way, the OPC UA server and the publisher must be on the same network.</span></span> <span data-ttu-id="7a03c-221">예를 들어 게시자의 정규화된 도메인 이름이 **publisher.mydomain.com**이면 OPC UA 서버의 정규화된 도메인 이름은 **myopcuaserver.mydomain.com**이어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-221">In other words, if the fully qualified domain name of the publisher is **publisher.mydomain.com** then the fully qualified domain name of the OPC UA server must be, for example, **myopcuaserver.mydomain.com**.</span></span> <span data-ttu-id="7a03c-222">설정이 다른 경우 **/shared** 폴더에 있는 publishesnodes.json 파일에 수동으로 노드를 추가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-222">If your setup is different, you can manually add nodes to the publishesnodes.json file found in the **/shared** folder.</span></span> <span data-ttu-id="7a03c-223">OPC 노드가 처음으로 성공적으로 게시되면 publishesnodes.json이 자동으로 생성됩니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-223">The publishesnodes.json is automatically generated on the first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="7a03c-224">이제 원격 분석이 게이트웨이 장치로 진행됩니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-224">Telemetry now flows from the gateway device.</span></span> <span data-ttu-id="7a03c-225">**새 팩터리** 아래에 있는 연결된 팩터리 포털의 **팩터리 위치** 보기에서 원격 분석을 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7a03c-225">You can view the telemetry in the **Factory Locations** view of the connected factory portal under **New Factory**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7a03c-226">다음 단계</span><span class="sxs-lookup"><span data-stu-id="7a03c-226">Next steps</span></span>

<span data-ttu-id="7a03c-227">연결된 팩터리 미리 구성된 솔루션의 아키텍처에 대한 자세한 내용은 [연결된 팩터리 미리 구성된 솔루션 연습][lnk-walkthrough]을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="7a03c-227">To learn more about the architecture of the connected factory preconfigured solution, see [Connected factory preconfigured solution walkthrough][lnk-walkthrough].</span></span>

[img-install-docker]: ./media/iot-suite-connected-factory-gateway-deployment/image1.png
[img-hub-connection]: ./media/iot-suite-connected-factory-gateway-deployment/image2.png
[img-docker-share]: ./media/iot-suite-connected-factory-gateway-deployment/image3.png

<span data-ttu-id="7a03c-228">[Windows용 Docker]: https://www.docker.com/docker-windows</span><span class="sxs-lookup"><span data-stu-id="7a03c-228">[Docker for Windows]: https://www.docker.com/docker-windows</span></span>
<span data-ttu-id="7a03c-229">[Azure IoT 장치 카탈로그]: https://catalog.azureiotsuite.com/?q=opc</span><span class="sxs-lookup"><span data-stu-id="7a03c-229">[Azure IoT device catalog]: https://catalog.azureiotsuite.com/?q=opc</span></span>
<span data-ttu-id="7a03c-230">[Azure Portal]: http://portal.azure.com/</span><span class="sxs-lookup"><span data-stu-id="7a03c-230">[Azure portal]: http://portal.azure.com/</span></span>
<span data-ttu-id="7a03c-231">[오픈 소스 OPC UA 클라이언트]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4</span><span class="sxs-lookup"><span data-stu-id="7a03c-231">[open-source OPC UA client]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4</span></span>
<span data-ttu-id="7a03c-232">[Docker를 설치]: https://www.docker.com/community-edition#/download</span><span class="sxs-lookup"><span data-stu-id="7a03c-232">[Install Docker]: https://www.docker.com/community-edition#/download</span></span>
[lnk-walkthrough]: iot-suite-connected-factory-sample-walkthrough.md
<span data-ttu-id="7a03c-233">[Azure IoT Edge]: https://github.com/Azure/iot-edge</span><span class="sxs-lookup"><span data-stu-id="7a03c-233">[Azure IoT Edge]: https://github.com/Azure/iot-edge</span></span>

[lnk-publisher-github]: https://github.com/Azure/iot-edge-opc-publisher
[lnk-publisher-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua
[lnk-proxy-github]: https://github.com/Azure/iot-edge-opc-proxy
[lnk-proxy-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua-proxy