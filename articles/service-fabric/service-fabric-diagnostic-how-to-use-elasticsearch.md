---
title: "Service Fabric 응용 프로그램 추적 저장소와 같은 Elasticsearch 사용 | Microsoft Docs"
description: "서비스 패브릭 응용 프로그램이 Elasticsearch 및 Kibana를 사용하여 응용 프로그램 추적을 통해 저장, 인덱싱 및 검색하는 방법에 대해 설명합니다."
services: service-fabric
documentationcenter: .net
author: karolz-ms
manager: adegeo
editor: 
ms.assetid: e59b0c39-e468-4d9e-b453-d5f2a8ad20d8
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: karolz@microsoft.com
redirect_url: /azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow
ms.openlocfilehash: 2d2ceceea131b41ad1a1735aaa2a859d035ab098
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 07/11/2017
---
# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a><span data-ttu-id="566be-103">서비스 패브릭 응용 프로그램 추적 저장소로 ElasticSearch 사용</span><span class="sxs-lookup"><span data-stu-id="566be-103">Use Elasticsearch as a Service Fabric application trace store</span></span>
## <a name="introduction"></a><span data-ttu-id="566be-104">소개</span><span class="sxs-lookup"><span data-stu-id="566be-104">Introduction</span></span>
<span data-ttu-id="566be-105">이 문서에서는 [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) 응용 프로그램이 프로그램 추적 저장소, 인덱싱 및 검색을 위해 **Elasticsearch** 및 **Kibana**를 사용할 수 있는 방법에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-105">This article describes how [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) applications can use **Elasticsearch** and **Kibana** for application trace storage, indexing, and search.</span></span> <span data-ttu-id="566be-106">[Elasticsearch](https://www.elastic.co/guide/index.html)는 이 작업에 적합한 공개 소스, 분산 및 확장 가능한 실시간 검색 및 분석 엔진이며</span><span class="sxs-lookup"><span data-stu-id="566be-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is an open-source, distributed, and scalable real-time search and analytics engine that is well-suited for this task.</span></span> <span data-ttu-id="566be-107">Microsoft Azure에서 실행되는 Windows 및 Linux 가상 컴퓨터에 설치할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-107">It can be installed on Windows and Linux virtual machines running in Microsoft Azure.</span></span> <span data-ttu-id="566be-108">Elasticsearch는 **ETW(Windows용 이벤트 추적)**와 같은 기술을 사용하여 생성된 *구조화된* 추적을 효율적으로 처리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-108">Elasticsearch can efficiently process *structured* traces produced using technologies such as **Event Tracing for Windows (ETW)**.</span></span>

<span data-ttu-id="566be-109">ETW는 서비스 패브릭 런타임에서 진단 정보(추적)를 얻는 데 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="566be-109">ETW is used by Service Fabric runtime to source diagnostic information (traces).</span></span> <span data-ttu-id="566be-110">이는 서비스 패브릭 응용 프로그램에서 응용 프로그램의 진단 정보를 얻는 데에도 권장되는 방법입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-110">It is the recommended method for Service Fabric applications to source their diagnostic information, too.</span></span> <span data-ttu-id="566be-111">동일한 메커니즘을 사용하면 런타임 제공 및 응용 프로그램 제공 추적 사이의 상관관계를 허용하고 문제를 보다 쉽게 해결할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-111">Using the same mechanism allows for correlation between runtime-supplied and application-supplied traces and makes troubleshooting easier.</span></span> <span data-ttu-id="566be-112">Visual Studio의 서비스 패브릭 프로젝트 템플릿에는 기본적으로 ETW 추적을 내보내는 로깅 API(.NET **EventSource** 클래스 기반)가 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="566be-112">Service Fabric project templates in Visual Studio include a logging API (based on the .NET **EventSource** class) that emits ETW traces by default.</span></span> <span data-ttu-id="566be-113">ETW를 사용한 서비스 패브릭 응용 프로그램 추적에 대한 일반적인 개요는 [로컬 컴퓨터 개발 설정에서의 모니터링 및 진단 서비스](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="566be-113">For a general overview of Service Fabric application tracing using ETW, see [Monitoring and diagnosing services in a local machine development setup](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span></span>

<span data-ttu-id="566be-114">Elasticsearch에 추적을 표시하려면 실시간으로 서비스 패브릭 클러스터 노드에서 캡처하고(응용 프로그램 실행 중) Elasticsearch 끝점에 전송해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-114">For the traces to show up in Elasticsearch, they need to be captured at the Service Fabric cluster nodes in real time (while the application is running) and sent to an Elasticsearch endpoint.</span></span> <span data-ttu-id="566be-115">추적 캡처에 대한 두 가지 주요 옵션이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-115">There are two major options for trace capturing:</span></span>

* <span data-ttu-id="566be-116">**In Process 추적 캡처**</span><span class="sxs-lookup"><span data-stu-id="566be-116">**In-process trace capturing**</span></span>  
  <span data-ttu-id="566be-117">응용 프로그램 또는 보다 정확하게 서비스 프로세스는 추적 저장소에 진단 데이터를 전송하는 것을 담당합니다(Elasticsearch).</span><span class="sxs-lookup"><span data-stu-id="566be-117">The application, or more precisely, service process, is responsible for sending out the diagnostic data to the trace store (Elasticsearch).</span></span>
* <span data-ttu-id="566be-118">**Out of Process 추적 캡처**</span><span class="sxs-lookup"><span data-stu-id="566be-118">**Out-of-process trace capturing**</span></span>  
  <span data-ttu-id="566be-119">별도 에이전트를 서비스 프로세스에서 추적 캡처하고 추적 저장소에 보냅니다.</span><span class="sxs-lookup"><span data-stu-id="566be-119">A separate agent is capturing traces from the service process or processes and sending them to the trace store.</span></span>

<span data-ttu-id="566be-120">아래에서 Azure에 Elasticsearch를 설정하는 방법을 설명하고 캡처 옵션의 장단점에 대해 알아보고 Elasticsearch에 데이터를 전송하도록 서비스 패브릭 서비스를 구성하는 방법을 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-120">Below, we describe how to set up Elasticsearch on Azure, discuss the pros and cons for both capture options, and explain how to configure a Service Fabric service to send data to Elasticsearch.</span></span>

## <a name="set-up-elasticsearch-on-azure"></a><span data-ttu-id="566be-121">Azure에 Elasticsearch 설정</span><span class="sxs-lookup"><span data-stu-id="566be-121">Set up Elasticsearch on Azure</span></span>
<span data-ttu-id="566be-122">Azure에 Elasticsearch 서비스를 설정하는 가장 간단한 방법은 [**Azure Resource Manager 템플릿**](../azure-resource-manager/resource-group-overview.md)을 통하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-122">The most straightforward way to set up the Elasticsearch service on Azure is through [**Azure Resource Manager templates**](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="566be-123">포괄적인 [Elasticsearch에 대한 빠른 시작 Azure 리소스 관리자 템플릿](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) 은 Azure 빠른 시작 템플릿 리포지토리에서 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-123">A comprehensive [Quickstart Azure Resource Manager template for Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is available from Azure Quickstart templates repository.</span></span> <span data-ttu-id="566be-124">이 템플릿에서는 규모 단위(노드 그룹)에 대한 별도의 저장소 계정을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-124">This template uses separate storage accounts for scale units (groups of nodes).</span></span> <span data-ttu-id="566be-125">또한 서로 다른 구성 및 여러 개의 연결된 데이터 디스크를 사용하여 별개의 클라이언트 및 서버 노드를 프로비전할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-125">It can also provision separate client and server nodes with different configurations and various numbers of data disks attached.</span></span>

<span data-ttu-id="566be-126">여기에서 **Azure 진단 도구 저장소** 의 [ES-MultiNode](https://github.com/Azure/azure-diagnostics-tools)라는 다른 템플릿을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-126">Here, we use another template, called **ES-MultiNode** from the [Azure diagnostic tools repository](https://github.com/Azure/azure-diagnostics-tools).</span></span> <span data-ttu-id="566be-127">이 템플릿은 사용하기 쉬우며 HTTP 기본 인증으로 보호되는 Elasticsearch 클러스터를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="566be-127">This template is easier to use, and it creates an Elasticsearch cluster protected by HTTP basic authentication.</span></span> <span data-ttu-id="566be-128">계속하기 전에 리포지토리를 복제하거나 zip 파일을 다운로드하여 GitHub에서 컴퓨터로 리포지토리를 다운로드하세요.</span><span class="sxs-lookup"><span data-stu-id="566be-128">Before you proceed, download the repository from GitHub to your machine (by either cloning the repository or downloading a zip file).</span></span> <span data-ttu-id="566be-129">ES-MultiNode 템플릿은 동일한 이름의 폴더에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-129">The ES-MultiNode template is located in the folder with the same name.</span></span>

### <a name="prepare-a-machine-to-run-elasticsearch-installation-scripts"></a><span data-ttu-id="566be-130">Elasticsearch 설치 스크립트를 실행하도록 컴퓨터 준비</span><span class="sxs-lookup"><span data-stu-id="566be-130">Prepare a machine to run Elasticsearch installation scripts</span></span>
<span data-ttu-id="566be-131">ES MultiNode 템플릿을 사용하는 가장 쉬운 방법은 `CreateElasticSearchCluster`라는 제공된 Azure PowerShell 스크립트를 통하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-131">The easiest way to use the ES-MultiNode template is through a provided Azure PowerShell script called `CreateElasticSearchCluster`.</span></span> <span data-ttu-id="566be-132">이 스크립트를 사용하려면 PowerShell 모듈 및 **openssl**이라는 도구를 설치해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-132">To use this script, you need to install PowerShell modules and a tool called **openssl**.</span></span> <span data-ttu-id="566be-133">후자는 Elasticsearch 클러스터를 원격으로 관리하는 데 사용될 수 있는 SSH 키를 만들기 위해 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-133">The latter is needed for creating an SSH key that can be used to administer your Elasticsearch cluster remotely.</span></span>

<span data-ttu-id="566be-134">`CreateElasticSearchCluster` 스크립트는 Windows 컴퓨터에서 ES-MultiNode 템플릿을 보다 쉽게 사용할 수 있도록 디자인되었습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-134">`CreateElasticSearchCluster` script is designed for ease of use with the ES-MultiNode template from a Windows machine.</span></span> <span data-ttu-id="566be-135">비Windows 컴퓨터에서 템플릿을 사용할 수도 있지만 해당 시나리오가 이 문서의 범위를 벗어납니다.</span><span class="sxs-lookup"><span data-stu-id="566be-135">It is possible to use the template on a non-Windows machine, but that scenario is beyond the scope of this article.</span></span>

1. <span data-ttu-id="566be-136">아직 설치하지 않은 경우 [**Azure PowerShell 모듈**](http://aka.ms/webpi-azps)을 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-136">If you haven't installed them already, install [**Azure PowerShell modules**](http://aka.ms/webpi-azps).</span></span> <span data-ttu-id="566be-137">메시지가 표시되면 **실행**을 클릭한 다음 **설치**합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-137">When prompted, click **Run**, then **Install**.</span></span> <span data-ttu-id="566be-138">Azure PowerShell 1.3 이상이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-138">Azure PowerShell 1.3 or newer is required.</span></span>
2. <span data-ttu-id="566be-139">**openssl** 도구는 [**Windows용 Git**](http://www.git-scm.com/downloads)의 배포에 포함되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-139">The **openssl** tool is included in the distribution of [**Git for Windows**](http://www.git-scm.com/downloads).</span></span> <span data-ttu-id="566be-140">[Windows용 GIT](http://www.git-scm.com/downloads) 를 아직 설치하지 않은 경우 지금 설치하세요.</span><span class="sxs-lookup"><span data-stu-id="566be-140">If you have not done so already, install [Git for Windows](http://www.git-scm.com/downloads) now.</span></span> <span data-ttu-id="566be-141">(기본 설치 옵션도 적합합니다.)</span><span class="sxs-lookup"><span data-stu-id="566be-141">(The default installation options are OK.)</span></span>
3. <span data-ttu-id="566be-142">Git가 설치되었지만 시스템 경로에 포함되지 않았다고 가정하면 Microsoft Azure PowerShell 창을 열고 다음 명령을 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-142">Assuming that Git has been installed but not included in the system path, open a Microsoft Azure PowerShell window and run the following commands:</span></span>
   
    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```
   
    <span data-ttu-id="566be-143">`<Git installation folder>`를 컴퓨터의 Git 위치로 대체합니다. 기본값은 **"C:\Program Files\Git"**입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-143">Replace the `<Git installation folder>` with the Git location on your machine; the default is **"C:\Program Files\Git"**.</span></span> <span data-ttu-id="566be-144">첫 번째 경로의 시작 부분에는 세미콜론 문자가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-144">Note the semicolon character at the beginning of the first path.</span></span>
4. <span data-ttu-id="566be-145">Azure에 로그온하고( [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet를 통해) Elastic Search 클러스터를 만드는 데 사용되어야 하는 구독을 선택했는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-145">Ensure that you are logged on to Azure (via [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) and that you have selected the subscription that should be used to create your Elastic Search cluster.</span></span> <span data-ttu-id="566be-146">`Get-AzureRmContext` 및 `Get-AzureRmSubscription` cmdlet를 사용하여 올바른 구독을 선택했는지 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-146">You can verify that correct subscription is selected using `Get-AzureRmContext` and `Get-AzureRmSubscription` cmdlets.</span></span>
5. <span data-ttu-id="566be-147">아직 수행하지 않은 경우 현재 디렉터리를 ES-MultiNode 폴더로 변경합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-147">If you haven't done so already, change the current directory to the ES-MultiNode folder.</span></span>

### <a name="run-the-createelasticsearchcluster-script"></a><span data-ttu-id="566be-148">CreateElasticSearchCluster 스크립트 실행</span><span class="sxs-lookup"><span data-stu-id="566be-148">Run the CreateElasticSearchCluster script</span></span>
<span data-ttu-id="566be-149">스크립트를 실행하기 전에 `azuredeploy-parameters.json` 파일을 열고 스크립트 매개 변수에 대한 값을 확인하거나 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-149">Before you run the script, open the `azuredeploy-parameters.json` file and verify or provide values for the script parameters.</span></span> <span data-ttu-id="566be-150">다음 매개 변수가 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="566be-150">The following parameters are provided:</span></span>

| <span data-ttu-id="566be-151">매개 변수 이름</span><span class="sxs-lookup"><span data-stu-id="566be-151">Parameter Name</span></span> | <span data-ttu-id="566be-152">설명</span><span class="sxs-lookup"><span data-stu-id="566be-152">Description</span></span> |
| --- | --- |
| <span data-ttu-id="566be-153">dnsNameForLoadBalancerIP</span><span class="sxs-lookup"><span data-stu-id="566be-153">dnsNameForLoadBalancerIP</span></span> |<span data-ttu-id="566be-154">Elasticsearch 클러스터에 대해 공개적으로 표시되는 DNS 이름을 만드는 데 사용되는 이름입니다(Azure 지역 도메인을 제공된 이름에 추가하여).</span><span class="sxs-lookup"><span data-stu-id="566be-154">The name that is used to create the publicly visible DNS name for the Elastic Search cluster (by appending the Azure region domain to the provided name).</span></span> <span data-ttu-id="566be-155">예를 들어 이 매개 변수 값이 "myBigCluster"인 경우 선택한 Azure 지역은 미국 서부이며 클러스터에 대한 결과 DNS 이름이 myBigCluster.westus.cloudapp.azure.com이 됩니다.</span><span class="sxs-lookup"><span data-stu-id="566be-155">For example, if this parameter value is "myBigCluster" and the chosen Azure region is West US, the resulting DNS name for the cluster is myBigCluster.westus.cloudapp.azure.com.</span></span> <br /><br /><span data-ttu-id="566be-156">이 이름은 데이터 노드 이름 같은 Elasticsearch 클러스터와 관련된 많은 아티팩트에 대한 이름의 루트로 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="566be-156">This name also serves as a root name for many artifacts associated with the Elastic Search cluster, such as data node names.</span></span> |
| <span data-ttu-id="566be-157">adminUsername</span><span class="sxs-lookup"><span data-stu-id="566be-157">adminUsername</span></span> |<span data-ttu-id="566be-158">Elasticsearch 클러스터를 관리하기 위한 관리자 계정 이름입니다(해당 SSH 키는 자동으로 생성됨).</span><span class="sxs-lookup"><span data-stu-id="566be-158">The name of the administrator account for managing the Elastic Search cluster (corresponding SSH keys are generated automatically).</span></span> |
| <span data-ttu-id="566be-159">dataNodeCount</span><span class="sxs-lookup"><span data-stu-id="566be-159">dataNodeCount</span></span> |<span data-ttu-id="566be-160">Elasticsearch 클러스터의 노드 수입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-160">The number of nodes in the Elastic Search cluster.</span></span> <span data-ttu-id="566be-161">스크립트의 현재 버전은 데이터와 쿼리 노드를 구분하지 않습니다. 모든 노드는 두 역할을 모두 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-161">The current version of the script does not distinguish between data and query nodes; all nodes play both roles.</span></span> <span data-ttu-id="566be-162">기본 노드 수는 3개입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-162">Defaults to 3 nodes.</span></span> |
| <span data-ttu-id="566be-163">dataDiskSize</span><span class="sxs-lookup"><span data-stu-id="566be-163">dataDiskSize</span></span> |<span data-ttu-id="566be-164">각 데이터 노드에 할당되는 데이터 디스크의 크기(GB)입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-164">The size of data disks (in GB) that is allocated for each data node.</span></span> <span data-ttu-id="566be-165">각 노드는 Elasticsearch 서비스 전용으로 4개의 데이터 디스크를 받게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="566be-165">Each node receives 4 data disks, exclusively dedicated to Elastic Search service.</span></span> |
| <span data-ttu-id="566be-166">region</span><span class="sxs-lookup"><span data-stu-id="566be-166">region</span></span> |<span data-ttu-id="566be-167">Elasticsearch 클러스터가 위치해야 하는 Azure 지역의 이름입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-167">The name of Azure region where the Elastic Search cluster should be located.</span></span> |
| <span data-ttu-id="566be-168">esUserName</span><span class="sxs-lookup"><span data-stu-id="566be-168">esUserName</span></span> |<span data-ttu-id="566be-169">ES 클러스터에 액세스하도록 구성할 사용자의 사용자 이름입니다(HTTP 기본 인증에 따라 달라짐).</span><span class="sxs-lookup"><span data-stu-id="566be-169">The user name of the user that is configured to have access to ES cluster (subject to HTTP basic authentication).</span></span> <span data-ttu-id="566be-170">암호는 매개 변수 파일의 일부가 아니며 `CreateElasticSearchCluster` 스크립트가 호출될 때 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="566be-170">The password is not part of parameters file and must be provided when `CreateElasticSearchCluster` script is invoked.</span></span> |
| <span data-ttu-id="566be-171">vmSizeDataNodes</span><span class="sxs-lookup"><span data-stu-id="566be-171">vmSizeDataNodes</span></span> |<span data-ttu-id="566be-172">Elasticsearch 클러스터 노드에 대한 Azure 가상 컴퓨터 크기입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-172">The Azure virtual machine size for Elastic Search cluster nodes.</span></span> <span data-ttu-id="566be-173">기본값은 Standard_D2입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-173">Defaults to Standard_D2.</span></span> |

<span data-ttu-id="566be-174">이제 스크립트를 실행할 준비가 되었습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-174">Now you are ready to run the script.</span></span> <span data-ttu-id="566be-175">다음 명령을 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-175">Issue the following command:</span></span>

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

<span data-ttu-id="566be-176">여기서,</span><span class="sxs-lookup"><span data-stu-id="566be-176">where</span></span> 

| <span data-ttu-id="566be-177">매개 변수 이름</span><span class="sxs-lookup"><span data-stu-id="566be-177">Script Parameter Name</span></span> | <span data-ttu-id="566be-178">설명</span><span class="sxs-lookup"><span data-stu-id="566be-178">Description</span></span> |
| --- | --- |
| `<es-group-name>` |<span data-ttu-id="566be-179">모든 Elasticsearch 클러스터 리소스를 포함하는 Azure 리소스 그룹의 이름입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-179">The name of the Azure resource group that will contain all Elastic Search cluster resources.</span></span> |
| `<azure-region>` |<span data-ttu-id="566be-180">Elasticsearch 클러스터를 만들어야 하는 Azure 지역의 이름입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-180">The name of the Azure region where the Elastic Search cluster should be created.</span></span> |
| `<es-password>` |<span data-ttu-id="566be-181">Elasticsearch 사용자의 암호입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-181">The password for the Elastic Search user.</span></span> |

> [!NOTE]
> <span data-ttu-id="566be-182">Test-AzureResourceGroup cmdlet에서 NullReferenceException을 받는 경우 Azure에 로그온하는 것을 잊은 것입니다(`Add-AzureRmAccount`).</span><span class="sxs-lookup"><span data-stu-id="566be-182">If you get a NullReferenceException from the Test-AzureResourceGroup cmdlet, you have forgotten to log on to Azure (`Add-AzureRmAccount`).</span></span>
> 
> 

<span data-ttu-id="566be-183">스크립트 실행에서 오류가 발생하고 잘못된 템플릿 매개 변수 값으로 오류가 발생한 것을 결정하는 경우 매개 변수 파일을 수정하고 다른 리소스 그룹 이름으로 스크립트를 다시 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-183">If you get an error from running the script and you determine that the error was caused by a wrong template parameter value, correct the parameter file and run the script again with a different resource group name.</span></span> <span data-ttu-id="566be-184">동일한 리소스 그룹 이름을 다시 사용하고 `-RemoveExistingResourceGroup` 매개 변수를 스크립트 호출에 추가하여 스크립트에서 이전 것을 정리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-184">You can also reuse the same resource group name and have the script clean up the old one by adding the `-RemoveExistingResourceGroup` parameter to the script invocation.</span></span>

### <a name="result-of-running-the-createelasticsearchcluster-script"></a><span data-ttu-id="566be-185">CreateElasticSearchCluster 스크립트 실행 결과</span><span class="sxs-lookup"><span data-stu-id="566be-185">Result of running the CreateElasticSearchCluster script</span></span>
<span data-ttu-id="566be-186">`CreateElasticSearchCluster` 스크립트를 실행한 후 다음과 같은 주요 아티팩트가 생성됩니다.</span><span class="sxs-lookup"><span data-stu-id="566be-186">After you run the `CreateElasticSearchCluster` script, the following main artifacts will be created.</span></span> <span data-ttu-id="566be-187">이 예제에서는 `dnsNameForLoadBalancerIP` 매개 변수의 값에 대해 "myBigCluster"를 사용했고 클러스터를 만든 지역을 미국 서부라고 가정합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-187">For this example we assume that you have used "myBigCluster" as the value of the `dnsNameForLoadBalancerIP` parameter and that the region where you created the cluster is West US.</span></span>

| <span data-ttu-id="566be-188">아티팩트</span><span class="sxs-lookup"><span data-stu-id="566be-188">Artifact</span></span> | <span data-ttu-id="566be-189">이름, 위치 및 설명</span><span class="sxs-lookup"><span data-stu-id="566be-189">Name, location, and remarks</span></span> |
| --- | --- |
| <span data-ttu-id="566be-190">원격 관리를 위한 SSH 키</span><span class="sxs-lookup"><span data-stu-id="566be-190">SSH key for remote administration</span></span> |<span data-ttu-id="566be-191">myBigCluster.key 파일(CreateElasticSearchCluster가 실행된 디렉터리에 있음).</span><span class="sxs-lookup"><span data-stu-id="566be-191">myBigCluster.key file (in the directory from which the CreateElasticSearchCluster was run).</span></span> <br /><br /><span data-ttu-id="566be-192">이 키 파일을 클러스터의 데이터 노드에 관리자 노드를 연결하는 데(관리자 노드를 통해) 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-192">This key file can be used to connect to the admin node and (through the admin node) to data nodes in the cluster.</span></span> |
| <span data-ttu-id="566be-193">관리 노드</span><span class="sxs-lookup"><span data-stu-id="566be-193">Admin node</span></span> |<span data-ttu-id="566be-194">myBigCluster-admin.westus.cloudapp.azure.com </span><span class="sxs-lookup"><span data-stu-id="566be-194">myBigCluster-admin.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="566be-195">원격 Elasticsearch 클러스터 관리를 위한 외부 SSH 연결을 허용하는 유일한 전용 VM입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-195">A dedicated VM for remote Elasticsearch cluster administration--the only one that allows external SSH connections.</span></span> <span data-ttu-id="566be-196">모든 Elasticsearch 클러스터 노드와 동일한 가상 네트워크에서 실행되지만 Elasticsearch 서비스를 실행하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-196">It runs on the same virtual network as all the Elasticsearch cluster nodes, but it does not run any Elasticsearch services.</span></span> |
| <span data-ttu-id="566be-197">데이터 노드</span><span class="sxs-lookup"><span data-stu-id="566be-197">Data nodes</span></span> |<span data-ttu-id="566be-198">myBigCluster1 …</span><span class="sxs-lookup"><span data-stu-id="566be-198">myBigCluster1 …</span></span> <span data-ttu-id="566be-199">myBigCluster*N*</span><span class="sxs-lookup"><span data-stu-id="566be-199">myBigCluster*N*</span></span> <br /><br /><span data-ttu-id="566be-200">Elasticsearch 및 Kibana 서비스를 실행하는 데이터 노드입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-200">Data nodes that are running Elasticsearch and Kibana services.</span></span> <span data-ttu-id="566be-201">각 노드에 SSH를 통해 연결할 수 있지만 관리자 노드를 통해서만 연결할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-201">You can connect via SSH to each node, but only via the admin node.</span></span> |
| <span data-ttu-id="566be-202">Elasticsearch 클러스터</span><span class="sxs-lookup"><span data-stu-id="566be-202">Elasticsearch cluster</span></span> |<span data-ttu-id="566be-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span><span class="sxs-lookup"><span data-stu-id="566be-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span></span> <br /><br /><span data-ttu-id="566be-204">Elasticsearch 클러스터에 대한 기본 끝점입니다(/es 접미사).</span><span class="sxs-lookup"><span data-stu-id="566be-204">The primary endpoint for the Elasticsearch cluster (note the /es suffix).</span></span> <span data-ttu-id="566be-205">기본 HTTP 인증으로 보호됩니다. 자격 증명은 ES-MultiNode 템플릿의 esUserName/esPassword 매개 변수로 지정됩니다.</span><span class="sxs-lookup"><span data-stu-id="566be-205">It is protected by basic HTTP authentication (the credentials were the specified esUserName/esPassword parameters of the ES-MultiNode template).</span></span> <span data-ttu-id="566be-206">클러스터에는 기본 클러스터 관리를 위한 헤드 플러그인(http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head)도 설치됩니다.</span><span class="sxs-lookup"><span data-stu-id="566be-206">The cluster has also the head plug-in installed (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) for basic cluster administration.</span></span> |
| <span data-ttu-id="566be-207">Kibana 서비스</span><span class="sxs-lookup"><span data-stu-id="566be-207">Kibana service</span></span> |<span data-ttu-id="566be-208">http://myBigCluster.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="566be-208">http://myBigCluster.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="566be-209">만든 Elasticsearch 클러스터에 데이터가 표시되도록 Kibana 서비스가 설정되었습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-209">The Kibana service is set up to show data from the created Elasticsearch cluster.</span></span> <span data-ttu-id="566be-210">클러스터 자체와 동일한 인증 자격 증명으로 보호됩니다.</span><span class="sxs-lookup"><span data-stu-id="566be-210">It is protected by the same authentication credentials as the cluster itself.</span></span> |

## <a name="in-process-versus-out-of-process-trace-capturing"></a><span data-ttu-id="566be-211">In-proces와 out-of-process 추적 캡처 비교</span><span class="sxs-lookup"><span data-stu-id="566be-211">In-process versus out-of-process trace capturing</span></span>
<span data-ttu-id="566be-212">소개 부분에서 진단 데이터 수집의 두 가지 기본 방법(In Process 및 Out of Process)을 언급했습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-212">In the introduction, we mentioned two fundamental ways of collecting diagnostic data: in-process and out-of-process.</span></span> <span data-ttu-id="566be-213">각각은 강점 및 약점이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-213">Each has strengths and weaknesses.</span></span>

<span data-ttu-id="566be-214">다음은 **in-process 추적 캡처** 의 장점입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-214">Advantages of the **in-process trace capturing** include:</span></span>

1. <span data-ttu-id="566be-215">*쉬운 구성 및 배포*</span><span class="sxs-lookup"><span data-stu-id="566be-215">*Easy configuration and deployment*</span></span>
   
   * <span data-ttu-id="566be-216">진단 데이터 수집 구성은 응용 프로그램 구성의 일부입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-216">The configuration of diagnostic data collection is just part of the application configuration.</span></span> <span data-ttu-id="566be-217">응용 프로그램 나머지와 항상 "동기화" 상태로 쉽게 유지할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-217">It is easy to always keep it "in sync" with the rest of the application.</span></span>
   * <span data-ttu-id="566be-218">응용 프로그램당 또는 서비스당 구성은 쉽게 달성할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-218">Per-application or per-service configuration is easily achievable.</span></span>
   * <span data-ttu-id="566be-219">Out of Proces 추적 캡처는 일반적으로 추가 관리 작업 및 잠재적인 오류 소스인 진단 에이전트의 별도 배포 및 구성이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-219">Out-of-process trace capturing usually requires a separate deployment and configuration of the diagnostic agent, which is an extra administrative task and a potential source of errors.</span></span> <span data-ttu-id="566be-220">특정 에이전트 기술은 가상 컴퓨터(노드) 당 하나의 에이전트 인스턴스만 허용하는 경우가 종종 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-220">The particular agent technology often allows only one instance of the agent per virtual machine (node).</span></span> <span data-ttu-id="566be-221">이는 진단 구성 수집에 대한 구성이 해당 노드에서 실행되는 모든 응용 프로그램 및 서비스에서 공유된다는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-221">This means that configuration for the collection of the diagnostic configuration is shared among all applications and services running on that node.</span></span>
2. <span data-ttu-id="566be-222">*유연성*</span><span class="sxs-lookup"><span data-stu-id="566be-222">*Flexibility*</span></span>
   
   * <span data-ttu-id="566be-223">응용 프로그램은 대상 데이터 저장소 시스템을 지원하는 클라이언트 라이브러리가 있는 한 데이터를 필요한 어느 곳이든 보낼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-223">The application can send the data wherever it needs to go, as long as there is a client library that supports the targeted data storage system.</span></span> <span data-ttu-id="566be-224">새로운 싱크를 원하는 대로 추가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-224">New sinks can be added as desired.</span></span>
   * <span data-ttu-id="566be-225">복잡한 캡처, 필터링 및 데이터 집계 규칙을 구현할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-225">Complex capture, filtering, and data-aggregation rules can be implemented.</span></span>
   * <span data-ttu-id="566be-226">out-of-process 추적 캡처는 종종 에이전트가 지원하는 데이터 싱크에 의해 제한됩니다.</span><span class="sxs-lookup"><span data-stu-id="566be-226">An out-of-process trace capturing is often limited by the data sinks that the agent supports.</span></span> <span data-ttu-id="566be-227">일부 에이전트는 확장할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-227">Some agents are extensible.</span></span>
3. <span data-ttu-id="566be-228">*내부 응용 프로그램 데이터 및 컨텍스트에 대한 액세스*</span><span class="sxs-lookup"><span data-stu-id="566be-228">*Access to internal application data and context*</span></span>
   
   * <span data-ttu-id="566be-229">응용 프로그램/서비스 프로세스 내에서 실행되는 진단 하위 시스템은 컨텍스트 정보와 함께 추적을 쉽게 보강할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-229">The diagnostic subsystem running inside the application/service process can easily augment the traces with contextual information.</span></span>
   * <span data-ttu-id="566be-230">Out of Process 방식에서 ETW(Windows용 이벤트 추적)와 같은 일부 프로세스간 통신 메커니즘을 통해 에이전트에 데이터를 보내야 합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-230">In the out-of-process approach, the data must be sent to an agent via some inter-process communication mechanism, such as Event Tracing for Windows.</span></span> <span data-ttu-id="566be-231">이 메커니즘에 따라 추가 제한 사항이 적용될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-231">This mechanism could impose additional limitations.</span></span>

<span data-ttu-id="566be-232">다음은 **out-of-process 추적 캡처** 의 장점입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-232">Advantages of the **out-of-process trace capturing** include:</span></span>

1. <span data-ttu-id="566be-233">*응용 프로그램을 모니터링하고 크래시 덤프를 수집하는 기능*</span><span class="sxs-lookup"><span data-stu-id="566be-233">*The ability to monitor the application and collect crash dumps*</span></span>
   
   * <span data-ttu-id="566be-234">응용 프로그램이 시작하지 못하거나 충돌하는 경우 In Process 추적 캡처는 실패할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-234">In-process trace capturing may be unsuccessful if the application fails to start or crashes.</span></span> <span data-ttu-id="566be-235">독립 에이전트는 중요한 문제 해결 정보를 캡처할 가능성이 훨씬 큽니다.</span><span class="sxs-lookup"><span data-stu-id="566be-235">An independent agent has a much better chance of capturing crucial troubleshooting information.</span></span><br /><br />
2. <span data-ttu-id="566be-236">*완성도, 견고성 및 검증된 성능*</span><span class="sxs-lookup"><span data-stu-id="566be-236">*Maturity, robustness, and proven performance*</span></span>
   
   * <span data-ttu-id="566be-237">플랫폼 공급업체(예: Microsoft Azure 진단 에이전트)에서 개발한 에이전트는 엄격한 테스트 및 강화를 받습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-237">An agent developed by a platform vendor (such as a Microsoft Azure Diagnostics agent) has been subject to rigorous testing and battle-hardening.</span></span>
   * <span data-ttu-id="566be-238">In Process 추적 캡처로 응용 프로그램 프로세스의 진단 데이터 전송 작업이 응용 프로그램 주요 작업을 방해하거나 타이밍 또는 성능 문제가 발생하지 않도록 처리되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-238">With in-process trace capturing, care must be taken to ensure that the activity of sending diagnostic data from an application process does not interfere with the application's main tasks or introduce timing or performance problems.</span></span> <span data-ttu-id="566be-239">독립적으로 실행 중인 에이전트는 이러한 문제가 발생할 가능성이 작고 시스템에 해당 영향을 제한하도록 특별히 설계되었습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-239">An independently running agent is less prone to these issues and is specifically designed to limit its impact on the system.</span></span>

<span data-ttu-id="566be-240">두 가지 접근법을 결합하여 양쪽의 이점을 누릴 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-240">It is possible to combine and benefit from both approaches.</span></span> <span data-ttu-id="566be-241">실제로 많은 응용 프로그램에는 이 방법이 최적의 솔루션일 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-241">Indeed, it might be the best solution for many applications.</span></span>

<span data-ttu-id="566be-242">여기에서 **Microsoft.Diagnostic.Listeners 라이브러리** 및 In Process 추적 캡처를 사용하여 서비스 패브릭 응용 프로그램에서 Elasticsearch 클러스터에 데이터를 보냅니다.</span><span class="sxs-lookup"><span data-stu-id="566be-242">Here, we use the **Microsoft.Diagnostic.Listeners library** and the in-process trace capturing to send data from a Service Fabric application to an Elasticsearch cluster.</span></span>

## <a name="use-the-listeners-library-to-send-diagnostic-data-to-elasticsearch"></a><span data-ttu-id="566be-243">수신기 라이브러리를 사용하여 Elasticsearch에 진단 데이터 보내기</span><span class="sxs-lookup"><span data-stu-id="566be-243">Use the Listeners library to send diagnostic data to Elasticsearch</span></span>
<span data-ttu-id="566be-244">Microsoft.Diagnostic.Listeners 라이브러리는 PartyCluster 샘플 서비스 패브릭 응용 프로그램의 일부입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-244">The Microsoft.Diagnostic.Listeners library is part of PartyCluster sample Service Fabric application.</span></span> <span data-ttu-id="566be-245">이를 사용하려면:</span><span class="sxs-lookup"><span data-stu-id="566be-245">To use it:</span></span>

1. <span data-ttu-id="566be-246">GitHub에서 [PartyCluster 샘플](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) 을 다운로드합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-246">Download [the PartyCluster sample](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) from GitHub.</span></span>
2. <span data-ttu-id="566be-247">PartyCluster 샘플 디렉터리에서 Microsoft.Diagnostics.Listeners 및 Microsoft.Diagnostics.Listeners.Fabric 프로젝트(전체 폴더)를 데이터를 Elasticsearch에 전송하는 응용 프로그램의 솔루션 폴더에 복사합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-247">Copy the Microsoft.Diagnostics.Listeners and Microsoft.Diagnostics.Listeners.Fabric projects (whole folders) from the PartyCluster sample directory to the solution folder of the application that is supposed to send the data to Elasticsearch.</span></span>
3. <span data-ttu-id="566be-248">대상 솔루션을 열고 솔루션 탐색기에서 솔루션 노드를 마우스 오른쪽 단추로 클릭하고 **기존 프로젝트 추가**를 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-248">Open the target solution, right-click the solution node in the Solution Explorer, and choose **Add Existing Project**.</span></span> <span data-ttu-id="566be-249">Microsoft.Diagnostics.Listeners 프로젝트를 솔루션에 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-249">Add the Microsoft.Diagnostics.Listeners project to the solution.</span></span> <span data-ttu-id="566be-250">Microsoft.Diagnostics.Listeners.Fabric 프로젝트에 대해 동일한 절차를 반복합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-250">Repeat the same for the Microsoft.Diagnostics.Listeners.Fabric project.</span></span>
4. <span data-ttu-id="566be-251">서비스 프로젝트의 프로젝트 참조를 두 개의 추가된 프로젝트에 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-251">Add a project reference from your service project(s) to the two added projects.</span></span> <span data-ttu-id="566be-252">(데이터를 Elasticsearch에 전송하는 각 서비스는 Microsoft.Diagnostics.EventListeners 및 Microsoft.Diagnostics.EventListeners.Fabric을 참조해야 합니다.)</span><span class="sxs-lookup"><span data-stu-id="566be-252">(Each service that is supposed to send data to Elasticsearch should reference Microsoft.Diagnostics.EventListeners and Microsoft.Diagnostics.EventListeners.Fabric).</span></span>
   
    ![Microsoft.Diagnostics.EventListeners 및 Microsoft.Diagnostics.EventListeners.Fabric 라이브러리에 대한 프로젝트 참조][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a><span data-ttu-id="566be-254">서비스 패브릭 일반 공급 릴리스 및 Microsoft.Diagnostics.Tracing Nuget 패키지</span><span class="sxs-lookup"><span data-stu-id="566be-254">Service Fabric General Availability release and Microsoft.Diagnostics.Tracing Nuget package</span></span>
<span data-ttu-id="566be-255">서비스 패브릭 일반 공급 릴리스(2.0.135, 2016년 3월 31일 출시)를 사용하여 빌드한 응용 프로그램은 **.NET Framework 4.5.2**를 대상으로 합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-255">Applications built with Service Fabric General Availability release (2.0.135, released March 31, 2016) target **.NET Framework 4.5.2**.</span></span> <span data-ttu-id="566be-256">이 버전은 GA 릴리스 시 Azure에서 지원하는 가장 높은 버전의 .NET Framework입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-256">This version is the highest version of the .NET Framework supported by Azure at the time of the GA release.</span></span> <span data-ttu-id="566be-257">아쉽게도 이 버전의 프레임워크는 Microsoft.Diagnostics.Listeners 라이브러리에서 필요한 특정 EventListener API가 부족합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-257">Unfortunately, this version of the framework lacks certain EventListener APIs that the Microsoft.Diagnostics.Listeners library needs.</span></span> <span data-ttu-id="566be-258">EventSource(패브릭 응용 프로그램에서 API 로깅의 기본을 형성하는 구성 요소) 및 EventListener는 강력하게 결합되므로 Microsoft.Diagnostics.Listeners 라이브러리를 사용하는 모든 프로젝트는 EventSource의 대체 구현을 사용해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-258">Because EventSource (the component that forms the basis of logging APIs in Fabric applications) and EventListener are tightly coupled, every project that uses the Microsoft.Diagnostics.Listeners library must use an alternative implementation of EventSource.</span></span> <span data-ttu-id="566be-259">이 구현은 Microsoft에서 작성한 **Microsoft.Diagnostics.Tracing Nuget 패키지**에서 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="566be-259">This implementation is provided by the **Microsoft.Diagnostics.Tracing Nuget package**, authored by Microsoft.</span></span> <span data-ttu-id="566be-260">패키지는 프레임워크에 포함된 이전 버전인 EventSource와 완벽하게 호환되므로 참조된 네임스페이스 변경 이외의 다른 코드 변경이 필요하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-260">The package is fully backward-compatible with EventSource included in the framework, so no code changes should be necessary other than referenced namespace changes.</span></span>

<span data-ttu-id="566be-261">EventSource 클래스의 Microsoft.Diagnostics.Tracing 구현을 사용하여 시작하려면 Elasticsearch에 데이터를 보내야 하는 각 서비스 프로젝트에 대해 이 단계를 따릅니다.</span><span class="sxs-lookup"><span data-stu-id="566be-261">To start using the Microsoft.Diagnostics.Tracing implementation of the EventSource class, follow these steps for each service project that needs to send data to Elasticsearch:</span></span>

1. <span data-ttu-id="566be-262">서비스 프로젝트를 마우스 오른쪽 단추로 클릭하고 **Nuget 패키지 관리**를 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-262">Right-click on the service project and choose **Manage Nuget Packages**.</span></span>
2. <span data-ttu-id="566be-263">nuget.org 패키지 원본으로 전환하고(선택되지 않은 경우) "**Microsoft.Diagnostics.Tracing**"을 검색합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-263">Switch to the nuget.org package source (if it is not already selected) and search for "**Microsoft.Diagnostics.Tracing**".</span></span>
3. <span data-ttu-id="566be-264">`Microsoft.Diagnostics.Tracing.EventSource` 패키지 및 해당 종속성을 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-264">Install the `Microsoft.Diagnostics.Tracing.EventSource` package (and its dependencies).</span></span>
4. <span data-ttu-id="566be-265">서비스 프로젝트에서 **ServiceEventSource.cs** 또는 **ActorEventSource.cs** 파일을 열고 파일 상단의 `using System.Diagnostics.Tracing` 지시문을 `using Microsoft.Diagnostics.Tracing` 지시문으로 대체합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-265">Open the **ServiceEventSource.cs** or **ActorEventSource.cs** file in your service project and replace the `using System.Diagnostics.Tracing` directive on top of the file with the `using Microsoft.Diagnostics.Tracing` directive.</span></span>

<span data-ttu-id="566be-266">이러한 단계는 **.NET Framework 4.6** 이 Microsoft Azure에서 지원되면 필요하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-266">These steps will not be necessary once the **.NET Framework 4.6** is supported by Microsoft Azure.</span></span>

### <a name="elasticsearch-listener-instantiation-and-configuration"></a><span data-ttu-id="566be-267">Elasticsearch 수신기 인스턴스화 및 구성</span><span class="sxs-lookup"><span data-stu-id="566be-267">Elasticsearch listener instantiation and configuration</span></span>
<span data-ttu-id="566be-268">진단 데이터를 Elasticsearch에 보내는 마지막 단계는 `ElasticSearchListener` 의 인스턴스를 만들고 Elasticsearch 연결 데이터와 구성하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-268">The final step for sending diagnostic data to Elasticsearch is to create an instance of `ElasticSearchListener` and configure it with Elasticsearch connection data.</span></span> <span data-ttu-id="566be-269">수신기는 서비스 프로젝트에 정의된 EventSource 클래스를 통해 발생한 모든 이벤트를 자동으로 캡처합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-269">The listener automatically captures all events raised via EventSource classes defined in the service project.</span></span> <span data-ttu-id="566be-270">서비스 수명 동안 유지해야 하므로 서비스 초기화 코드에서 만드는 것이 적합합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-270">It needs to be alive during the lifetime of the service, so the best place to create it is in the service initialization code.</span></span> <span data-ttu-id="566be-271">상태 비저장 서비스에 대한 초기화 코드는 필요한 변경 후 다음과 같이 보입니다( `****`(으)로 시작하는 주석에서 지적한 추가).</span><span class="sxs-lookup"><span data-stu-id="566be-271">Here is how the initialization code for a stateless service could look after the necessary changes (additions pointed out in comments starting with `****`):</span></span>

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add the following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is the entry point of the service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider, new FabricHealthReporter("ElasticSearchEventListener"));
                }

                // The ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name to a .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of the class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that the ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

<span data-ttu-id="566be-272">Elasticsearch 연결 데이터는 서비스 구성 파일(**PackageRoot\Config\Settings.xml**)에서 별도 섹션에 넣어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-272">Elasticsearch connection data should be put in a separate section in the service configuration file (**PackageRoot\Config\Settings.xml**).</span></span> <span data-ttu-id="566be-273">섹션의 이름은 `FabricConfigurationProvider` 생성자에 전달된 값에 해당해야 합니다. 예는 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-273">The name of the section must correspond to the value passed to the `FabricConfigurationProvider` constructor, for example:</span></span>

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
<span data-ttu-id="566be-274">`serviceUri`, `userName` 및 `password` 매개 변수 값은 각각 Elasticsearch 클러스터 끝점 주소, Elasticsearch 사용자 이름 및 암호에 해당합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-274">The values of `serviceUri`, `userName` and `password` parameters correspond to the Elasticsearch cluster endpoint address, Elasticsearch user name, and password, respectively.</span></span> <span data-ttu-id="566be-275">`indexNamePrefix`는 Elasticsearch 인덱스의 접두사입니다. Microsoft.Diagnostics.Listeners 라이브러리는 매일 해당 데이터에 대한 새 인덱스를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="566be-275">`indexNamePrefix` is the prefix for Elasticsearch indexes; the Microsoft.Diagnostics.Listeners library creates a new index for its data daily.</span></span>

### <a name="verification"></a><span data-ttu-id="566be-276">확인</span><span class="sxs-lookup"><span data-stu-id="566be-276">Verification</span></span>
<span data-ttu-id="566be-277">이것으로 끝입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-277">That's it!</span></span> <span data-ttu-id="566be-278">이제 서비스가 실행될 때마다 구성에 지정된 Elasticsearch 서비스에 추적을 보내기 시작합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-278">Now, whenever the service is run, it starts sending traces to the Elasticsearch service specified in the configuration.</span></span> <span data-ttu-id="566be-279">대상 Elasticsearch 인스턴스와 연결된 Kibana UI를 열어 이 작업을 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="566be-279">You can verify this by opening the Kibana UI associated with the target Elasticsearch instance.</span></span> <span data-ttu-id="566be-280">이 예제에서는 페이지 주소가 http://myBigCluster.westus.cloudapp.azure.com/입니다.</span><span class="sxs-lookup"><span data-stu-id="566be-280">In our example, the page address is http://myBigCluster.westus.cloudapp.azure.com/.</span></span> <span data-ttu-id="566be-281">`ElasticSearchListener` 인스턴스에 대해 선택한 이름 접두사를 포함하는 인덱스가 실제로 만들어졌으며 데이터로 채워졌는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="566be-281">Check that indexes with the name prefix chosen for the `ElasticSearchListener` instance have indeed been created and populated with data.</span></span>

![PartyCluster 응용 프로그램 이벤트를 보여 주는 Kibana][2]

## <a name="next-steps"></a><span data-ttu-id="566be-283">다음 단계</span><span class="sxs-lookup"><span data-stu-id="566be-283">Next steps</span></span>
* [<span data-ttu-id="566be-284">서비스 패브릭 서비스 진단 및 모니터링에 대한 자세한 정보</span><span class="sxs-lookup"><span data-stu-id="566be-284">Learn more about diagnosing and monitoring a Service Fabric service</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png
