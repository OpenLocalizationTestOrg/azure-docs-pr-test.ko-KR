---
title: "클라우드 서비스 할당 실패 문제 해결 | Microsoft Docs"
description: "Azure에서 클라우드 서비스 배포 시 할당 실패 문제 해결"
services: azure-service-management, cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 529157eb-e4a1-4388-aa2b-09e8b923af74
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: 3379b6d9bea874abecae7e56d30cfb15e6b0c2fc
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/03/2017
---
# <a name="troubleshooting-allocation-failure-when-you-deploy-cloud-services-in-azure"></a><span data-ttu-id="fa4c8-103">Azure에서 클라우드 서비스 배포 시 할당 실패 문제 해결</span><span class="sxs-lookup"><span data-stu-id="fa4c8-103">Troubleshooting allocation failure when you deploy Cloud Services in Azure</span></span>
## <a name="summary"></a><span data-ttu-id="fa4c8-104">요약</span><span class="sxs-lookup"><span data-stu-id="fa4c8-104">Summary</span></span>
<span data-ttu-id="fa4c8-105">클라우드 서비스에 인스턴스를 배포하거나 새 웹 또는 작업자 역할 인스턴스를 추가할 때 Microsoft Azure는 계산 리소스를 할당합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-105">When you deploy instances to a Cloud Service or add new web or worker role instances, Microsoft Azure allocates compute resources.</span></span> <span data-ttu-id="fa4c8-106">이러한 작업을 수행하면서 Azure 구독 제한에 도달하기 전에 오류를 수신하는 경우도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-106">You may occasionally receive errors when performing these operations even before you reach the Azure subscription limits.</span></span> <span data-ttu-id="fa4c8-107">이 문서는 일부 일반적인 할당 오류의 이유를 설명하고 가능한 수정을 제안합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-107">This article explains the causes of some of the common allocation failures and suggests possible remediation.</span></span> <span data-ttu-id="fa4c8-108">서비스 배포를 계획하는 사용자에게 이 정보가 유용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-108">The information may also be useful when you plan the deployment of your services.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

### <a name="background--how-allocation-works"></a><span data-ttu-id="fa4c8-109">배경 – 할당의 작동 원리</span><span class="sxs-lookup"><span data-stu-id="fa4c8-109">Background – How allocation works</span></span>
<span data-ttu-id="fa4c8-110">Azure 데이터 센터의 서버는 클러스터로 분할되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-110">The servers in Azure datacenters are partitioned into clusters.</span></span> <span data-ttu-id="fa4c8-111">여러 클러스터에서 새 클라우드 서비스 할당 요청을 시도합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-111">A new cloud service allocation request is attempted in multiple clusters.</span></span> <span data-ttu-id="fa4c8-112">첫 번째 인스턴스가 클라우드 서비스(스테이징 또는 프로덕션)에 배포되면 해당 클라우드 서비스가 클러스터에 고정됩니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-112">When the first instance is deployed to a cloud service(in either staging or production), that cloud service gets pinned to a cluster.</span></span> <span data-ttu-id="fa4c8-113">이후 클라우드 서비스에 대한 모든 추가 배포는 동일한 클러스터에서 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-113">Any further deployments for the cloud service will happen in the same cluster.</span></span> <span data-ttu-id="fa4c8-114">이 문서에서는 이것을 “클러스터에 고정된”이라고 하겠습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-114">In this article, we'll refer to this as "pinned to a cluster".</span></span> <span data-ttu-id="fa4c8-115">아래 다이어그램 1은 여러 클러스터에 시도되는 정상적인 할당의 사례를 보여 줍니다. 다이어그램 2는 클라우드 서비스 CS_1이 호스트되는 클러스터 2에 고정된 할당의 사례를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-115">Diagram 1 below illustrates the case of a normal allocation which is attempted in multiple clusters; Diagram 2 illustrates the case of an allocation that's pinned to Cluster 2 because that's where the existing Cloud Service CS_1 is hosted.</span></span>

![할당 다이어그램](./media/cloud-services-allocation-failure/Allocation1.png)

### <a name="why-allocation-failure-happens"></a><span data-ttu-id="fa4c8-117">할당 오류가 발생하는 이유</span><span class="sxs-lookup"><span data-stu-id="fa4c8-117">Why allocation failure happens</span></span>
<span data-ttu-id="fa4c8-118">할당 요청이 클러스터에 고정되면 사용 가능한 리소스 풀이 클러스터로 제한되기 때문에 유휴 리소스를 찾는 데 실패할 가능성이 높습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-118">When an allocation request is pinned to a cluster, there's a higher chance of failing to find free resources since the available resource pool is limited to a cluster.</span></span> <span data-ttu-id="fa4c8-119">할당 요청이 클러스터에 고정되어 있지만 요청하는 리소스 유형이 이 클러스터에서 지원되지 않으면, 클러스터에 유휴 리소스가 있어도 사용자의 요청은 실패합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-119">Furthermore, if your allocation request is pinned to a cluster but the type of resource you requested is not supported by that cluster, your request will fail even if the cluster has free resource.</span></span> <span data-ttu-id="fa4c8-120">아래 다이어그램 3은 유일한 후보 클러스터에 유휴 리소스가 없어서 고정된 할당이 실패하는 경우를 보여줍니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-120">Diagram 3 below illustrates the case where a pinned allocation fails because the only candidate cluster does not have free resources.</span></span> <span data-ttu-id="fa4c8-121">다이어그램 4는 클러스터에 유휴 리소스가 있지만 유일한 후보 클러스터가 요청한 VM 크기를 지원하지 않기 때문에 고정된 할당이 실패하는 경우를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-121">Diagram 4 illustrates the case where a pinned allocation fails because the only candidate cluster does not support the requested VM size, even though the cluster has free resources.</span></span>

![고정된 할당 오류](./media/cloud-services-allocation-failure/Allocation2.png)

## <a name="troubleshooting-allocation-failure-for-cloud-services"></a><span data-ttu-id="fa4c8-123">클라우드 서비스에 대한 할당 실패 문제 해결</span><span class="sxs-lookup"><span data-stu-id="fa4c8-123">Troubleshooting allocation failure for cloud services</span></span>
### <a name="error-message"></a><span data-ttu-id="fa4c8-124">오류 메시지</span><span class="sxs-lookup"><span data-stu-id="fa4c8-124">Error Message</span></span>
<span data-ttu-id="fa4c8-125">다음과 같은 오류 메시지가 표시될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-125">You may see the following error message:</span></span>

    "Azure operation '{operation id}' failed with code Compute.ConstrainedAllocationFailed. Details: Allocation failed; unable to satisfy constraints in request. The requested new service deployment is bound to an Affinity Group, or it targets a Virtual Network, or there is an existing deployment under this hosted service. Any of these conditions constrains the new deployment to specific Azure resources. Please retry later or try reducing the VM size or number of role instances. Alternatively, if possible, remove the aforementioned constraints or try deploying to a different region."

### <a name="common-issues"></a><span data-ttu-id="fa4c8-126">일반적인 문제</span><span class="sxs-lookup"><span data-stu-id="fa4c8-126">Common Issues</span></span>
<span data-ttu-id="fa4c8-127">다음은 할당 요청이 단일 클러스터에 고정되도록 하는 일반적인 할당 시나리오입니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-127">Here are the common allocation scenarios that cause an allocation request to be pinned to a single cluster.</span></span>

* <span data-ttu-id="fa4c8-128">스테이징 슬롯에 배포하는 경우 - 클라우드 서비스가 두 슬롯 중 하나에 배포된 경우 전체 클라우드 서비스가 특정 클러스터에 고정됩니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-128">Deploying to Staging Slot - If a cloud service has a deployment in either slot, then the entire cloud service is pinned to a specific cluster.</span></span>  <span data-ttu-id="fa4c8-129">이는 프로덕션 슬롯에 이미 배포가 있을 경우 프로덕션 슬롯과 동일한 클러스터에만 새 스테이징 배포를 할당할 수 있다는 의미입니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-129">This means that if a deployment already exists in the production slot, then a new staging deployment can only be allocated in the same cluster as the production slot.</span></span> <span data-ttu-id="fa4c8-130">클러스터의 용량이 거의 찼을 경우 요청이 실패할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-130">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="fa4c8-131">크기 조정 - 기존 클라우드 서비스에 새 인스턴스를 추가할 때는 동일한 클러스터에 할당해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-131">Scaling - Adding new instances to an existing cloud service must allocate in the same cluster.</span></span>  <span data-ttu-id="fa4c8-132">작은 크기 조정 요청은 대부분 할당할 수 있지만 항상 가능한 것은 아닙니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-132">Small scaling requests can usually be allocated, but not always.</span></span> <span data-ttu-id="fa4c8-133">클러스터의 용량이 거의 찼을 경우 요청이 실패할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-133">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="fa4c8-134">선호도 그룹 - 클라우드 서비스가 선호도 그룹에 고정되어 있지 않는 한, 빈 클라우드 서비스에 새로 배포할 경우 해당 영역에 있는 클러스터의 패브릭에 의해서만 할당할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-134">Affinity Group - A new deployment to an empty cloud service can be allocated by the fabric in any cluster in that region, unless the cloud service is pinned to an affinity group.</span></span> <span data-ttu-id="fa4c8-135">동일한 선호도 그룹에 대한 배포는 동일한 클러스터에서 시도됩니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-135">Deployments to the same affinity group will be attempted on the same cluster.</span></span> <span data-ttu-id="fa4c8-136">클러스터의 용량이 거의 찼을 경우 요청이 실패할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-136">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="fa4c8-137">선호도 그룹 vNet - 이전에는 가상 네트워크가 영역이 아닌 선호도 그룹에 연결되었고 이러한 가상 네트워크의 클라우드 서비스는 선호도 그룹 클러스터에 고정되었습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-137">Affinity Group vNet - Older Virtual Networks were tied to affinity groups instead of regions, and cloud services in these Virtual Networks would be pinned to the affinity group cluster.</span></span> <span data-ttu-id="fa4c8-138">이 가상 네트워크 형식에 대한 배포는 고정된 클러스터에서 시도됩니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-138">Deployments to this type of virtual network will be attempted on the pinned cluster.</span></span> <span data-ttu-id="fa4c8-139">클러스터의 용량이 거의 찼을 경우 요청이 실패할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-139">If the cluster is nearing capacity, the request may fail.</span></span>

## <a name="solutions"></a><span data-ttu-id="fa4c8-140">솔루션</span><span class="sxs-lookup"><span data-stu-id="fa4c8-140">Solutions</span></span>
1. <span data-ttu-id="fa4c8-141">새 클라우드 서비스에 다시 배포 - 이 솔루션은 플랫폼이 해당 영역의 모든 클러스터에서 선택할 수 있으므로 가장 성공률이 높습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-141">Redeploy to a new cloud service - This solution is likely to be most successful as it allows the platform to choose from all clusters in that region.</span></span>

   * <span data-ttu-id="fa4c8-142">새 클라우드 서비스에 작업을 배포합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-142">Deploy the workload to a new cloud service</span></span>  
   * <span data-ttu-id="fa4c8-143">새 클라우드 서비스로의 트래픽을 가리키도록 CNAME 또는 A 레코드를 업데이트합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-143">Update the CNAME or A record to point traffic to the new cloud service</span></span>
   * <span data-ttu-id="fa4c8-144">제로(0) 트래픽이 이전 사이트로 이동하면 이전 클라우드 서비스를 삭제할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-144">Once zero traffic is going to the old site, you can delete the old cloud service.</span></span> <span data-ttu-id="fa4c8-145">이 솔루션은 가동 중지 시간 없이 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-145">This solution should incur zero downtime.</span></span>
2. <span data-ttu-id="fa4c8-146">프로덕션 및 스테이징 슬롯 삭제 - 이 솔루션은 기존 DNS 이름을 유지하지만 응용 프로그램 가동 중지 시간이 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-146">Delete both production and staging slots - This solution will preserve your existing DNS name, but will cause downtime to your application.</span></span>

   * <span data-ttu-id="fa4c8-147">기존 클라우드 서비스의 프로덕션 및 스테이징 슬롯을 삭제하여 클라우드 서비스를 비웁니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-147">Delete the production and staging slots of an existing cloud service so that the cloud service is empty, and then</span></span>
   * <span data-ttu-id="fa4c8-148">기존 클라우드 서비스에서 새 배포를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-148">Create a new deployment in the existing cloud service.</span></span> <span data-ttu-id="fa4c8-149">영역의 모든 클러스터에서 할당이 다시 시도됩니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-149">This will re-attempt to allocation on all clusters in the region.</span></span> <span data-ttu-id="fa4c8-150">클라우드 서비스가 선호도 그룹에 연결되지 않았는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-150">Ensure the cloud service is not tied to an affinity group.</span></span>
3. <span data-ttu-id="fa4c8-151">예약된 IP - 이 솔루션은 기존 IP 주소를 유지하지만 응용 프로그램 가동 중지 시간이 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-151">Reserved IP -  This solution will preserve your existing IP address, but will cause downtime to your application.</span></span>  

   * <span data-ttu-id="fa4c8-152">Powershell을 사용하여 기존 배포에 대한 ReservedIP 만들기</span><span class="sxs-lookup"><span data-stu-id="fa4c8-152">Create a ReservedIP for your existing deployment using Powershell</span></span>

     ```
     New-AzureReservedIP -ReservedIPName {new reserved IP name} -Location {location} -ServiceName {existing service name}
     ```
   * <span data-ttu-id="fa4c8-153">위의 #2에 따라 서비스의 CSCFG에 새 ReservedIP를 지정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-153">Follow #2 from above, making sure to specify the new ReservedIP in the service's CSCFG.</span></span>
4. <span data-ttu-id="fa4c8-154">새 배포에 대한 선호도 그룹 제거 - 선호도 그룹은 더 이상 권장되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-154">Remove affinity group for new deployments - Affinity Groups are no longer recommended.</span></span> <span data-ttu-id="fa4c8-155">위의 #1에 따라 새 클라우드 서비스를 배포합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-155">Follow steps for #1 above to deploy a new cloud service.</span></span> <span data-ttu-id="fa4c8-156">클라우드 서비스가 선호도 그룹에 없는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-156">Ensure cloud service is not in an affinity group.</span></span>
5. <span data-ttu-id="fa4c8-157">지역 가상 네트워크로 변환 - [선호도 그룹에서 지역 VNet(가상 네트워크)으로 마이그레이션하는 방법](../virtual-network/virtual-networks-migrate-to-regional-vnet.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="fa4c8-157">Convert to a Regional Virtual Network - See [How to migrate from Affinity Groups to a Regional Virtual Network (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span></span>
