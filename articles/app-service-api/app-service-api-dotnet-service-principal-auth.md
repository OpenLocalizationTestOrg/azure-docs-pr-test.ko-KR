---
title: "Azure 앱 서비스에서 API 앱에 대 한 사용자 인증 aaaService | Microsoft Docs"
description: "자세한 내용은 방법 서비스 간 시나리오에 대 한 Azure 앱 서비스의 API tooprotect 응용 프로그램입니다."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 94d9ee11f38293df4a2fd815ef02c59cc6defed4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 10/06/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="7f447-103">Azure 앱 서비스의 API 앱에 대한 서비스 주체 인증</span><span class="sxs-lookup"><span data-stu-id="7f447-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="7f447-104">개요</span><span class="sxs-lookup"><span data-stu-id="7f447-104">Overview</span></span>
<span data-ttu-id="7f447-105">이 문서에서는 설명 어떻게 toouse 앱 서비스 인증에 대 한 *내부* tooAPI 앱에 액세스 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-105">This article explains how toouse App Service authentication for *internal* access tooAPI apps.</span></span> <span data-ttu-id="7f447-106">내부 시나리오 되도록 toobe 사용 될 응용 프로그램 코드에 의해서만 API 앱이 있는 위치입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-106">An internal scenario is where you have an API app that you want toobe consumable only by your own application code.</span></span> <span data-ttu-id="7f447-107">hello 권장 방법은 tooimplement이이 경우 앱 서비스에서 Azure AD toouse tooprotect hello 라고 API 앱.</span><span class="sxs-lookup"><span data-stu-id="7f447-107">hello recommended way tooimplement this scenario in App Service is toouse Azure AD tooprotect hello called API app.</span></span> <span data-ttu-id="7f447-108">응용 프로그램 id (서비스 주체) 자격 증명을 제공 하 여 Azure AD에서 얻을 수 있는 전달자 토큰을 사용 하는 보호 된 hello API 앱을 호출 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-108">You call hello protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="7f447-109">대안 toousing Azure AD에 대 한 참조 hello **서비스 간 인증** hello 섹션 [Azure 앱 서비스 인증 개요](../app-service/app-service-authentication-overview.md#service-to-service-authentication)합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-109">For alternatives toousing Azure AD, see hello **Service-to-service authentication** section of hello [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="7f447-110">이 문서에서는 다음에 대해 알아봅니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="7f447-111">어떻게 toouse tooprotect API 앱을 Azure Active Directory (Azure AD) 인증 되지 않은 액세스 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-111">How toouse Azure Active Directory (Azure AD) tooprotect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="7f447-112">어떻게 API 앱, 웹 응용 프로그램 또는 Azure AD 서비스 주체 (앱 id) 자격 증명을 사용 하 여 모바일 앱에서 보호 된 API tooconsume 앱.</span><span class="sxs-lookup"><span data-stu-id="7f447-112">How tooconsume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="7f447-113">방법에 대 한 정보에 대 한 논리 앱에서 tooconsume 참조 [논리 앱과 앱 서비스에서 호스팅되는 사용자 지정 API를 사용 하 여](../logic-apps/logic-apps-custom-hosted-api.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-113">For information about how tooconsume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="7f447-114">사용자 로그온 방법가 브라우저에서 toomake 해당 hello API 앱을 보호 합니다를 호출할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-114">How toomake sure that hello protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="7f447-115">어떻게 toomake 해당 hello API 앱을 보호 합니다만 호출할 수는 특정 Azure AD 서비스 사용자입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-115">How toomake sure that hello protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="7f447-116">hello 문서에는 두 개의 섹션이 포함 됩니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-116">hello article contains two sections:</span></span>

* <span data-ttu-id="7f447-117">hello [tooconfigure Azure 앱 서비스에서 사용자 인증을 서비스 하는 방법을](#authconfig) 섹션에서는 일반적인 방법에 설명 모든 API 앱 및 tooconsume hello API 앱을 보호 하는 방법에 대 한 tooconfigure 인증 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-117">hello [How tooconfigure service principal authentication in Azure App Service](#authconfig) section explains in general how tooconfigure authentication for any API app, and how tooconsume hello protected API app.</span></span> <span data-ttu-id="7f447-118">이 섹션에서.NET, Node.js, Java 등 응용 프로그램 서비스를 지 원하는 tooall 프레임 워크 똑같이 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-118">This section applies equally tooall frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="7f447-119">Hello로 시작 [hello.NET 시작 하기 자습서를 계속](#tutorialstart) 섹션 hello 자습서에서는 응용 프로그램 서비스에서 실행 되는.NET 예제 응용 프로그램에 대 한 "액세스 내부" 시나리오에서 구성 하는 과정입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-119">Starting with hello [Continuing hello .NET getting-started tutorials](#tutorialstart) section, hello tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="7f447-120"><a id="authconfig"></a>Tooconfigure Azure 앱 서비스에서 사용자 인증을 서비스 하는 방법</span><span class="sxs-lookup"><span data-stu-id="7f447-120"><a id="authconfig"></a> How tooconfigure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="7f447-121">이 섹션에서는 tooany API 앱에 적용 되는 일반적인 지침을 제공 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-121">This section provides general instructions that apply tooany API app.</span></span> <span data-ttu-id="7f447-122">너무 단계 특정 toohello tooDo 목록.NET 예제 응용 프로그램을 이동[hello.NET API 앱에 대 한 자습서 시리즈 계속](#tutorialstart)합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-122">For steps specific toohello tooDo List .NET sample application, go too[Continuing hello .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="7f447-123">Hello에 [Azure 포털](https://portal.azure.com/), toohello 이동 **설정** tooprotect를 원하고 hello 찾을 hello API 앱의 블레이드에서 **기능** 섹션 및 클릭**인증 / 권한 부여**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-123">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you want tooprotect, and then find hello **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Azure 포털에서 인증/권한 부여](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="7f447-125">Hello에 **인증 / 권한 부여** 블레이드에서 클릭 **에**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-125">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="7f447-126">Hello에 **요청이 인증 되지 않은 경우 동작 tootake** 드롭 다운 목록 **Azure Active Directory로 로그인** 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-126">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="7f447-127">**인증 공급자**에서 **Azure Active Directory**를 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Azure 포털에서 인증/권한 부여 블레이드](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="7f447-129">Hello 구성 **Azure Active Directory 설정** 블레이드 toocreate 새로운 Azure AD 응용 프로그램 또는 이미 있는 경우 기존 Azure AD 응용 프로그램을 사용 하 여 toouse 되도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-129">Configure hello **Azure Active Directory Settings** blade toocreate a new Azure AD application, or use an existing Azure AD application if you already have one that you want toouse.</span></span>
   
    <span data-ttu-id="7f447-130">내부 시나리오는 일반적으로 API 앱을 호출하는 API 앱을 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="7f447-131">각 API 앱 또는 하나의 Azure AD 응용 프로그램에 분리된 AD 응용 프로그램을 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="7f447-132">이 블레이드에서 자세한 지침을 참조 하십시오. [어떻게 tooconfigure 앱 서비스 응용 프로그램 toouse Azure Active Directory 로그인](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-132">For detailed instructions on this blade, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="7f447-133">클릭 하 여 hello 인증 공급자 구성 블레이드를 마치면 **확인**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-133">When you're done with hello authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="7f447-134">Hello에 **인증 / 권한 부여** 블레이드에서 클릭 **저장**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-134">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![저장을 클릭합니다.](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="7f447-136">이 도구를 실행 하는 경우 앱 서비스 hello 구성 된 Azure AD 테 넌 트의 호출자 로부터 요청 허용 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-136">When this is done, App Service only allows requests from callers in hello configured Azure AD tenant.</span></span> <span data-ttu-id="7f447-137">보호 된 hello API 앱 인증 또는 권한 부여 코드가 필요 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-137">No authentication or authorization code is required in hello protected API app.</span></span> <span data-ttu-id="7f447-138">hello 전달자 토큰이 함께 자주 사용 되는 클레임 toohello API 앱에에서 전달 HTTP 헤더 하 고 서비스 사용자와 같은 특정 호출자의 요청은 코드 toovalidate에서 해당 정보를 읽을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-138">hello bearer token is passed toohello API app along with commonly used claims in HTTP headers, and you can read that information in code toovalidate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="7f447-139">이 인증 기능이 작동 hello.NET, Node.js, 및 Java와 같은 모든 언어에 대해 동일한 방식으로 해당 앱 서비스 지원 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-139">This authentication functionality works hello same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-tooconsume-hello-protected-api-app"></a><span data-ttu-id="7f447-140">Tooconsume hello API 앱을 보호 하는 방법</span><span class="sxs-lookup"><span data-stu-id="7f447-140">How tooconsume hello protected API app</span></span>
<span data-ttu-id="7f447-141">hello 호출자 API 호출에는 Azure AD 전달자 토큰을 제공 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-141">hello caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="7f447-142">tooget 서비스 사용자 자격 증명을 사용 하 여 전달자 토큰을 hello 호출자 사용 하 여 Active Directory 인증 라이브러리 (ADAL에 대 한 [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), 또는 [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="7f447-142">tooget a bearer token using service principal credentials, hello caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="7f447-143">토큰 tooget ADAL 호출 하는 hello 코드 tooADAL hello를 다음 정보를 제공 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-143">tooget a token, hello code that calls ADAL provides tooADAL hello following information:</span></span>

* <span data-ttu-id="7f447-144">Azure AD 테 넌 트의 hello 이름입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-144">hello name of your Azure AD tenant.</span></span>
* <span data-ttu-id="7f447-145">hello 클라이언트 ID와 클라이언트 암호 (응용 프로그램 키) hello 호출자와 연관 된 hello Azure AD 응용 프로그램의입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-145">hello client ID and client secret (app key) of hello Azure AD app associated with hello caller.</span></span>
* <span data-ttu-id="7f447-146">hello hello와 연결 된 Azure AD 응용 프로그램의 클라이언트 ID hello API 앱을 보호 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-146">hello client ID of hello Azure AD application associated with hello protected API app.</span></span> <span data-ttu-id="7f447-147">(Azure AD에 대 한 응용 프로그램을 하나만 사용 되는 경우이 hello 같은 클라이언트 ID hello 호출자에 대 한 hello 대로.)</span><span class="sxs-lookup"><span data-stu-id="7f447-147">(If just one Azure AD application is used, this is hello same client ID as hello one for hello caller.)</span></span>

<span data-ttu-id="7f447-148">이러한 값은 hello의 hello Azure AD 페이지에서 사용할 [Azure 클래식 포털](https://manage.windowsazure.com/)합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-148">These values are available in hello Azure AD pages of hello [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="7f447-149">Hello 토큰 획득 한 면 hello 호출자에 hello 인증 헤더에 HTTP 요청과 함께 포함 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-149">Once hello token has been acquired, hello caller includes it with HTTP requests in hello Authorization header.</span></span>  <span data-ttu-id="7f447-150">앱 서비스는 hello 토큰의 유효성을 검사 하 고 hello 요청 tooreach hello 보호 API 앱을 허용 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-150">App Service validates hello token and allows hello requests tooreach hello protected API app.</span></span>

#### <a name="how-tooprotect-hello-api-app-from-access-by-users-in-hello-same-tenant"></a><span data-ttu-id="7f447-151">어떻게 hello에 대 한 사용자의 액세스 tooprotect hello API 앱 동일한 테 넌 트</span><span class="sxs-lookup"><span data-stu-id="7f447-151">How tooprotect hello API app from access by users in hello same tenant</span></span>
<span data-ttu-id="7f447-152">전달자 토큰 같은 테 넌 트 hello에 대 한 유효한 것으로 간주 되는 hello에 사용자에 대 한 API 앱을 보호 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-152">Bearer tokens for users in hello same tenant are considered valid for hello protected API app.</span></span>  <span data-ttu-id="7f447-153">서비스 사용자를 호출할 수 있는 tooensure hello API의 보호 된 앱을 hello에 대 한 코드 API 앱 toovalidate hello hello 토큰에서 클레임에 따라 보호 된 추가:</span><span class="sxs-lookup"><span data-stu-id="7f447-153">If you want tooensure that only a service principal can call hello protected API app, add code in hello protected API app toovalidate hello following claims from hello token:</span></span>

* <span data-ttu-id="7f447-154">`appid`hello 호출자와 연관 된 hello Azure AD 응용 프로그램의 클라이언트 ID hello 이어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-154">`appid` should be hello client ID of hello Azure AD application that is associated with hello caller.</span></span> 
* <span data-ttu-id="7f447-155">`oid`(`objectidentifier`) hello 호출자의 hello 서비스 보안 주체 ID 여야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-155">`oid` (`objectidentifier`) should be hello service principal ID of hello caller.</span></span> 

<span data-ttu-id="7f447-156">앱 서비스는 hello 제공 `objectidentifier` hello X-MS-클라이언트-보안 주체 ID 헤더에는 클레임입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-156">App Service also provides hello `objectidentifier` claim in hello X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-tooprotect-hello-api-app-from-browser-access"></a><span data-ttu-id="7f447-157">Tooprotect은 브라우저 액세스에서 API 앱 hello 하는 방법</span><span class="sxs-lookup"><span data-stu-id="7f447-157">How tooprotect hello API app from browser access</span></span>
<span data-ttu-id="7f447-158">보호 된 hello API 앱에 코드의 클레임 유효성을 검사 하지 않는 하 고 별도 사용 하는 경우 Azure AD 응용 프로그램 hello API 앱을 보호 된 해야 Azure AD 응용 프로그램의 회신 URL은 해당 hello 하지 hello API 응용 프로그램의 기본 URL과 동일 hello 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-158">If you don't validate claims in code in hello protected API app, and if you use a separate Azure AD application for hello protected API app, make sure that hello Azure AD application's Reply URL is not hello same as hello API app's base URL.</span></span> <span data-ttu-id="7f447-159">회신 URL hello 가리키면 직접 보호 toohello API 앱, hello 동일한 Azure AD 테 넌 트의 사용자 수 toohello API 앱을 찾아보기, 로그온 한 hello API를 성공적으로 호출 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-159">If hello Reply URL points directly toohello protected API app, a user in hello same Azure AD tenant could browse toohello API app, log on, and successfully call hello API.</span></span>

## <span data-ttu-id="7f447-160"><a id="tutorialstart"></a>Hello.NET API 앱에 대 한 자습서 시리즈를 계속합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-160"><a id="tutorialstart"></a> Continuing hello .NET API Apps tutorial series</span></span>
<span data-ttu-id="7f447-161">Hello Node.js 또는 Java 자습서 시리즈 API 앱에 대 한를 따르는 경우 건너뛸 toohello [다음 단계](#next-steps) 섹션.</span><span class="sxs-lookup"><span data-stu-id="7f447-161">If you are following hello Node.js or Java tutorial series for API apps, skip toohello [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="7f447-162">이 문서의 나머지 부분에서는 hello hello.NET API 앱에 대 한 자습서 시리즈를 지속 하 고 hello 완료 한 것으로 가정 [사용자 인증 자습서](app-service-api-dotnet-user-principal-auth.md) hello 샘플 응용 프로그램 사용자 인증으로 Azure에서 실행 되 고 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-162">hello remainder of this article continues hello .NET API Apps tutorial series and assumes that you have completed hello [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have hello sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="7f447-163">Azure에서 인증 설정</span><span class="sxs-lookup"><span data-stu-id="7f447-163">Set up authentication in Azure</span></span>
<span data-ttu-id="7f447-164">이 섹션에서는 구성한 앱 서비스 하므로 HTTP만 요청 tooreach hello 데이터 계층 API 앱을 통해 해당 hello는 hello 할 유효한 Azure AD 전달자 토큰입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-164">In this section you configure App Service so that hello only HTTP requests it allows tooreach hello data tier API app are hello ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="7f447-165">Hello 중간 계층 API 앱 toosend 응용 프로그램 자격 증명 tooAzure AD 구성 hello 섹션 뒤에서 전달자 토큰 돌아갈 및 보낼 hello 전달자 토큰 toohello 데이터 계층 API 앱.</span><span class="sxs-lookup"><span data-stu-id="7f447-165">In hello following section, you configure hello middle tier API app toosend application credentials tooAzure AD, get back a bearer token, and send hello bearer token toohello data tier API app.</span></span> <span data-ttu-id="7f447-166">이 프로세스는 hello 다이어그램에 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-166">This process is illustrated in hello diagram.</span></span>

![서비스 인증 다이어그램](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="7f447-168">다음 hello 자습서 방향 하는 동안 문제를 실행 하는 경우 참조 hello [문제 해결](#troubleshooting) hello 자습서의 hello 끝 섹션.</span><span class="sxs-lookup"><span data-stu-id="7f447-168">If you run into problems while following hello tutorial directions, see hello [Troubleshooting](#troubleshooting) section at hello end of hello tutorial.</span></span> 

1. <span data-ttu-id="7f447-169">Hello에 [Azure 포털](https://portal.azure.com/), toohello 이동 **설정** hello ToDoListDataAPI (데이터 계층) API 앱에 대해 생성 하 고 클릭 hello API 앱의 블레이드에서 **설정을**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-169">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you created for hello ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="7f447-170">Hello에 **설정** 블레이드, 찾기 hello **기능** 섹션을 선택한 다음 클릭 **인증 / 권한 부여**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-170">In hello **Settings** blade, find hello **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Azure 포털에서 인증/권한 부여](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="7f447-172">Hello에 **인증 / 권한 부여** 블레이드에서 클릭 **에**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-172">In hello **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="7f447-173">Hello에 **요청이 인증 되지 않은 경우 동작 tootake** 드롭 다운 목록 **Azure Active Directory로 로그인**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-173">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="7f447-174">앱 서비스 tooensure만 요청 reach hello API 앱을 인증 하는 hello 설정입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-174">This is hello setting that causes App Service tooensure that only authenticated requests reach hello API app.</span></span> <span data-ttu-id="7f447-175">요청에 유효한 전달자 토큰에 대 한 앱 서비스 hello 토큰 toohello API 앱을 따라 전달 및 자주 사용 되는 클레임 toomake 된 HTTP 헤더 정보를 채웁니다 tooyour 보다 쉽게 사용할 수 있는 코드입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-175">For requests that have valid bearer tokens, App Service passes hello tokens along toohello API app and populates HTTP headers with commonly used claims toomake that information more easily available tooyour code.</span></span>
5. <span data-ttu-id="7f447-176">**인증 공급자** 아래에서 **Azure Active Directory**를 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Azure 포털에서 인증/권한 부여 블레이드](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="7f447-178">Hello에 **Azure Active Directory 설정** 블레이드에서 클릭 **Express**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-178">In hello **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="7f447-179">Hello로 **Express** 옵션 Azure Azure AD에서 AAD 응용 프로그램을 자동으로 만들 수 [테 넌 트](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant)합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-179">With hello **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="7f447-180">않아도 toocreate 테 넌 트 마다 Azure 계정이 자동으로 하나에 있기 때문에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-180">You don't have toocreate a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="7f447-181">**관리 모드**에서 아직 선택하지 않은 경우 **새 AD 앱 만들기**를 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="7f447-182">hello 포털 연결 hello **앱 만들기** 이며 기본값은 입력된 상자입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-182">hello portal plugs hello **Create App** input box with a default value.</span></span> <span data-ttu-id="7f447-183">기본적으로 hello Azure AD 응용 프로그램 이름은 hello API 응용 프로그램으로 hello 동일 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-183">By default, hello Azure AD application is named hello same as hello API app.</span></span> <span data-ttu-id="7f447-184">원하는 경우 다른 이름을 입력합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-184">If you prefer, you can enter a different name.</span></span>
   
    ![Azure AD 설정](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="7f447-186">**참고**:는 대신 단일 Azure AD를 사용할 수 있습니다 호출 API 앱 hello 둘 다 고 hello 보호 API 앱에 대 한 응용 프로그램입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-186">**Note**: As an alternative, you could use a single Azure AD application for both hello calling API app and hello protected API app.</span></span> <span data-ttu-id="7f447-187">해당 대체 항목을 선택한 경우 필요 없습니다 hello **새 AD 앱 만들기** hello 사용자 인증 자습서의 앞부분에 나오는 Azure AD 응용 프로그램을 이미 만들어졌기 때문에 여기 옵션입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-187">If you chose that alternative, you would not need hello **Create New AD App** option here because you already created an Azure AD application earlier in hello user authentication tutorial.</span></span> <span data-ttu-id="7f447-188">이 자습서에서는 사용할 호출 API 앱 및 hello hello API 앱을 보호 된 Azure AD 응용 프로그램을 분리 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-188">For this tutorial, you'll use separate Azure AD applications for hello calling API app and hello protected API app.</span></span>
8. <span data-ttu-id="7f447-189">Hello에 hello 값 메모 **앱 만들기** 입력된 상자; 것이 AAD 응용 프로그램에서에서 조회 hello Azure 클래식 포털 나중입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-189">Make a note of hello value that is in hello **Create App** input box; you'll look up this AAD application in hello Azure classic portal later.</span></span>
9. <span data-ttu-id="7f447-190">**확인**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-190">Click **OK**.</span></span>
10. <span data-ttu-id="7f447-191">Hello에 **인증 / 권한 부여** 블레이드에서 클릭 **저장**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-191">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![저장을 클릭합니다.](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="7f447-193">앱 서비스와 Azure Active Directory 응용 프로그램을 만듭니다 **로그온 URL** 및 **회신 URL** API 앱 toohello URL을 자동으로 설정 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set toohello URL of your API app.</span></span> <span data-ttu-id="7f447-194">hello 후자 값에서 AAD 테 넌 트 toolog 프로그램의 사용자와 액세스 hello API 앱 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-194">hello latter value enables users in your AAD tenant toolog in and access hello API app.</span></span>

### <a name="verify-that-hello-api-app-is-protected"></a><span data-ttu-id="7f447-195">Hello API 앱 보호 되는지 확인</span><span class="sxs-lookup"><span data-stu-id="7f447-195">Verify that hello API app is protected</span></span>
1. <span data-ttu-id="7f447-196">브라우저에서 toohello 앱의 URL을 hello API 이동: hello에 **API 앱** 아래 hello 링크를 클릭 하는 hello Azure 포털에서에서 블레이드 **URL**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-196">In a browser go toohello URL of hello API app: in hello **API app** blade in hello Azure portal, click hello link under **URL**.</span></span> 
   
    <span data-ttu-id="7f447-197">사용자는 리디렉션된 tooa 로그인 화면 인증 되지 않은 요청이 tooreach hello API 앱 허용 되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-197">You are redirected tooa login screen because unauthenticated requests are not allowed tooreach hello API app.</span></span> 
   
    <span data-ttu-id="7f447-198">경우 브라우저가 않습니다 toohello Swagger UI, 브라우저 이미 기록 될 수 있습니다-이 경우 InPrivate 또는 Incognito 창을 열고 toohello UI Swagger URL로 이동 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-198">If your browser does go toohello Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go toohello Swagger UI URL.</span></span>
2. <span data-ttu-id="7f447-199">AAD 테넌트의 사용자 자격 증명으로 로그인합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="7f447-200">에 로그온 하는 hello "만들었습니다" 페이지 hello 브라우저에 나타납니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-200">When you're logged on, hello "successfully created" page appears in hello browser.</span></span>

## <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="7f447-201">Hello ToDoListAPI 프로젝트 tooacquire를 구성 하 고 hello Azure AD 토큰 보내기</span><span class="sxs-lookup"><span data-stu-id="7f447-201">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="7f447-202">이 섹션에서는 다음 작업 hello 수행 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-202">In this section you do hello following tasks:</span></span>

* <span data-ttu-id="7f447-203">Azure AD 응용 프로그램 자격 증명 tooacquire 토큰을 사용 하는 hello 중간 계층 API 앱에 코드를 추가 하 고 http toohello 데이터 계층 API 응용 프로그램에 요청을 보냅니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-203">Add code in hello middle tier API app that uses Azure AD application credentials tooacquire a token and send it with HTTP requests toohello data tier API app.</span></span>
* <span data-ttu-id="7f447-204">Azure AD에서 필요한 hello 자격 증명을 가져옵니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-204">Get hello credentials you need from Azure AD.</span></span>
* <span data-ttu-id="7f447-205">Hello 중간 계층 API 앱에에서 Azure 앱 서비스 런타임 환경 설정에 hello 자격 증명을 입력 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-205">Enter hello credentials into Azure App Service runtime environment settings in hello middle tier API app.</span></span> 

### <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="7f447-206">Hello ToDoListAPI 프로젝트 tooacquire를 구성 하 고 hello Azure AD 토큰 보내기</span><span class="sxs-lookup"><span data-stu-id="7f447-206">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="7f447-207">Visual Studio에서 hello ToDoListAPI 프로젝트의 변경 내용을 따라 hello를 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-207">Make hello following changes in hello ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="7f447-208">Hello에서 모든 코드 hello 주석 처리 제거 *ServicePrincipal.cs* 파일입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-208">Uncomment all of hello code in hello *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="7f447-209">.NET tooacquire hello Azure AD 전달자 토큰에 ADAL을 사용 하는 hello 코드입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-209">This is hello code that uses ADAL for .NET tooacquire hello Azure AD bearer token.</span></span>  <span data-ttu-id="7f447-210">나중에 hello Azure 런타임 환경에서 설정 하는 몇 가지 구성 값을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-210">It uses several configuration values that you'll set in hello Azure runtime environment later.</span></span> <span data-ttu-id="7f447-211">Hello 코드는 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-211">Here's hello code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="7f447-212">**참고:** 이 코드는 hello 프로젝트에 이미 설치 된.NET NuGet 패키지 (Microsoft.IdentityModel.Clients.ActiveDirectory)에 대 한 ADAL hello 필요 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-212">**Note:** This code requires hello ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in hello project.</span></span> <span data-ttu-id="7f447-213">처음부터이 프로젝트를 만들 때,이 패키지 tooinstall 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-213">If you were creating this project from scratch, you would have tooinstall this package.</span></span> <span data-ttu-id="7f447-214">이 패키지에서 hello API 앱 새 프로젝트 템플릿이 자동으로 설치 되지 않았습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-214">This package is not automatically installed by hello API app new-project template.</span></span>
2. <span data-ttu-id="7f447-215">*컨트롤러/ToDoListController*, hello의 hello 코드를 주석 처리 제거 `NewDataAPIClient` hello 토큰 tooHTTP 요청 hello 인증 헤더에 추가 하는 메서드.</span><span class="sxs-lookup"><span data-stu-id="7f447-215">In *Controllers/ToDoListController*, uncomment hello code in hello `NewDataAPIClient` method that adds hello token tooHTTP requests in hello authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="7f447-216">Hello ToDoListAPI 프로젝트를 배포 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-216">Deploy hello ToDoListAPI project.</span></span> <span data-ttu-id="7f447-217">(Hello 프로젝트를 마우스 오른쪽 단추로 클릭 한 다음 클릭 **게시 > 게시**.)</span><span class="sxs-lookup"><span data-stu-id="7f447-217">(Right-click hello project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="7f447-218">Visual Studio hello 프로젝트를 배포 하 고 브라우저 toohello 웹 앱의 기본 URL을 엽니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-218">Visual Studio deploys hello project and opens a browser toohello web app's base URL.</span></span> <span data-ttu-id="7f447-219">이 정상 시도 toogo tooa 웹 API 기본 URL에 대 한 브라우저에서 403 오류 페이지를 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-219">This will show a 403 error page, which is normal for an attempt toogo tooa Web API base URL from a browser.</span></span>
4. <span data-ttu-id="7f447-220">닫기 hello 브라우저입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-220">Close hello browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="7f447-221">Azure AD 구성 값 가져오기</span><span class="sxs-lookup"><span data-stu-id="7f447-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="7f447-222">Hello에 [Azure 클래식 포털](https://manage.windowsazure.com/), 너무 이동**Azure Active Directory**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-222">In hello [Azure classic portal](https://manage.windowsazure.com/), go too**Azure Active Directory**.</span></span>
2. <span data-ttu-id="7f447-223">Hello에 **디렉터리** 탭에서 AAD 테 넌 트를 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-223">On hello **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="7f447-224">클릭 **응용 프로그램 > 회사가 보유 한 응용 프로그램**, 다음 hello 확인 표시를 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-224">Click **Applications > Applications my company owns**, and then click hello check mark.</span></span>
4. <span data-ttu-id="7f447-225">응용 프로그램의 hello 목록의 hello 하나 hello ToDoListDataAPI (데이터 계층) API 앱에 대 한 인증을 사용 하는 경우 한 만든 Azure의 hello 이름을 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-225">In hello list of applications, click hello name of hello one that Azure created for you when you enabled authentication for hello ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="7f447-226">Hello 클릭 **구성** 탭 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-226">Click hello **Configure** tab.</span></span>
6. <span data-ttu-id="7f447-227">복사 hello **클라이언트 ID** 값 및에서 나중에 가져올 수 있습니다 했지만 위치를 저장 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-227">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="7f447-228">Hello Azure 클래식 포털에서에서 돌아가서 toohello 목록이 **회사가 보유 한 응용 프로그램**, hello 중간 계층 ToDoListAPI API 앱 (hello 하지 hello 이전 자습서에서 만든 것에 대해 만든 hello AAD 응용 프로그램을 클릭 하 고 hello이이 자습서에서 만든 것).</span><span class="sxs-lookup"><span data-stu-id="7f447-228">In hello Azure classic portal go back toohello list of **Applications my company owns**, and click hello AAD application that you created for hello middle tier ToDoListAPI API app (hello one you created in hello previous tutorial, not hello one you created in this tutorial).</span></span>
8. <span data-ttu-id="7f447-229">Hello 클릭 **구성** 탭 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-229">Click hello **Configure** tab.</span></span>
9. <span data-ttu-id="7f447-230">복사 hello **클라이언트 ID** 값 및에서 나중에 가져올 수 있습니다 했지만 위치를 저장 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-230">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="7f447-231">아래 **키**선택, **1 년** hello에서 **기간 선택** 드롭 다운 목록입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-231">Under **keys**, select **1 year** from hello **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="7f447-232">**Save**를 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-232">Click **Save**.</span></span>
    
     ![앱 키 생성](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="7f447-234">Hello 키 값을 복사 하 고에서 나중에 가져올 수 있습니다 했지만 위치를 저장 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-234">Copy hello key value and save it someplace you can get it from later.</span></span>
    
     ![새 앱 키 복사](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-hello-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="7f447-236">Hello API 중간 계층 응용 프로그램의 런타임 환경에서 Azure AD 설정 구성</span><span class="sxs-lookup"><span data-stu-id="7f447-236">Configure Azure AD settings in hello middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="7f447-237">Toohello 이동 [Azure 포털](https://portal.azure.com/)를 이동한 후 toohello **API 앱** 블레이드 hello TodoListAPI (중간 계층) 프로젝트를 호스팅하는 hello API 앱에 대 한 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-237">Go toohello [Azure portal](https://portal.azure.com/), and then navigate toohello **API App** blade for hello API app that hosts hello TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="7f447-238">**설정 > 응용 프로그램 설정**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="7f447-239">Hello에 **앱 설정** 섹션을 따라 hello 키와 값을 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-239">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="7f447-240">**키**</span><span class="sxs-lookup"><span data-stu-id="7f447-240">**Key**</span></span> | <span data-ttu-id="7f447-241">ida:Authority</span><span class="sxs-lookup"><span data-stu-id="7f447-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="7f447-242">**값**</span><span class="sxs-lookup"><span data-stu-id="7f447-242">**Value**</span></span> |<span data-ttu-id="7f447-243">https://login.microsoftonline.com/{Azure AD 테넌트 이름}</span><span class="sxs-lookup"><span data-stu-id="7f447-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="7f447-244">**예제**</span><span class="sxs-lookup"><span data-stu-id="7f447-244">**Example**</span></span> |<span data-ttu-id="7f447-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="7f447-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="7f447-246">**키**</span><span class="sxs-lookup"><span data-stu-id="7f447-246">**Key**</span></span> | <span data-ttu-id="7f447-247">ida:ClientId</span><span class="sxs-lookup"><span data-stu-id="7f447-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="7f447-248">**값**</span><span class="sxs-lookup"><span data-stu-id="7f447-248">**Value**</span></span> |<span data-ttu-id="7f447-249">응용 프로그램 (중간 계층-ToDoListAPI)을 호출 하는 hello의 클라이언트 ID</span><span class="sxs-lookup"><span data-stu-id="7f447-249">Client ID of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="7f447-250">**예제**</span><span class="sxs-lookup"><span data-stu-id="7f447-250">**Example**</span></span> |<span data-ttu-id="7f447-251">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="7f447-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="7f447-252">**키**</span><span class="sxs-lookup"><span data-stu-id="7f447-252">**Key**</span></span> | <span data-ttu-id="7f447-253">ida:ClientSecret</span><span class="sxs-lookup"><span data-stu-id="7f447-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="7f447-254">**값**</span><span class="sxs-lookup"><span data-stu-id="7f447-254">**Value**</span></span> |<span data-ttu-id="7f447-255">응용 프로그램 (중간 계층-ToDoListAPI)을 호출 하는 hello의 응용 프로그램 키</span><span class="sxs-lookup"><span data-stu-id="7f447-255">App key of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="7f447-256">**예제**</span><span class="sxs-lookup"><span data-stu-id="7f447-256">**Example**</span></span> |<span data-ttu-id="7f447-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="7f447-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="7f447-258">**키**</span><span class="sxs-lookup"><span data-stu-id="7f447-258">**Key**</span></span> | <span data-ttu-id="7f447-259">ida:Resource</span><span class="sxs-lookup"><span data-stu-id="7f447-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="7f447-260">**값**</span><span class="sxs-lookup"><span data-stu-id="7f447-260">**Value**</span></span> |<span data-ttu-id="7f447-261">응용 프로그램을 호출 하는 hello의 클라이언트 ID (데이터 계층-ToDoListDataAPI)</span><span class="sxs-lookup"><span data-stu-id="7f447-261">Client ID of hello called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="7f447-262">**예제**</span><span class="sxs-lookup"><span data-stu-id="7f447-262">**Example**</span></span> |<span data-ttu-id="7f447-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="7f447-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="7f447-264">**참고**:에 대 한 `ida:Resource`, 응용 프로그램의 호출 hello를 사용 하면 **클라이언트 ID** 아닌 해당 **앱 ID URI**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-264">**Note**: For `ida:Resource`, make sure you use hello called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="7f447-265">`ida:ClientId`및 `ida:Resource` 서로 구분 hello 중간 계층 및 데이터 계층에 대 한 Azure AD applicaations을 사용 중 이므로이 자습서에 대 한 값입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for hello middle tier and data tier.</span></span> <span data-ttu-id="7f447-266">단일 사용 중 이었다 면 hello 호출 hello 및 API 앱에 대 한 Azure AD 응용 프로그램 보호 API 앱, hello 둘 다에 같은 값을 사용 하 여 `ida:ClientId` 및 `ida:Resource`합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-266">If you were using a single Azure AD application for hello calling API app and hello protected API app, you would use hello same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="7f447-267">hello 코드 hello Azure 런타임 환경과 또는 hello 프로젝트의 Web.config 파일에 저장 될 수 있으므로 ConfigurationManager tooget 이러한 값을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-267">hello code uses ConfigurationManager tooget these values, so they could be stored in hello project's Web.config file or in hello Azure runtime environment.</span></span> <span data-ttu-id="7f447-268">Azure 앱 서비스에서 ASP.NET 응용 프로그램을 실행하는 동안 환경 설정은 Web.config에서 설정을 자동으로 재정의합니다. 환경 설정을 일반적으로 [보다 안전한 방식으로 toostore 중요 한 정보가 tooa Web.config 파일을 비교](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure)합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config. Environment settings are generally a [more secure way toostore sensitive information compared tooa Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="7f447-269">**Save**를 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-269">Click **Save**.</span></span>
   
    ![저장을 클릭합니다.](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-hello-application"></a><span data-ttu-id="7f447-271">Hello 응용 프로그램 테스트</span><span class="sxs-lookup"><span data-stu-id="7f447-271">Test hello application</span></span>
1. <span data-ttu-id="7f447-272">브라우저에서 toohello hello AngularJS 프런트 엔드 웹 응용 프로그램의 HTTPS URL을 이동 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-272">In a browser go toohello HTTPS URL of hello AngularJS front end web app.</span></span>
2. <span data-ttu-id="7f447-273">Hello 클릭 **tooDo 목록** 탭과 Azure AD 테 넌 트의 사용자에 대 한 자격 증명으로 로그인 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-273">Click hello **tooDo List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="7f447-274">Hello 응용 프로그램이 작동 하는 할 일 항목 tooverify를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-274">Add to-do items tooverify that hello application is working.</span></span>
   
    ![tooDo 목록 페이지](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="7f447-276">Hello 응용 프로그램이 예상 대로 작동 하지 않을 경우 모든 hello Azure 포털에에서 입력 한 hello 설정을 두 번 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-276">If hello application doesn't work as expected, double-check all of hello settings you entered in hello Azure portal.</span></span> <span data-ttu-id="7f447-277">올바른 toobe hello 설정을 모두 없으면 참조 hello [문제 해결](#troubleshooting) 이 자습서의 뒷부분에 나오는 섹션.</span><span class="sxs-lookup"><span data-stu-id="7f447-277">If all of hello settings appear toobe correct, see hello [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-hello-api-app-from-browser-access"></a><span data-ttu-id="7f447-278">Hello API 앱에서 브라우저 액세스 보호</span><span class="sxs-lookup"><span data-stu-id="7f447-278">Protect hello API app from browser access</span></span>
<span data-ttu-id="7f447-279">이 자습서에 대 한 별도 만든 hello ToDoListDataAPI (데이터 계층) API 앱에 대 한 Azure AD 응용 프로그램입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-279">For this tutorial you created a separate Azure AD application for hello ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="7f447-280">지금까지 살펴본 대로, 앱 서비스는 AAD 응용 프로그램을 만들 때 hello AAD 응용 프로그램에서 브라우저와 로그에는 사용자 toogo toohello API 앱 URL을 사용 하도록 설정 하는 방식으로 구성 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-280">As you've seen, when App Service creates an AAD application, it configures hello AAD application in a way that enables a user toogo toohello API app's URL in a browser and log on.</span></span> <span data-ttu-id="7f447-281">즉, Azure AD 테 넌 트 뿐 아니라 서비스 사용자는 최종 사용자 수, tooaccess hello API.</span><span class="sxs-lookup"><span data-stu-id="7f447-281">That means it's possible for an end user in your Azure AD tenant, not just a service principal, tooaccess hello API.</span></span> 

<span data-ttu-id="7f447-282">API 앱을 보호 hello에 코드를 작성 하지 않고 tooprevent 브라우저 액세스를 원하는 경우에 hello을 변경할 수 있습니다 **회신 URL** 하 게 구분할 hello API 앱에서 기본 URL의 hello AAD 응용 프로그램입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-282">If you want tooprevent browser access without writing any code in hello protected API app, you can change hello **Reply URL** in hello AAD application so that it's different from hello API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="7f447-283">브라우저 액세스 사용 안 함</span><span class="sxs-lookup"><span data-stu-id="7f447-283">Disable browser access</span></span>
1. <span data-ttu-id="7f447-284">Hello 클래식 포털에서 **구성** TodoListService hello에 대해 만들어진 hello AAD 응용 프로그램에 대 한 탭 hello에 hello 값을 변경 하세요 **회신 URL** 구분 되는 올바른 URL 있지만 하지 hello API 응용 프로그램의 필드 URL입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-284">In hello classic portal's **Configure** tab for hello AAD application that was created for hello TodoListService, change hello value in hello **Reply URL** field so that it is a valid URL but not hello API app's URL.</span></span>
2. <span data-ttu-id="7f447-285">**Save**를 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-285">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="7f447-286">브라우저 액세스가 더 이상 작동하지 않는지 확인</span><span class="sxs-lookup"><span data-stu-id="7f447-286">Verify browser access no longer works</span></span>
<span data-ttu-id="7f447-287">이전 버전을 이동할 수 있습니다 toohello API 앱 URL을 브라우저에서 개별 사용자의 자격 증명으로 로그온 하 여 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-287">Earlier you verified that you can go toohello API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="7f447-288">이 섹션에서 더 이상 가능하지 않은지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-288">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="7f447-289">새 브라우저 창에서 toohello hello API 앱 URL을 다시 이동 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-289">In a new browser window, go toohello URL of hello API app again.</span></span>
2. <span data-ttu-id="7f447-290">경우에 로그 라는 toodo 메시지가 표시 되므로.</span><span class="sxs-lookup"><span data-stu-id="7f447-290">Log in when prompted toodo so.</span></span>
3. <span data-ttu-id="7f447-291">로그인 성공 하지만 tooan 오류 페이지를 안내 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-291">Login succeeds but leads tooan error page.</span></span>
   
    <span data-ttu-id="7f447-292">Hello AAD 테 넌 트의 사용자가 로그인 하 고 브라우저에서 hello API에 액세스할 수 없는 있도록 hello AAD 응용 프로그램을 구성 했습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-292">You've configured hello AAD app so that users in hello AAD tenant cannot log in and access hello API from a browser.</span></span> <span data-ttu-id="7f447-293">여전히 toohello 웹 앱의 URL을 이동 하 할 일 항목을 더 추가 하 여 확인할 수 있는 서비스 보안 주체 토큰을 사용 하 여 hello API 앱에 액세스할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-293">You can still access hello API app by using a service principal token, which you can verify by going toohello web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-tooa-particular-service-principal"></a><span data-ttu-id="7f447-294">액세스 tooa 특정 서비스 사용자를 제한 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-294">Restrict access tooa particular service principal</span></span>
<span data-ttu-id="7f447-295">사용자에 대 한 토큰을 얻을 수 있는 모든 호출자가 지금 바로 사용 하거나 Azure AD 테 넌 트에 서비스 사용자는 hello TodoListDataAPI (데이터 계층) API 앱을 호출할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-295">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call hello TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="7f447-296">Hello 데이터 계층 API 앱은만 특정 서비스 보안 주체와만 hello TodoListAPI (중간 계층) API 앱에서 호출을 허용 하는지 toomake를 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-296">You might want toomake sure that hello data tier API app only accepts calls from hello TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="7f447-297">이러한 제한 사항은 toovalidate hello 코드를 추가 하 여 추가할 수 있습니다 `appid` 및 `objectidentifier` 들어오는 호출에는 클레임입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-297">You can add these restrictions by adding code toovalidate hello `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="7f447-298">이 자습서에 대 한 앱 ID와 컨트롤러 작업에서 직접 서비스 보안 주체 ID의 유효성을 검사 하는 hello 코드를 넣습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-298">For this tutorial you put hello code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="7f447-299">옵션은 사용자 지정 toouse `Authorize` 특성 또는 toodo 시작 시퀀스 (예: OWIN 미들웨어)를 사용 하 여이 유효성 검사 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-299">Alternatives are toouse a custom `Authorize` attribute or toodo this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="7f447-300">예를 보려면 hello 후자 참조 [이 샘플 응용 프로그램](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs)합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-300">For an example of hello latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="7f447-301">다음 변경 내용을 toohello TodoListDataAPI 프로젝트 hello를 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-301">Make hello following changes toohello TodoListDataAPI project.</span></span>

1. <span data-ttu-id="7f447-302">열기 hello *Controllers/TodoListController.cs* 파일입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-302">Open hello *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="7f447-303">설정 하는 hello 줄의 주석 처리 제거 `trustedCallerClientId` 및 `trustedCallerServicePrincipalId`합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-303">Uncomment hello lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="7f447-304">Hello CheckCallerId 메서드의에서 hello 코드 주석 처리를 제거 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-304">Uncomment hello code in hello CheckCallerId method.</span></span> <span data-ttu-id="7f447-305">이 메서드는 hello 컨트롤러의 모든 동작 메서드에의 hello 시작 될 때 호출 됩니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-305">This method is called at hello start of every action method in hello controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "hello appID or service principal ID is not hello expected value." });
            }
        }
4. <span data-ttu-id="7f447-306">Hello ToDoListDataAPI 프로젝트 tooAzure 앱 서비스를 다시 배포 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-306">Redeploy hello ToDoListDataAPI project tooAzure App Service.</span></span>
5. <span data-ttu-id="7f447-307">Toohello AngularJS 프런트 엔드 웹 응용 프로그램의 HTTPS URL 이동한 hello 홈 페이지에서 클릭 hello 브라우저에서 **tooDo 목록** 탭 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-307">In your browser, go toohello AngularJS front end web app's HTTPS URL, and in hello home page click hello **tooDo List** tab.</span></span>
   
    <span data-ttu-id="7f447-308">hello 응용 프로그램은 다시 toohello 종료 호출이 실패 하 고 때문에 작동 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-308">hello application doesn't work because calls toohello back end are failing.</span></span> <span data-ttu-id="7f447-309">새 코드 hello 및 검사 하 고 실제 appid objectidentifier 있지만 hello 올바른 값 toocheck 아직 없는 대 한 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-309">hello new code is checking actual appid and objectidentifier but it doesn't yet have hello correct values toocheck them against.</span></span> <span data-ttu-id="7f447-310">hello 브라우저 개발자 도구 콘솔 보고 해당 hello 서버에서 HTTP 401 오류를 반환 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-310">hello browser Developer Tools Console reports that hello server is returning an HTTP 401 error.</span></span>
   
    ![개발자 도구 콘솔의 오류](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="7f447-312">단계를 수행 하는 hello hello 예상 값을 구성 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-312">In hello following steps you configure hello expected values.</span></span>
6. <span data-ttu-id="7f447-313">Azure AD PowerShell을 사용 하 여 값을 가져올 hello hello 서비스의 주 hello hello TodoListWebApp 프로젝트에 대해 생성 하는 Azure AD 응용 프로그램에 대 한 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-313">Using Azure AD PowerShell, get hello value of hello service principal for hello Azure AD application that you created for hello TodoListWebApp project.</span></span>
   
    <span data-ttu-id="7f447-314">a.</span><span class="sxs-lookup"><span data-stu-id="7f447-314">a.</span></span> <span data-ttu-id="7f447-315">방법에 대 한 Azure PowerShell tooinstall tooyour 구독을 연결 하 고, 참조 [Azure PowerShell 사용 하 여 Azure 리소스 관리자와](../powershell-azure-resource-manager.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-315">For instructions on how tooinstall Azure PowerShell and connect tooyour subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="7f447-316">b.</span><span class="sxs-lookup"><span data-stu-id="7f447-316">b.</span></span> <span data-ttu-id="7f447-317">서비스 주체 목록을 tooget 실행 hello `Login-AzureRmAccount` 명령을 클릭 한 다음 hello `Get-AzureRmADServicePrincipal` 명령입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-317">tooget a list of service principals, execute hello `Login-AzureRmAccount` command and then hello `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="7f447-318">c.</span><span class="sxs-lookup"><span data-stu-id="7f447-318">c.</span></span> <span data-ttu-id="7f447-319">Hello objectid hello에 대 한 hello TodoListAPI 응용 프로그램의 서비스 사용자 찾아에서 나중에 복사할 수 있습니다 위치에 저장 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-319">Find hello objectid for hello service principal of hello TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="7f447-320">Hello Azure 포털에서에서 hello ToDoListDataAPI 프로젝트를 배포 하는 hello API 앱에 대 한 toohello API 앱 블레이드를 탐색 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-320">In hello Azure portal, navigate toohello API app blade for hello API app that you deployed hello ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="7f447-321">**설정 > 응용 프로그램 설정**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-321">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="7f447-322">Hello에 **앱 설정** 섹션을 따라 hello 키와 값을 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-322">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="7f447-323">**키**</span><span class="sxs-lookup"><span data-stu-id="7f447-323">**Key**</span></span> | <span data-ttu-id="7f447-324">todo:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="7f447-324">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="7f447-325">**값**</span><span class="sxs-lookup"><span data-stu-id="7f447-325">**Value**</span></span> |<span data-ttu-id="7f447-326">호출하는 응용 프로그램의 서비스 주체 ID</span><span class="sxs-lookup"><span data-stu-id="7f447-326">Service principal id of calling application</span></span> |
   | <span data-ttu-id="7f447-327">**예제**</span><span class="sxs-lookup"><span data-stu-id="7f447-327">**Example**</span></span> |<span data-ttu-id="7f447-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="7f447-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="7f447-329">**키**</span><span class="sxs-lookup"><span data-stu-id="7f447-329">**Key**</span></span> | <span data-ttu-id="7f447-330">todo:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="7f447-330">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="7f447-331">**값**</span><span class="sxs-lookup"><span data-stu-id="7f447-331">**Value**</span></span> |<span data-ttu-id="7f447-332">호출 하는 응용 프로그램-hello TodoListAPI Azure AD 응용 프로그램에서 복사한 클라이언트 ID</span><span class="sxs-lookup"><span data-stu-id="7f447-332">Client ID of calling application - copied from hello TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="7f447-333">**예제**</span><span class="sxs-lookup"><span data-stu-id="7f447-333">**Example**</span></span> |<span data-ttu-id="7f447-334">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="7f447-334">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="7f447-335">**Save**를 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-335">Click **Save**.</span></span>
    
     ![저장을 클릭합니다.](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="7f447-337">브라우저에서 toohello 웹 앱의 URL을 반환 하 고 hello 홈 페이지에서 hello 클릭 **tooDo 목록** 탭 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-337">In your browser, return toohello web app's URL, and in hello home page click hello **tooDo List** tab.</span></span>
    
     <span data-ttu-id="7f447-338">이 시간 hello 응용 프로그램 ID 및 서비스 보안 주체 ID hello 신뢰할 수 있는 호출자에 게 앱 hello 예상 값 때문에 예상 대로 작동 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-338">This time hello application works as expected because hello trusted caller app ID and service principal ID are hello expected values.</span></span>
    
     ![tooDo 목록 페이지](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-hello-projects-from-scratch"></a><span data-ttu-id="7f447-340">처음부터 hello 프로젝트 빌드</span><span class="sxs-lookup"><span data-stu-id="7f447-340">Building hello projects from scratch</span></span>
<span data-ttu-id="7f447-341">hello를 사용 하 여 hello 두 웹 API 프로젝트가 만들어진 **Azure API 앱** 프로젝트 템플릿 및 hello 기본 값 컨트롤러와 ToDoList 컨트롤러 교체 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-341">hello two Web API projects were created by using hello **Azure API App** project template and replacing hello default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="7f447-342">Hello ToDoListAPI 프로젝트에서 Azure AD 서비스 보안 주체 토큰을 획득에 대 한 hello [Active Directory 인증 라이브러리 (ADAL).NET 용](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet 패키지가 설치 되었습니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-342">For acquiring Azure AD service principal tokens in hello ToDoListAPI project, hello [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="7f447-343">방법에 대 한 정보는 너무 ToDoListAngular와 같은 웹 API 백 엔드에서 AngularJS 단일 페이지 응용 프로그램을 만들기, 참조 [손에에 랩: 빌드는 단일 페이지 응용 프로그램 (SPA) ASP.NET Web API와 Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs)합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-343">For information about how too create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="7f447-344">방법에 대 한 정보에 대 한 Azure AD 인증 코드 tooadd 참조 [보안 AngularJS 단일 페이지 응용 프로그램을 Azure AD와](../active-directory/active-directory-devquickstarts-angular.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-344">For information about how tooadd Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="7f447-345">문제 해결</span><span class="sxs-lookup"><span data-stu-id="7f447-345">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="7f447-346">ToDoListAPI(중간 계층) 및 ToDoListDataAPI(데이터 계층)를 혼동하지 않아야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-346">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="7f447-347">예를 들어이 자습서에서는 추가한 인증 toohello 데이터 계층 API 앱 **hello 응용 프로그램 키는 hello hello 중간 계층 API 앱에 대해 만든 Azure AD 응용 프로그램에서에서 가져와야 합니다. 하지만**합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-347">For example, in this tutorial you add authentication toohello data tier API app, **but hello app key must come from hello Azure AD application that you created for hello middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7f447-348">다음 단계</span><span class="sxs-lookup"><span data-stu-id="7f447-348">Next steps</span></span>
<span data-ttu-id="7f447-349">이 hello API 앱 일련의에서 hello 마지막 자습서입니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-349">This is hello last tutorial in hello API Apps series.</span></span> 

<span data-ttu-id="7f447-350">Azure Active Directory에 대 한 자세한 내용은 다음 리소스는 hello를 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="7f447-350">For more information about Azure Active Directory, see hello following resources.</span></span>

* [<span data-ttu-id="7f447-351">Azure AD 개발자 가이드</span><span class="sxs-lookup"><span data-stu-id="7f447-351">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="7f447-352">Azure AD 시나리오</span><span class="sxs-lookup"><span data-stu-id="7f447-352">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="7f447-353">Azure AD 샘플</span><span class="sxs-lookup"><span data-stu-id="7f447-353">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="7f447-354">hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) 샘플은 유사한 toowhat 앱 서비스 인증을 사용 하지 않고이 자습서에 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-354">hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar toowhat is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="7f447-355">다른 방법에 대 한 내용은 toodeploy Visual Studio 프로젝트 tooAPI 앱 또는 Visual Studio를 사용 하 여 [배포를 자동화](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) 에서 [소스 제어 시스템이](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), 참조 [어떻게 toodeploy는 Azure 앱 서비스 앱](../app-service-web/web-sites-deploy.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="7f447-355">For information about other ways toodeploy Visual Studio projects tooAPI apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How toodeploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

