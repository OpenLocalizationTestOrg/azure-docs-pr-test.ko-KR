---
title: "다중 테넌트 SaaS 앱에서 다수의 Azure SQL 데이터베이스 성능 모니터링 | Microsoft Docs"
description: "Azure SQL Database Wingtip SaaS 앱에서 데이터베이스 및 풀의 성능 모니터링 및 관리"
keywords: "SQL Database 자습서"
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/26/2017
ms.author: sstein
ms.openlocfilehash: 42f727aa40e744916b1a8adf634c10d55880bef0
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/03/2017
---
# <a name="monitor-performance-of-the-wingtip-saas-application"></a><span data-ttu-id="b9bb5-104">Wingtip SaaS 응용 프로그램의 성능 모니터링</span><span class="sxs-lookup"><span data-stu-id="b9bb5-104">Monitor performance of the Wingtip SaaS application</span></span>

<span data-ttu-id="b9bb5-105">이 자습서에서는 SaaS 응용 프로그램에서 사용되는 몇 가지 주요 성능 관리 시나리오를 살펴봅니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-105">In this tutorial, several key performance management scenarios used in SaaS applications are explored.</span></span> <span data-ttu-id="b9bb5-106">부하 생성기를 사용하여 모든 테넌트 데이터베이스에서의 활동을 시뮬레이션하여 SQL Database 및 탄력적 풀의 기본 제공 모니터링 및 경고 기능을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-106">Using a load generator to simulate activity across all tenant databases, the built-in monitoring and alerting features of SQL Database and elastic pools are demonstrated.</span></span>

<span data-ttu-id="b9bb5-107">Wingtip SaaS 앱은 단일 테넌트 데이터 모델을 사용하며, 각 장소(테넌트)에 자체 데이터베이스가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-107">The Wingtip SaaS app uses a single-tenant data model, where each venue (tenant) has their own database.</span></span> <span data-ttu-id="b9bb5-108">많은 SaaS 응용 프로그램과 마찬가지로 예상 테넌트 워크로드 패턴은 예측하기 어렵고 간헐적입니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-108">Like many SaaS applications, the anticipated tenant workload pattern is unpredictable and sporadic.</span></span> <span data-ttu-id="b9bb5-109">예를 들어 티켓 판매는 아무 때나 발생할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-109">In other words, ticket sales may occur at any time.</span></span> <span data-ttu-id="b9bb5-110">이러한 일반적인 데이터베이스 사용 패턴을 이용하기 위해 테넌트 데이터베이스가 Elastic Database 풀에 배포됩니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-110">To take advantage of this typical database usage pattern, tenant databases are deployed into elastic database pools.</span></span> <span data-ttu-id="b9bb5-111">탄력적 풀은 많은 데이터베이스에 걸쳐 리소스를 공유하여 솔루션의 비용을 최적화합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-111">Elastic pools optimize the cost of a solution by sharing resources across many databases.</span></span> <span data-ttu-id="b9bb5-112">이 유형의 패턴에서는 풀 전체에 걸쳐 부하가 합리적으로 균형을 유지하도록 데이터베이스 및 풀 리소스 사용을 모니터링해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-112">With this type of pattern, it's important to monitor database and pool resource usage to ensure that loads are reasonably balanced across pools.</span></span> <span data-ttu-id="b9bb5-113">또한 개별 데이터베이스에 적합한 리소스가 있고 풀이 [eDTU](sql-database-what-is-a-dtu.md) 한도에 도달하지 않도록 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-113">You also need to ensure that individual databases have adequate resources, and that pools are not hitting their [eDTU](sql-database-what-is-a-dtu.md) limits.</span></span> <span data-ttu-id="b9bb5-114">이 자습서에서는 데이터베이스와 풀을 모니터링하고 관리하는 방법과 워크로드 변화에 응답하여 정정 작업을 실행하는 방법을 탐색합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-114">This tutorial explores ways to monitor and manage databases and pools, and how to take corrective action in response to variations in workload.</span></span>

<span data-ttu-id="b9bb5-115">이 자습서에서는 다음 방법에 대해 알아봅니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-115">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="b9bb5-116">제공된 부하 생성기를 실행하여 테넌트 데이터베이스에 대한 사용량 시뮬레이션</span><span class="sxs-lookup"><span data-stu-id="b9bb5-116">Simulate usage on the tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="b9bb5-117">부하 증가에 응답하여 테넌트 데이터베이스 모니터링</span><span class="sxs-lookup"><span data-stu-id="b9bb5-117">Monitor the tenant databases as they respond to the increase in load</span></span>
> * <span data-ttu-id="b9bb5-118">증가된 데이터베이스 부하에 응답하여 탄력적 풀 강화</span><span class="sxs-lookup"><span data-stu-id="b9bb5-118">Scale up the Elastic pool in response to the increased database load</span></span>
> * <span data-ttu-id="b9bb5-119">데이터베이스 작업의 부하를 분산하도록 두 번째 탄력적 풀을 프로비전</span><span class="sxs-lookup"><span data-stu-id="b9bb5-119">Provision a second Elastic pool to load balance database activity</span></span>


<span data-ttu-id="b9bb5-120">이 자습서를 수행하려면 다음 필수 조건이 완료되었는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-120">To complete this tutorial, make sure the following prerequisites are completed:</span></span>

* <span data-ttu-id="b9bb5-121">Wingtip SaaS 앱이 배포되었습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-121">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="b9bb5-122">5분 내에 배포하려면 [Wingtip SaaS 응용 프로그램 배포 및 탐색](sql-database-saas-tutorial.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-122">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="b9bb5-123">Azure PowerShell이 설치되었습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-123">Azure PowerShell is installed.</span></span> <span data-ttu-id="b9bb5-124">자세한 내용은 [Azure PowerShell 시작](https://docs.microsoft.com/powershell/azure/get-started-azureps)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-124">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-to-saas-performance-management-patterns"></a><span data-ttu-id="b9bb5-125">SaaS 성능 관리 패턴 소개</span><span class="sxs-lookup"><span data-stu-id="b9bb5-125">Introduction to SaaS performance management patterns</span></span>

<span data-ttu-id="b9bb5-126">데이터베이스 성능 관리는 성능 데이터 컴파일과 분석 및 그런 다음 응용 프로그램에 대해 허용되는 응답 시간을 유지하도록 매개 변수를 조정하여 이 데이터에 반응하는 과정으로 구성됩니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-126">Managing database performance consists of compiling and analyzing performance data, and then reacting to this data by adjusting parameters to maintain an acceptable response time for your application.</span></span> <span data-ttu-id="b9bb5-127">여러 테넌트를 호스팅할 때 Elastic Database 풀은 예측 불가능한 워크로드를 가진 데이터베이스 그룹에 대한 리소스를 제공하고 관리하는 비용 효율적인 방법입니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-127">When hosting multiple tenants, Elastic database pools are a cost-effective way to provide and manage resources for a group of databases with unpredictable workloads.</span></span> <span data-ttu-id="b9bb5-128">특정 워크로드 패턴의 경우 풀에서 관리하면 S3 데이터베이스 두 개만 이점을 얻을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-128">With certain workload patterns, as few as two S3 databases can benefit from being managed in a pool.</span></span>

![미디어](./media/sql-database-saas-tutorial-performance-monitoring/app-diagram.png)

<span data-ttu-id="b9bb5-130">풀 및 풀에 있는 데이터베이스를 모니터링하여 성능의 허용 범위로 유지되는지 확인해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-130">Pools, and the databases in pools, should be monitored to ensure they stay within acceptable ranges of performance.</span></span> <span data-ttu-id="b9bb5-131">풀 구성을 모든 데이터베이스의 집계 워크로드에 대한 요구에 맞게 조정하여 풀 eDTU가 전체 워크로드에 적합하게 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-131">Tune the pool configuration to meet the needs of the aggregate workload of all databases, ensuring that the pool eDTUs are appropriate for the overall workload.</span></span> <span data-ttu-id="b9bb5-132">데이터베이스별 최소 및 데이터베이스별 최대 eDTU 값을 특정 응용 프로그램 요구 사항에 적합한 값으로 조정합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-132">Adjust the per-database min and per-database max eDTU values to appropriate values for your specific application requirements.</span></span>

### <a name="performance-management-strategies"></a><span data-ttu-id="b9bb5-133">성능 관리 전략</span><span class="sxs-lookup"><span data-stu-id="b9bb5-133">Performance management strategies</span></span>

* <span data-ttu-id="b9bb5-134">수동으로 성능을 모니터링할 필요가 없도록 하려면 **데이터베이스 또는 풀이 정상 범위를 벗어난 경우 트리거되는 경고를 설정**하는 것이 가장 효과적입니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-134">To avoid having to manually monitor performance, it’s most effective to **set alerts that trigger when databases or pools stray out of normal ranges**.</span></span>
* <span data-ttu-id="b9bb5-135">풀의 집계 성능의 단기적 변동에 대응하기 위해 **풀 eDTU 수준을 확장하거나 축소할 수 있습니다**.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-135">To respond to short-term fluctuations in the aggregate performance level of a pool, the **pool eDTU level can be scaled up or down**.</span></span> <span data-ttu-id="b9bb5-136">이러한 변동이 정기적으로 또는 예측 가능한 단위로 발생하는 경우 **풀 크기 조정을 자동으로 일어나도록 예약**할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-136">If this fluctuation occurs on a regular or predictable basis, **scaling the pool can be scheduled to occur automatically**.</span></span> <span data-ttu-id="b9bb5-137">예를 들어 워크로드가 가볍다고 알고 있는 경우 야간 또는 주말 중으로 규모를 축소할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-137">For example, scale down when you know your workload is light, maybe overnight, or during weekends.</span></span>
* <span data-ttu-id="b9bb5-138">더 장기적인 변동 또는 데이터베이스 수 변화에 대응하기 위해 **개별 데이터베이스를 다른 풀로 이동**할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-138">To respond to longer-term fluctuations, or changes in the number of databases, **individual databases can be moved into other pools**.</span></span>
* <span data-ttu-id="b9bb5-139">*개별* 데이터베이스 부하의 단기적 증가에 대응하기 위해 **개별 데이터베이스를 풀에서 제외하고 개별 성능 수준을 할당**할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-139">To respond to short term increases in *individual* database load **individual databases can be taken out of a pool and assigned an individual performance level**.</span></span> <span data-ttu-id="b9bb5-140">부하가 감소한 후 데이터베이스를 풀에 반환할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-140">Once the load is reduced, the database can then be returned to the pool.</span></span> <span data-ttu-id="b9bb5-141">이러한 상황을 미리 안다면 데이터베이스에 언제나 필요한 리소스가 있도록 하고 풀에 있는 다른 데이터베이스에 영향을 미치지 않도록 데이터베이스를 선제적으로 이동할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-141">When this is known in advance, databases can be moved pre-emptively to ensure the database always has the resources it needs, and to avoid impact on other databases in the pool.</span></span> <span data-ttu-id="b9bb5-142">이 요구 사항이 예측 가능하다면 인기 있는 이벤트에 대한 티켓 판매의 급격한 증가를 경험한 영역을 응용 프로그램에 통합할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-142">If this requirement is predictable, such as a venue experiencing a rush of ticket sales for a popular event, then this management behavior can be integrated into the application.</span></span>

<span data-ttu-id="b9bb5-143">[Azure Portal](https://portal.azure.com)은 대부분의 리소스에 대한 기본 제공 모니터링 및 경고를 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-143">The [Azure portal](https://portal.azure.com) provides built-in monitoring and alerting on most resources.</span></span> <span data-ttu-id="b9bb5-144">SQL Database의 경우 데이터베이스 및 풀에 대한 모니터링 및 경고가 가능합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-144">For SQL Database, monitoring and alerting is available on databases and pools.</span></span> <span data-ttu-id="b9bb5-145">이 기본 제공 모니터링 및 경고는 리소스별로 다르므로 소수의 리소스에 사용하면 편리하지만 많은 리소스를 가지고 작업하는 경우 그리 편리하지 않을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-145">This built-in monitoring and alerting is resource-specific, so it's convenient to use for small numbers of resources, but is not very convenient when working with many resources.</span></span>

<span data-ttu-id="b9bb5-146">여러 리소스로 작업하는 대규모 시나리오의 경우 [Log Analytics(OMS)](sql-database-saas-tutorial-log-analytics.md)를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-146">For high-volume scenarios where you're working with many reources, [Log Analytics (OMS)](sql-database-saas-tutorial-log-analytics.md) can be used.</span></span> <span data-ttu-id="b9bb5-147">이것은 여러 서비스에서 원격 분석을 수집하고 쿼리 및 경고 설정에 사용할 수 있는 Log Analytics 작업 영역에서 수집된</span><span class="sxs-lookup"><span data-stu-id="b9bb5-147">This is a separate Azure service that provides analytics over emitted diagnostic logs and telemetry gathered in a log analytics workspace.</span></span> <span data-ttu-id="b9bb5-148">원격 분석에 대한 분석을 제공하는 개별 Azure 서비스입니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-148">Log Analytics can collect telemetry from many services and be used to query and set alerts.</span></span>

## <a name="get-the-wingtip-application-source-code-and-scripts"></a><span data-ttu-id="b9bb5-149">Wingtip 응용 프로그램 소스 코드 및 스크립트 가져오기</span><span class="sxs-lookup"><span data-stu-id="b9bb5-149">Get the Wingtip application source code and scripts</span></span>

<span data-ttu-id="b9bb5-150">Wingtip SaaS 스크립트 및 응용 프로그램 소스 코드는 [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github 리포지토리에서 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-150">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="b9bb5-151">[Wingtip SaaS 스크립트를 다운로드하는 단계](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="b9bb5-151">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="provision-additional-tenants"></a><span data-ttu-id="b9bb5-152">추가 테넌트 프로비전</span><span class="sxs-lookup"><span data-stu-id="b9bb5-152">Provision additional tenants</span></span>

<span data-ttu-id="b9bb5-153">풀은 S3 데이터베이스가 단 두 개인 경우 비용 효율적일 수 있지만 풀에 있는 데이터베이스가 많을수록 평균 적용이 더 비용 효율적입니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-153">While pools can be cost-effective with just two S3 databases, the more databases that are in the pool the more cost-effective the averaging effect becomes.</span></span> <span data-ttu-id="b9bb5-154">성능 모니터링과 관리가 규모별로 작동하는 방법을 잘 이해하기 위해 이 자습서에서 적어도 20개의 데이터베이스를 배포해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-154">For a good understanding of how performance monitoring and management works at scale, this tutorial requires you have at least 20 databases deployed.</span></span>

<span data-ttu-id="b9bb5-155">이미 이전 자습서에서 테넌트의 배치를 프로비전한 경우 [모든 테넌트 데이터베이스에 대한 사용량 시뮬레이션](#simulate-usage-on-all-tenant-databases) 섹션을 건너뛸 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-155">If you already provisioned a batch of tenants in a prior tutorial, skip to the [Simulate usage on all tenant databases](#simulate-usage-on-all-tenant-databases) section.</span></span>

1. <span data-ttu-id="b9bb5-156">*PowerShell ISE*에서 ...\\Learning Modules\\성능 모니터링 및 관리\\*Demo-PerformanceMonitoringAndManagement.ps1*을 엽니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-156">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in the *PowerShell ISE*.</span></span> <span data-ttu-id="b9bb5-157">이 자습서를 실행하는 동안 여러 시나리오를 실행할 때 이 스크립트를 열어 두세요.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-157">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="b9bb5-158">**$DemoScenario** = **1**, **Provision a batch of tenants** 설정</span><span class="sxs-lookup"><span data-stu-id="b9bb5-158">Set **$DemoScenario** = **1**, **Provision a batch of tenants**</span></span>
1. <span data-ttu-id="b9bb5-159">**F5** 키를 눌러 스크립트를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-159">Press **F5** to run the script.</span></span>

<span data-ttu-id="b9bb5-160">이 스크립트는 테넌트 17개를 5분 이내에 배포합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-160">The script will deploy 17 tenants in less than five minutes.</span></span>

<span data-ttu-id="b9bb5-161">*New-TenantBatch* 스크립트는 테넌트의 배치를 만드는 [Resource Manager](../azure-resource-manager/index.md) 템플릿의 중첩 또는 연결된 집합을 사용하며, 기본적으로 **basetenantdb** 데이터베이스를 카탈로그 서버에 복사하여 새 테넌트 데이터베이스를 만든 다음 이들을 카탈로그에 등록하며, 끝으로 이들을 테넌트 이름과 장소 유형으로 초기화합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-161">The *New-TenantBatch* script uses a nested or linked set of [Resource Manager](../azure-resource-manager/index.md) templates that create a batch of tenants, which by default copies the database **basetenantdb** on the catalog server to create the new tenant databases, then registers these in the catalog, and finally initializes them with the tenant name and venue type.</span></span> <span data-ttu-id="b9bb5-162">이 방법은 앱이 새 테넌트를 프로비전하는 방법과 일치합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-162">This is consistent with the way the app provisions a new tenant.</span></span> <span data-ttu-id="b9bb5-163">*basetenantdb*에 대해 실행한 변경은 이후 프로비전하는 새 테넌트에 모두 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-163">Any changes made to *basetenantdb* are applied to any new tenants provisioned thereafter.</span></span> <span data-ttu-id="b9bb5-164">*기존* 테넌트 데이터베이스(*basetenantdb* 데이터베이스 포함)에 대해 스키마를 변경하는 방법은 [스키마 관리 자습서](sql-database-saas-tutorial-schema-management.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-164">See the [Schema Management tutorial](sql-database-saas-tutorial-schema-management.md) to see how to make schema changes to *existing* tenant databases (including the *basetenantdb* database).</span></span>

## <a name="simulate-usage-on-all-tenant-databases"></a><span data-ttu-id="b9bb5-165">모든 테넌트 데이터베이스에 대한 사용 시뮬레이션</span><span class="sxs-lookup"><span data-stu-id="b9bb5-165">Simulate usage on all tenant databases</span></span>

<span data-ttu-id="b9bb5-166">*Demo-PerformanceMonitoringAndManagement.ps1* 스크립트는 모든 테넌트 데이터베이스에 대해 실행되는 워크로드를 시뮬레이션하는 경우 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-166">The *Demo-PerformanceMonitoringAndManagement.ps1* script is provided that simulates a workload running against all tenant databases.</span></span> <span data-ttu-id="b9bb5-167">사용 가능한 부하 시나리오 중 하나를 사용하여 부하가 생성됩니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-167">The load is generated using one of the available load scenarios:</span></span>

| <span data-ttu-id="b9bb5-168">데모</span><span class="sxs-lookup"><span data-stu-id="b9bb5-168">Demo</span></span> | <span data-ttu-id="b9bb5-169">시나리오</span><span class="sxs-lookup"><span data-stu-id="b9bb5-169">Scenario</span></span> |
|:--|:--|
| <span data-ttu-id="b9bb5-170">2</span><span class="sxs-lookup"><span data-stu-id="b9bb5-170">2</span></span> | <span data-ttu-id="b9bb5-171">표준 강도 부하(약 40 DTU) 생성</span><span class="sxs-lookup"><span data-stu-id="b9bb5-171">Generate normal intensity load (approx. 40 DTU)</span></span> |
| <span data-ttu-id="b9bb5-172">3</span><span class="sxs-lookup"><span data-stu-id="b9bb5-172">3</span></span> | <span data-ttu-id="b9bb5-173">데이터베이스별로 버스트가 더 길고 더 잦은 부하 생성</span><span class="sxs-lookup"><span data-stu-id="b9bb5-173">Generate load with longer and more frequent bursts per database</span></span>|
| <span data-ttu-id="b9bb5-174">4</span><span class="sxs-lookup"><span data-stu-id="b9bb5-174">4</span></span> | <span data-ttu-id="b9bb5-175">데이터베이스별로 DTU 버스트가 더 높은(약 80 DTU) 부하 생성</span><span class="sxs-lookup"><span data-stu-id="b9bb5-175">Generate load with higher DTU bursts per database (approx. 80 DTU)</span></span>|
| <span data-ttu-id="b9bb5-176">5</span><span class="sxs-lookup"><span data-stu-id="b9bb5-176">5</span></span> | <span data-ttu-id="b9bb5-177">표준 부하에 더하여 단일 테넌트의 높은 부하 생성(약 95 DTU)</span><span class="sxs-lookup"><span data-stu-id="b9bb5-177">Generate a normal load plus a high load on a single tenant (approx. 95 DTU)</span></span>|
| <span data-ttu-id="b9bb5-178">6</span><span class="sxs-lookup"><span data-stu-id="b9bb5-178">6</span></span> | <span data-ttu-id="b9bb5-179">여러 풀에 걸쳐 불균형 부하 생성</span><span class="sxs-lookup"><span data-stu-id="b9bb5-179">Generate unbalanced load across multiple pools</span></span>|

<span data-ttu-id="b9bb5-180">부하 생성기는 *가상* CPU만의 부하를 모든 테넌트 데이터베이스에 적용합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-180">The load generator applies a *synthetic* CPU-only load to every tenant database.</span></span> <span data-ttu-id="b9bb5-181">이 생성기는 각 테넌트 데이터베이스에 대해 작업을 시작하여 부하를 생성하는 저장 프로세서를 주기적으로 호출합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-181">The generator starts a job for each tenant database, which calls a stored procedure periodically that generates the load.</span></span> <span data-ttu-id="b9bb5-182">부하 수준(eDTU 단위), 기간 및 간격은 모든 데이터베이스에 걸쳐 변화하여 예측 불가능한 테넌트 작업을 시뮬레이션합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-182">The load levels (in eDTUs), duration, and intervals are varied across all databases, simulating unpredictable tenant activity.</span></span>

1. <span data-ttu-id="b9bb5-183">*PowerShell ISE*에서 ...\\Learning Modules\\성능 모니터링 및 관리\\*Demo-PerformanceMonitoringAndManagement.ps1*을 엽니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-183">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in the *PowerShell ISE*.</span></span> <span data-ttu-id="b9bb5-184">이 자습서를 실행하는 동안 여러 시나리오를 실행할 때 이 스크립트를 열어 두세요.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-184">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="b9bb5-185">**$DemoScenario** = **2**를 설정하고, *일반 강도 부하를 생성*합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-185">Set **$DemoScenario** = **2**, *Generate normal intensity load*.</span></span>
1. <span data-ttu-id="b9bb5-186">**F5**를 눌러 모든 테넌트 데이터베이스에 부하를 적용합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-186">Press **F5** to apply a load to all your tenant databases.</span></span>

<span data-ttu-id="b9bb5-187">Wingtip은 SaaS 앱이며 SaaS 앱상의 실제 부하는 일반적으로 간헐적이고 예측할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-187">Wingtip is a SaaS app, and the real-world load on a SaaS app is typically sporadic and unpredictable.</span></span> <span data-ttu-id="b9bb5-188">이를 시뮬레이션하기 위해 부하 생성기에서 모든 테넌트에 대해 분산된 임의의 부하를 생성합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-188">To simulate this, the load generator produces a randomized load distributed across all tenants.</span></span> <span data-ttu-id="b9bb5-189">부하 패턴이 나타나기 위해서는 몇 분 정도 걸리므로, 다음 섹션의 부하 모니터링을 수행하기 전에 약 3~5분 동안 부하 생성기를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-189">Several minutes are needed for the load pattern to emerge, so run the load generator for 3-5 minutes before attempting to monitor the load in the following sections.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b9bb5-190">부하 생성기는 로컬 PowerShell 세션에서 일련의 작업으로 실행 중입니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-190">The load generator is running as a series of jobs in your local PowerShell session.</span></span> <span data-ttu-id="b9bb5-191">*Demo-PerformanceMonitoringAndManagement.ps1* 탭을 열어 두세요!</span><span class="sxs-lookup"><span data-stu-id="b9bb5-191">Keep the *Demo-PerformanceMonitoringAndManagement.ps1* tab open!</span></span> <span data-ttu-id="b9bb5-192">탭을 닫거나 컴퓨터를 일시 중단하면 부하 생성기가 중단됩니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-192">If you close the tab, or suspend your machine, the load generator stops.</span></span> <span data-ttu-id="b9bb5-193">부하 생성기는 *job-invoking* 상태로 유지되어 부하 생성기가 시작된 후에 프로비전되는 모든 새 테넌트에서 부하를 생성합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-193">The load generator remains in a *job-invoking* state where it generates load on any new tenants that are provisioned after the generator is started.</span></span> <span data-ttu-id="b9bb5-194">*Ctrl-C*를 사용하여 새 작업 호출을 중지하고 스크립트를 종료합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-194">Use *Ctrl-C* to stop invoking new jobs and exit the script.</span></span> <span data-ttu-id="b9bb5-195">부하 생성기는 계속 실행되지만 기존 테넌트에만 실행됩니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-195">The load generator will continue to run, but only on existing tenants.</span></span>

## <a name="monitor-resource-usage-using-the-azure-portal"></a><span data-ttu-id="b9bb5-196">Azure Portal을 사용하여 리소스 사용 모니터링</span><span class="sxs-lookup"><span data-stu-id="b9bb5-196">Monitor resource usage using the Azure portal</span></span>

<span data-ttu-id="b9bb5-197">적용 중인 부하 때문에 발생하는 리소스 사용을 모니터링하려면 테넌트 데이터베이스가 포함된 풀에 대해 포털을 엽니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-197">To monitor the resource usage that results from the load being applied, open the portal to the pool containing the tenant databases:</span></span>

1. <span data-ttu-id="b9bb5-198">[Azure Portal](https://portal.azure.com)을 열고 *tenants1-&lt;USER&gt;* 서버를 찾습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-198">Open the [Azure portal](https://portal.azure.com) and browse to the *tenants1-&lt;USER&gt;* server.</span></span>
1. <span data-ttu-id="b9bb5-199">아래로 스크롤하여 탄력적 풀을 찾은 다음 **Pool1**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-199">Scroll down and locate elastic pools and click **Pool1**.</span></span> <span data-ttu-id="b9bb5-200">이 풀에는 지금까지 만든 모든 테넌트 데이터베이스가 포함되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-200">This pool contains all the tenant databases created so far.</span></span>

<span data-ttu-id="b9bb5-201">**탄력적 풀 모니터링** 및 **Elastic Database 모니터링** 차트를 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-201">Observe the **Elastic pool monitoring** and **Elastic database monitoring** charts.</span></span>

<span data-ttu-id="b9bb5-202">풀의 리소스 사용률은 풀에 있는 모든 데이터베이스에 대한 집계 데이터베이스 사용률입니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-202">The pool's resource utilization is the aggregate database utilization for all databases in the pool.</span></span> <span data-ttu-id="b9bb5-203">데이터베이스 차트에는 가장 많이 사용되는 5개의 데이터베이스가 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-203">The database chart shows the five hottest databases:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/pool1.png)

<span data-ttu-id="b9bb5-204">풀에는 상위 5개 데이터베이스 이외에 추가 데이터베이스가 있으므로 풀 사용률은 상위 5개 데이터베이스 차트에 반영되지 않은 작업을 표시합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-204">Because there are additional databases in the pool beyond the top five, the pool utilization shows activity that is not reflected in the top five databases chart.</span></span> <span data-ttu-id="b9bb5-205">추가 세부 정보를 보려면 **데이터베이스 리소스 사용률**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-205">For additional details, click **Database Resource Utilization**:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/database-utilization.png)


## <a name="set-performance-alerts-on-the-pool"></a><span data-ttu-id="b9bb5-206">풀에 대한 성능 경고 설정</span><span class="sxs-lookup"><span data-stu-id="b9bb5-206">Set performance alerts on the pool</span></span>

<span data-ttu-id="b9bb5-207">풀에 대해 다음과 같이 사용률 \>75%일 때 트리거되는 경고를 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-207">Set an alert on the pool that triggers on \>75% utilization as follows:</span></span>

1. <span data-ttu-id="b9bb5-208">[Azure Portal](https://portal.azure.com)에서 *Pool1*(*tenants1-\<user\>* 서버에 있는)을 엽니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-208">Open *Pool1* (on the *tenants1-\<user\>* server) in the [Azure portal](https://portal.azure.com).</span></span>
1. <span data-ttu-id="b9bb5-209">**경고 규칙**, **+ 경고 추가**를 차례로 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-209">Click **Alert Rules**, and then click **+ Add alert**:</span></span>

   ![경고 추가](media/sql-database-saas-tutorial-performance-monitoring/add-alert.png)

1. <span data-ttu-id="b9bb5-211">**높은 DTU** 등과 같은 이름을 제공</span><span class="sxs-lookup"><span data-stu-id="b9bb5-211">Provide a name, such as **High DTU**,</span></span>
1. <span data-ttu-id="b9bb5-212">다음 값을 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-212">Set the following values:</span></span>
   * <span data-ttu-id="b9bb5-213">**메트릭 = eDTU 백분율**</span><span class="sxs-lookup"><span data-stu-id="b9bb5-213">**Metric = eDTU percentage**</span></span>
   * <span data-ttu-id="b9bb5-214">**조건 = 보다 큼**.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-214">**Condition = greater than**.</span></span>
   * <span data-ttu-id="b9bb5-215">**임계값 = 75**.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-215">**Threshold = 75**.</span></span>
   * <span data-ttu-id="b9bb5-216">**기간 = 지난 30분 동안**.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-216">**Period = Over the last 30 minutes**.</span></span>
1. <span data-ttu-id="b9bb5-217">*추가 관리자 전자 메일* 상자에 메일 주소를 추가하고 **확인**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-217">Add an email address to the *Additional administrator email(s)* box and click **OK**.</span></span>

   ![경고 설정](media/sql-database-saas-tutorial-performance-monitoring/alert-rule.png)


## <a name="scale-up-a-busy-pool"></a><span data-ttu-id="b9bb5-219">사용 중인 풀 확장</span><span class="sxs-lookup"><span data-stu-id="b9bb5-219">Scale up a busy pool</span></span>

<span data-ttu-id="b9bb5-220">풀에 대한 집계 부하 수준이 풀에서 최대로 출력되는 지점까지 증가하고 eDTU 사용률이 100%에 도달한 경우 개별 데이터베이스 성능에 영향을 주며 풀에 있는 모든 데이터베이스에 대한 쿼리 응답 시간이 느려질 가능성이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-220">If the aggregate load level increases on a pool to the point that it maxes out the pool and reaches 100% eDTU usage, then individual database performance is affected, potentially slowing query response times for all databases in the pool.</span></span>

<span data-ttu-id="b9bb5-221">**단기적으로** 추가 리소스를 제공하도록 풀을 확장하거나 풀에서 데이터베이스를 제거할 것을 생각할 수 있습니다(다른 풀로 이동 또는 풀에서 독립형 서비스 계층으로).</span><span class="sxs-lookup"><span data-stu-id="b9bb5-221">**Short term**, consider scaling up the pool to provide additional resources, or removing databases from the pool (moving them to other pools, or out of the pool to a stand-alone service tier).</span></span>

<span data-ttu-id="b9bb5-222">**장기적으로** 데이터베이스 성능을 개선하기 위해 쿼리 또는 인덱스의 최적화를 생각할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-222">**Longer term**, consider optimizing queries or index usage to improve database performance.</span></span> <span data-ttu-id="b9bb5-223">성능에 대한 응용 프로그램의 민감도에 따라 풀이 사용률 100% eDTU에 도달하기 전에 풀을 확장하는 자체의 모범 사례를 발행합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-223">Depending on the application's sensitivity to performance issues its best practice to scale a pool up before it reaches 100% eDTU usage.</span></span> <span data-ttu-id="b9bb5-224">경고를 사용하여 미리 경고합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-224">Use an alert to warn you in advance.</span></span>

<span data-ttu-id="b9bb5-225">생성기에 의해 생성된 부하를 증가시켜 사용 중인 풀을 시뮬레이션할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-225">You can simulate a busy pool by increasing the load produced by the generator.</span></span> <span data-ttu-id="b9bb5-226">데이터베이스가 더 자주 그리고 더 오래 버스트하도록 하면 개별 데이터베이스의 요구 사항을 변경하지 않고 풀에 대한 집계 부하가 증가합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-226">Causing the databases to burst more frequently, and for longer, increasing the aggregate load on the pool without changing the requirements of the individual databases.</span></span> <span data-ttu-id="b9bb5-227">풀 확장은 포털 내에서 또는 PowerShell에서 쉽게 수행됩니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-227">Scaling up the pool is easily done in the portal or from PowerShell.</span></span> <span data-ttu-id="b9bb5-228">이 연습에서는 포털을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-228">This exercise uses the portal.</span></span>

1. <span data-ttu-id="b9bb5-229">*$DemoScenario* = **3**를 설정하고, 데이터베이스별로 더 오래 더 잦은 버스트를 사용하여 부하를 생성하여 각 데이터베이스에서 요구하는 최고 부하를 변경하지 않고 _풀에 대한 집계 부하의 강도를 증가_시킵니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-229">Set *$DemoScenario* = **3**, _Generate load with longer and more frequent bursts per database_ to increase the intensity of the aggregate load on the pool without changing the peak load required by each database.</span></span>
1. <span data-ttu-id="b9bb5-230">**F5**를 눌러 모든 테넌트 데이터베이스에 부하를 적용합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-230">Press **F5** to apply a load to all your tenant databases.</span></span>

1. <span data-ttu-id="b9bb5-231">Azure Portal에서 **Pool1**로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-231">Go to **Pool1** in the Azure portal.</span></span>

<span data-ttu-id="b9bb5-232">상위 차트에 대해 증가한 풀 eDTU 사용량을 모니터링합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-232">Monitor the increased pool eDTU usage on the upper chart.</span></span> <span data-ttu-id="b9bb5-233">더 높은 새 부하를 시작하려면 몇 분 걸리지만 풀이 최대 사용률에 도달하기 시작하는 것을 보고 바로 알 수 있으며 부하가 새로운 패턴으로 안정됨에 따라 풀에 빠르게 과부하가 걸립니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-233">It takes a few minutes for the new higher load to kick in, but you should quickly see the pool start to hit max utilization, and as the load steadies into the new pattern, it rapidly overloads the pool.</span></span>

1. <span data-ttu-id="b9bb5-234">풀을 강화하려면 **Pool1** 페이지 위쪽의 **풀 구성**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-234">To scale up the pool, click **Configure pool** at the top of the **Pool1** page.</span></span>
1. <span data-ttu-id="b9bb5-235">**풀 eDTU** 설정을 **100**으로 조정합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-235">Adjust the **Pool eDTU** setting to **100**.</span></span> <span data-ttu-id="b9bb5-236">풀 eDTU를 변경해도 데이터베이스별 설정은 변경되지 않습니다(여전히 데이터베이스별로 최대 50 eDTU).</span><span class="sxs-lookup"><span data-stu-id="b9bb5-236">Changing the pool eDTU does not change the per-database settings (which is still 50 eDTU max per database).</span></span> <span data-ttu-id="b9bb5-237">**풀 구성** 페이지의 오른쪽에서 데이터베이스별 설정을 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-237">You can see the per-database settings on the right side of the **Configure pool** page.</span></span>
1. <span data-ttu-id="b9bb5-238">**저장**을 클릭하여 풀 크기 조정 요청을 제출합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-238">Click **Save** to submit the request to scale the pool.</span></span>

<span data-ttu-id="b9bb5-239">**Pool1** > **개요**로 돌아가 모니터링 차트를 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-239">Go back to **Pool1** > **Overview** to view the monitoring charts.</span></span> <span data-ttu-id="b9bb5-240">풀에 더 많은 리소스를 제공한 효과를 모니터링합니다(데이터베이스 수가 적고 임의 부하이지만 일정 시간 동안 실행할 때까지 최종적으로 보는 것이 언제나 쉽지는 않음).</span><span class="sxs-lookup"><span data-stu-id="b9bb5-240">Monitor the effect of providing the pool with more resources (although with few databases and a randomized load it’s not always easy to see conclusively until you run for some time).</span></span> <span data-ttu-id="b9bb5-241">차트를 보는 동안 하위 차트 100%가 여전히 50 eDTU이지만 데이터베이스별 최대값이 여전히 50 eDTU이므로 상위 차트의 100%가 이제 100 eDTU를 나타낸다는 것을 염두에 둡니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-241">While you are looking at the charts bear in mind that 100% on the upper chart now represents 100 eDTUs, while on the lower chart 100% is still 50 eDTUs as the per-database max is still 50 eDTUs.</span></span>

<span data-ttu-id="b9bb5-242">데이터베이스는 프로세스 전체에 걸쳐 온라인이고 완전하게 사용할 수 있도록 남아 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-242">Databases remain online and fully available throughout the process.</span></span> <span data-ttu-id="b9bb5-243">마지막 순간에 각 데이터베이스가 새 풀 eDTU에 대해 사용할 수 있는 준비가 되어 있고 활성 연결은 끊어집니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-243">At the last moment as each database is ready to be enabled with the new pool eDTU, any active connections are broken.</span></span> <span data-ttu-id="b9bb5-244">응용 프로그램 코드는 언제나 끊어진 연결을 재시도하도록 작성해야 하므로 확장된 풀의 데이터베이스에 다시 연결합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-244">Application code should always be written to retry dropped connections, and so will reconnect to the database in the scaled-up pool.</span></span>

## <a name="load-balance-between-pools"></a><span data-ttu-id="b9bb5-245">풀 간의 부하 분산</span><span class="sxs-lookup"><span data-stu-id="b9bb5-245">Load balance between pools</span></span>

<span data-ttu-id="b9bb5-246">풀을 확장하는 대안으로 두 번째 풀을 만들고 데이터베이스를 해당 풀로 이동하여 두 풀 사이에 부하를 분산합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-246">As an alternative to scaling up the pool, create a second pool and move databases into it to balance the load between the two pools.</span></span> <span data-ttu-id="b9bb5-247">이렇게 하려면 첫 번째와 같은 서버에 새 풀을 만들어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-247">To do this the new pool must be created on the same server as the first.</span></span>

1. <span data-ttu-id="b9bb5-248">[Azure Portal](https://portal.azure.com)에서 **tenants1-&lt;USER&gt;** 서버를 엽니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-248">In the [Azure portal](https://portal.azure.com), open the **tenants1-&lt;USER&gt;** server.</span></span>
1. <span data-ttu-id="b9bb5-249">**+ 새 풀**을 클릭하고 현재 서버에 풀을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-249">Click **+ New pool** to create a pool on the current server.</span></span>
1. <span data-ttu-id="b9bb5-250">**Elastic Database 풀** 템플릿에서 다음을 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-250">On the **Elastic database pool** template:</span></span>

    1. <span data-ttu-id="b9bb5-251">**이름**을 *Pool2*로 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-251">Set **Name** to *Pool2*.</span></span>
    1. <span data-ttu-id="b9bb5-252">가격 책정 계층을 **표준 풀**로 남겨 둡니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-252">Leave the pricing tier as **Standard Pool**.</span></span>
    1. <span data-ttu-id="b9bb5-253">**구성 풀**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-253">Click **Configure pool**,</span></span>
    1. <span data-ttu-id="b9bb5-254">**풀 eDTU**를 *50 eDTU*로 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-254">Set **Pool eDTU** to *50 eDTU*.</span></span>
    1. <span data-ttu-id="b9bb5-255">**데이터베이스 추가**를 클릭하여 서버에서 *Pool2*에 추가할 수 있는 데이터베이스 목록을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-255">Click **Add databases** to see a list of databases on the server that can be added to *Pool2*.</span></span>
    1. <span data-ttu-id="b9bb5-256">데이터베이스 10개를 선택하여 새 풀로 이동하고 **선택**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-256">Select any 10 databases to move these to the new pool, and then click **Select**.</span></span> <span data-ttu-id="b9bb5-257">부하 생성기를 실행한 경우 서비스에서 성능 프로필에 기본 50 eDTU 크기보다 더 큰 풀이 필요한 것을 이미 알고 있으며 100 eDTU 설정으로 시작하도록 권장합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-257">If you've been running the load generator, the service already knows that your performance profile requires a larger pool than the default 50 eDTU size and recommends starting with a 100 eDTU setting.</span></span>

    ![권장 사항](media/sql-database-saas-tutorial-performance-monitoring/configure-pool.png)

    1. <span data-ttu-id="b9bb5-259">이 자습서에서는 기본값 50 eDTU를 유지하고 **선택**을 다시 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-259">For this tutorial, leave the default at 50 eDTUs, and click **Select** again.</span></span>
    1. <span data-ttu-id="b9bb5-260">**확인**을 클릭하여 새 풀을 만들고 선택한 데이터베이스를 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-260">Select **OK** to create the new pool and to move the selected databases into it.</span></span>

<span data-ttu-id="b9bb5-261">풀을 만들고 데이터베이스를 해당 풀로 이동하는 데 몇 분이 걸립니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-261">Creating the pool and moving the databases takes a few minutes.</span></span> <span data-ttu-id="b9bb5-262">이동 중인 데이터베이스는 열려 있는 모든 연결이 닫히는 시점인 마지막 순간까지 온라인이고 완전히 액세스할 수 있는 상태로 남아 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-262">As databases are moved they remain online and fully accessible until the very last moment, at which point any open connections are closed.</span></span> <span data-ttu-id="b9bb5-263">몇 가지 다시 시도 논리가 있는 경우 클라이언트는 새 풀의 데이터베이스에 연결합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-263">As long as you have some retry logic, clients will then connect to the database in the new pool.</span></span>

<span data-ttu-id="b9bb5-264">**Pool2**(*tenants1* 서버)로 이동하여 풀을 열고 성능을 모니터링합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-264">Browse to **Pool2** (on the *tenants1* server) to open the pool and monitor its performance.</span></span> <span data-ttu-id="b9bb5-265">표시되지 않는 경우 새 풀의 프로비전이 완료될 때까지 기다립니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-265">If you don't see it, wait for provisioning of the new pool to complete.</span></span>

<span data-ttu-id="b9bb5-266">이제 *Pool1*의 리소스 사용량이 떨어지고 *Pool2*에 유사한 부하가 걸려 있는 것으로 나타나야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-266">You now see that resource usage on *Pool1* has dropped and that *Pool2* is now similarly loaded.</span></span>

## <a name="manage-performance-of-a-single-database"></a><span data-ttu-id="b9bb5-267">단일 데이터베이스의 성능 관리</span><span class="sxs-lookup"><span data-stu-id="b9bb5-267">Manage performance of a single database</span></span>

<span data-ttu-id="b9bb5-268">풀에 있는 단일 데이터베이스가 지속적인 높은 부하를 경험하는 경우 풀 구성에 따라 풀의 리소스를 많이 차지하고 다른 데이터베이스에 영향을 주는 경향이 있을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-268">If a single database in a pool experiences a sustained high load, depending on the pool configuration, it may tend to dominate the resources in the pool and impact other databases.</span></span> <span data-ttu-id="b9bb5-269">작업이 일정 시간 동안 계속되는 것으로 보이면 데이터베이스를 잠시 풀에서 밖으로 이동할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-269">If the activity is likely to continue for some time, the database can be temporarily moved out of the pool.</span></span> <span data-ttu-id="b9bb5-270">이를 통해 데이터베이스에 필요한 추가 리소스를 유지하고 다른 데이터베이스와 격리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-270">This allows the database to have the extra resources it needs, and isolates it from the other databases.</span></span>

<span data-ttu-id="b9bb5-271">이 연습에서는 인기 있는 콘서트에 대한 티켓을 판매할 때 높은 부하를 경험하는 Contoso 콘서트 홀의 영향을 시뮬레이션합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-271">This exercise simulates the effect of Contoso Concert Hall experiencing a high load when tickets go on sale for a popular concert.</span></span>

1. <span data-ttu-id="b9bb5-272">...\\*Demo-PerformanceMonitoringAndManagement.ps1* 스크립트를 엽니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-272">Open the …\\*Demo-PerformanceMonitoringAndManagement.ps1* script.</span></span>
1. <span data-ttu-id="b9bb5-273">**$DemoScenario = 5를 설정하고, 표준 부하에 더하여 단일 테넌트에 대한 높은 부하(약 95 DTU)를 생성합니다.**</span><span class="sxs-lookup"><span data-stu-id="b9bb5-273">Set **$DemoScenario = 5, Generate a normal load plus a high load on a single tenant (approx. 95 DTU).**</span></span>
1. <span data-ttu-id="b9bb5-274">**$SingleTenantDatabaseName = contosoconcerthall** 설정</span><span class="sxs-lookup"><span data-stu-id="b9bb5-274">Set **$SingleTenantDatabaseName = contosoconcerthall**</span></span>
1. <span data-ttu-id="b9bb5-275">**F5**를 사용하여 스크립트를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-275">Execute the script using **F5**.</span></span>


1. <span data-ttu-id="b9bb5-276">[Azure Portal](https://portal.azure.com)에서 **Pool1**을 엽니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-276">In the [Azure portal](https://portal.azure.com) open **Pool1**.</span></span>
1. <span data-ttu-id="b9bb5-277">**탄력적 풀 모니터링** 차트를 검사하고 증가된 풀 eDTU 사용량을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-277">Inspect the **Elastic pool monitoring** chart and look for the increased pool eDTU usage.</span></span> <span data-ttu-id="b9bb5-278">1~2분 후 더 높은 부하가 시작되어야 하며 곧 이어 풀이 100% 사용률에 도달하는 것을 확인해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-278">After a minute or two, the higher load should start to kick in, and you should quickly see that the pool hits 100% utilization.</span></span>
1. <span data-ttu-id="b9bb5-279">지난 시간에 가장 많이 사용한 데이터베이스를 나타내는 **Elastic Database 모니터링**을 검사합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-279">Inspect the **Elastic database monitoring** display which shows the hottest databases in the past hour.</span></span> <span data-ttu-id="b9bb5-280">*contosoconcerthall* 데이터베이스는 곧 가장 많이 사용한 데이터베이스 5개 중 하나로 나타나야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-280">The *contosoconcerthall* database should soon appear as one of the five hottest databases.</span></span>
1. <span data-ttu-id="b9bb5-281">**Elastic Database 모니터링** **차트**를 클릭하면 아무 데이터베이스나 모니터링할 수 있는 **데이터베이스 리소스 사용률** 페이지가 열립니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-281">**Click on the Elastic database monitoring** **chart** and it opens the **Database Resource Utilization** page where you can monitor any of the databases.</span></span> <span data-ttu-id="b9bb5-282">이 기능을 사용하여 *contosoconcerthall* 데이터베이스에 대한 화면을 격리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-282">This lets you isolate the display for the *contosoconcerthall* database.</span></span>
1. <span data-ttu-id="b9bb5-283">데이터베이스 목록을 보려면 **contosoconcerthall**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-283">From the list of databases, click **contosoconcerthall**.</span></span>
1. <span data-ttu-id="b9bb5-284">**가격 책정 계층(DTU 조정)**을 클릭하여 **성능 구성** 페이지를 엽니다. 여기에서 데이터베이스에 대한 독립 실행형 성능 수준을 설정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-284">Click **Pricing Tier (scale DTUs)** to open the **Configure performance** page where you can set a stand-alone performance level for the database.</span></span>
1. <span data-ttu-id="b9bb5-285">**표준** 탭을 클릭하여 표준 계층에서 규모 옵션을 엽니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-285">Click on the **Standard** tab to open the scale options in the Standard tier.</span></span>
1. <span data-ttu-id="b9bb5-286">**DTU 슬라이드**를 오른쪽으로 밀어 **100** DTU를 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-286">Slide the **DTU slider** to right to select **100** DTUs.</span></span> <span data-ttu-id="b9bb5-287">이는 서비스 목표 **S3**에 해당합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-287">Note this corresponds to the service objective, **S3**.</span></span>
1. <span data-ttu-id="b9bb5-288">**적용**을 클릭하여 데이터베이스를 풀에서 밖으로 이동하고 *표준 S3* 데이터베이스로 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-288">Click **Apply** to move the database out of the pool and make it a *Standard S3* database.</span></span>
1. <span data-ttu-id="b9bb5-289">크기 조정이 완료되면 탄력적 풀과 데이터베이스 블레이드에서 contosoconcerthall 데이터베이스 및 Pool1에 대한 영향을 모니터링합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-289">Once scaling is complete, monitor the effect on the contosoconcerthall database and Pool1 on the elastic pool and database blades.</span></span>

<span data-ttu-id="b9bb5-290">비용을 줄이기 위해 contosoconcerthall 데이터베이스에 대해 높은 부하가 진정되면 지체 없이 풀로 반환해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-290">Once the high load on the contosoconcerthall database subsides you should promptly return it to the pool to reduce its cost.</span></span> <span data-ttu-id="b9bb5-291">이러한 상황이 일어나는 시기를 확실히 모르는 경우 DTU 사용량이 풀의 데이터베이스별 최대값보다 낮게 떨어질 때 트리거되는 데이터베이스에 대한 경고를 설정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-291">If it’s unclear when that will happen you could set an alert on the database that will trigger when its DTU usage drops below the per-database max on the pool.</span></span> <span data-ttu-id="b9bb5-292">풀로 데이터베이스 이동은 연습 5에서 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-292">Moving a database into a pool is described in exercise 5.</span></span>

## <a name="other-performance-management-patterns"></a><span data-ttu-id="b9bb5-293">다른 성능 관리 패턴</span><span class="sxs-lookup"><span data-stu-id="b9bb5-293">Other Performance Management Patterns</span></span>

<span data-ttu-id="b9bb5-294">**선제적 크기 조정** 위 연습에서는 찾는 데이터베이스가 어느 것인지 알고 있는 격리된 데이터베이스를 크기 조정하는 방법을 탐색했습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-294">**Pre-emptive scaling** In the exercise above where you explored how to scale an isolated database, you knew which database to look for.</span></span> <span data-ttu-id="b9bb5-295">Contoso 콘서트 홀의 관리 부서에서 티켓 판매가 임박했음을 Wingtips에 알리면 데이터베이스가 선제적으로 풀에서 밖으로 이동될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-295">If the management of Contoso Concert Hall had informed Wingtips of the impending ticket sale, the database could have been moved out of the pool pre-emptively.</span></span> <span data-ttu-id="b9bb5-296">그렇지 않으면 풀 또는 데이터베이스에 무슨 일이 일어나고 있는지 파악하라는 경고가 필요했을 가능성이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-296">Otherwise, it would likely have required an alert on the pool or the database to spot what was happening.</span></span> <span data-ttu-id="b9bb5-297">성능 저하에 대해 불평하는 풀에 있는 다른 테넌트에서 이에 관하여 알아보기를 원하지 않을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-297">You wouldn’t want to learn about this from the other tenants in the pool complaining of degraded performance.</span></span> <span data-ttu-id="b9bb5-298">테넌트가 추가 리소스를 필요로 하는 기간을 예측할 수 있는 경우 Azure Automation Runbook을 설정하여 데이터베이스를 풀에서 밖으로 이동한 다음 정의된 일정에 다시 안으로 이동할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-298">And if the tenant can predict how long they will need additional resources you can set up an Azure Automation runbook to move the database out of the pool and then back in again on a defined schedule.</span></span>

<span data-ttu-id="b9bb5-299">**테넌트 셀프 서비스 크기 조정** 크기 조정은 관리 API가 통해 쉽게 호출되는 작업이므로 테넌트 데이터베이스를 테넌트가 마주치는 응용 프로그램으로 크기 조정하는 기능을 쉽게 만들어 SaaS 서비스의 기능으로 제공할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-299">**Tenant self-service scaling** Because scaling is a task easily called via the management API, you can easily build the ability to scale tenant databases into your tenant-facing application, and offer it as a feature of your SaaS service.</span></span> <span data-ttu-id="b9bb5-300">예를 들어 테넌트가 확장과 축소를 직접 관리하게 할 수 있으며, 이는 아마도 테넌트의 대금 청구에 직접 연결될 것입니다!</span><span class="sxs-lookup"><span data-stu-id="b9bb5-300">For example, let tenants self-administer scaling up and down, perhaps linked directly to their billing!</span></span>

<span data-ttu-id="b9bb5-301">**풀을 사용량 패턴에 맞게 일정에 따라 확장 및 축소**</span><span class="sxs-lookup"><span data-stu-id="b9bb5-301">**Scaling a pool up and down on a schedule to match usage patterns**</span></span>

<span data-ttu-id="b9bb5-302">집계 테넌트 사용량이 예측 가능한 사용량 패턴을 따르는 경우 Azure Automation을 사용하여 풀을 일정에 따라 확장 및 축소할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-302">Where aggregate tenant usage follows predictable usage patterns, you can use Azure Automation to scale a pool up and down on a schedule.</span></span> <span data-ttu-id="b9bb5-303">예를 들어 리소스 요구 사항이 떨어지는 것으로 알고 있는 평일 오후 6시 후에 풀을 축소하고 오전 6시 전에 다시 확장할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-303">For example, scale a pool down after 6pm and up again before 6am on weekdays when you know there is a drop in resource requirements.</span></span>



## <a name="next-steps"></a><span data-ttu-id="b9bb5-304">다음 단계</span><span class="sxs-lookup"><span data-stu-id="b9bb5-304">Next steps</span></span>

<span data-ttu-id="b9bb5-305">이 자습서에서는 다음 방법에 대해 알아봅니다.</span><span class="sxs-lookup"><span data-stu-id="b9bb5-305">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="b9bb5-306">제공된 부하 생성기를 실행하여 테넌트 데이터베이스에 대한 사용량 시뮬레이션</span><span class="sxs-lookup"><span data-stu-id="b9bb5-306">Simulate usage on the tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="b9bb5-307">부하 증가에 응답하여 테넌트 데이터베이스 모니터링</span><span class="sxs-lookup"><span data-stu-id="b9bb5-307">Monitor the tenant databases as they respond to the increase in load</span></span>
> * <span data-ttu-id="b9bb5-308">증가된 데이터베이스 부하에 응답하여 탄력적 풀 강화</span><span class="sxs-lookup"><span data-stu-id="b9bb5-308">Scale up the Elastic pool in response to the increased database load</span></span>
> * <span data-ttu-id="b9bb5-309">데이터베이스 작업의 부하를 분산하도록 두 번째 탄력적 풀을 프로비전</span><span class="sxs-lookup"><span data-stu-id="b9bb5-309">Provision a second Elastic pool to load balance the database activity</span></span>

[<span data-ttu-id="b9bb5-310">단일 테넌트 복원 자습서</span><span class="sxs-lookup"><span data-stu-id="b9bb5-310">Restore a single tenant tutorial</span></span>](sql-database-saas-tutorial-restore-single-tenant.md)


## <a name="additional-resources"></a><span data-ttu-id="b9bb5-311">추가 리소스</span><span class="sxs-lookup"><span data-stu-id="b9bb5-311">Additional resources</span></span>

* <span data-ttu-id="b9bb5-312">[Wingtip SaaS 응용 프로그램 배포를 기반으로 작성된](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials) 추가 자습서</span><span class="sxs-lookup"><span data-stu-id="b9bb5-312">Additional [tutorials that build upon the Wingtip SaaS application deployment](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="b9bb5-313">SQL 탄력적 풀</span><span class="sxs-lookup"><span data-stu-id="b9bb5-313">SQL Elastic pools</span></span>](sql-database-elastic-pool.md)
* [<span data-ttu-id="b9bb5-314">Azure Automation</span><span class="sxs-lookup"><span data-stu-id="b9bb5-314">Azure automation</span></span>](../automation/automation-intro.md)
* <span data-ttu-id="b9bb5-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) - Log Analytics 설정 및 사용 자습서</span><span class="sxs-lookup"><span data-stu-id="b9bb5-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) - Setting up and using Log Analytics tutorial</span></span>
