---
title: "Azure SQL Database를 사용하는 다중 테넌트 앱에서 새 테넌트 프로비전 | Microsoft Docs"
description: "Wingtip SaaS 앱에 새 테넌트를 프로비전 및 카탈로그 작성하는 방법에 대해 알아봅니다."
keywords: "SQL Database 자습서"
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: sstein
ms.openlocfilehash: 8fa4c4f95386a92c8c818eef1a5b4de5a086fe07
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/18/2017
---
# <a name="provision-new-tenants-and-register-them-in-the-catalog"></a><span data-ttu-id="d0ddf-104">새 테넌트를 프로비전하고 카탈로그에 등록</span><span class="sxs-lookup"><span data-stu-id="d0ddf-104">Provision new tenants and register them in the catalog</span></span>

<span data-ttu-id="d0ddf-105">이 자습서에서는 프로비전 및 카탈로그 SaaS 패턴 및 Wingtip SaaS 응용 프로그램에서 구현되는 방법에 대해 알아봅니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-105">In this tutorial, you learn about the provision and catalog SaaS patterns, and how they are implemented in the Wingtip SaaS application.</span></span> <span data-ttu-id="d0ddf-106">새 테넌트 데이터베이스를 만들고 초기화하고 응용 프로그램의 테넌트 카탈로그에 등록합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-106">You create and initialize new tenant databases, and register them in the application’s tenant catalog.</span></span> <span data-ttu-id="d0ddf-107">카탈로그는 SaaS 응용 프로그램 간에 많은 테넌트와 해당 데이터를 유지 관리하는 데이터베이스입니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-107">The catalog is a database that maintains the mapping between the SaaS application's many tenants and their data.</span></span> <span data-ttu-id="d0ddf-108">카탈로그는 응용 프로그램 요청을 올바른 데이터베이스에 디렉션하는 중요한 역할을 합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-108">The catalog plays an important role directing application requests to the correct database.</span></span>  

<span data-ttu-id="d0ddf-109">이 자습서에서는 다음 방법에 대해 알아봅니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-109">In this tutorial, you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="d0ddf-110">구현되는 방법을 단계별로 포함하는 단일 새 테넌트 프로비전</span><span class="sxs-lookup"><span data-stu-id="d0ddf-110">Provision a single new tenant, including stepping through how this is implemented</span></span>
> * <span data-ttu-id="d0ddf-111">추가 테넌트의 배치 프로비전</span><span class="sxs-lookup"><span data-stu-id="d0ddf-111">Provision a batch of additional tenants</span></span>


<span data-ttu-id="d0ddf-112">이 자습서를 수행하려면 다음 필수 조건이 완료되었는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-112">To complete this tutorial, make sure the following prerequisites are completed:</span></span>

* <span data-ttu-id="d0ddf-113">Wingtip SaaS 앱이 배포되었습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-113">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="d0ddf-114">5분 내에 배포하려면 [Wingtip SaaS 응용 프로그램 배포 및 탐색](sql-database-saas-tutorial.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-114">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="d0ddf-115">Azure PowerShell이 설치되었습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="d0ddf-116">자세한 내용은 [Azure PowerShell 시작](https://docs.microsoft.com/powershell/azure/get-started-azureps)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-to-the-saas-catalog-pattern"></a><span data-ttu-id="d0ddf-117">SaaS 카탈로그 패턴 소개</span><span class="sxs-lookup"><span data-stu-id="d0ddf-117">Introduction to the SaaS Catalog pattern</span></span>

<span data-ttu-id="d0ddf-118">데이터베이스 지원 다중 테넌트 SaaS 응용 프로그램에서 각 테넌트 정보가 저장되어 있는 위치를 아는 것이 중요합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-118">In a database-backed multi-tenant SaaS application, it's important to know where information for each tenant is stored.</span></span> <span data-ttu-id="d0ddf-119">SaaS 카탈로그 패턴에서 카탈로그 데이터베이스를 사용하여 각 테넌트와 해당 데이터가 저장되는 장소 간의 매핑을 유지합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-119">In the SaaS catalog pattern, a catalog database is used to hold the mapping between each tenant and where their data is stored.</span></span> <span data-ttu-id="d0ddf-120">Wingtip SaaS 앱은 데이터베이스별 단일 테넌트 아키텍처를 사용하지만 테넌트 대 데이터베이스 매핑을 카탈로그에 적용하는 기본적인 패턴은 사용하는 데이터베이스가 다중 테넌트인지 단일 테넌트인지 여하와 상관없이 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-120">The Wingtip SaaS app uses a single-tenant per database architecture, but the basic pattern of storing tenant-to-database mapping in a catalog applies whether a multi-tenant or single-tenant database is used.</span></span>

<span data-ttu-id="d0ddf-121">각 테넌트는 카탈로그에서 이를 식별하는 키에 할당되며 적절한 데이터베이스의 위치에 매핑됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-121">Each tenant is assigned a key that identifies them in the catalog and which is mapped to the location of the appropriate database.</span></span> <span data-ttu-id="d0ddf-122">Wingtip SaaS 앱에서 키는 테넌트 이름의 해시에서 형성됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-122">In the Wingtip SaaS app, the key is formed from a hash of the tenant’s name.</span></span> <span data-ttu-id="d0ddf-123">이를 통해 응용 프로그램 URL의 테넌트 이름 부분을 사용하여 키를 생성할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-123">This allows the tenant name portion of the application URL to be used to construct the key.</span></span> <span data-ttu-id="d0ddf-124">다른 테넌트 키 스키마를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-124">Other tenant key schemes could be used.</span></span>  

<span data-ttu-id="d0ddf-125">카탈로그는 응용 프로그램에 미치는 영향을 최소화하면서 데이터베이스의 이름 또는 위치의 변경을 허용합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-125">The catalog allows the name or location of the database to be changed with minimal impact on the application.</span></span>  <span data-ttu-id="d0ddf-126">다중 테넌트 데이터베이스 모델에서 데이터베이스 간에 테넌트 ‘이동’을 적용합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-126">In a multi-tenant database model, this also accommodates ‘moving’ a tenant between databases.</span></span>  <span data-ttu-id="d0ddf-127">카탈로그는 테넌트 또는 데이터베이스가 유지 관리 또는 기타 작업에 대해 오프라인 상태인지 여부를 나타나내는 데 사용될 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-127">The catalog can also be used to indicate whether a tenant or database is offline for maintenance or other actions.</span></span> <span data-ttu-id="d0ddf-128">이는 [단일 테넌트 복원 자습서](sql-database-saas-tutorial-restore-single-tenant.md)에서 살펴봅니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-128">This is explored in the [restore single tenant tutorial](sql-database-saas-tutorial-restore-single-tenant.md).</span></span>

<span data-ttu-id="d0ddf-129">또한 카탈로그, 사실상 SaaS 응용 프로그램에 대한 관리 데이터베이스는 데이터베이스의 계층 또는 버전, 스키마 버전, 서비스 계획 또는 테넌트에 제공되는 SLA 및 응용 프로그램 관리, 고객 지원 또는 devops 프로세스를 활성화하는 기타 정보와 같은 추가 테넌트 또는 데이터베이스 메타데이터를 저장할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-129">In addition, the catalog, which is in effect a management database for a SaaS application, can store additional tenant or database metadata, such as the tier or edition of a database, schema version, service plan, or SLAs offered to tenants, and other info that enables application management, customer support, or devops processes.</span></span>  

<span data-ttu-id="d0ddf-130">SaaS 응용 프로그램 이외에도 카탈로그는 데이터베이스 도구를 활성화할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-130">Beyond the SaaS application, the catalog can enable database tools.</span></span>  <span data-ttu-id="d0ddf-131">Wingtip SaaS 샘플에서 카탈로그는 [임시 분석 자습서](sql-database-saas-tutorial-adhoc-analytics.md)에서 설명된 테넌트 간 쿼리를 활성화하는 데 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-131">In the Wingtip SaaS sample, the catalog is used to enable cross-tenant query, explored in the [ad hoc analytics tutorial](sql-database-saas-tutorial-adhoc-analytics.md).</span></span> <span data-ttu-id="d0ddf-132">데이터베이스 간 작업 관리는 [스키마 관리](sql-database-saas-tutorial-schema-management.md) 및 [테넌트 분석](sql-database-saas-tutorial-tenant-analytics.md) 자습서에서 살펴봅니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-132">Cross-database job management is explored in the [schema management](sql-database-saas-tutorial-schema-management.md) and [tenant analytics](sql-database-saas-tutorial-tenant-analytics.md) tutorials.</span></span> 

<span data-ttu-id="d0ddf-133">Wingtip SaaS 앱에서 카탈로그는 [EDCL(Elastic Database 클라이언트 라이브러리)](sql-database-elastic-database-client-library.md)의 분할 관리 기능을 사용하여 구현됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-133">In the Wingtip SaaS app, the catalog is implemented using the Shard Management features of the [Elastic Database Client Library (EDCL)](sql-database-elastic-database-client-library.md).</span></span> <span data-ttu-id="d0ddf-134">EDCL을 통해 응용 프로그램은 데이터베이스 기반 분할 맵을 만들고, 관리하고 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-134">The EDCL enables an application to create, manage, and use a database-backed shard map.</span></span> <span data-ttu-id="d0ddf-135">분할 맵은 분할된 데이터베이스(데이터베이스)의 목록 및 키(테넌트)와 데이터베이스 간의 매핑을 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-135">A shard map contains a list of shards (databases) and the mapping between keys (tenants) and databases.</span></span>  <span data-ttu-id="d0ddf-136">분할 맵에서 항목을 만들고 응용 프로그램에서 올바른 데이터베이스로 효율적으로 연결하기 위해 테넌트를 프로비전하는 동안 응용 프로그램 또는 PowerShell 스크립트에서 EDCL 함수를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-136">EDCL functions can be used from applications or PowerShell scripts during tenant provisioning to create the entries in the shard map, and from applications to efficiently connect to the correct database.</span></span> <span data-ttu-id="d0ddf-137">EDCL은 연결 정보를 캐시하여 카탈로그 데이터베이스에 대한 트래픽을 최소화하고 응용 프로그램 속도를 높입니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-137">EDCL caches connection information to minimize the traffic to the catalog database and speed up the application.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="d0ddf-138">매핑 데이터는 카탈로그 데이터베이스에서 액세스할 수 있지만 *편집하지는 마세요*!</span><span class="sxs-lookup"><span data-stu-id="d0ddf-138">The mapping data is accessible in the catalog database, but *don't edit it*!</span></span> <span data-ttu-id="d0ddf-139">매핑 데이터는 Elastic Database 클라이언트 라이브러리 API를 사용해서만 편집하세요.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-139">Edit mapping data using Elastic Database Client Library APIs only.</span></span> <span data-ttu-id="d0ddf-140">매핑 데이터의 직접 조작은 카탈로그가 손상될 위험이 있으며 지원되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-140">Directly manipulating the mapping data risks corrupting the catalog and is not supported.</span></span>


## <a name="introduction-to-the-saas-provisioning-pattern"></a><span data-ttu-id="d0ddf-141">SaaS 프로비전 패턴 소개</span><span class="sxs-lookup"><span data-stu-id="d0ddf-141">Introduction to the SaaS Provisioning pattern</span></span>

<span data-ttu-id="d0ddf-142">단일 테넌트 데이터베이스 모델을 사용하는 SaaS 응용 프로그램에서 새 테넌트를 온보딩하는 경우 새 테넌트 데이터베이스를 프로비전해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-142">When onboarding a new tenant in a SaaS application that uses a single-tenant database model a new tenant database must be provisioned.</span></span>  <span data-ttu-id="d0ddf-143">적절한 위치 및 서비스 계층에 만들어지고 적절한 스키마 및 참조 데이터를 사용하여 초기화한 다음 적절한 테넌트 키에서 카탈로그에 등록되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-143">It must be created in the appropriate location and service tier, initialized with appropriate schema and reference data, and then registered in the catalog under the appropriate tenant key.</span></span>  

<span data-ttu-id="d0ddf-144">SQL 스크립트 실행, bacpac 배포 또는 '골든' 템플릿 데이터베이스 복사를 포함할 수 있는 데이터베이스 프로비전에 서로 다른 방법을 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-144">Different approaches can be used to database provisioning, which could include executing SQL scripts, deploying a bacpac, or copying a 'golden' template database.</span></span>  

<span data-ttu-id="d0ddf-145">사용하는 프로비전 방법은 전체 스키마 관리 전략에서 포괄적이어야 하며 새 데이터베이스가 최신 스키마로 프로비전되는지 확인해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-145">The provisioning approach you use must be comprehended in your overall schema management strategy, which must ensure that new databases are provisioned with the latest schema.</span></span>  <span data-ttu-id="d0ddf-146">이는 [스키마 관리 자습서](sql-database-saas-tutorial-schema-management.md)에서 살펴봅니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-146">This is explored in the [schema management tutorial](sql-database-saas-tutorial-schema-management.md).</span></span>  

<span data-ttu-id="d0ddf-147">Wingtip SaaS 앱은 카탈로그 서버에 배포된 basetenantdb라는 골든 데이터베이스를 복사하여 새 테넌트를 프로비전합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-147">The Wingtip SaaS app provisions new tenants by copying a golden database named basetenantdb, deployed on the catalog server.</span></span>  <span data-ttu-id="d0ddf-148">프로비전은 등록 환경의 일부로 응용 프로그램 및/또는 스크립트를 사용하여 지원되는 오프라인으로 통합될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-148">Provisioning could be integrated into the application as part of a sign-up experience, and/or supported offline using scripts.</span></span> <span data-ttu-id="d0ddf-149">이 자습서는 PowerShell을 사용하는 프로비전을 살펴봅니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-149">This tutorial will explore provisioning using PowerShell.</span></span> <span data-ttu-id="d0ddf-150">프로비전 스크립트는 basetenantdb를 복사하여 탄력적 풀에 새 테넌트 데이터베이스를 만든 다음 테넌트 관련 정보를 사용하여 초기화하고 카탈로그 분할 맵에 등록합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-150">The provisioning scripts copy the basetenantdb to create a new tenant database in an elastic pool, then initialize it with tenant-specific info and register it in the catalog shard map.</span></span>  <span data-ttu-id="d0ddf-151">샘플 앱에서 데이터베이스는 테넌트 이름을 기반으로 이름이 지정되지만 이는 패턴의 중요한 부분이 아닙니다. 카탈로그를 사용하면 데이터베이스에 모든 이름을 할당할 수 있습니다.+</span><span class="sxs-lookup"><span data-stu-id="d0ddf-151">In the sample app, databases are given names based on the tenant name, but this is not a critical part of the pattern – the use of the catalog allows any name to be assigned to the database.+</span></span> 


## <a name="get-the-wingtip-application-scripts"></a><span data-ttu-id="d0ddf-152">Wingtip 응용 프로그램 스크립트 가져오기</span><span class="sxs-lookup"><span data-stu-id="d0ddf-152">Get the Wingtip application scripts</span></span>

<span data-ttu-id="d0ddf-153">Wingtip SaaS 스크립트 및 응용 프로그램 소스 코드는 [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github 리포지토리에서 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-153">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="d0ddf-154">[Wingtip SaaS 스크립트를 다운로드하는 단계](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="d0ddf-154">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>


## <a name="provision-and-catalog-detailed-walkthrough"></a><span data-ttu-id="d0ddf-155">자세한 연습 프로비전 및 카탈로그</span><span class="sxs-lookup"><span data-stu-id="d0ddf-155">Provision and catalog detailed walkthrough</span></span>

<span data-ttu-id="d0ddf-156">Wingtip 응용 프로그램에서 새 테넌트 프로비전을 구현하는 방법을 이해하려면 테넌트를 프로비전하는 동안 워크플로를 통해 중단점 및 단계를 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-156">To understand how the Wingtip application implements new tenant provisioning, add a breakpoint and step through the workflow while provisioning a tenant:</span></span>

1. <span data-ttu-id="d0ddf-157">...\\Learning Modules\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_을 열고 다음 매개 변수를 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-157">Open ...\\Learning Modules\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_ and set the following parameters:</span></span>
   * <span data-ttu-id="d0ddf-158">**$TenantName** = 새 장소의 이름(예: *Bushwillow 블루스*).</span><span class="sxs-lookup"><span data-stu-id="d0ddf-158">**$TenantName** = the name of the new venue (for example, *Bushwillow Blues*).</span></span>
   * <span data-ttu-id="d0ddf-159">**$VenueType** = 미리 정의된 장소 유형 중 하나: *블루스*, 클래식 음악, 댄스, 재즈, 유도, 자동차 경주, 다목적, 오페라, 록 음악, 축구.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-159">**$VenueType** = one of the pre-defined venue types: *blues*, classicalmusic, dance, jazz, judo, motorracing, multipurpose, opera, rockmusic, soccer.</span></span>
   * <span data-ttu-id="d0ddf-160">**$DemoScenario** = **1**. 이 매개 변수를 **1**로 설정하면 *단일 테넌트가 프로비전*됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-160">**$DemoScenario** = **1**, Set to **1** to *Provision a single tenant*.</span></span>

1. <span data-ttu-id="d0ddf-161">커서를 다음 48행의 아무 위치에 두고 중단점을 추가합니다. *새로 만들기-테넌트 \`*를 클릭하고 **F9**를 누릅니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-161">Add a breakpoint by putting your cursor anywhere on line 48, the line that says: *New-Tenant \`*, and press **F9**.</span></span>

   ![중단점](media/sql-database-saas-tutorial-provision-and-catalog/breakpoint.png)

1. <span data-ttu-id="d0ddf-163">스크립트를 실행하려면 **F5** 키를 누릅니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-163">To run the script press **F5**.</span></span>

1. <span data-ttu-id="d0ddf-164">스크립트 실행이 중단점에서 중지된 후 **F11**을 눌러 한 단계씩 코드를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-164">After the script execution stops at the breakpoint, press **F11** to step into the code.</span></span>

   ![중단점](media/sql-database-saas-tutorial-provision-and-catalog/debug.png)



<span data-ttu-id="d0ddf-166">**디버그** 메뉴 옵션(**F10** 및 **F11** 키)을 사용하여 스크립트 실행을 추적하면서 피호출 함수로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-166">Trace the script's execution using the **Debug** menu options - **F10** and **F11** to step over or into the called functions.</span></span> <span data-ttu-id="d0ddf-167">PowerShell 스크립트를 디버깅하는 방법에 대한 자세한 내용은 [PowerShell 스크립트 사용 및 디버깅 관련 팁](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-167">For more information about debugging PowerShell scripts, see [Tips on working with and debugging PowerShell scripts](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span></span>


<span data-ttu-id="d0ddf-168">다음은 명시적으로 팔로우하는 단계는 아니지만 스크립트를 디버깅하는 동안 단계별로 실행하는 워크플로의 설명입니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-168">The following are not steps to explicitly follow, but an explanation of the workflow you step through while debugging the script:</span></span>

1. <span data-ttu-id="d0ddf-169">Azure에 로그인하여 작업 중인 Azure 구독을 선택하는 함수를 포함하고 있는 **SubscriptionManagement.psm1 모듈을 가져옵니다**.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-169">**Import the SubscriptionManagement.psm1** module that contains functions for signing in to Azure and selecting the Azure subscription you are working with.</span></span>
1. <span data-ttu-id="d0ddf-170">[Shard Management](sql-database-elastic-scale-shard-map-management.md) 함수에 대한 카탈로그 및 테넌트 수준 추상화를 제공하는 **CatalogAndDatabaseManagement.psm1 모듈을 가져옵니다**.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-170">**Import the CatalogAndDatabaseManagement.psm1** module that provides a catalog and tenant-level abstraction over the [Shard Management](sql-database-elastic-scale-shard-map-management.md) functions.</span></span> <span data-ttu-id="d0ddf-171">이는 카탈로그 패턴의 많은 부분을 캡슐화하고 탐색할 가치가 있는 중요한 모듈입니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-171">This is an important module that encapsulates much of the catalog pattern and is worth exploring.</span></span>
1. <span data-ttu-id="d0ddf-172">**구성 세부 정보를 가져옵니다**.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-172">**Get configuration details**.</span></span> <span data-ttu-id="d0ddf-173">구성 가져오기(F11을 사용하여)까지 단계별로 실행하고 앱 구성이 어떻게 지정되었는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-173">Step into Get-Configuration (with F11) and see how the app config is specified.</span></span> <span data-ttu-id="d0ddf-174">리소스 이름 및 기타 앱별 값이 여기서 정의되지만 스크립트를 숙지할 때까지 이러한 값을 변경하지 마세요.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-174">Resource names and other app-specific values are defined here, but do not change any of these values until you are familiar with the scripts.</span></span>
1. <span data-ttu-id="d0ddf-175">**카탈로그 개체를 가져옵니다**.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-175">**Get the catalog object**.</span></span> <span data-ttu-id="d0ddf-176">더 높은 수준의 스크립트에 사용되는 카탈로그 개체를 작성하고 반환하는 카탈로그 가져오기까지 단계별로 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-176">Step into Get-Catalog which composes and returns a catalog object that is used in the higher-level script.</span></span>  <span data-ttu-id="d0ddf-177">이 함수는 **AzureShardManagement.psm1**에서 가져온 분할 관리 기능을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-177">This function uses Shard Management functions that are imported from **AzureShardManagement.psm1**.</span></span> <span data-ttu-id="d0ddf-178">카탈로그 개체는 다음과 같은 개체로 구성됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-178">The catalog object is composed of the following:</span></span>
   * <span data-ttu-id="d0ddf-179">$catalogServerFullyQualifiedName은 표준 stem과 사용자 이름을 사용하여 생성됩니다. _catalog-\<user\>.database.windows.net_.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-179">$catalogServerFullyQualifiedName is constructed using the standard stem plus your User name: _catalog-\<user\>.database.windows.net_.</span></span>
   * <span data-ttu-id="d0ddf-180">$catalogDatabaseName은 구성에서 검색됩니다. *tenantcatalog*.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-180">$catalogDatabaseName is retrieved from the config: *tenantcatalog*.</span></span>
   * <span data-ttu-id="d0ddf-181">$shardMapManager 개체는 카탈로그 데이터베이스에서 초기화됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-181">$shardMapManager object is initialized from the catalog database.</span></span>
   * <span data-ttu-id="d0ddf-182">$shardMap 개체는 카탈로그 데이터베이스의 *tenantcatalog* 분할 맵에서 초기화됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-182">$shardMap object is initialized from the *tenantcatalog* shard map in the catalog database.</span></span>
   <span data-ttu-id="d0ddf-183">카탈로그 개체가 구성되고 반환되며 더 높은 수준의 스크립트에서 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-183">A catalog object is composed and returned, and used in the higher-level script.</span></span>
1. <span data-ttu-id="d0ddf-184">**새 테넌트 키를 계산**합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-184">**Calculate the new tenant key**.</span></span> <span data-ttu-id="d0ddf-185">테넌트 이름에서 테넌트 키를 만드는 데에는 해시 함수가 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-185">A hash function is used to create the tenant key from the tenant name.</span></span>
1. <span data-ttu-id="d0ddf-186">**테넌트 키가 이미 존재하는지 여부를 확인**합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-186">**Check if the tenant key already exists**.</span></span> <span data-ttu-id="d0ddf-187">카탈로그에 대해 키를 사용할 수 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-187">The catalog is checked to ensure the key is available.</span></span>
1. <span data-ttu-id="d0ddf-188">**New-TenantDatabase를 사용하여 테넌트 데이터베이스가 프로비전됩니다.**</span><span class="sxs-lookup"><span data-stu-id="d0ddf-188">**The tenant database is provisioned with New-TenantDatabase.**</span></span> <span data-ttu-id="d0ddf-189">**F11**을 사용하여 단계를 실행하고 [Azure Resource Manager 템플릿](../azure-resource-manager/resource-manager-template-walkthrough.md)을 사용하여 데이터베이스가 프로비전되는 방법을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-189">Use **F11** to step in and see how the database is provisioned using an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md).</span></span>

<span data-ttu-id="d0ddf-190">어느 분할이 어느 테넌트에 속하는지 밝히기 위해 테넌트 이름에서 데이터베이스 이름이 구성됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-190">The database name is constructed from the tenant name to make it clear which shard belongs to which tenant.</span></span> <span data-ttu-id="d0ddf-191">(데이터베이스 이름 지정에 대한 다른 전략을 사용해도 좋습니다.)+ 카탈로그 서버에서 골든 데이터베이스(baseTenantDB)를 복사하여 테넌트 데이터베이스를 만드는 데에는 Resource Manager 템플릿이 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-191">(Other strategies for database naming could easily be used.)+ A Resource Manager template is used to create a tenant database by copying a golden database (baseTenantDB) on the catalog server.</span></span> <span data-ttu-id="d0ddf-192">대안 방법은 빈 데이터베이스를 만든 다음 bacpac을 가져와서 초기화하거나 잘 알려진 위치에서 초기화 스크립트를 실행하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-192">An alternative approach could be to create an empty database and then initialize it by importing a bacpac, or to execute an initialization script from a well-known location.</span></span>  

<span data-ttu-id="d0ddf-193">Resource Manager 템플릿은 \Learning Modules\Common\ 폴더: *tenantdatabasecopytemplate.json*에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-193">The Resource Manager template is in the …\Learning Modules\Common\ folder: *tenantdatabasecopytemplate.json*</span></span>

<span data-ttu-id="d0ddf-194">테넌트 데이터베이스가 만들어진 후 **장소(테넌트) 이름과 장소 유형으로 추가로 초기화**됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-194">After the tenant database is created, it is then further **initialized with the venue (tenant) name and the venue type**.</span></span> <span data-ttu-id="d0ddf-195">여기서 다른 초기화가 수행될 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-195">Other initialization could also be done here.</span></span>

<span data-ttu-id="d0ddf-196">테넌트 데이터베이스는 테넌트 키를 사용하여 *Add-TenantDatabaseToCatalog*를 통해 **카탈로그에 등록됩니다**.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-196">The **tenant database is registered in the catalog** with *Add-TenantDatabaseToCatalog* using the tenant key.</span></span> <span data-ttu-id="d0ddf-197">**F11**을 사용하여 세부 정보까지 단계별로 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-197">Use **F11** to step into the details:</span></span>

* <span data-ttu-id="d0ddf-198">카탈로그 데이터베이스가 분할 맵(알려진 데이터베이스의 목록)에 추가됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-198">The catalog database is added to the shard map (the list of known databases).</span></span>
* <span data-ttu-id="d0ddf-199">키 값을 분할에 연결하는 매핑이 만들어집니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-199">The mapping that links the key value to the shard is created.</span></span>
* <span data-ttu-id="d0ddf-200">테넌트에 관한 추가 메타데이터(장소의 이름)가 카탈로그의 테넌트 테이블에 추가됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-200">Additional meta data (the venue's name) about the tenant is added to the Tenants table in the catalog.</span></span>  <span data-ttu-id="d0ddf-201">테넌트 테이블은 ShardManagement 스키마의 일부가 아니며 EDCL에 의해 설치되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-201">The Tenants table is not part of the ShardManagement schema and is not installed by the EDCL.</span></span>  <span data-ttu-id="d0ddf-202">이 테이블은 카탈로그 데이터베이스가 추가 응용 프로그램 관련 데이터를 지원하기 위해 확장하는 방법을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-202">This table illustrates how the Catalog database can be extended to support additional application-specific data.</span></span>   


<span data-ttu-id="d0ddf-203">프로비전이 완료된 후 실행은 *Demo-ProvisionAndCatalog* 스크립트로 반환되며 브라우저에 새 테넌트에 대한 **이벤트** 페이지가 열립니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-203">After provisioning completes, execution returns to the original *Demo-ProvisionAndCatalog* script, which opens the **Events** page for the new tenant in the browser:</span></span>

   ![events](media/sql-database-saas-tutorial-provision-and-catalog/new-tenant.png)


## <a name="provision-a-batch-of-tenants"></a><span data-ttu-id="d0ddf-205">테넌트의 배치 프로비전</span><span class="sxs-lookup"><span data-stu-id="d0ddf-205">Provision a batch of tenants</span></span>

<span data-ttu-id="d0ddf-206">이 연습에서는 17개의 테넌트의 배치를 프로비전합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-206">This exercise provisions a batch of 17 tenants.</span></span> <span data-ttu-id="d0ddf-207">다른 Wingtip SaaS 자습서를 시작하기 전에 이 테넌트의 배치를 프로비전하므로 작업할 데이터베이스가 몇 개 있는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-207">It’s recommended you provision this batch of tenants before starting other Wingtip SaaS tutorials, so there's more than just a few databases to work with.</span></span>

1. <span data-ttu-id="d0ddf-208">*PowerShell ISE*에서 ...\\Learning Modules\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1*을 열고 *$DemoScenario* 매개 변수를 3으로 변경합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-208">Open ...\\Learning Modules\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1* in the *PowerShell ISE* and change the *$DemoScenario* parameter to 3:</span></span>
   * <span data-ttu-id="d0ddf-209">**$DemoScenario** = **3**. 이와 같이 매개 변수를 **3**으로 변경하면 *테넌트 배치가 프로비전*됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-209">**$DemoScenario** = **3**, change to **3** to *Provision a batch of tenants*.</span></span>
1. <span data-ttu-id="d0ddf-210">**F5**를 누르고 스크립트를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-210">Press **F5** and run the script.</span></span>

<span data-ttu-id="d0ddf-211">이 스크립트는 추가 테넌트의 배치를 배포합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-211">The script deploys a batch of additional tenants.</span></span> <span data-ttu-id="d0ddf-212">[Azure Resource Manager 템플릿](../azure-resource-manager/resource-manager-template-walkthrough.md)을 사용하여 배치를 제어한 다음 각 데이터베이스의 프로비전을 연결된 템플릿에 위임합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-212">It uses an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md) that controls the batch and then delegates provisioning of each database to a linked template.</span></span> <span data-ttu-id="d0ddf-213">템플릿을 이 방법으로 사용하면 Azure Resource Manager가 스크립트에 대한 프로비전 프로세스를 중개할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-213">Using templates in this way allows Azure Resource Manager to broker the provisioning process for your script.</span></span> <span data-ttu-id="d0ddf-214">템플릿은 데이터베이스를 가능하면 병렬로 프로비전하고 필요한 경우 재시도를 처리하여 전체 프로세스를 최적화합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-214">Templates provision databases in parallel where it can, and handles retries if needed, optimizing the overall process.</span></span> <span data-ttu-id="d0ddf-215">이 스크립트는 idempotent이므로 어떤 이유로 실패하거나 중지되는 경우 다시 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-215">The script is idempotent so if it fails or stops for any reason, run it again.</span></span>

### <a name="verify-the-batch-of-tenants-successfully-deployed"></a><span data-ttu-id="d0ddf-216">테넌트의 배치가 성공적으로 배포되었는지 확인</span><span class="sxs-lookup"><span data-stu-id="d0ddf-216">Verify the batch of tenants successfully deployed</span></span>

* <span data-ttu-id="d0ddf-217">[Azure Portal](https://portal.azure.com)에서 서버 목록으로 이동하여 *tenants1* 서버를 열고 **SQL 데이터베이스**를 클릭한 다음 17개 추가 데이터베이스의 배치가 목록에 포함되어 있음을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-217">Open the *tenants1* server by browsing to your list of servers in the [Azure portal](https://portal.azure.com), click **SQL databases**, and verify the batch of 17 additional databases are now in the list:</span></span>

   ![데이터베이스 목록](media/sql-database-saas-tutorial-provision-and-catalog/database-list.png)



## <a name="other-provisioning-patterns"></a><span data-ttu-id="d0ddf-219">기타 프로비전 패턴</span><span class="sxs-lookup"><span data-stu-id="d0ddf-219">Other provisioning patterns</span></span>

<span data-ttu-id="d0ddf-220">이 자습서에 포함되지 않은 기타 프로비전 패턴은 다음을 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-220">Other provisioning patterns not included in this tutorial include:</span></span>

<span data-ttu-id="d0ddf-221">**데이터베이스를 미리 프로비전.**</span><span class="sxs-lookup"><span data-stu-id="d0ddf-221">**Pre-provisioning databases.**</span></span> <span data-ttu-id="d0ddf-222">사전 프로비전 패턴은 탄력적 풀의 데이터베이스가 추가 비용을 추가하지 않는다는 사실을 악용합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-222">The pre-provisioning pattern exploits the fact that databases in an elastic pool do not add extra cost.</span></span> <span data-ttu-id="d0ddf-223">요금은 데이터베이스가 아닌 탄력적 풀에 대해 청구되며 유휴 데이터베이스는 리소스를 소비하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-223">Billing is for the elastic pool, not the databases, and idle databases consume no resources.</span></span> <span data-ttu-id="d0ddf-224">풀에 있는 데이터베이스를 미리 프로비전하고 필요한 경우 할당하면 테넌트 온보딩 시간이 크게 감소할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-224">By pre-provisioning databases in a pool and allocating them when needed, tenant onboarding time can be reduced significantly.</span></span> <span data-ttu-id="d0ddf-225">버퍼를 예상 프로비전 속도에 적합하게 유지하기 위해 필요한 경우 미리 프로비전한 데이터베이스 수를 조정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-225">The number of databases pre-provisioned could be adjusted as needed to keep a buffer suitable for the anticipated provisioning rate.</span></span>

<span data-ttu-id="d0ddf-226">**자동 프로비전.**</span><span class="sxs-lookup"><span data-stu-id="d0ddf-226">**Auto-provisioning.**</span></span> <span data-ttu-id="d0ddf-227">자동 프로비전 패턴에서는 전용 프로비전 서비스를 사용하여 서버, 풀 및 필요한 경우 데이터베이스를 자동으로 프로비전하며, 원하는 경우 탄력적 풀에 데이터베이스 미리 프로비전을 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-227">In the auto-provisioning pattern, a dedicated provisioning service is used to provision servers, pools, and databases automatically as needed – including pre-provisioning databases in elastic pools if desired.</span></span> <span data-ttu-id="d0ddf-228">또한 데이터베이스가 디커미션되고 삭제된 경우 원한다면 프로비전 서비스에 의해 탄력적 풀의 빈 공간을 채울 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-228">And if databases are de-commissioned and deleted, gaps in elastic pools can be filled by the provisioning service as desired.</span></span> <span data-ttu-id="d0ddf-229">그러한 서비스는 단순할 수도 있고 복잡할 수도 있으며(예를 들어 여러 지리적 영역에 걸쳐 프로비전을 처리) 재해 복구에 대해 그러한 전략을 사용 중인 경우 지역에서 복제를 자동으로 설정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-229">Such a service could be simple or complex – for example, handling provisioning across multiple geographies, and could set up geo-replication automatically if that strategy is being used for disaster recovery.</span></span> <span data-ttu-id="d0ddf-230">자동 프로비전 패턴에서 클라이언트 응용 프로그램 또는 스크립트는 프로비전 서비스에 의해 처리할 프로비전 요청을 큐에 제출한 다음 서비스를 폴링하여 완료를 결정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-230">With the auto-provisioning pattern, a client application or script would submit a provisioning request to a queue to be processed by the provisioning service, and would then poll the service to determine completion.</span></span> <span data-ttu-id="d0ddf-231">미리 프로비전을 사용하는 경우 요청은 서비스를 통해 신속하게 처리되어 백그라운드에서 실행 중인 대체 데이터베이스의 프로비전을 관리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-231">If pre-provisioning is used, requests would be handled quickly with the service managing provisioning of a replacement database running in the background.</span></span>



## <a name="next-steps"></a><span data-ttu-id="d0ddf-232">다음 단계</span><span class="sxs-lookup"><span data-stu-id="d0ddf-232">Next steps</span></span>

<span data-ttu-id="d0ddf-233">이 자습서에서는 다음 방법에 대해 알아보았습니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-233">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="d0ddf-234">단일 새 테넌트 프로비전</span><span class="sxs-lookup"><span data-stu-id="d0ddf-234">Provision a single new tenant</span></span>
> * <span data-ttu-id="d0ddf-235">추가 테넌트의 배치 프로비전</span><span class="sxs-lookup"><span data-stu-id="d0ddf-235">Provision a batch of additional tenants</span></span>
> * <span data-ttu-id="d0ddf-236">테넌트 프로비전 및 카탈로그에 테넌트 등록의 세부 정보를 한 단계씩 알아봅니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-236">Step into the details of provisioning tenants, and registering them into the catalog</span></span>

<span data-ttu-id="d0ddf-237">[성능 모니터링 자습서](sql-database-saas-tutorial-performance-monitoring.md)를 시도해 봅니다.</span><span class="sxs-lookup"><span data-stu-id="d0ddf-237">Try the [Performance monitoring tutorial](sql-database-saas-tutorial-performance-monitoring.md).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="d0ddf-238">추가 리소스</span><span class="sxs-lookup"><span data-stu-id="d0ddf-238">Additional Resources</span></span>

* <span data-ttu-id="d0ddf-239">[Wingtip SaaS 응용 프로그램을 기반으로 작성된](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials) 추가 자습서</span><span class="sxs-lookup"><span data-stu-id="d0ddf-239">Additional [tutorials that build upon the Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="d0ddf-240">Elastic Database 클라이언트 라이브러리</span><span class="sxs-lookup"><span data-stu-id="d0ddf-240">Elastic database client library</span></span>](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-database-client-library)
* [<span data-ttu-id="d0ddf-241">Windows PowerShell ISE에서 스크립트를 디버그하는 방법</span><span class="sxs-lookup"><span data-stu-id="d0ddf-241">How to Debug Scripts in Windows PowerShell ISE</span></span>](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise)
