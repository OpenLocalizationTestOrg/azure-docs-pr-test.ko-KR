---
title: "Azure Stream Analytics 및 AzureML 함수를 사용한 작업 크기 조정 | Microsoft Docs"
description: "Azure Machine Learning 함수를 사용할 때 Stream Analytics 작업의 크기를 적절하게 조정하는 방법(분할, SU 수량 등)에 대해 알아봅니다."
keywords: 
documentationcenter: 
services: stream-analytics
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 47ce7c5e-1de1-41ca-9a26-b5ecce814743
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: jeffstok
ms.openlocfilehash: 5e07e4efcd14cd8c12124cb34058ef6c345f7f47
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/29/2017
---
# <a name="scale-your-stream-analytics-job-with-azure-machine-learning-functions"></a><span data-ttu-id="676be-103">Azure Machine Learning 함수를 사용하여 Stream Analytics 작업의 크기 조정</span><span class="sxs-lookup"><span data-stu-id="676be-103">Scale your Stream Analytics job with Azure Machine Learning functions</span></span>
<span data-ttu-id="676be-104">Stream Analytics 작업을 설정하고 그 작업을 통해 몇 가지 샘플 데이터를 실행하면 아주 간단한 경우가 종종 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-104">It is often quite easy to set up an Stream Analytics job and run some sample data through it.</span></span> <span data-ttu-id="676be-105">더 큰 데이터 볼륨으로 같은 작업을 실행해야 할 때 어떻게 해야 할까요?</span><span class="sxs-lookup"><span data-stu-id="676be-105">What should we do when we need to run the same job with higher data volume?</span></span> <span data-ttu-id="676be-106">크기를 조정할 수 있도록 Stream Analytics 작업을 구성하는 방법을 이해해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="676be-106">It requires us to understand how to configure the Stream Analytics job so that it will scale.</span></span> <span data-ttu-id="676be-107">이 문서에서는 Machine Learning 함수를 사용하여 Stream Analytics 작업의 크기를 조정하는 방법을 집중적으로 다루겠습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-107">In this document, we will focus on the special aspects of scaling Stream Analytics jobs with Machine Learning functions.</span></span> <span data-ttu-id="676be-108">Stream Analytics 작업의 크기를 조정하는 일반적인 방법은 [작업 크기 조정](stream-analytics-scale-jobs.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="676be-108">For information on how to scale Stream Analytics jobs in general see the article [Scaling jobs](stream-analytics-scale-jobs.md).</span></span>

## <a name="what-is-an-azure-machine-learning-function-in-stream-analytics"></a><span data-ttu-id="676be-109">Stream Analytics의 Azure Machine Learning 함수란 무엇입니까?</span><span class="sxs-lookup"><span data-stu-id="676be-109">What is an Azure Machine Learning function in Stream Analytics?</span></span>
<span data-ttu-id="676be-110">Stream Analytics의 Machine Learning 함수는 Stream Analytics 쿼리 언어에 일반 함수 호출처럼 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-110">A Machine Learning function in Stream Analytics can be used like a regular function call in the Stream Analytics query language.</span></span> <span data-ttu-id="676be-111">그러나 내부를 들여다보면, 함수 호출이 실제로는 Azure Machine Learning 웹 서비스 요청입니다.</span><span class="sxs-lookup"><span data-stu-id="676be-111">However, behind the scene, the function calls are actually Azure Machine Learning Web Service requests.</span></span> <span data-ttu-id="676be-112">Machine Learning 웹 서비스는 같은 웹 서비스 API 호출의 여러 행을 "배치로 처리"하여 전체적인 처리량을 개선할 수 있으며, 이러한 배치를 미니 배치라고 부릅니다.</span><span class="sxs-lookup"><span data-stu-id="676be-112">Machine Learning web services support “batching” multiple rows, which is called mini-batch, in the same web service API call, to improve overall throughput.</span></span> <span data-ttu-id="676be-113">자세한 내용은 [Stream Analytics의 Azure Machine Learning 함수](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) 및 [Azure Machine Learning 웹 서비스](../machine-learning/machine-learning-consume-web-services.md) 문서를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="676be-113">Please see the following articles for more details; [Azure Machine Learning functions in Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) and [Azure Machine Learning Web Services](../machine-learning/machine-learning-consume-web-services.md).</span></span>

## <a name="configure-a-stream-analytics-job-with-machine-learning-functions"></a><span data-ttu-id="676be-114">Machine Learning 함수를 사용하여 Stream Analytics 작업 구성</span><span class="sxs-lookup"><span data-stu-id="676be-114">Configure a Stream Analytics job with Machine Learning functions</span></span>
<span data-ttu-id="676be-115">Stream Analytics 작업에 대한 Machine Learning 함수를 구성할 때 두 가지 매개 변수를 고려해야 합니다. 하나는 Machine Learning 함수 호출의 배치 크기이고, 다른 하나는 Stream Analytics 작업에 프로비전된 SU(스트리밍 단위)입니다.</span><span class="sxs-lookup"><span data-stu-id="676be-115">When configuring a Machine Learning function for Stream Analytics job, there are two parameters to consider, the batch size of the Machine Learning function calls, and the streaming units (SUs) provisioned for the Stream Analytics job.</span></span> <span data-ttu-id="676be-116">이러한 개매 변수의 적절한 값을 결정하려면 먼저 대기 시간과 처리량, 즉, Stream Analytics 작업의 대기 시간과 각 SU의 처리량을 결정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="676be-116">To determine the appropriate values for these, first a decision must be made between latency and throughput, that is, latency of the Stream Analytics job, and throughput of each SU.</span></span> <span data-ttu-id="676be-117">SU를 추가하면 작업 실행 비용이 증가하기는 하지만 언제나 SU를 작업에 추가하여 적절하게 분할된 Stream Analytics 쿼리의 처리량을 높일 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-117">SUs may always be added to a job to increase throughput of a well partitioned Stream Analytics query, although additional SUs increases the cost of running the job.</span></span>

<span data-ttu-id="676be-118">따라서 Stream Analytics 작업을 실행할 때 대기 시간 *허용 오차*를 결정하는 것이 중요합니다.</span><span class="sxs-lookup"><span data-stu-id="676be-118">Therefore it is important to determine the *tolerance* of latency in running a Stream Analytics job.</span></span> <span data-ttu-id="676be-119">Azure Machine Learning 서비스 요청의 실행 대기 시간이 길어지면 당연히 배치 크기가 커지고, 결과적으로 Stream Analytics 작업의 대기 시간이 더욱 길어집니다.</span><span class="sxs-lookup"><span data-stu-id="676be-119">Additional latency from running Azure Machine Learning service requests will naturally increase with batch size, which will compound the latency of the Stream Analytics job.</span></span> <span data-ttu-id="676be-120">반면, 배치 크기를 늘리면 Stream Analytics 작업이 *같은 수*의 Machine Learning 웹 서비스 요청으로 더 많은 이벤트*를 처리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-120">On the other hand, increasing batch size allows the Stream Analytics job to process *more events with the *same number* of Machine Learning web service requests.</span></span> <span data-ttu-id="676be-121">Machine Learning 웹 서비스의 대기 시간이 배치 크기에 비례해서 거의 선형적으로 증가하는 경우가 종종 있기 때문에 주어진 상황에서 Machine Learning 웹 서비스에 가장 경제적인 배치 크기를 고려해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="676be-121">Often the increase of Machine Learning web service latency is sub-linear to the increase of batch size so it is important to consider the most cost-efficient batch size for a Machine Learning web service in any given situation.</span></span> <span data-ttu-id="676be-122">웹 서비스 요청의 기본 배치 크기는 1000이며 [Stream Analytics REST API](https://msdn.microsoft.com/library/mt653706.aspx "Stream Analytics REST API") 또는 [Stream Analytics용 PowerShell 클라이언트](stream-analytics-monitor-and-manage-jobs-use-powershell.md "Stream Analytics용 PowerShell 클라이언트")를 사용하여 수정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-122">The default batch size for the web service requests is 1000 and may be modified either by using the [Stream Analytics REST API](https://msdn.microsoft.com/library/mt653706.aspx "Stream Analytics REST API") or the [PowerShell client for Stream Analytics](stream-analytics-monitor-and-manage-jobs-use-powershell.md "PowerShell client for Stream Analytics").</span></span>

<span data-ttu-id="676be-123">배치 크기가 결정되면 함수가 초당 처리할 이벤트 수에 따라 SU(스트리밍 단위)의 양을 결정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-123">Once a batch size has been determined, the amount of streaming units (SUs) can be determined, based on the number of events that the function needs to process per second.</span></span> <span data-ttu-id="676be-124">스트리밍 단위에 대한 자세한 내용은 [Stream Analytics 크기 조정 작업](stream-analytics-scale-jobs.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="676be-124">For more information about streaming units, see [Stream Analytics scale jobs](stream-analytics-scale-jobs.md).</span></span>

<span data-ttu-id="676be-125">1SU 작업과 3SU 작업도 20개의 동시 연결을 갖는다는 점을 제외하면, 일반적으로 6SU마다 Machine Learning 웹 서비스에 대한 20개의 동시 연결이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-125">In general, there are 20 concurrent connections to the Machine Learning web service for every 6 SUs, except that 1 SU jobs and 3 SU jobs will get 20 concurrent connections also.</span></span>  <span data-ttu-id="676be-126">예를 들어 입력 데이터 속도가 초당 200,000 이벤트이고 배치 크기를 기본값인 1000으로 두면 1000 이벤트 미니 배치가 포함된 웹 서비스 대기 시간은 200ms입니다.</span><span class="sxs-lookup"><span data-stu-id="676be-126">For example, if the input data rate is 200,000 events per second and the batch size is left to the default of 1000 the resulting web service latency with 1000 events mini-batch is 200ms.</span></span> <span data-ttu-id="676be-127">즉, 모든 연결에서 Machine Learning 웹 서비스에 초당 5개의 요청을 만들 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-127">This means every connection can make 5 requests to the Machine Learning web service in a second.</span></span> <span data-ttu-id="676be-128">연결이 20개이면 Stream Analytics 작업에서 200ms 동안 20,000개 이벤트를 처리할 수 있으므로 초당 100,000개 이벤트를 처리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-128">With 20 connections, the Stream Analytics job can process 20,000 events in 200ms  and therefore 100,000 events in a second.</span></span> <span data-ttu-id="676be-129">그러므로 초당 200,000 이벤트를 처리하려면 Stream Analytics 작업에 동시 연결 40개가 필요하고, 12SU가 필요하다는 결론이 나옵니다.</span><span class="sxs-lookup"><span data-stu-id="676be-129">So to process 200,000 events per second, the Stream Analytics job needs 40 concurrent connections, which comes out to 12 SUs.</span></span> <span data-ttu-id="676be-130">아래 다이어그램은 Stream Analytics 작업에서 Machine Learning 웹 서비스 끝점으로 전송되는 요청을 보여줍니다. 6SU마다 Machine Learning 웹 서비스에 대한 최대 동시 연결 20개가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-130">The diagram below illustrates the requests from the Stream Analytics job to the Machine Learning web service endpoint – Every 6 SUs has 20 concurrent connections to Machine Learning web service at max.</span></span>

<span data-ttu-id="676be-131">![Machine Learning 함수 2 작업 예제를 사용한 Stream Analytics 크기 조정](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Machine Learning 함수 2 작업 예제를 사용한 Stream Analytics 크기 조정")</span><span class="sxs-lookup"><span data-stu-id="676be-131">![Scale Stream Analytics with Machine Learning Functions 2 job example](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Scale Stream Analytics with Machine Learning Functions 2 job example")</span></span>

<span data-ttu-id="676be-132">일반적으로 배치 크기가 ***B***이고, 배치 크기 B의 웹 서비스 대기 시간이 ***L***밀리초이면 SU ***N***개가 포함된 Stream Analytics 작업의 처리량은 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-132">In general, ***B*** for batch size, ***L*** for the web service latency at batch size B in milliseconds, the throughput of an Stream Analytics job with ***N*** SUs is:</span></span>

<span data-ttu-id="676be-133">![Machine Learning 함수 수식을 사용한 Stream Analytics 크기 조정](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Machine Learning 함수 수식을 사용한 Stream Analytics 크기 조정")</span><span class="sxs-lookup"><span data-stu-id="676be-133">![Scale Stream Analytics with Machine Learning Functions Formula](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Scale Stream Analytics with Machine Learning Functions Formula")</span></span>

<span data-ttu-id="676be-134">Machine Learning 웹 서비스 쪽의 '최대 동시 호출'도 고려해야 합니다. 이 값을 최대 값(현재는 200)으로 설정하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-134">An additional consideration may be the 'max concurrent calls' on the Machine Learning web service side, it’s recommended to set this to the maximum value (200 currently).</span></span>

<span data-ttu-id="676be-135">이 설정에 대한 자세한 내용은 [Machine Learning 웹 서비스와 관련된 크기 조정 문서](../machine-learning/machine-learning-scaling-webservice.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="676be-135">For more information on this setting please review the [Scaling article for Machine Learning Web Services](../machine-learning/machine-learning-scaling-webservice.md).</span></span>

## <a name="example--sentiment-analysis"></a><span data-ttu-id="676be-136">예 – 정서 분석</span><span class="sxs-lookup"><span data-stu-id="676be-136">Example – Sentiment Analysis</span></span>
<span data-ttu-id="676be-137">다음 예제는 [Stream Analytics Machine Learning 통합 자습서](stream-analytics-machine-learning-integration-tutorial.md)에 설명된 대로 정서 분석 Machine Learning 함수를 사용하는 Stream Analytics 작업을 포함하고 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-137">The following example includes a Stream Analytics job with the sentiment analysis Machine Learning function, as described in the [Stream Analytics Machine Learning integration tutorial](stream-analytics-machine-learning-integration-tutorial.md).</span></span>

<span data-ttu-id="676be-138">아래와 같이 완전히 분할된 간단한 쿼리 다음에 **sentiment** 함수가 옵니다.</span><span class="sxs-lookup"><span data-stu-id="676be-138">The query is a simple fully partitioned query followed by the **sentiment** function, as shown below:</span></span>

    WITH subquery AS (
        SELECT text, sentiment(text) as result from input
    )

    Select text, result.[Score]
    Into output
    From subquery

<span data-ttu-id="676be-139">처리량이 초당 10,000 트윗인 Stream Analytics 작업을 만들어서 트윗(이벤트) 정서 분석을 수행해야 하는 시나리오를 가정해 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-139">Consider the following scenario; with a throughput of 10,000 tweets per second a Stream Analytics job must be created to perform sentiment analysis of the tweets (events).</span></span> <span data-ttu-id="676be-140">1SU를 사용하면 이 Stream Analytics 작업에서 트래픽을 처리할 수 있을까요?</span><span class="sxs-lookup"><span data-stu-id="676be-140">Using 1 SU, could this Stream Analytics job be able to handle the traffic?</span></span> <span data-ttu-id="676be-141">기본 배치 크기인 1000을 사용하면 작업에서 입력을 처리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-141">Using the default batch size of 1000 the job should be able to keep up with the input.</span></span> <span data-ttu-id="676be-142">뿐만 아니라 추가된 Machine Learning 함수가 생성하는 대기 시간이 정서 분석 Machine Learning 웹 서비스(배치 크기는 기본값인 1000)의 일반적인 기본 대기 시간인 1초를 초과하면 안 됩니다.</span><span class="sxs-lookup"><span data-stu-id="676be-142">Further the added Machine Learning function should generate no more than a second of latency, which is the general default latency of the sentiment analysis Machine Learning web service (with a default batch size of 1000).</span></span> <span data-ttu-id="676be-143">Stream Analytics 작업의 **전체적인** 또는 종단 간 대기 시간은 일반적으로 몇 초입니다.</span><span class="sxs-lookup"><span data-stu-id="676be-143">The Stream Analytics job’s **overall** or end-to-end latency would typically be a few seconds.</span></span> <span data-ttu-id="676be-144">이 Stream Analytics 작업, *특히* Machine Learning 함수 호출에 대해 좀 더 자세히 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-144">Take a more detailed look into this Stream Analytics job, *especially* the Machine Learning function calls.</span></span> <span data-ttu-id="676be-145">배치 크기가 1000이면 10,000 이벤트를 처리하기 위해 웹 서버로 약 10개의 요청을 보내야 합니다.</span><span class="sxs-lookup"><span data-stu-id="676be-145">Having the batch size as 1000, a throughput of 10,000 events will take about 10 requests to web service.</span></span> <span data-ttu-id="676be-146">1SU를 사용하더라도 이 입력 트래픽을 처리하기에 충분한 동시 연결이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-146">Even with 1 SU, there are enough concurrent connections to accommodate this input traffic.</span></span>

<span data-ttu-id="676be-147">하지만 입력 이벤트 속도가 100배 증가하여 이제 Stream Analytics 작업에서 초당 1,000,000 트윗을 처리해야 한다면 어떻게 해야 할까요?</span><span class="sxs-lookup"><span data-stu-id="676be-147">But what if the input event rate increases by 100x and now the Stream Analytics job needs to process 1,000,000 tweets per second?</span></span> <span data-ttu-id="676be-148">두 가지 옵션이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-148">There are two options:</span></span>

1. <span data-ttu-id="676be-149">배치 크기를 늘립니다.</span><span class="sxs-lookup"><span data-stu-id="676be-149">Increase the batch size, or</span></span>
2. <span data-ttu-id="676be-150">입력 스트림을 분할하여 이벤트를 병렬로 처리합니다.</span><span class="sxs-lookup"><span data-stu-id="676be-150">Partition the input stream to process the events in parallel</span></span>

<span data-ttu-id="676be-151">첫 번째 옵션을 사용하면 작업 **대기 시간** 이 증가합니다.</span><span class="sxs-lookup"><span data-stu-id="676be-151">With the first option, the job **latency** will increase.</span></span>

<span data-ttu-id="676be-152">두 번째 옵션을 사용하면 더 많은 SU를 프로비전해야 하고, 따라서 더 많은 동시 Machine Learning 웹 서비스 요청을 생성해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="676be-152">With the second option, more SUs would need to be provisioned and therefore generate more concurrent Machine Learning web service requests.</span></span> <span data-ttu-id="676be-153">즉, 작업 **비용** 이 증가합니다.</span><span class="sxs-lookup"><span data-stu-id="676be-153">This means the job **cost** will increase.</span></span>

<span data-ttu-id="676be-154">정서 분석 Machine Learning 웹 서비스의 대기 시간이 1000개 미만 이벤트 배치에서는 200ms, 5,000 이벤트 배치에서는 250ms, 10,000 이벤트 배치에서는 300ms, 또는 25,000 이벤트 배치에서는 500ms라고 가정하겠습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-154">Assume the latency of the sentiment analysis Machine Learning web service is 200ms for 1000-event batches or below, 250ms for 5,000-event batches, 300ms for 10,000-event batches or 500ms for 25,000-event batches.</span></span>

1. <span data-ttu-id="676be-155">첫 번째 옵션을 사용할 경우(추가 SU를 프로비전하지 **않음**) 배치 크기를 **25,000**으로 늘릴 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-155">Using the first option, (**not** provisioning more SUs), the batch size could be increased to **25,000**.</span></span> <span data-ttu-id="676be-156">이렇게 하면 작업에서 Machine Learning 웹 서비스에 대한 동시 연결 20개(호출당 대기 시간 500ms)를 사용하여 1,000,000 이벤트를 처리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-156">This in turn would allow the job to process 1,000,000 events with 20 concurrent connections to the Machine Learning web service (with a latency of 500ms per call).</span></span> <span data-ttu-id="676be-157">Machine Learning 웹 서비스 요청에 대한 감정 함수 요청으로 인해 Stream Analytics 작업의 대기 시간이 **200ms**에서 **500ms**로 증가합니다.</span><span class="sxs-lookup"><span data-stu-id="676be-157">So the additional latency of the Stream Analytics job due to the sentiment function requests against the Machine Learning web service requests would be increased from **200ms** to **500ms**.</span></span> <span data-ttu-id="676be-158">그러나 배치 크기를 무한정 늘릴 수는 **없습니다**. Machine Learning 웹 서비스는 작업 후 100초가 지나면 웹 서비스 요청 시간이 초과되므로 요청의 페이로드 크기가 4MB 이하여야 하기 때문입니다.</span><span class="sxs-lookup"><span data-stu-id="676be-158">However, note that batch size **cannot** be increased infinitely as the Machine Learning web services requires the payload size of a request be 4MB or smaller web service requests timeout after 100 seconds of operation.</span></span>
2. <span data-ttu-id="676be-159">두 번째 옵션을 사용할 경우 배치 크기는 1000으로 유지되고 웹 서비스 대기 시간이 200ms이므로, 웹 서비스에 대한 동시 연결 20개마다 1000 * 20 * 5 이벤트 = 초당 100,000 이벤트를 처리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-159">Using the second option, the batch size is left at 1000, with 200ms web service latency, every 20 concurrent connections to the web service would be able to process 1000 * 20 * 5 events = 100,000 per second.</span></span> <span data-ttu-id="676be-160">따라서 초당 1,000,000 이벤트를 처리하려면 작업에 60SU가 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="676be-160">So to process 1,000,000 events per second, the job would need 60 SUs.</span></span> <span data-ttu-id="676be-161">첫 번째 옵션과 비교하면, Stream Analytics 작업에서 웹 서비스 배치 요청을 더 많이 만들며, 그로 인해 비용도 함께 증가합니다.</span><span class="sxs-lookup"><span data-stu-id="676be-161">Compared to the first option, Stream Analytics job would make more web service batch requests, in turn generating an increased cost.</span></span>

<span data-ttu-id="676be-162">아래는 SU 및 배치 크기(초당 이벤트 수)에 따른 Stream Analytics 작업의 처리량을 보여 주는 테이블입니다.</span><span class="sxs-lookup"><span data-stu-id="676be-162">Below is a table for the throughput of the Stream Analytics job for different SUs and batch sizes (in number of events per second).</span></span>

| <span data-ttu-id="676be-163">배치 크기(ML 대기 시간)</span><span class="sxs-lookup"><span data-stu-id="676be-163">batch size (ML latency)</span></span> | <span data-ttu-id="676be-164">500(200ms)</span><span class="sxs-lookup"><span data-stu-id="676be-164">500 (200ms)</span></span> | <span data-ttu-id="676be-165">1,000(200ms)</span><span class="sxs-lookup"><span data-stu-id="676be-165">1,000 (200ms)</span></span> | <span data-ttu-id="676be-166">5,000(250ms)</span><span class="sxs-lookup"><span data-stu-id="676be-166">5,000 (250ms)</span></span> | <span data-ttu-id="676be-167">10,000(300ms)</span><span class="sxs-lookup"><span data-stu-id="676be-167">10,000 (300ms)</span></span> | <span data-ttu-id="676be-168">25,000(500ms)</span><span class="sxs-lookup"><span data-stu-id="676be-168">25,000 (500ms)</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="676be-169">**1SU**</span><span class="sxs-lookup"><span data-stu-id="676be-169">**1 SU**</span></span> |<span data-ttu-id="676be-170">2,500</span><span class="sxs-lookup"><span data-stu-id="676be-170">2,500</span></span> |<span data-ttu-id="676be-171">5,000</span><span class="sxs-lookup"><span data-stu-id="676be-171">5,000</span></span> |<span data-ttu-id="676be-172">20,000</span><span class="sxs-lookup"><span data-stu-id="676be-172">20,000</span></span> |<span data-ttu-id="676be-173">30,000</span><span class="sxs-lookup"><span data-stu-id="676be-173">30,000</span></span> |<span data-ttu-id="676be-174">50,000</span><span class="sxs-lookup"><span data-stu-id="676be-174">50,000</span></span> |
| <span data-ttu-id="676be-175">**3SU**</span><span class="sxs-lookup"><span data-stu-id="676be-175">**3 SUs**</span></span> |<span data-ttu-id="676be-176">2,500</span><span class="sxs-lookup"><span data-stu-id="676be-176">2,500</span></span> |<span data-ttu-id="676be-177">5,000</span><span class="sxs-lookup"><span data-stu-id="676be-177">5,000</span></span> |<span data-ttu-id="676be-178">20,000</span><span class="sxs-lookup"><span data-stu-id="676be-178">20,000</span></span> |<span data-ttu-id="676be-179">30,000</span><span class="sxs-lookup"><span data-stu-id="676be-179">30,000</span></span> |<span data-ttu-id="676be-180">50,000</span><span class="sxs-lookup"><span data-stu-id="676be-180">50,000</span></span> |
| <span data-ttu-id="676be-181">**6SU**</span><span class="sxs-lookup"><span data-stu-id="676be-181">**6 SUs**</span></span> |<span data-ttu-id="676be-182">2,500</span><span class="sxs-lookup"><span data-stu-id="676be-182">2,500</span></span> |<span data-ttu-id="676be-183">5,000</span><span class="sxs-lookup"><span data-stu-id="676be-183">5,000</span></span> |<span data-ttu-id="676be-184">20,000</span><span class="sxs-lookup"><span data-stu-id="676be-184">20,000</span></span> |<span data-ttu-id="676be-185">30,000</span><span class="sxs-lookup"><span data-stu-id="676be-185">30,000</span></span> |<span data-ttu-id="676be-186">50,000</span><span class="sxs-lookup"><span data-stu-id="676be-186">50,000</span></span> |
| <span data-ttu-id="676be-187">**12SU**</span><span class="sxs-lookup"><span data-stu-id="676be-187">**12 SUs**</span></span> |<span data-ttu-id="676be-188">5,000</span><span class="sxs-lookup"><span data-stu-id="676be-188">5,000</span></span> |<span data-ttu-id="676be-189">10,000</span><span class="sxs-lookup"><span data-stu-id="676be-189">10,000</span></span> |<span data-ttu-id="676be-190">40,000</span><span class="sxs-lookup"><span data-stu-id="676be-190">40,000</span></span> |<span data-ttu-id="676be-191">60,000</span><span class="sxs-lookup"><span data-stu-id="676be-191">60,000</span></span> |<span data-ttu-id="676be-192">100,000</span><span class="sxs-lookup"><span data-stu-id="676be-192">100,000</span></span> |
| <span data-ttu-id="676be-193">**18SU**</span><span class="sxs-lookup"><span data-stu-id="676be-193">**18 SUs**</span></span> |<span data-ttu-id="676be-194">7,500</span><span class="sxs-lookup"><span data-stu-id="676be-194">7,500</span></span> |<span data-ttu-id="676be-195">15,000</span><span class="sxs-lookup"><span data-stu-id="676be-195">15,000</span></span> |<span data-ttu-id="676be-196">60,000</span><span class="sxs-lookup"><span data-stu-id="676be-196">60,000</span></span> |<span data-ttu-id="676be-197">90,000</span><span class="sxs-lookup"><span data-stu-id="676be-197">90,000</span></span> |<span data-ttu-id="676be-198">150,000</span><span class="sxs-lookup"><span data-stu-id="676be-198">150,000</span></span> |
| <span data-ttu-id="676be-199">**24SU**</span><span class="sxs-lookup"><span data-stu-id="676be-199">**24 SUs**</span></span> |<span data-ttu-id="676be-200">10,000</span><span class="sxs-lookup"><span data-stu-id="676be-200">10,000</span></span> |<span data-ttu-id="676be-201">20,000</span><span class="sxs-lookup"><span data-stu-id="676be-201">20,000</span></span> |<span data-ttu-id="676be-202">80,000</span><span class="sxs-lookup"><span data-stu-id="676be-202">80,000</span></span> |<span data-ttu-id="676be-203">120,000</span><span class="sxs-lookup"><span data-stu-id="676be-203">120,000</span></span> |<span data-ttu-id="676be-204">200,000</span><span class="sxs-lookup"><span data-stu-id="676be-204">200,000</span></span> |
| <span data-ttu-id="676be-205">**…**</span><span class="sxs-lookup"><span data-stu-id="676be-205">**…**</span></span> |<span data-ttu-id="676be-206">…</span><span class="sxs-lookup"><span data-stu-id="676be-206">…</span></span> |<span data-ttu-id="676be-207">…</span><span class="sxs-lookup"><span data-stu-id="676be-207">…</span></span> |<span data-ttu-id="676be-208">…</span><span class="sxs-lookup"><span data-stu-id="676be-208">…</span></span> |<span data-ttu-id="676be-209">…</span><span class="sxs-lookup"><span data-stu-id="676be-209">…</span></span> |<span data-ttu-id="676be-210">…</span><span class="sxs-lookup"><span data-stu-id="676be-210">…</span></span> |
| <span data-ttu-id="676be-211">**60SU**</span><span class="sxs-lookup"><span data-stu-id="676be-211">**60 SUs**</span></span> |<span data-ttu-id="676be-212">25,000</span><span class="sxs-lookup"><span data-stu-id="676be-212">25,000</span></span> |<span data-ttu-id="676be-213">50,000</span><span class="sxs-lookup"><span data-stu-id="676be-213">50,000</span></span> |<span data-ttu-id="676be-214">200,000</span><span class="sxs-lookup"><span data-stu-id="676be-214">200,000</span></span> |<span data-ttu-id="676be-215">300,000</span><span class="sxs-lookup"><span data-stu-id="676be-215">300,000</span></span> |<span data-ttu-id="676be-216">500,000</span><span class="sxs-lookup"><span data-stu-id="676be-216">500,000</span></span> |

<span data-ttu-id="676be-217">이제 Stream Analytics 작업에서 Machine Learning 함수가 어떻게 작동하는지 충분히 이해하셨을 것입니다.</span><span class="sxs-lookup"><span data-stu-id="676be-217">By now, you should already have a good understanding of how Machine Learning functions in Stream Analytics work.</span></span> <span data-ttu-id="676be-218">또한 Stream Analytics 작업이 데이터 원본에서 데이터를 "끌어오며" 각 "끌어오기"는 Stream Analytics 작업에서 처리할 이벤트 배치를 반환한다는 내용도 이해하셨을 것입니다.</span><span class="sxs-lookup"><span data-stu-id="676be-218">You likely also understand that Stream Analytics jobs “pull” data from data sources and each “pull” returns a batch of events for the Stream Analytics job to process.</span></span> <span data-ttu-id="676be-219">이 끌어오기 모델이 Machine Learning 웹 서비스 요청에 어떤 영향을 미칠까요?</span><span class="sxs-lookup"><span data-stu-id="676be-219">How does this pull model impact the Machine Learning web service requests?</span></span>

<span data-ttu-id="676be-220">일반적으로 Machine Learning 함수에 대해 설정하는 배치 크기를 각 Stream Analytics 작업의 “끌어오기”에서 반환하는 이벤트 수로 나누어서 딱 떨어지는 경우는 별로 없습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-220">Normally, the batch size we set for Machine Learning functions won’t exactly be divisible by the number of events returned by each Stream Analytics job “pull”.</span></span> <span data-ttu-id="676be-221">이와 같은 경우 Machine Learning 웹 서비스가 “부분” 배치를 통해 호출됩니다.</span><span class="sxs-lookup"><span data-stu-id="676be-221">When this occurs the Machine Learning web service will be called with “partial” batches.</span></span> <span data-ttu-id="676be-222">이는 끌어오기 간에 이벤트를 병합할 때 추가 작업 대기 시간 오버헤드를 유발하지 않기 위한 조치입니다.</span><span class="sxs-lookup"><span data-stu-id="676be-222">This is done to not incur additional job latency overhead in coalescing events from pull to pull.</span></span>

## <a name="new-function-related-monitoring-metrics"></a><span data-ttu-id="676be-223">새 함수 관련 모니터링 메트릭</span><span class="sxs-lookup"><span data-stu-id="676be-223">New function-related monitoring metrics</span></span>
<span data-ttu-id="676be-224">Stream Analytics 작업의 모니터링 영역에 함수 관련 메트릭 세 개가 추가되었습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-224">In the Monitor area of a Stream Analytics job, three additional function-related metrics have been added.</span></span> <span data-ttu-id="676be-225">이 세 개 함수는 아래 그림에 나와 있는 것처럼 FUNCTION REQUESTS, FUNCTION EVENTS 및 FAILED FUNCTION REQUESTS입니다.</span><span class="sxs-lookup"><span data-stu-id="676be-225">They are FUNCTION REQUESTS, FUNCTION EVENTS and FAILED FUNCTION REQUESTS, as shown in the graphic below.</span></span>

<span data-ttu-id="676be-226">![Machine Learning 함수 메트릭을 사용한 Stream Analytics 크기 조정](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Machine Learning 함수 메트릭을 사용한 Stream Analytics 크기 조정")</span><span class="sxs-lookup"><span data-stu-id="676be-226">![Scale Stream Analytics with Machine Learning Functions Metrics](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Scale Stream Analytics with Machine Learning Functions Metrics")</span></span>

<span data-ttu-id="676be-227">함수는 아래와 같이 정의됩니다.</span><span class="sxs-lookup"><span data-stu-id="676be-227">The are defined as follows:</span></span>

<span data-ttu-id="676be-228">**FUNCTION REQUESTS**: 함수 요청의 수</span><span class="sxs-lookup"><span data-stu-id="676be-228">**FUNCTION REQUESTS**: The number of function requests.</span></span>

<span data-ttu-id="676be-229">**FUNCTION EVENTS**: 함수 요청의 이벤트 수</span><span class="sxs-lookup"><span data-stu-id="676be-229">**FUNCTION EVENTS**: The number events in the function requests.</span></span>

<span data-ttu-id="676be-230">**FAILED FUNCTION REQUESTS**: 실패한 함수 요청의 수.</span><span class="sxs-lookup"><span data-stu-id="676be-230">**FAILED FUNCTION REQUESTS**: The number of failed function requests.</span></span>

## <a name="key-takeaways"></a><span data-ttu-id="676be-231">핵심 내용</span><span class="sxs-lookup"><span data-stu-id="676be-231">Key Takeaways</span></span>
<span data-ttu-id="676be-232">핵심을 요약하자면, Machine Learning 함수를 사용하여 Stream Analytics 작업의 크기를 조정하려면 다음 사항을 고려해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="676be-232">To summarize the main points, in order to scale an Stream Analytics job with Machine Learning functions, the following items must be considered:</span></span>

1. <span data-ttu-id="676be-233">입력 이벤트 속도</span><span class="sxs-lookup"><span data-stu-id="676be-233">The input event rate</span></span>
2. <span data-ttu-id="676be-234">실행 중인 Stream Analytics 작업에 허용되는 대기 시간(따라서 Machine Learning 웹 서비스 요청의 배치 크기)</span><span class="sxs-lookup"><span data-stu-id="676be-234">The tolerated latency for the running Stream Analytics job (and thus the batch size of the Machine Learning web service requests)</span></span>
3. <span data-ttu-id="676be-235">프로비전된 Stream Analytics SU 및 Machine Learning 웹 서비스 요청 수(추가 함수 관련 비용)</span><span class="sxs-lookup"><span data-stu-id="676be-235">The provisioned Stream Analytics SUs and the number of Machine Learning web service requests (the additional function-related costs)</span></span>

<span data-ttu-id="676be-236">이 예에서는 완전하게 분할된 Stream Analytics 쿼리가 사용되었습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-236">A fully partitioned Stream Analytics query was used as an example.</span></span> <span data-ttu-id="676be-237">보다 복잡한 쿼리가 필요한 경우 [Azure Stream Analytics 포럼](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) 에서 Stream Analytics 팀에게 추가 도움을 받을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="676be-237">If a more complex query is needed the [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) is a great resource for getting additional help from the Stream Analytics team.</span></span>

## <a name="next-steps"></a><span data-ttu-id="676be-238">다음 단계</span><span class="sxs-lookup"><span data-stu-id="676be-238">Next steps</span></span>
<span data-ttu-id="676be-239">Stream Analytics에 대한 자세한 내용은 다음 항목을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="676be-239">To learn more about Stream Analytics, see:</span></span>

* [<span data-ttu-id="676be-240">Azure Stream Analytics 사용 시작</span><span class="sxs-lookup"><span data-stu-id="676be-240">Get started using Azure Stream Analytics</span></span>](stream-analytics-real-time-fraud-detection.md)
* [<span data-ttu-id="676be-241">Azure  Stream Analytics 작업 규모 지정</span><span class="sxs-lookup"><span data-stu-id="676be-241">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="676be-242">Azure  Stream Analytics 쿼리 언어 참조</span><span class="sxs-lookup"><span data-stu-id="676be-242">Azure Stream Analytics Query Language Reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="676be-243">Azure Stream Analytics 관리 REST API 참조</span><span class="sxs-lookup"><span data-stu-id="676be-243">Azure Stream Analytics Management REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)
