---
title: "스트림 분석에 대 한 aaaJSON 출력 | Microsoft Docs"
description: "비구조화된 JSON 데이터에 대한 데이터 보관 및 짧은 대기 시간 쿼리를 위해 Stream Analytics에서 JSON 출력의 대상을 Azure Cosmos DB로 지정할 수 있는 방법을 알아봅니다."
keywords: "JSON 출력"
documentationcenter: 
services: stream-analytics,documentdb
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 5d2a61a6-0dbf-4f1b-80af-60a80eb25dd1
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: fa717818c839ecd7a60fcee33d22011990fd5878
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 10/06/2017
---
# <a name="target-azure-cosmos-db-for-json-output-from-stream-analytics"></a><span data-ttu-id="310f0-104">Stream Analytics에서 JSON 출력의 대상을 Azure Cosmos DB로 지정</span><span class="sxs-lookup"><span data-stu-id="310f0-104">Target Azure Cosmos DB for JSON output from Stream Analytics</span></span>
<span data-ttu-id="310f0-105">비구조화된 JSON 데이터에 대한 데이터 보관 및 짧은 대기 시간 쿼리를 사용하기 위해 Stream Analytics에서 JSON 출력의 대상을 [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/)로 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-105">Stream Analytics can target [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) for JSON output, enabling data archiving and low-latency queries on unstructured JSON data.</span></span> <span data-ttu-id="310f0-106">이 문서에서는 이 구성을 구현하기 위한 몇 가지 모범 사례를 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-106">This document covers some best practices for implementing this configuration.</span></span>

<span data-ttu-id="310f0-107">Cosmos DB에 익숙하지 않은 사용자, 살펴보세요 [Azure Cosmos DB 학습 경로](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget 시작 합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-107">For those who are unfamiliar with Cosmos DB, take a look at [Azure Cosmos DB’s learning path](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget started.</span></span> 

<span data-ttu-id="310f0-108">참고: Mongo DB API 기반 Cosmos DB 컬렉션은 현재 지원되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-108">Note: Mongo DB API based Cosmos DB collections is currently not supported.</span></span> 

## <a name="basics-of-cosmos-db-as-an-output-target"></a><span data-ttu-id="310f0-109">출력 대상으로서 Cosmos DB의 기본 사항</span><span class="sxs-lookup"><span data-stu-id="310f0-109">Basics of Cosmos DB as an output target</span></span>
<span data-ttu-id="310f0-110">hello Azure Cosmos DB 출력 스트림 분석에서 쓰기를 스트림을 여 Cosmos DB 커넥터가 컬렉션으로 JSON 출력으로 결과 처리를 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-110">hello Azure Cosmos DB output in Stream Analytics enables writing your stream processing results as JSON output into your Cosmos DB collection(s).</span></span> <span data-ttu-id="310f0-111">스트림 분석에서에서 만들지 않습니다 컬렉션 데이터베이스 대신 필요 toocreate을 선행 합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-111">Stream Analytics does not create collections in your database, instead requiring you toocreate them upfront.</span></span> <span data-ttu-id="310f0-112">Cosmos DB 컬렉션의 hello 청구 비용 투명 tooyou 있고 일관성과 직접 사용 하 여 컬렉션의 용량 hello hello 성능을 조정할 수 있도록 않도록 이것이 [Cosmos DB Api](https://msdn.microsoft.com/library/azure/dn781481.aspx)합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-112">This is so that hello billing costs of Cosmos DB collections are transparent tooyou, and so that you can tune hello performance, consistency and capacity of your collections directly using hello [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span></span> <span data-ttu-id="310f0-113">스트리밍 작업 toologically 별도 당 하나의 Cosmos DB 데이터베이스를 사용 하는 스트리밍 작업에 대 한 사용자 컬렉션을 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-113">We recommend using one Cosmos DB Database per streaming job toologically separate your collections for a streaming job.</span></span>

<span data-ttu-id="310f0-114">Hello Cosmos DB 컬렉션 옵션 중 일부는 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-114">Some of hello Cosmos DB collection options are detailed below.</span></span>

## <a name="tune-consistency-availability-and-latency"></a><span data-ttu-id="310f0-115">일관성, 가용성 및 대기 시간 조정</span><span class="sxs-lookup"><span data-stu-id="310f0-115">Tune consistency, availability, and latency</span></span>
<span data-ttu-id="310f0-116">toomatch 응용 프로그램 요구 사항, Cosmos DB 있습니다 toofine 조정 hello 데이터베이스 및 컬렉션 및 확인 척도로 상대적 일관성, 가용성 및 대기 시간.</span><span class="sxs-lookup"><span data-stu-id="310f0-116">toomatch your application requirements, Cosmos DB allows you toofine tune hello database and collections and make trade-offs between consistency, availability and latency.</span></span> <span data-ttu-id="310f0-117">시나리오에서 읽기 및 쓰기 대기 시간에 대해 필요로 하는 읽기 일관성 수준에 따라 데이터베이스 계정에 대한 일관성 수준을 선택할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-117">Depending on what levels of read consistency your scenario needs against read and write latency, you can choose a consistency level on your database account.</span></span> <span data-ttu-id="310f0-118">또한 기본적으로 Cosmos DB 인덱싱을 사용할 수 있도록 동기 각 CRUD 작업 tooyour 컬렉션에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-118">Also by default, Cosmos DB enables synchronous indexing on each CRUD operation tooyour collection.</span></span> <span data-ttu-id="310f0-119">이 다른 유용한 옵션 toocontrol hello Cosmos DB의 성능을 읽기/쓰기입니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-119">This is another useful option toocontrol hello write/read performance in Cosmos DB.</span></span> <span data-ttu-id="310f0-120">이 항목에 자세한 내용은 hello 검토 [프로그램 데이터베이스 및 쿼리 일관성 수준 변경](../documentdb/documentdb-consistency-levels.md) 문서.</span><span class="sxs-lookup"><span data-stu-id="310f0-120">For further information on this topic, review hello [change your database and query consistency levels](../documentdb/documentdb-consistency-levels.md) article.</span></span>

## <a name="upserts-from-stream-analytics"></a><span data-ttu-id="310f0-121">Stream Analytics에서 Upsert</span><span class="sxs-lookup"><span data-stu-id="310f0-121">Upserts from Stream Analytics</span></span>
<span data-ttu-id="310f0-122">스트림 분석 통합 Cosmos DB와 함께 지정된 된 문서 ID 열에 따라 Cosmos DB 컬렉션에 tooinsert 또는 업데이트 레코드를 허용 합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-122">Stream Analytics integration with Cosmos DB allows you tooinsert or update records in your Cosmos DB collection based on a given Document ID column.</span></span> <span data-ttu-id="310f0-123">참조 된 tooas 이기도 한 *Upsert*합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-123">This is also referred tooas an *Upsert*.</span></span>

<span data-ttu-id="310f0-124">스트림 분석에서 tooa 문서 ID가 충돌 인해 삽입이 실패 하면 업데이트가 수행만 됩니다 한 낙관적 Upsert 방법을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-124">Stream Analytics utilizes an optimistic Upsert approach, where updates are only done when insert fails due tooa Document ID conflict.</span></span> <span data-ttu-id="310f0-125">이 업데이트 부분 업데이트가 toohello 문서에 새 속성 또는 기존 속성을 증분 방식으로 수행 교체의 추가 예: 수 있으므로 패치라고, 스트림 분석에서 수행 됩니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-125">This update is performed by Stream Analytics as a PATCH, so it enables partial updates toohello document, i.e. addition of new properties or replacing an existing property is performed incrementally.</span></span> <span data-ttu-id="310f0-126">Note hello 속성의 값 배열에서 JSON 문서에서에서 변경 작업으로 인해 덮어쓸 가져오는 hello 전체 배열, 즉, hello 배열 병합 되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-126">Note that changes in hello values of array properties in your JSON document result in hello entire array getting overwritten, i.e. hello array is not merged.</span></span>

## <a name="data-partitioning-in-cosmos-db"></a><span data-ttu-id="310f0-127">Cosmos DB의 데이터 분할</span><span class="sxs-lookup"><span data-stu-id="310f0-127">Data partitioning in Cosmos DB</span></span>
<span data-ttu-id="310f0-128">Cosmos DB [컬렉션 분할](../cosmos-db/partition-data.md) hello 데이터를 분할 하기 위한 방법을 권장 됩니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-128">Cosmos DB [partitioned collections](../cosmos-db/partition-data.md) are hello recommended approach for partitioning your data.</span></span> 

<span data-ttu-id="310f0-129">단일 Cosmos DB 컬렉션에 대 한 스트림 분석 여전히 있습니다 toopartition을 hello 쿼리 패턴와 응용 프로그램의 성능 요구에 따라 데이터.</span><span class="sxs-lookup"><span data-stu-id="310f0-129">For single Cosmos DB collections, Stream Analytics still allows you toopartition your data based on both hello query patterns and performance needs of your application.</span></span> <span data-ttu-id="310f0-130">각 컬렉션 수 too10GB 데이터 (최대)이 고 현재 구성 방법은 tooscale 없습니다는를 포함 (또는 오버플로) 컬렉션입니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-130">Each collection may contain up too10GB of data (maximum) and currently there is no way tooscale up (or overflow) a collection.</span></span> <span data-ttu-id="310f0-131">를 확장에 대 한 스트림 분석 하면 지정 된 접두사가 포함 된 toowrite toomultiple 컬렉션 (사용 정보를 아래 참조).</span><span class="sxs-lookup"><span data-stu-id="310f0-131">For scaling out, Stream Analytics allows you toowrite toomultiple collections with a given prefix (see usage details below).</span></span> <span data-ttu-id="310f0-132">스트림 분석 일관 된 hello를 사용 하 여 [해시 파티션 확인자](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) hello 사용자에 따라 전략 PartitionKey 열 toopartition 해당 출력 레코드를 제공 합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-132">Stream Analytics uses hello consistent [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategy based on hello user provided PartitionKey column toopartition its output records.</span></span> <span data-ttu-id="310f0-133">hello hello 스트리밍 작업의 시작 시간에 접두사를 제공 하는 hello 사용 하 여 컬렉션으로 사용 됩니다 hello 출력 파티션 수 toowhich hello 작업 tooin 병렬 씁니다 (Cosmos DB 컬렉션 = 출력 파티션을).</span><span class="sxs-lookup"><span data-stu-id="310f0-133">hello number of collections with hello given prefix at hello streaming job’s start time is used as hello output partition count, toowhich hello job writes tooin parallel (Cosmos DB Collections = Output Partitions).</span></span> <span data-ttu-id="310f0-134">삽입만 수행하는 지연 인덱싱을 사용하는 단일 컬렉션의 경우 약 0.4MB/초의 쓰기 처리량을 예상할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-134">For a single collection with lazy indexing doing only inserts, about 0.4 MB/s write throughput can be expected.</span></span> <span data-ttu-id="310f0-135">여러 컬렉션을 사용 하 여 증가 된 용량 및 있습니다 tooachieve 더 높은 처리량을 허용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-135">Using multiple collections can allow you tooachieve higher throughput and increased capacity.</span></span>

<span data-ttu-id="310f0-136">향후 hello에 tooincrease hello 파티션 수를 가져오려는 경우 toostop을 새로운 컬렉션 변환한 다음 hello 스트림 분석 작업을 다시 시작 하 고 기존 컬렉션에서 repartition hello 데이터 작업을 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-136">If you intend tooincrease hello partition count in hello future, you may need toostop your job, repartition hello data from your existing collections into new collections and then restart hello Stream Analytics job.</span></span> <span data-ttu-id="310f0-137">PartitionResolver를 사용하고 샘플 코드와 함께 다시 분할하는 방법에 대한 자세한 내용은 후속 게시물에서 다룰 예정입니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-137">More details on using PartitionResolver and re-partitioning along with sample code, will be included in a follow-up post.</span></span> <span data-ttu-id="310f0-138">hello 문서 [분할과 Cosmos DB에 크기 조정](../documentdb/documentdb-partition-data.md) 도이 세부 정보를 제공 합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-138">hello article [Partitioning and scaling in Cosmos DB](../documentdb/documentdb-partition-data.md) also provides details on this.</span></span>

## <a name="cosmos-db-settings-for-json-output"></a><span data-ttu-id="310f0-139">JSON 출력에 대한 Cosmos DB 설정</span><span class="sxs-lookup"><span data-stu-id="310f0-139">Cosmos DB settings for JSON output</span></span>
<span data-ttu-id="310f0-140">Cosmos DB를 Stream Analytics의 출력으로 만들면 아래와 같은 정보를 묻는 메시지가 생성됩니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-140">Creating Cosmos DB as an output in Stream Analytics generates a prompt for information as seen below.</span></span> <span data-ttu-id="310f0-141">이 섹션에서는 hello 속성 정의 대해 설명 합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-141">This section provides an explanation of hello properties definition.</span></span>

<span data-ttu-id="310f0-142">분할된 컬렉션</span><span class="sxs-lookup"><span data-stu-id="310f0-142">Partitioned Collection</span></span> | <span data-ttu-id="310f0-143">여러 “단일 파티션” 컬렉션</span><span class="sxs-lookup"><span data-stu-id="310f0-143">Multiple “Single Partition” collections</span></span>
---|---
![documentdb Stream Analytics 출력 화면](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-1.png) |  ![documentdb Stream Analytics 출력 화면](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-2.png)


  
> [!NOTE]
> <span data-ttu-id="310f0-146">hello **여러 "단일 파티션" 컬렉션** 시나리오는 파티션 키가 필요 하 고 지원 되는 구성 합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-146">hello **Multiple “Single Partition” collections** scenario requires a partition key and is a supported configuration.</span></span> 

* <span data-ttu-id="310f0-147">**출력 별칭** – ASA 쿼리에서이 출력 하는 별칭 toorefer</span><span class="sxs-lookup"><span data-stu-id="310f0-147">**Output Alias** – An alias toorefer this output in your ASA query</span></span>  
* <span data-ttu-id="310f0-148">**계정 이름** – hello 이름 또는 끝점 URI hello Cosmos DB 계정입니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-148">**Account Name** – hello name or endpoint URI of hello Cosmos DB account.</span></span>  
* <span data-ttu-id="310f0-149">**계정 키** – hello Cosmos DB 계정에 대 한 hello 공유 액세스 키입니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-149">**Account Key** – hello shared access key for hello Cosmos DB account.</span></span>  
* <span data-ttu-id="310f0-150">**데이터베이스** – hello Cosmos DB 데이터베이스 이름입니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-150">**Database** – hello Cosmos DB database name.</span></span>  
* <span data-ttu-id="310f0-151">**컬렉션 이름 패턴** – hello 컬렉션 이름 또는 hello 컬렉션 toobe 사용에 대 한 해당 패턴입니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-151">**Collection Name Pattern** – hello collection name or their pattern for hello collections toobe used.</span></span> <span data-ttu-id="310f0-152">hello 컬렉션 이름 형식은 파티션은 0부터 시작 하는 여기서 hello 선택적 {partition} 토큰을 사용 하 여 생성할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-152">hello collection name format can be constructed using hello optional {partition} token, where partitions start from 0.</span></span> <span data-ttu-id="310f0-153">다음은 유효한 입력 샘플입니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-153">Following are sample valid inputs:</span></span>  
  <span data-ttu-id="310f0-154">1\) MyCollection – "MyCollection"이라는 이름의 컬렉션이 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-154">1\) MyCollection – One collection named “MyCollection” must exist.</span></span>  
  <span data-ttu-id="310f0-155">2\) MyCollection{partition} – "MyCollection0”, “MyCollection1”, “MyCollection2” 등의 컬렉션이 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-155">2\) MyCollection{partition} – Such collections must exist– "MyCollection0”, “MyCollection1”, “MyCollection2” and so on.</span></span>  
* <span data-ttu-id="310f0-156">**파티션 키** – 선택 사항.</span><span class="sxs-lookup"><span data-stu-id="310f0-156">**Partition Key** – Optional.</span></span> <span data-ttu-id="310f0-157">컬렉션 이름 패턴에 {parition} 토큰을 사용하는 경우에만 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-157">This is only needed if you are using a {parition} token in your collection name pattern.</span></span> <span data-ttu-id="310f0-158">출력 컬렉션 간에 분할에 대 한 출력 toospecify hello 키를 사용 하는 이벤트에 대 한 hello 필드의 hello 이름입니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-158">hello name of hello field in output events used toospecify hello key for partitioning output across collections.</span></span> <span data-ttu-id="310f0-159">단일 컬렉션 출력의 경우 임의의 출력 열(예: PartitionId)이 사용될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-159">For single collection output, any arbitrary output column can be used e.g. PartitionId.</span></span>  
* <span data-ttu-id="310f0-160">**문서 ID** – 선택 사항입니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-160">**Document ID** – Optional.</span></span> <span data-ttu-id="310f0-161">출력 이벤트의 hello 필드의 hello 이름을 사용 하는 삽입 또는 업데이트 작업은 기반으로 toospecify hello 기본 키입니다.</span><span class="sxs-lookup"><span data-stu-id="310f0-161">hello name of hello field in output events used toospecify hello primary key on which insert or update operations are based.</span></span>  
