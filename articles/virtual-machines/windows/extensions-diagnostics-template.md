---
title: "Azure Virtual Machines에 모니터링 및 진단 추가 | Microsoft Docs"
description: "Azure 리소스 관리자 템플릿을 사용하여 새로운 Windows 가상 컴퓨터와 Azure 진단 확장을 만듭니다."
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 6955e3d8c7b032ee898be11e611080905b5069ba
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/18/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="7bbcc-103">Windows VM 및 Azure Resource Manager 템플릿을 사용하여 모니터링 및 진단 사용</span><span class="sxs-lookup"><span data-stu-id="7bbcc-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="7bbcc-104">Azure 진단 확장은 Windows 기반 Azure 가상 컴퓨터에 모니터링 및 진단 기능을 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-104">The Azure Diagnostics Extension provides the monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="7bbcc-105">확장을 Azure 리소스 관리자 템플릿에 속하도록 포함시켜서 가상 컴퓨터에서 이러한 기능을 사용하도록 설정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-105">You can enable these capabilities on the virtual machine by including the extension as part of the azure resource manager template.</span></span> <span data-ttu-id="7bbcc-106">가상 컴퓨터 템플릿의 일부로 확장을 포함시키는 것과 관련된 자세한 내용은 [VM 확장을 사용하여 Azure 리소스 관리자 템플릿 작성](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) 을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="7bbcc-107">이 문서는 Azure 진단 확장을 Windows 가상 컴퓨터 템플릿에 추가하는 방법을 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-107">This article describes how you can add the Azure Diagnostics extension to a windows virtual machine template.</span></span>  

## <a name="add-the-azure-diagnostics-extension-to-the-vm-resource-definition"></a><span data-ttu-id="7bbcc-108">Azure 진단 확장을 가상 컴퓨터 정의에 추가</span><span class="sxs-lookup"><span data-stu-id="7bbcc-108">Add the Azure Diagnostics extension to the VM resource definition</span></span>
<span data-ttu-id="7bbcc-109">Windows 가상 컴퓨터에서 진단 확장을 사용하도록 설정하려면 진단 확장을 리소스 관리자 템플릿에 VM 리소스로 추가해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-109">To enable the diagnostics extension on a Windows Virtual Machine you need to add the extension as a VM resource in the Resource manager template.</span></span>

<span data-ttu-id="7bbcc-110">간단한 리소스 관리자를 기반으로 하는 가상 컴퓨터의 경우 확장 구성을 가상 컴퓨터에 대한 *resources* 배열로 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-110">For a simple Resource Manager based Virtual Machine add the extension configuration to the *resources* array for the Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="7bbcc-111">가상 컴퓨터의 리소스 노드 아래에 확장을 구성하는 대신 템플릿의 루트 리소스 노드에 확장 구성을 추가하는 것도 일반적인 방법입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-111">Another common convention is add the extension configuration at the root resources node of the template instead of defining it under the virtual machine's resources node.</span></span> <span data-ttu-id="7bbcc-112">이런 방식의 경우 *name* 및 *type* 값을 통해 확장과 가상 컴퓨터 간의 계층적인 관계를 명시적으로 지정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-112">With this approach you have to explicitly specify a hierarchical relation between the extension and the virtual machine with the *name* and *type* values.</span></span> <span data-ttu-id="7bbcc-113">예:</span><span class="sxs-lookup"><span data-stu-id="7bbcc-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="7bbcc-114">확장은 가상 컴퓨터와 항상 연결되므로, 가상 컴퓨터의 리소스 노드 아래에 직접적으로 확장을 정의하거나 기본 수준에서 확장을 정의하고 계층적인 명명 규칙을 사용하여 가상 컴퓨터와 확장을 연결할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-114">The extension is always associated with the virtual machine, you can either directly define it under the virtual machine's resource node directly or define it at the base level and use the hierarchical naming convention to associate it with the virtual machine.</span></span>

<span data-ttu-id="7bbcc-115">가상 컴퓨터 규모 집합 확장 구성은 *VirtualMachineProfile*의 *extensionProfile* 속성에 지정됩니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-115">For Virtual Machine Scale Sets the extensions configuration is specified in the *extensionProfile* property of the *VirtualMachineProfile*.</span></span>

<span data-ttu-id="7bbcc-116">*publisher* 속성의 값이 **Microsoft.Azure.Diagnostics**이고 *type* 속성의 값이 **IaaSDiagnostics**이면, Azure 진단 확장이 고유하게 식별됩니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-116">The *publisher* property with the value of **Microsoft.Azure.Diagnostics** and the *type* property with the value of **IaaSDiagnostics** uniquely identify the Azure Diagnostics extension.</span></span>

<span data-ttu-id="7bbcc-117">*name* 속성의 값은 리소스 그룹에서 확장을 참조하는 데 사용될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-117">The value of the *name* property can be used to refer to the extension in the resource group.</span></span> <span data-ttu-id="7bbcc-118">특히 **Microsoft.Insights.VMDiagnosticsSettings**로 설정하면 Azure Portal에서 모니터링 차트가 올바르게 표시되도록 Azure Portal에서 쉽게 식별할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-118">Setting it specifically to **Microsoft.Insights.VMDiagnosticsSettings** will enable it to be easily identified by the Azure portal ensuring that the monitoring charts show up correctly in the Azure portal.</span></span>

<span data-ttu-id="7bbcc-119">*typeHandlerVersion* 은 사용할 확장의 버전을 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-119">The *typeHandlerVersion* specifies the version of the extension you would like to use.</span></span> <span data-ttu-id="7bbcc-120">*autoUpgradeMinorVersion* 부 버전을 **true** 로 설정하면 사용 가능한 최신의 부 버전 확장이 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-120">Setting *autoUpgradeMinorVersion* minor version to **true** ensures that you will get the latest Minor version of the extension that is available.</span></span> <span data-ttu-id="7bbcc-121">새로운 기능과 버그 수정을 모두 포함하는 최신의 진단 확장을 사용하려면 항상 *autoUpgradeMinorVersion* 을 **true** 로 설정하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-121">It is highly recommended that you always set *autoUpgradeMinorVersion* to always be **true** so that you always get to use the latest available diagnostics extension with all the new features and bug fixes.</span></span> 

<span data-ttu-id="7bbcc-122">*settings* 요소는 설정하고 확장에서 다시 읽어올 수 있는(공용 구성으로 참조되기도 하는) 확장에 대한 구성 속성을 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-122">The *settings* element contains configurations properties for the extension that can be set and read back from the extension (sometimes referred to as public configuration).</span></span> <span data-ttu-id="7bbcc-123">*xmlcfg* 속성은 진단 에이전트에 의해 수집되는 진단 로그, 성능 카운터 등에 대한 XML 기반 구성을 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-123">The *xmlcfg* property contains xml based configuration for the diagnostics logs, performance counters etc that will be collected by the diagnostics agent.</span></span> <span data-ttu-id="7bbcc-124">XML 스키마 자체에 대한 자세한 내용은 [진단 구성 스키마](https://msdn.microsoft.com/library/azure/dn782207.aspx) 를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about the xml schema itself.</span></span> <span data-ttu-id="7bbcc-125">실제 XML 구성은 Azure 리소스 관리자 템플릿에 변수로 저장한 후 연결하여 base64로 인코딩하여 *xmlcfg*에 대한 값을 설정하는 것이 일반적인 방식입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-125">A common practice is to store the actual xml configuration as a variable in the Azure Resource Manager template and then concatenate and base64 encode them to set the value for *xmlcfg*.</span></span> <span data-ttu-id="7bbcc-126">변수에 xml을 저장하는 방법에 대한 자세한 내용은 [진단 구성 변수](#diagnostics-configuration-variables) 섹션을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-126">See the section on [diagnostics configuration variables](#diagnostics-configuration-variables) to understand more about how to store the xml in variables.</span></span> <span data-ttu-id="7bbcc-127">*storageAccount* 속성은 진단 데이터가 전송되는 저장소 계정의 이름을 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-127">The *storageAccount* property specifies the name of the storage account to which diagnostics data will be transferred.</span></span> 

<span data-ttu-id="7bbcc-128">*protectedSettings* 의 속성은(개인 구성으로 참조되기도 하는) 설정할 수 있지만 설정된 후에는 다시 읽어올 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-128">The properties in *protectedSettings* (sometimes referred to as private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="7bbcc-129">*protectedSettings* 의 쓰기 전용 특성은 진단 데이터를 기록하는 저장소 계정 키와 같은 중요한 정보를 저장하는 데 유용합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-129">The write-only nature of *protectedSettings* makes it useful for storing secrets like the storage account key where the diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="7bbcc-130">진단 저장소 계정을 매개 변수로 지정</span><span class="sxs-lookup"><span data-stu-id="7bbcc-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="7bbcc-131">위의 진단 저장소 JSON 코드 조각은 진단 데이터가 저장되는 진단 저장소 계정을 지정하기 위해 *existingdiagnosticsStorageAccountName* 및 *existingdiagnosticsStorageResourceGroup*이라는 두 가지 매개 변수를 가정합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-131">The diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* to specify the diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="7bbcc-132">진단 저장소 계정을 매개 변수로 지정하면 다양한 환경에서 진단 저장소 계정을 간편하게 변경할 수 있습니다. 예를 들어, 테스트와 프로덕션 배포에 서로 다른 진단 저장소 계정을 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-132">Specifying the diagnostics storage account as a parameter makes it easy to change the diagnostics storage account across different environments e.g. you may want to use a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "The name of an existing storage account to which diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "The resource group for the storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="7bbcc-133">가상 컴퓨터에 대한 리소스 그룹에 진단 저장소 계정을 지정하는 것보다는 리소스 그룹별로 진단 저장소 계정을 지정하는 것이 가장 바람직합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-133">It is best practice to specify a diagnostics storage account in a different resource group than the resource group for the virtual machine.</span></span> <span data-ttu-id="7bbcc-134">리소스 그룹은 자체적인 수명을 갖는 배포 단위라고 간주할 수 있으며, 가상 컴퓨터는 배포되었다가 구성 업데이트가 새로 생성되면 다시 배포될 수 있지만, 이렇게 가상 컴퓨터가 배포되더라도 동일한 저장소 계정에 진단 데이터를 계속 저장하기를 바라는 경우가 일반적입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-134">A resource group can be considered to be a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it to it but you may want to continue storing the diagnostics data in the same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="7bbcc-135">다른 리소스에 저장소 계정을 지정해 두면, 저장소 계정은 다양한 가상 컴퓨터 배포로부터 데이터를 받아들이기 때문에 다양한 버전에서 손쉽게 문제를 해결하는 것이 가능해집니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-135">Having the storage account in a different resource enables the storage account to accept data from various virtual machine deployments making it easy to troubleshoot issues across the various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="7bbcc-136">Visual Studio에서 Windows 가상 컴퓨터 템플릿을 만들면, 기본 저장소 계정은 가상 컴퓨터 VHD가 업로드되는 위치와 동일한 저장소 계정을 사용하도록 설정됩니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-136">If you create a windows virtual machine template from Visual Studio the default storage account might be set to use the same storage account where the virtual machine VHD is uploaded.</span></span> <span data-ttu-id="7bbcc-137">이것은 VM 초기 설정을 간소화하기 위한 것입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-137">This is to simplify initial setup of the VM.</span></span> <span data-ttu-id="7bbcc-138">매개 변수로 전달될 수 있는 다른 저장소 계정을 사용하려면 템플릿을 리팩터링해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-138">You should re-factor the template to use a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="7bbcc-139">진단 구성 변수</span><span class="sxs-lookup"><span data-stu-id="7bbcc-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="7bbcc-140">위의 진단 확장 JSON 코드 조각은 진단 저장소에 대한 저장소 계정 키 생성을 간소화하기 위해서 *accountid* 변수를 정의합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-140">The diagnostics extension json snippet above defines an *accountid* variable to simplify getting the storage account key for the diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="7bbcc-141">진단 확장의 *xmlcfg* 속성은 함께 연결되는 여러 개의 변수를 사용하여 정의됩니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-141">The *xmlcfg* property for the diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="7bbcc-142">이러한 변수의 값은 XML에 있기 때문에 JSON 변수를 설정할 때 올바르게 이스케이프되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-142">The values of these variables are in xml so they need to be escaped correctly when setting the json variables.</span></span>

<span data-ttu-id="7bbcc-143">다음은 Windows 이벤트 로그 및 진단 인프라 로그와 함께 표준 시스템 수준 성능 카운터를 수집하는 진단 구성 XML을 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-143">The following describes the diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="7bbcc-144">올바르게 이스케이프되고 형식이 지정되었으므로, 템플릿의 변수 섹션으로 구성을 바로 붙여넣을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-144">It has been escaped and formatted correctly so that the configuration can directly be pasted into the variables section of your template.</span></span> <span data-ttu-id="7bbcc-145">사람이 읽기에 좀 더 편한 구성 XML의 예를 보려면 [진단 구성 스키마](https://msdn.microsoft.com/library/azure/dn782207.aspx) 를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-145">See the [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of the configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="7bbcc-146">위의 구성에서 Metrics 정의 XML 노드는 앞서 XML에서 *PerformanceCounter* 노드에 정의한 성능 카운터가 집계되고 저장되는 방식을 정의하기 때문에 중요한 구성 요소입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-146">The Metrics definition xml node in the above configuration is an important configuration element as it defines how the performance counters defined earlier in the xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="7bbcc-147">이러한 메트릭은 Azure 포털에서 모니터링 차트 및 경고를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-147">These metrics drive the monitoring charts and alerts in the Azure portal.</span></span>  <span data-ttu-id="7bbcc-148">Azure 포털의 VM 모니터링 데이터를 확인하려는 경우 VM에 대한 진단 구성에 *resourceID* 및 **MetricAggregation**이 있는 **메트릭** 노드가 포함되어 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-148">The **Metrics** node with the *resourceID* and **MetricAggregation** must be included in the diagnostics configuration for your VM if you want to see the VM monitoring data in the Azure portal.</span></span> 
> 
> 

<span data-ttu-id="7bbcc-149">다음은 메트릭 정의에 대한 XML 예제입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-149">The following is an example of the xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="7bbcc-150">*resourceID* 속성은 구독 내의 가상 컴퓨터를 고유하게 식별합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-150">The *resourceID* attribute uniquely identifies the virtual machine in your subscription.</span></span> <span data-ttu-id="7bbcc-151">구독 및 배포하는 리소스 그룹을 기반으로 템플릿에서 자동으로 값을 업데이트할 수 있도록 subscription() 및 resourceGroup() 함수를 사용해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-151">Make sure to use the subscription() and resourceGroup() functions so that the template automatically updates those values based on the subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="7bbcc-152">루프 내에서 여러 개의 가상 컴퓨터를 만드는 경우에는 각각의 개별적인 VM을 제대로 구별하도록 copyIndex() 함수를 통해 *resourceID* 값을 채워야 합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-152">If you are creating multiple Virtual Machines in a loop then you will have to populate the *resourceID* value with an copyIndex() function to correctly differentiate each individual VM.</span></span> <span data-ttu-id="7bbcc-153">다음과 같이 *xmlCfg* 값을 업데이트하여 이것을 지원할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-153">The *xmlCfg* value can be updated to support this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="7bbcc-154">MetricAggregation의 *PT1H* 및 *PT1M* 값은 1분간의 집계와 1시간의 집계를 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-154">The MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="7bbcc-155">저장소의 WADMetrics 테이블</span><span class="sxs-lookup"><span data-stu-id="7bbcc-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="7bbcc-156">위의 Metrics 구성은 다음과 같은 명명 규칙으로 진단 저장소 계정에 테이블을 생성합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-156">The Metrics configuration above will generate tables in your diagnostics storage account with the following naming conventions:</span></span>

* <span data-ttu-id="7bbcc-157">**WADMetrics** : 모든 WADMetrics 테이블에 대한 표준 접두사</span><span class="sxs-lookup"><span data-stu-id="7bbcc-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="7bbcc-158">**PT1H** 또는 **PT1M** : 1시간 또는 1분 동안 집계된 데이터가 테이블에 포함되어 있다는 것을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-158">**PT1H** or **PT1M** : Signifies that the table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="7bbcc-159">**P10D** : 테이블이 데이터 수집을 시작한 시점부터 시작하여 10일간의 데이터를 포함할 것이라는 것을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-159">**P10D** : Signifies the table will contain data for 10 days from when the table started collecting data</span></span>
* <span data-ttu-id="7bbcc-160">**V2S** : 문자열 상수입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-160">**V2S** : String constant</span></span>
* <span data-ttu-id="7bbcc-161">**yyyymmdd** : 테이블이 데이터 수집을 시작한 날짜입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-161">**yyyymmdd** : The date at which the table started collecting data</span></span>

<span data-ttu-id="7bbcc-162">예제: *WADMetricsPT1HP10DV2S20151108* 은 2015년 11월 11일부터 10일간 1시간 동안 수집한 메트릭 데이터를 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="7bbcc-163">각각의 WADMetrics 테이블은 다음 열을 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-163">Each WADMetrics table will contain the following columns:</span></span>

* <span data-ttu-id="7bbcc-164">**PartitionKey**: partitionkey는 VM 리소스를 고유하게 식별하기 위해 *resourceID* 값을 기준으로 생성됩니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-164">**PartitionKey**: The partitionkey is constructed based on the *resourceID* value to uniquely identify the VM resource.</span></span> <span data-ttu-id="7bbcc-165">예: 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="7bbcc-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="7bbcc-166">**RowKey** : <Descending time tick>:<Performance Counter Name> 형식을 따릅니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-166">**RowKey** : Follows the format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="7bbcc-167">감소하는 시간 틱 계산식은 최대 시간 틱 빼기 집계 기간이 시작된 시간입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-167">The descending time tick calculation is max time ticks minus the time of the beginning of the aggregation period.</span></span> <span data-ttu-id="7bbcc-168">예:</span><span class="sxs-lookup"><span data-stu-id="7bbcc-168">E.g.</span></span> <span data-ttu-id="7bbcc-169">샘플 기간이 10-Nov-2015 00:00Hrs UTC에 시작되었으면 계산식은 DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks)이 됩니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-169">if the sample period started on 10-Nov-2015 and 00:00Hrs UTC then the calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="7bbcc-170">사용 가능 메모리 바이트 성능 카운터의 row key는 2519551871999999999__:005CMemory:005CAvailable:0020Bytes가 됩니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-170">For the memory available bytes performance counter the row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="7bbcc-171">**counterName** : 성능 카운터의 이름입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-171">**CounterName** : Is the name of the performance counter.</span></span> <span data-ttu-id="7bbcc-172">이것은 XML config에 정의된 *counterSpecifier* 와 일치합니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-172">This matches the *counterSpecifier* defined in the xml config.</span></span>
* <span data-ttu-id="7bbcc-173">**Maximum** : 집계 기간 동안 성능 카운터의 최대 값입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-173">**Maximum** : The maximum value of the performance counter over the aggregation period.</span></span>
* <span data-ttu-id="7bbcc-174">**Minimum** : 집계 기간 동안 성능 카운터의 최소 값입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-174">**Minimum** : The minimum value of the performance counter over the aggregation period.</span></span>
* <span data-ttu-id="7bbcc-175">**Total** : 집계 기간 동안 보고된 모든 성능 카운터 값의 합계입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-175">**Total** : The sum of all values of the performance counter reported over the aggregation period.</span></span>
* <span data-ttu-id="7bbcc-176">**Count** : 성능 카운터에 대해 보고된 값의 총 개수입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-176">**Count** : The total number of values reported for the performance counter.</span></span>
* <span data-ttu-id="7bbcc-177">**Average** : 집계 기간 동안 성능 카운터의 평균(합계/개수) 값입니다.</span><span class="sxs-lookup"><span data-stu-id="7bbcc-177">**Average** : The average (total/count) value of the performance counter over the aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7bbcc-178">다음 단계</span><span class="sxs-lookup"><span data-stu-id="7bbcc-178">Next Steps</span></span>
* <span data-ttu-id="7bbcc-179">진단 확장을 포함하는 Windows 가상 컴퓨터의 샘플 템플릿은 [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span><span class="sxs-lookup"><span data-stu-id="7bbcc-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="7bbcc-180">[Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) 또는 [Azure 명령줄](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)을 사용하여 Resource Manager 템플릿 배포</span><span class="sxs-lookup"><span data-stu-id="7bbcc-180">Deploy the resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="7bbcc-181">[Azure 리소스 관리자 템플릿 작성](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="7bbcc-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>

