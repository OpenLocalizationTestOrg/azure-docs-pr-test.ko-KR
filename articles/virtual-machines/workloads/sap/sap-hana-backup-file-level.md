---
title: "파일 수준의 SAP HANA Azure 백업 | Microsoft Docs"
description: "Azure 가상 컴퓨터에는 SAP HANA에 대한 두 가지 주요 백업 방법이 있습니다. 이 문서에서는 파일 수준의 SAP HANA Azure 백업에 대해 설명합니다"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 5db0ceb1648b5afa278e1cbe1c42fce8033bfdc1
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/29/2017
---
# <a name="sap-hana-azure-backup-on-file-level"></a><span data-ttu-id="d0419-103">파일 수준의 SAP HANA Azure 백업</span><span class="sxs-lookup"><span data-stu-id="d0419-103">SAP HANA Azure Backup on file level</span></span>

## <a name="introduction"></a><span data-ttu-id="d0419-104">소개</span><span class="sxs-lookup"><span data-stu-id="d0419-104">Introduction</span></span>

<span data-ttu-id="d0419-105">이 문서는 3부로 구성된 SAP HANA 백업 관련 문서 시리즈의 일부입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="d0419-106">[Azure Virtual Machines의 SAP HANA 백업 가이드](./sap-hana-backup-guide.md)에서 시작에 대한 개요와 정보를 제공하고, [저장소 스냅숏에 기반한 SAP HANA 백업](./sap-hana-backup-storage-snapshots.md)에서 저장소 스냅숏을 기반으로 하는 백업 옵션을 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-106">[Backup guide for SAP HANA on Azure Virtual Machines](./sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA backup based on storage snapshots](./sap-hana-backup-storage-snapshots.md) covers the storage snapshot-based backup option.</span></span>

<span data-ttu-id="d0419-107">Azure VM 크기를 살펴보면 GS5에서 64개 디스크가 연결된 데이터 디스크를 허용한다는 것을 알 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-107">Looking at the Azure VM sizes, one can see that a GS5 allows 64 attached data disks.</span></span> <span data-ttu-id="d0419-108">대용량 SAP HANA 시스템의 경우 데이터와 로그 파일을 유지하는 데 많은 수의 디스크를 이미 사용하고 있으므로 소프트웨어 RAID와 결합하여 디스크 IO 처리량을 최적화할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-108">For large SAP HANA systems, a significant number of disks might already be taken for data and log files, possibly in combination with software RAID for optimal disk IO throughput.</span></span> <span data-ttu-id="d0419-109">이 경우 SAP HANA 백업 파일을 어디에 저장할 것인지, 시간이 지남에 따라 연결된 데이터 디스크를 채울 수 있는지 등의 의문을 갖게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-109">The question then is where to store SAP HANA backup files, which could fill up the attached data disks over time?</span></span> <span data-ttu-id="d0419-110">Azure VM 크기 표에 대해서는 [Azure의 Linux 가상 컴퓨터 크기](../../linux/sizes.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="d0419-110">See [Sizes for Linux virtual machines in Azure](../../linux/sizes.md) for the Azure VM size tables.</span></span>

<span data-ttu-id="d0419-111">현재 Azure Backup 서비스에서 사용할 수 있는 SAP HANA 백업 통합은 없습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-111">There is no SAP HANA backup integration available with Azure Backup service at this time.</span></span> <span data-ttu-id="d0419-112">파일 수준에서 백업/복원을 관리하는 표준 방법은 SAP HANA Studio 또는 SAP HANA SQL 문을 통해 파일 기반 백업을 수행하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-112">The standard way to manage backup/restore at the file level is with a file-based backup via SAP HANA Studio or via SAP HANA SQL statements.</span></span> <span data-ttu-id="d0419-113">자세한 내용은 [SAP HANA SQL 및 시스템 보기 참조](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf)(영문)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="d0419-113">See [SAP HANA SQL and System Views Reference](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf) for more information.</span></span>

![SAP HANA Studio 백업 메뉴 항목의 대화 상자를 보여 주는 그림](media/sap-hana-backup-file-level/image022.png)

<span data-ttu-id="d0419-115">이 그림에서는 SAP HANA Studio 백업 메뉴 항목의 대화 상자를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-115">This figure shows the dialog of the backup menu item in SAP HANA Studio.</span></span> <span data-ttu-id="d0419-116">&quot;파일&quot; 유형을 선택하면 SAP HANA에서 백업 파일을 쓰는 파일 시스템의 경로를 지정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-116">When choosing type &quot;file,&quot; one has to specify a path in the file system where SAP HANA writes the backup files.</span></span> <span data-ttu-id="d0419-117">복원도 동일한 방식으로 작동합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-117">Restore works the same way.</span></span>

<span data-ttu-id="d0419-118">간단하고 직관적인 선택으로 보이지만 몇 가지 고려 사항이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-118">While this choice sounds simple and straight forward, there are some considerations.</span></span> <span data-ttu-id="d0419-119">앞에서 설명한 대로 Azure VM에 연결할 수 있는 데이터 디스크의 수는 제한됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-119">As mentioned before, an Azure VM has a limitation of number of data disks that can be attached.</span></span> <span data-ttu-id="d0419-120">데이터베이스와 디스크 처리량 요구 사항의 크기에 따라 VM의 파일 시스템에 SAP HANA 백업 파일을 저장할 수 있는 용량이 부족할 수 있으므로 여러 데이터 디스크에서 스트라이핑을 사용하는 소프트웨어 RAID가 포함될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-120">There might not be capacity to store SAP HANA backup files on the file systems of the VM, depending on the size of the database and disk throughput requirements, which might involve software RAID using striping across multiple data disks.</span></span> <span data-ttu-id="d0419-121">테라바이트 단위의 데이터를 처리할 때 이러한 백업 파일을 이동하고 파일 크기 제한과 성능을 관리하기 위한 다양한 옵션이 이 문서의 뒷부분에 나와 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-121">Various options for moving these backup files, and managing file size restrictions and performance when handling terabytes of data, are provided later in this article.</span></span>

<span data-ttu-id="d0419-122">전체 용량과 관련하여 더 많은 유연성을 제공하는 또 다른 옵션은 Azure Blob 저장소입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-122">Another option, which offers more freedom regarding total capacity, is Azure blob storage.</span></span> <span data-ttu-id="d0419-123">단일 Blob은 1TB로 제한되지만, 단일 Blob 컨테이너의 총 용량은 현재 500TB입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-123">While a single blob is also restricted to 1 TB, the total capacity of a single blob container is currently 500 TB.</span></span> <span data-ttu-id="d0419-124">또한 고객은 소위 &quot;멋진&quot; Blob 저장소를 선택할 수 있으며, 이 경우 비용상의 혜택이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-124">Additionally, it gives customers the choice to select so-called &quot;cool&quot; blob storage, which has a cost benefit.</span></span> <span data-ttu-id="d0419-125">멋진 Blob 저장소에 대한 자세한 내용은 [Azure Blob Storage: 핫 및 쿨 저장소 계층](../../../storage/blobs/storage-blob-storage-tiers.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="d0419-125">See [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md) for details about cool blob storage.</span></span>

<span data-ttu-id="d0419-126">보안을 강화하려면 지리적 복제된 저장소 계정을 사용하여 SAP HANA 백업을 저장합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-126">For additional safety, use a geo-replicated storage account to store the SAP HANA backups.</span></span> <span data-ttu-id="d0419-127">저장소 계정 복제에 대한 자세한 내용은 [Azure Storage 복제](../../../storage/common/storage-redundancy.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="d0419-127">See [Azure Storage replication](../../../storage/common/storage-redundancy.md) for details about storage account replication.</span></span>

<span data-ttu-id="d0419-128">지리적 복제된 전용 백업 저장소 계정에 SAP HANA 백업 전용 VHD를 배치할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-128">One could place dedicated VHDs for SAP HANA backups in a dedicated backup storage account that is geo-replicated.</span></span> <span data-ttu-id="d0419-129">그렇지 않으면 지리적 복제된 저장소 계정 또는 다른 지역에 있는 저장소 계정에 SAP HANA 백업을 보관하는 VHD를 복사할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-129">Or else one could copy the VHDs that keep the SAP HANA backups to a geo-replicated storage account, or to a storage account that is in a different region.</span></span>

## <a name="azure-backup-agent"></a><span data-ttu-id="d0419-130">Azure Backup 에이전트</span><span class="sxs-lookup"><span data-stu-id="d0419-130">Azure backup agent</span></span>

<span data-ttu-id="d0419-131">Azure 백업은 전체 VM을 백업할 뿐만 아니라 게스트 OS에 설치해야 하는 백업 에이전트를 통해 파일과 디렉터리를 백업하는 옵션도 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-131">Azure backup offers the option to not only back up complete VMs, but also files and directories via the backup agent, which has to be installed on the guest OS.</span></span> <span data-ttu-id="d0419-132">그러나 2016년 12월 현재 이 에이전트는 Windows에서만 지원됩니다([Resource Manager 배포 모델을 사용하여 Azure로 Windows 서버 또는 클라이언트 백업](../../../backup/backup-configure-vault.md) 참조).</span><span class="sxs-lookup"><span data-stu-id="d0419-132">But as of December 2016, this agent is only supported on Windows (see [Back up a Windows Server or client to Azure using the Resource Manager deployment model](../../../backup/backup-configure-vault.md)).</span></span>

<span data-ttu-id="d0419-133">이 문제를 해결하려면 먼저 SAP HANA 백업 파일을 Azure의 Windows VM에 복사한(예: SAMBA 공유를 통해) 다음, 여기서 Azure Backup 에이전트를 사용하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-133">A workaround is to first copy SAP HANA backup files to a Windows VM on Azure (for example, via SAMBA share) and then use the Azure backup agent from there.</span></span> <span data-ttu-id="d0419-134">기술적으로 가능하지만 Linux와 Windows VM 간의 복사로 인해 더욱 복잡하게 되며 백업 또는 복원 프로세스가 상당히 느려집니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-134">While it is technically possible, it would add complexity and slow down the backup or restore process quite a bit due to the copy between the Linux and the Windows VM.</span></span> <span data-ttu-id="d0419-135">따라서 이 해결 방법은 수행하지 않는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-135">It is not recommended to follow this approach.</span></span>

## <a name="azure-blobxfer-utility-details"></a><span data-ttu-id="d0419-136">Azure blobxfer 유틸리티 정보</span><span class="sxs-lookup"><span data-stu-id="d0419-136">Azure blobxfer utility details</span></span>

<span data-ttu-id="d0419-137">Azure 저장소에 디렉터리와 파일을 저장하려면 CLI 또는 PowerShell을 사용하거나 [Azure SDK](https://azure.microsoft.com/downloads/) 중 하나를 사용하여 도구를 개발할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-137">To store directories and files on Azure storage, one could use CLI or PowerShell, or develop a tool using one of the [Azure SDKs](https://azure.microsoft.com/downloads/).</span></span> <span data-ttu-id="d0419-138">또한 Azure 저장소에 데이터를 복사하는 데 즉시 사용할 수 있는 유틸리티인 AzCopy도 있지만, 이는 Windows 전용입니다([AzCopy 명령줄 유틸리티로 데이터 전송](../../../storage/common/storage-use-azcopy.md) 참조).</span><span class="sxs-lookup"><span data-stu-id="d0419-138">There is also a ready-to-use utility, AzCopy, for copying data to Azure storage, but it is Windows only (see [Transfer data with the AzCopy Command-Line Utility](../../../storage/common/storage-use-azcopy.md)).</span></span>

<span data-ttu-id="d0419-139">따라서 blobxfer 유틸리티가 SAP HANA 백업 파일을 복사하는 데 사용되었습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-139">Therefore blobxfer was used for copying SAP HANA backup files.</span></span> <span data-ttu-id="d0419-140">이 유틸리티는 프로덕션 환경에서 많은 고객이 사용하는 오픈 소스이며 [GitHub](https://github.com/Azure/blobxfer)에서 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-140">It is open source, used by many customers in production environments, and available on [GitHub](https://github.com/Azure/blobxfer).</span></span> <span data-ttu-id="d0419-141">이 도구를 사용하면 Azure Blob 저장소 또는 Azure 파일 공유에 데이터를 직접 복사할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-141">This tool allows one to copy data directly to either Azure blob storage or Azure file share.</span></span> <span data-ttu-id="d0419-142">또한 여러 파일이 있는 디렉터리를 복사하는 경우 md5 해시 또는 자동 병렬 처리와 같은 유용한 기능을 다양하게 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-142">It also offers a range of useful features, like md5 hash or automatic parallelism when copying a directory with multiple files.</span></span>

## <a name="sap-hana-backup-performance"></a><span data-ttu-id="d0419-143">SAP HANA 백업 성능</span><span class="sxs-lookup"><span data-stu-id="d0419-143">SAP HANA backup performance</span></span>

![SAP HANA Studio의 SAP HANA 백업 콘솔 스크린샷](media/sap-hana-backup-file-level/image023.png)

<span data-ttu-id="d0419-145">이 스크린샷은 SAP HANA Studio의 SAP HANA 백업 콘솔입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-145">This screenshot is of the SAP HANA backup console in SAP HANA Studio.</span></span> <span data-ttu-id="d0419-146">XFS 파일 시스템을 사용하여 HANA VM에 연결된 단일 Azure 표준 저장소 디스크에서 230GB의 백업을 수행하는 데 약 42분이 걸렸습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-146">It took about 42 minutes to do the backup of the 230 GB on a single Azure standard storage disk attached to the HANA VM using XFS file system.</span></span>

![SAP HANA 테스트 VM의 YaST 스크린샷](media/sap-hana-backup-file-level/image024.png)

<span data-ttu-id="d0419-148">이 스크린샷은 SAP HANA 테스트 VM의 YaST입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-148">This screenshot is of YaST on the SAP HANA test VM.</span></span> <span data-ttu-id="d0419-149">앞에서 설명한 대로 SAP HANA 백업을 위한 1TB 단일 디스크를 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-149">One can see the 1-TB single disk for SAP HANA backup as mentioned before.</span></span> <span data-ttu-id="d0419-150">230GB를 백업하는 데 약 42분이 걸렸습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-150">It took about 42 minutes to backup 230 GB.</span></span> <span data-ttu-id="d0419-151">또한 5개의 200GB 디스크가 연결되었고, 소프트웨어 RAID md0이 만들어졌으며, 이러한 5개의 Azure 데이터 디스크에 스트라이핑이 사용되었습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-151">In addition, five 200-GB disks were attached and software RAID md0 created, with striping on top of these five Azure data disks.</span></span>

![연결된 5개 Azure 표준 저장소 데이터 디스크에 대한 스트라이핑으로 소프트웨어 RAID에서 동일한 백업 반복](media/sap-hana-backup-file-level/image025.png)

<span data-ttu-id="d0419-153">연결된 5개 Azure 표준 저장소 데이터 디스크에 스트라이핑을 사용하여 소프트웨어 RAID에서 동일한 백업을 반복하면 백업 시간이 42분에서 10분으로 줄었습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-153">Repeating the same backup on software RAID with striping across five attached Azure standard storage data disks brought the backup time from 42 minutes down to 10 minutes.</span></span> <span data-ttu-id="d0419-154">디스크는 캐싱 없이 VM에 연결되었습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-154">The disks were attached without caching to the VM.</span></span> <span data-ttu-id="d0419-155">따라서 디스크 쓰기 처리량이 백업 시간에 매우 중요하다는 것이 분명합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-155">So it is obvious how important disk write throughput is for the backup time.</span></span> <span data-ttu-id="d0419-156">게다가 Azure 프리미엄 저장소로 전환하여 프로세스를 더욱 가속화함으로써 성능을 최적화할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-156">One could then switch to Azure premium storage to further accelerate the process for optimal performance.</span></span> <span data-ttu-id="d0419-157">일반적으로 프로덕션 시스템에는 Azure 프리미엄 저장소를 사용해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-157">In general, Azure premium storage should be used for production systems.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-blob-storage"></a><span data-ttu-id="d0419-158">Azure Blob 저장소에 SAP HANA 백업 파일 복사</span><span class="sxs-lookup"><span data-stu-id="d0419-158">Copy SAP HANA backup files to Azure blob storage</span></span>

<span data-ttu-id="d0419-159">2016년 12월 현재 SAP HANA 백업 파일을 신속하게 저장하는 가장 좋은 옵션은 Azure Blob 저장소입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-159">As of December 2016, the best option to quickly store SAP HANA backup files is Azure blob storage.</span></span> <span data-ttu-id="d0419-160">Azure의 GS5 VM에서 실행되는 단일 Blob 컨테이너는 500TB 크기로 제한되지만, 대부분의 SAP HANA 시스템에 충분한 크기이며 SAP HANA 백업을 충분하게 유지할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-160">One single blob container has a limit of 500 TB, enough for most SAP HANA systems, running in a GS5 VM on Azure, to keep sufficient SAP HANA backups.</span></span> <span data-ttu-id="d0419-161">고객은 &quot;핫&quot; 및 &quot;콜드&quot; Blob 저장소 중에서 선택할 수 있습니다([Azure Blob Storage: 핫 및 쿨 저장소 계층](../../../storage/blobs/storage-blob-storage-tiers.md) 참조).</span><span class="sxs-lookup"><span data-stu-id="d0419-161">Customers have the choice between &quot;hot&quot; and &quot;cold&quot; blob storage (see [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md)).</span></span>

<span data-ttu-id="d0419-162">blobxfer 도구를 사용하면 SAP HANA 백업 파일을 직접 Azure Blob 저장소에 쉽게 복사할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-162">With the blobxfer tool, it is easy to copy the SAP HANA backup files directly to Azure blob storage.</span></span>

![SAP HANA 파일 전체 백업의 파일](media/sap-hana-backup-file-level/image026.png)

<span data-ttu-id="d0419-164">여기서 SAP HANA 파일 전체 백업의 파일을 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-164">Here one can see the files of a full SAP HANA file backup.</span></span> <span data-ttu-id="d0419-165">4개의 파일이 있으며, 가장 큰 파일은 약 230GB입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-165">There are four files and the biggest one has roughly 230 GB.</span></span>

![Azure 표준 저장소 계정 Blob 컨테이너에 230GB를 복사하는 데 약 3,000초 소요](media/sap-hana-backup-file-level/image027.png)

<span data-ttu-id="d0419-167">초기 테스트에서 md5 해시를 사용하지 않고서 Azure 표준 저장소 계정 Blob 컨테이너에 230GB를 복사하는 데 약 3,000초가 걸렸습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-167">Not using md5 hash in the initial test, it took roughly 3000 seconds to copy the 230 GB to an Azure standard storage account blob container.</span></span>

![Azure Portal에 표시된 화면에서 캡처한 스크린샷](media/sap-hana-backup-file-level/image028.png)

<span data-ttu-id="d0419-169">Azure Portal에 표시된 화면에서 캡처한 스크린샷입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-169">In this screenshot, one can see how it looks on the Azure portal.</span></span> <span data-ttu-id="d0419-170">&quot;sap-hana-backups&quot;라는 이름의 Blob 컨테이너를 만들었으며, SAP HANA 백업 파일을 나타내는 4개의 Blob이 포함되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-170">A blob container named &quot;sap-hana-backups&quot; was created and includes the four blobs, which represent the SAP HANA backup files.</span></span> <span data-ttu-id="d0419-171">그 중 하나는 약 230GB 크기입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-171">One of them has a size of roughly 230 GB.</span></span>

<span data-ttu-id="d0419-172">HANA Studio 백업 콘솔을 사용하면 HANA 백업 파일의 최대 파일 크기를 제한할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-172">The HANA Studio backup console allows one to restrict the max file size of HANA backup files.</span></span> <span data-ttu-id="d0419-173">샘플 환경에서는 하나의 230GB 대용량 파일 대신 여러 개의 작은 백업 파일을 갖출 수 있도록 하여 성능이 향상되었습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-173">In the sample environment, it improved performance by making it possible to have multiple smaller backup files, instead of one large 230-GB file.</span></span>

![백업 시간이 향상되지 않는 HANA 쪽 백업 파일 크기 제한 설정](media/sap-hana-backup-file-level/image029.png)

<span data-ttu-id="d0419-175">HANA 쪽에서 백업 파일 크기 제한을 설정하는 경우 이 그림과 같이 파일을 순차적으로 쓰기 때문에 백업 시간이 향상되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-175">Setting the backup file size limit on the HANA side doesn&#39;t improve the backup time, because the files are written sequentially as shown in this figure.</span></span> <span data-ttu-id="d0419-176">파일 크기 제한을 60GB로 설정했으므로 백업에서 하나의 230GB 파일 대신 4개의 큰 데이터 파일을 만들었습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-176">The file size limit was set to 60 GB, so the backup created four large data files instead of the 230-GB single file.</span></span>

![blobxfer 도구의 병렬 처리를 테스트하기 위해 HANA 백업 파일의 최대 크기를 15GB로 설정](media/sap-hana-backup-file-level/image030.png)

<span data-ttu-id="d0419-178">blobxfer 도구의 병렬 처리를 테스트하기 위해 HANA 백업 파일의 최대 크기를 15GB로 설정하여 19개의 백업 파일을 만들었습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-178">To test parallelism of the blobxfer tool, the max file size for HANA backups was then set to 15 GB, which resulted in 19 backup files.</span></span> <span data-ttu-id="d0419-179">이 구성으로 인해 blobxfer를 통해 Azure Blob 저장소에 230GB를 복사하는 데 걸린 시간이 3,000초에서 875초로 줄었습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-179">This configuration brought the time for blobxfer to copy the 230 GB to Azure blob storage from 3000 seconds down to 875 seconds.</span></span>

<span data-ttu-id="d0419-180">이 결과는 Azure Blob 쓰기에 대한 60MB/초 제한 설정에 따른 것입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-180">This result is due to the limit of 60 MB/sec for writing an Azure blob.</span></span> <span data-ttu-id="d0419-181">여러 Blob을 통한 병렬 처리는 병목 현상을 해결하지만, 단점이 있습니다. 즉 이러한 모든 HANA 백업 파일을 Azure Blob 저장소에 복사하는 blobxfer 도구의 성능이 향상되어 HANA VM과 네트워크 모두에 부하가 걸리며,</span><span class="sxs-lookup"><span data-stu-id="d0419-181">Parallelism via multiple blobs solves the bottleneck, but there is a downside: increasing performance of the blobxfer tool to copy all these HANA backup files to Azure blob storage puts load on both the HANA VM and the network.</span></span> <span data-ttu-id="d0419-182">HANA 시스템의 작업에 영향을 미칩니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-182">Operation of HANA system becomes impacted.</span></span>

## <a name="blob-copy-of-dedicated-azure-data-disks-in-backup-software-raid"></a><span data-ttu-id="d0419-183">백업 소프트웨어 RAID에서 전용 Azure 데이터 디스크의 Blob 복사</span><span class="sxs-lookup"><span data-stu-id="d0419-183">Blob copy of dedicated Azure data disks in backup software RAID</span></span>

<span data-ttu-id="d0419-184">수동 VM 데이터 디스크 백업과 달리, 이 방법에서는 HANA 데이터, HANA 로그 파일 및 구성 파일을 포함하여 전체 SAP 설치를 저장하기 위해 VM의 모든 데이터 디스크를 백업하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-184">Unlike the manual VM data disk backup, in this approach one does not back up all the data disks on a VM to save the whole SAP installation, including HANA data, HANA log files, and config files.</span></span> <span data-ttu-id="d0419-185">대신 SAP HANA 파일 전체 백업을 저장하기 위해 여러 Azure 데이터 VHD에 스트라이핑을 사용하여 소프트웨어 RAID를 전용으로 배치하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-185">Instead, the idea is to have dedicated software RAID with striping across multiple Azure data VHDs for storing a full SAP HANA file backup.</span></span> <span data-ttu-id="d0419-186">SAP HANA 백업이 있는 이러한 디스크만 복사합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-186">One copies only these disks, which have the SAP HANA backup.</span></span> <span data-ttu-id="d0419-187">이러한 디스크는 전용 HANA 백업 저장소 계정에 쉽게 보관하거나 추가 처리를 위해 전용 &quot;관리 VM 백업&quot;에 쉽게 연결할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-187">They could easily be kept in a dedicated HANA backup storage account, or attached to a dedicated &quot;backup management VM&quot; for further processing.</span></span>

![관련된 모든 VHD는 **start-azurestorageblobcopy** PowerShell 명령으로 복사되었습니다.](media/sap-hana-backup-file-level/image031.png)

<span data-ttu-id="d0419-189">로컬 소프트웨어 RAID에 대한 백업을 완료한 후에 **start-azurestorageblobcopy** PowerShell 명령([Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy) 참조)을 사용하여 관련된 모든 VHD를 복사했습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-189">After the backup to the local software RAID was completed, all VHDs involved were copied using the **start-azurestorageblobcopy** PowerShell command (see [Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span></span> <span data-ttu-id="d0419-190">백업 파일을 유지하기 위한 전용 파일 시스템에만 영향을 미치기 때문에 디스크의 SAP HANA 데이터 또는 로그 파일 일관성에 대한 문제는 없습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-190">As it only affects the dedicated file system for keeping the backup files, there are no concerns about SAP HANA data or log file consistency on the disk.</span></span> <span data-ttu-id="d0419-191">이 명령의 이점은 VM이 온라인 상태로 유지되는 동안 작동한다는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-191">A benefit of this command is that it works while the VM stays online.</span></span> <span data-ttu-id="d0419-192">어떤 프로세스도 백업 스트라이프 세트에 쓰지 못하도록 하기 위해 Blob 복사하기 전에 분리하고 나중에 다시 탑재합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-192">To be certain that no process writes to the backup stripe set, be sure to unmount it before the blob copy, and mount it again afterwards.</span></span> <span data-ttu-id="d0419-193">또는 파일 시스템을 &quot;고정&quot;(freeze)하는 적절한 방법을 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-193">Or one could use an appropriate way to &quot;freeze&quot; the file system.</span></span> <span data-ttu-id="d0419-194">예를 들어 XFS 파일 시스템의 경우 xfs\_freeze를 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-194">For example, via xfs\_freeze for the XFS file system.</span></span>

![Azure Portal의 vhds 컨테이너에 있는 Blob의 목록을 보여 주는 스크린샷](media/sap-hana-backup-file-level/image032.png)

<span data-ttu-id="d0419-196">이 스크린샷은 Azure Portal의 &quot;vhds&quot; 컨테이너에 있는 Blob의 목록을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-196">This screenshot shows the list of blobs in the &quot;vhds&quot; container on the Azure portal.</span></span> <span data-ttu-id="d0419-197">SAP HANA 백업 파일을 유지하기 위해 소프트웨어 RAID 역할을 수행하는 SAP HANA 서버 VM에 5개의 VHD가 연결되어 있음을 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-197">The screenshot shows the five VHDs, which were attached to the SAP HANA server VM to serve as the software RAID to keep SAP HANA backup files.</span></span> <span data-ttu-id="d0419-198">또한 Blob 복사 명령을 통해 수행된 5개의 복사본도 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-198">It also shows the five copies, which were taken via the blob copy command.</span></span>

![테스트하기 위해 앱 서버 VM에 연결된 SAP HANA 백업 소프트웨어 RAID 디스크 복사본](media/sap-hana-backup-file-level/image033.png)

<span data-ttu-id="d0419-200">테스트하기 위해 SAP HANA 백업 소프트웨어 RAID 디스크의 복사본이 앱 서버 VM에 연결되었습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-200">For testing purposes, the copies of the SAP HANA backup software RAID disks were attached to the app server VM.</span></span>

![디스크 복사본을 연결하기 위해 종료된 앱 서버 VM](media/sap-hana-backup-file-level/image034.png)

<span data-ttu-id="d0419-202">디스크 복사본을 연결하기 위해 앱 서버 VM이 종료되었습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-202">The app server VM was shut down to attach the disk copies.</span></span> <span data-ttu-id="d0419-203">VM을 시작한 후 디스크와 RAID가 올바르게 검색되었습니다(UUID를 통해 탑재됨).</span><span class="sxs-lookup"><span data-stu-id="d0419-203">After starting the VM, the disks and the RAID were discovered correctly (mounted via UUID).</span></span> <span data-ttu-id="d0419-204">YaST 파티셔너를 통해 만들어진 탑재 지점만 누락되었습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-204">Only the mount point was missing, which was created via the YaST partitioner.</span></span> <span data-ttu-id="d0419-205">나중에 SAP HANA 백업 파일 복사본이 OS 수준에서 표시되도록 했습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-205">Afterwards the SAP HANA backup file copies became visible on OS level.</span></span>

## <a name="copy-sap-hana-backup-files-to-nfs-share"></a><span data-ttu-id="d0419-206">NFS 공유에 SAP HANA 백업 파일 복사</span><span class="sxs-lookup"><span data-stu-id="d0419-206">Copy SAP HANA backup files to NFS share</span></span>

<span data-ttu-id="d0419-207">성능 또는 디스크 공간 관점에서 SAP HANA 시스템에 미치는 잠재적 영향을 줄이려면 NFS 공유에 SAP HANA 백업 파일을 저장하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-207">To lessen the potential impact on the SAP HANA system from a performance or disk space perspective, one might consider storing the SAP HANA backup files on an NFS share.</span></span> <span data-ttu-id="d0419-208">기술적으로는 작동하지만, 두 번째 Azure VM을 NFS 공유의 호스트로 사용한다는 것을 의미합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-208">Technically it works, but it means using a second Azure VM as the host of the NFS share.</span></span> <span data-ttu-id="d0419-209">VM 네트워크 대역폭으로 인해 VM 크기가 작아지면 안됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-209">It should not be a small VM size, due to the VM network bandwidth.</span></span> <span data-ttu-id="d0419-210">그렇다면 이 &quot;백업 VM&quot;을 종료하고 SAP HANA 백업을 실행하기만 하면 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-210">It would make sense then to shut down this &quot;backup VM&quot; and only bring it up for executing the SAP HANA backup.</span></span> <span data-ttu-id="d0419-211">NFS 공유를 작성하면 네트워크에 부하가 걸리고 SAP HANA 시스템에 영향을 미치지만, 나중에 &quot;백업 VM&quot;에서 백업 파일을 관리하는 것만으로 SAP HANA 시스템에 전혀 영향을 미치지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-211">Writing on an NFS share puts load on the network and impacts the SAP HANA system, but merely managing the backup files afterwards on the &quot;backup VM&quot; would not influence the SAP HANA system at all.</span></span>

![다른 Azure VM의 NFS 공유를 탑재한 SAP HANA 서버 VM](media/sap-hana-backup-file-level/image035.png)

<span data-ttu-id="d0419-213">NFS 사용 사례를 확인하기 위해 SAP HANA 서버 VM에 다른 Azure VM의 NFS 공유를 탑재했습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-213">To verify the NFS use case, an NFS share from another Azure VM was mounted to the SAP HANA server VM.</span></span> <span data-ttu-id="d0419-214">특별한 NFS 튜닝을 적용하지 않았습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-214">There was no special NFS tuning applied.</span></span>

![백업을 직접 수행하는 데 1시간 46분이 걸렸습니다.](media/sap-hana-backup-file-level/image036.png)

<span data-ttu-id="d0419-216">NFS 공유는 SAP HANA 서버와 같이 빠른 스트라이프 세트였습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-216">The NFS share was a fast stripe set, like the one on the SAP HANA server.</span></span> <span data-ttu-id="d0419-217">그럼에도 불구하고 로컬 스트라이프 세트에 쓸 때 NFS 공유에서 백업을 직접 수행하는 데 10분이 아닌 1시간 46분이 걸렸습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-217">Nevertheless, it took 1 hour and 46 minutes to do the backup directly on the NFS share instead of 10 minutes, when writing to a local stripe set.</span></span>

![1시간 43분으로 그다지 빠르지 않은 대안](media/sap-hana-backup-file-level/image037.png)

<span data-ttu-id="d0419-219">로컬 스트라이프 세트로 백업하고 OS 수준에서 NFS 공유로 복사하는 대안(간단한 **cp -avr** 명령 사용)은 그다지 빠르지 않았습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-219">The alternative of doing a backup to a local stripe set and copying to the NFS share on OS level (a simple **cp -avr** command) wasn't much quicker.</span></span> <span data-ttu-id="d0419-220">1시간 43분이 걸렸습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-220">It took 1 hour and 43 minutes.</span></span>

<span data-ttu-id="d0419-221">이 방법은 효과가 있으나 230GB 백업 테스트의 성능은 좋지 않았습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-221">So it works, but performance wasn't good for the 230-GB backup test.</span></span> <span data-ttu-id="d0419-222">다중 테라바이트 크기로 작업할 경우에는 더욱 나쁠 것입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-222">It would look even worse for multi terabytes.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-file-service"></a><span data-ttu-id="d0419-223">Azure 파일 서비스에 SAP HANA 백업 파일 복사</span><span class="sxs-lookup"><span data-stu-id="d0419-223">Copy SAP HANA backup files to Azure file service</span></span>

<span data-ttu-id="d0419-224">Azure Linux VM 내에 Azure 파일 공유를 탑재할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-224">It is possible to mount an Azure file share inside an Azure Linux VM.</span></span> <span data-ttu-id="d0419-225">[Linux에서 Azure File Storage를 사용하는 방법](../../../storage/files/storage-how-to-use-files-linux.md) 문서에서 작업을 수행하는 방법에 대해 자세히 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-225">The article [How to use Azure File storage with Linux](../../../storage/files/storage-how-to-use-files-linux.md) provides details on how to do it.</span></span> <span data-ttu-id="d0419-226">현재 Azure 파일 공유당 5TB의 할당량 제한이 있으며, 파일당 파일 크기 제한은 1TB입니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-226">Keep in mind that there is currently a 5-TB quota limit of one Azure file share, and a file size limit of 1 TB per file.</span></span> <span data-ttu-id="d0419-227">저장소 제한에 대한 내용은 [Azure Storage 확장성 및 성능 목표](../../../storage/common/storage-scalability-targets.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="d0419-227">See [Azure Storage Scalability and Performance Targets](../../../storage/common/storage-scalability-targets.md) for information on storage limits.</span></span>

<span data-ttu-id="d0419-228">그러나 테스트한 결과 SAP HANA 백업이 현재 이러한 종류의 CIFS 탑재와 직접 작동하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-228">Tests have shown, however, that SAP HANA backup doesn&#39;t currently work directly with this kind of CIFS mount.</span></span> <span data-ttu-id="d0419-229">또한 [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529)에서도 CIFS를 권장하지 않는다고 명시하고 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-229">It is also stated in [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529) that CIFS is not recommended.</span></span>

![SAP HANA Studio의 백업 대화 상자에서 오류를 보여 주는 그림](media/sap-hana-backup-file-level/image038.png)

<span data-ttu-id="d0419-231">이 그림에서는 CIFS 탑재 Azure 파일 공유에 직접 백업하려고 할 때 SAP HANA Studio의 백업 대화 상자에서 오류가 있음을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-231">This figure shows an error in the backup dialog in SAP HANA Studio, when trying to back up directly to a CIFS-mounted Azure file share.</span></span> <span data-ttu-id="d0419-232">따라서 먼저 표준 SAP HANA 백업을 VM 파일 시스템으로 수행한 다음 Azure 파일 서비스에 백업 파일을 복사해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-232">So one has to do a standard SAP HANA backup into a VM file system first, and then copy the backup files from there to Azure file service.</span></span>

![19개 SAP HANA 백업 파일을 복사하는 데 929초 정도 걸렸음을 보여 주는 그림](media/sap-hana-backup-file-level/image039.png)

<span data-ttu-id="d0419-234">이 그림에서는 총 크기가 약 230GB인 19개의 SAP HANA 백업 파일을 Azure 파일 공유에 복사하는 데 929초 정도 걸렸음을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-234">This figure shows that it took about 929 seconds to copy 19 SAP HANA backup files with a total size of roughly 230 GB to the Azure file share.</span></span>

![SAP HANA VM의 원본 디렉터리 구조가 복사된 Azure 파일 공유](media/sap-hana-backup-file-level/image040.png)

<span data-ttu-id="d0419-236">이 스크린샷에서는 SAP HANA VM의 원본 디렉터리 구조, 즉 1개 디렉터리(hana\_backup\_fsl\_15gb) 및 19개 개별 백업 파일이 Azure 파일 공유에 복사되었음을 알 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-236">In this screenshot, one can see that the source directory structure on the SAP HANA VM was copied to the Azure file share: one directory (hana\_backup\_fsl\_15gb) and 19 individual backup files.</span></span>

<span data-ttu-id="d0419-237">Azure파일에 SAP HANA 백업 파일을 저장할 때 SAP HANA 파일 백업에서 이를 직접 지원하는 경우 이 작업은 향후 흥미로운 옵션이 될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-237">Storing SAP HANA backup files on Azure files could be an interesting option in the future when SAP HANA file backups support it directly.</span></span> <span data-ttu-id="d0419-238">또는 NFS를 통해 Azure 파일을 탑재할 수 있는 경우 최대 할당량 제한이 5TB보다 훨씬 큽니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-238">Or when it becomes possible to mount Azure files via NFS and the maximum quota limit is considerably higher than 5 TB.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d0419-239">다음 단계</span><span class="sxs-lookup"><span data-stu-id="d0419-239">Next steps</span></span>
* <span data-ttu-id="d0419-240">[Azure Virtual Machines의 SAP HANA 백업 가이드](sap-hana-backup-guide.md) - 시작에 대한 개요 및 정보를 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-240">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="d0419-241">[저장소 스냅숏에 기반한 SAP HANA 백업](sap-hana-backup-storage-snapshots.md) - 저장소 스냅숏을 기반으로 하는 백업 옵션을 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-241">[SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describes the storage snapshot-based backup option.</span></span>
* <span data-ttu-id="d0419-242">[Azure의 SAP HANA(큰 인스턴스) 고가용성 및 재해 복구](hana-overview-high-availability-disaster-recovery.md) - Azure의 SAP HANA(큰 인스턴스)에 대한 고가용성 및 재해 복구 계획을 설정하는 방법을 알아봅니다.</span><span class="sxs-lookup"><span data-stu-id="d0419-242">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
