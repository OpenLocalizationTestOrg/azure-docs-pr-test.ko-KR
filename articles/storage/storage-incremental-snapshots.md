---
title: "관리되지 않는 Azure VM 디스크의 백업 및 복구에 대해 증분 스냅숏 사용 | Microsoft Docs"
description: "증분 스냅숏을 사용하여 Azure 가상 컴퓨터 디스크의 백업 및 복구에 대한 사용자 지정 솔루션을 만듭니다."
services: storage
documentationcenter: na
author: aungoo-msft
manager: tadb
editor: tysonn
ms.assetid: 3524b987-bd65-4e35-83e7-fbc2136643e5
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/23/2017
ms.author: aungoo
ms.openlocfilehash: 7b08ce207b2a3cc2dd3d3559765def6af42a844a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 07/11/2017
---
# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="be549-103">증분 스냅숏을 사용하여 Azure 관리되지 않는 VM 디스크 백업</span><span class="sxs-lookup"><span data-stu-id="be549-103">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="be549-104">개요</span><span class="sxs-lookup"><span data-stu-id="be549-104">Overview</span></span>
<span data-ttu-id="be549-105">Azure 저장소는 Blob의 스냅숏을 만드는 기능을 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-105">Azure Storage provides the capability to take snapshots of blobs.</span></span> <span data-ttu-id="be549-106">스냅숏은 해당 시점에 Blob 상태를 캡처합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-106">Snapshots capture the blob state at that point in time.</span></span> <span data-ttu-id="be549-107">이 문서에서는 스냅숏을 사용하여 가상 컴퓨터 디스크의 백업을 유지 관리할 수 있는 방법의 시나리오에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-107">In this article, we will describe a scenario of how you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="be549-108">Azure 백업 및 복구 서비스를 사용하지 않도록 선택하고 가상 컴퓨터 디스크에 대한 사용자 지정 백업 전략을 만들 때 이 방법론을 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-108">You can use this methodology when you choose not to use Azure Backup and Recovery Service, and wish to create a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="be549-109">Azure 가상 컴퓨터 디스크는 Azure 저장소에 페이지 Blob으로 저장됩니다.</span><span class="sxs-lookup"><span data-stu-id="be549-109">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="be549-110">이 문서에서는 가상 컴퓨터 디스크에 대한 백업 전략을 논의하고 있으므로 페이지 Blob의 컨텍스트에서 스냅숏을 참조합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-110">Since we are talking about backup strategy for virtual machine disks in this article, we will be referring to snapshots in the context of page blobs.</span></span> <span data-ttu-id="be549-111">스냅숏에 대한 자세한 내용은 [Blob의 스냅숏 만들기](https://msdn.microsoft.com/library/azure/hh488361.aspx)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="be549-111">To learn more about snapshots, refer to [Creating a Snapshot of a Blob](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="be549-112">스냅숏은 무엇입니까?</span><span class="sxs-lookup"><span data-stu-id="be549-112">What is a snapshot?</span></span>
<span data-ttu-id="be549-113">Blob 스냅숏은 특정 시점에 캡처된 Blob의 읽기 전용 버전입니다.</span><span class="sxs-lookup"><span data-stu-id="be549-113">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="be549-114">스냅숏이 생성된 후에는 읽거나 복사하거나 삭제할 수 있지만 수정할 수는 없습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-114">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="be549-115">스냅숏을 사용하면 특정 시점에서 표시된 대로 Blob을 백업할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-115">Snapshots provide a way to back up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="be549-116">REST 버전 2015-04-05까지 전체 스냅숏을 복사하는 기능이 있었습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-116">Until REST version 2015-04-05 you had the ability to copy full snapshots.</span></span> <span data-ttu-id="be549-117">REST 버전 2015-07-08 이상에서는 증분 스냅숏을 복사할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-117">With the REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="be549-118">전체 스냅숏 복사</span><span class="sxs-lookup"><span data-stu-id="be549-118">Full snapshot copy</span></span>
<span data-ttu-id="be549-119">스냅숏은 기본 Blob의 백업을 유지하도록 Blob으로 다른 저장소 계정에 복사될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-119">Snapshots can be copied to another storage account as a blob to keep backups of the base blob.</span></span> <span data-ttu-id="be549-120">또한 Blob을 이전 버전으로 복원하는 것과 같은 해당 기본 Blob에 대해 스냅숏을 복사할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-120">You can also copy a snapshot over its base blob, which is like restoring the blob to an earlier version.</span></span> <span data-ttu-id="be549-121">스냅숏이 하나의 저장소 계정에서 다른 저장소 계정으로 복사되면 기본 페이지 Blob과 동일한 공간을 차지합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-121">When a snapshot is copied from one storage account to another, it will occupy the same space as the base page blob.</span></span> <span data-ttu-id="be549-122">따라서 하나의 저장소 계정에서 다른 저장소 계정으로 전체 스냅숏 복사는 느려지고 대상 저장소 계정에서 많은 공간을 사용하게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="be549-122">Therefore, copying whole snapshots from one storage account to another will be slow and will also consume lot of space in the target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="be549-123">기본 Blob을 다른 대상으로 복사하는 경우 Blob의 스냅숏은 함께 복사되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-123">If you copy the base blob to another destination, the snapshots of the blob are not copied along with it.</span></span> <span data-ttu-id="be549-124">마찬가지로 복사본으로 기본 Blob을 덮어쓴 경우 기본 Blob와 연결된 스냅숏은 영향을 받지 않고 기본 Blob 이름으로 그대로 유지됩니다.</span><span class="sxs-lookup"><span data-stu-id="be549-124">Similarly, if you overwrite a base blob with a copy, snapshots associated with the base blob are not affected and stay intact under base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="be549-125">스냅숏을 사용하여 디스크 백업</span><span class="sxs-lookup"><span data-stu-id="be549-125">Back up disks using snapshots</span></span>
<span data-ttu-id="be549-126">가상 컴퓨터 디스크에 대한 백업 전략으로 디스크 또는 페이지 Blob의 스냅숏을 주기적으로 작성할 수 있으며 [Blob 복사](https://msdn.microsoft.com/library/azure/dd894037.aspx) 작업 또는 [AzCopy](storage-use-azcopy.md)와 같은 도구를 사용하여 스냅숏을 다른 저장소 계정에 복사할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-126">As a backup strategy for your virtual machine disks, you can take periodic snapshots of the disk or page blob, and copy them to another storage account using tools like [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) operation or [AzCopy](storage-use-azcopy.md).</span></span> <span data-ttu-id="be549-127">스냅숏을 다른 이름으로 대상 페이지 Blob에 복사할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-127">You can copy a snapshot to a destination page blob with a different name.</span></span> <span data-ttu-id="be549-128">그러면 생성되는 대상 페이지 Blob은 스냅숏이 아닌 쓰기 가능한 페이지 Blob입니다.</span><span class="sxs-lookup"><span data-stu-id="be549-128">The resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="be549-129">이 문서 뒷부분에서는 스냅숏을 사용하여 가상 컴퓨터 디스크를 백업하는 단계에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-129">Later in this article we will describe steps to take backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="be549-130">스냅숏을 사용하여 디스크 복원</span><span class="sxs-lookup"><span data-stu-id="be549-130">Restore disks using snapshots</span></span>
<span data-ttu-id="be549-131">디스크를 백업 스냅숏 중 하나에서 캡처된 이전 안정적인 버전으로 복원할 때 기본 페이지 Blob에 대해 스냅숏을 복사할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-131">When it is time to restore your disk to a previous stable version captured in one of the backup snapshots, you can copy a snapshot over the base page blob.</span></span> <span data-ttu-id="be549-132">스냅숏이 기본 페이지 Blob으로 올라간 후 스냅숏은 유지되지만 읽고 쓰기가 가능한 복사본으로 해당 원본을 덮어쓰게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="be549-132">After the snapshot is promoted to the base page blob, the snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="be549-133">이 문서의 뒷부분에서는 해당 스냅숏에서 디스크의 이전 버전을 복원하는 단계에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-133">Later in this article we will describe steps to restore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="be549-134">전체 스냅숏 복사 구현</span><span class="sxs-lookup"><span data-stu-id="be549-134">Implementing full snapshot copy</span></span>
<span data-ttu-id="be549-135">다음을 수행하여 전체 스냅숏 복사를 구현할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-135">You can implement a full snapshot copy by doing the following,</span></span>

* <span data-ttu-id="be549-136">먼저 [Blob 스냅숏](https://msdn.microsoft.com/library/azure/ee691971.aspx) 작업을 사용하여 기본 Blob의 스냅숏을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="be549-136">First, take a snapshot of the base blob using the [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) operation.</span></span>
* <span data-ttu-id="be549-137">그런 다음 [Blob 복사](https://msdn.microsoft.com/library/azure/dd894037.aspx)를 사용하여 스냅숏을 대상 저장소 계정에 복사합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-137">Then, copy the snapshot to a target storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span>
* <span data-ttu-id="be549-138">기본 Blob의 백업 복사본을 유지하려면 이 프로세스를 반복합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-138">Repeat this process to maintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="be549-139">증분 스냅숏 복사</span><span class="sxs-lookup"><span data-stu-id="be549-139">Incremental snapshot copy</span></span>
<span data-ttu-id="be549-140">[GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) API의 새로운 기능은 페이지 Blob 또는 디스크의 스냅숏을 백업하는 더 좋은 방법을 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-140">The new feature in [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) API provides a much better way to back up the snapshots of your page blobs or disks.</span></span> <span data-ttu-id="be549-141">API는 기본 Blob과 스냅숏 간의 변경 사항의 목록을 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-141">The API returns the list of changes between the base blob and the snapshots.</span></span> <span data-ttu-id="be549-142">이는 백업 계정에 사용되는 저장소 공간의 양을 줄입니다.</span><span class="sxs-lookup"><span data-stu-id="be549-142">This reduces the amount of storage space used on the backup account.</span></span> <span data-ttu-id="be549-143">API는 프리미엄 저장소 뿐만 아니라 표준 저장소에 페이지 Blob을 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-143">The API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="be549-144">이 API를 사용하여 이제 Azure VM에 대한 빠르고 효율적인 백업 솔루션을 빌드할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-144">Using this API, you can now build faster and efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="be549-145">REST 버전 2015-07-08 이상에서 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-145">This will be available with the REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="be549-146">증분 스냅숏 복사를 통해 다음 간의 차이를 하나의 저장소 계정에서 다른 저장소 계정으로 복사할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-146">Incremental Snapshot Copy allows you to copy from one storage account to another the difference between,</span></span>

* <span data-ttu-id="be549-147">기본 Blob과 해당 스냅숏 또는</span><span class="sxs-lookup"><span data-stu-id="be549-147">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="be549-148">기본 Blob의 두 스냅숏 모두</span><span class="sxs-lookup"><span data-stu-id="be549-148">Any two snapshots of the base blob</span></span>

<span data-ttu-id="be549-149">다음과 같은 조건이 충족된 경우</span><span class="sxs-lookup"><span data-stu-id="be549-149">Provided the following conditions are met,</span></span>

* <span data-ttu-id="be549-150">2016년 1월 1일 또는 그 이후에 Blob을 만든 경우</span><span class="sxs-lookup"><span data-stu-id="be549-150">The blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="be549-151">[PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) 또는 [Blob 복사](https://msdn.microsoft.com/library/azure/dd894037.aspx)를 사용하여 두 스냅숏 간에 Blob을 덮어쓰지 않은 경우</span><span class="sxs-lookup"><span data-stu-id="be549-151">The blob was not overwritten with [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) or [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) between two snapshots.</span></span>

<span data-ttu-id="be549-152">**참고**: 이 기능은 프리미엄 및 표준 Azure 페이지 Blob에 대해 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-152">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="be549-153">스냅숏을 사용하는 사용자 지정 백업 전략이 있는 경우 하나의 저장소 계정에서 다른 저장소 계정으로 스냅숏 복사가 매우 느려질 수 있고 저장소 공간을 많이 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-153">When you have a custom backup strategy that uses snapshots, copying the snapshots from one storage account to another can be very slow and consumes a lot of storage space.</span></span> <span data-ttu-id="be549-154">전체 스냅숏을 백업 저장소 계정에 복사하는 대신 백업 페이지 Blob에 연속 스냅숏 간의 차이를 기록할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-154">Instead of copying the entire snapshot to a backup storage account, you can write the difference between consecutive snapshots to a backup page blob.</span></span> <span data-ttu-id="be549-155">이러한 방식으로 복사하는 시간 및 백업을 저장하는 공간이 상당히 줄어듭니다.</span><span class="sxs-lookup"><span data-stu-id="be549-155">This way, the time to copy and space to store backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="be549-156">증분 스냅숏 복사 구현</span><span class="sxs-lookup"><span data-stu-id="be549-156">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="be549-157">다음을 수행하여 증분 스냅숏 복사를 구현할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-157">You can implement incremental snapshot copy by doing the following,</span></span>

* <span data-ttu-id="be549-158">[Blob 스냅숏](https://msdn.microsoft.com/library/azure/ee691971.aspx)을 사용하여 기본 Blob의 스냅숏을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="be549-158">Take a snapshot of the base blob using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx).</span></span>
* <span data-ttu-id="be549-159">[Blob 복사](https://msdn.microsoft.com/library/azure/dd894037.aspx)를 사용하여 스냅숏을 대상 백업 저장소 계정에 복사합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-159">Copy the snapshot to the target backup storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span> <span data-ttu-id="be549-160">이것이 백업 페이지 Blob이 됩니다.</span><span class="sxs-lookup"><span data-stu-id="be549-160">This will be the backup page blob.</span></span> <span data-ttu-id="be549-161">이 백업 페이지 Blob의 스냅숏을 만들고 백업 계정에 저장합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-161">Take a snapshot of this backup page blob and store in backup account.</span></span>
* <span data-ttu-id="be549-162">Blob 스냅숏을 사용하여 기본 Blob의 또 다른 스냅숏을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="be549-162">Take another snapshot of the base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="be549-163">[GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx)를 사용하여 기본 Blob의 첫 번째 스냅숏과 두 번째 스냅숏 간의 차이를 가져옵니다.</span><span class="sxs-lookup"><span data-stu-id="be549-163">Get the difference between first and second snapshots of base blob using  [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx).</span></span> <span data-ttu-id="be549-164">새 매개 변수 **prevsnapshot** 을 사용하여 차이를 가져오려는 스냅숏의 날짜/시간 값을 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-164">Use the new parameter **prevsnapshot** to specify the DateTime value of the snapshot you want to get the difference with.</span></span> <span data-ttu-id="be549-165">이 매개 변수가 존재하는 경우 REST 응답에는 페이지 지우기를 포함하여 대상 스냅숏과 이전 스냅숏 간의 변경된 페이지만 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="be549-165">When this parameter is present, the REST response will include only the pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="be549-166">[PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) 를 사용하여 이러한 변경 내용을 백업 페이지 Blob에 적용합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-166">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) to apply these changes to the backup page blob.</span></span>
* <span data-ttu-id="be549-167">마지막으로, 백업 페이지 Blob의 스냅숏을 만들고 백업 저장소 계정에 저장합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-167">Finally, take a snapshot of the backup page blob and store it in the backup storage account.</span></span>

<span data-ttu-id="be549-168">다음 섹션에서는 증분 스냅숏 복사를 사용하여 디스크의 백업을 유지 관리할 수 있는 방법을 보다 자세히 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-168">In the next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="be549-169">시나리오</span><span class="sxs-lookup"><span data-stu-id="be549-169">Scenario</span></span>
<span data-ttu-id="be549-170">이 섹션에서는 스냅숏을 사용하여 가상 컴퓨터 디스크에 대한 사용자 지정 백업 전략을 포함하는 시나리오에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-170">In this section we will describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="be549-171">프리미엄 저장소 P30 디스크가 연결된 DS 시리즈 Azure VM을 고려합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-171">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="be549-172">*mypremiumdisk*라는 P30 디스크는 *mypremiumaccount*라는 프리미엄 저장소 계정에 저장됩니다.</span><span class="sxs-lookup"><span data-stu-id="be549-172">The P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="be549-173">*mybackupstdaccount*라는 표준 저장소 계정은 *mypremiumdisk*의 백업을 저장하는 데 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="be549-173">A standard storage account called *mybackupstdaccount* will be used for storing the backup of *mypremiumdisk*.</span></span> <span data-ttu-id="be549-174">12시간마다 *mypremiumdisk* 의 스냅숏을 유지하려고 합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-174">We would like to keep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="be549-175">저장소 계정 및 디스크 만들기에 대해 알아보려면 [Azure 저장소 계정 정보](storage-create-storage-account.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="be549-175">To learn about creating storage account and disks, refer to [About Azure storage accounts](storage-create-storage-account.md).</span></span>

<span data-ttu-id="be549-176">Azure VM 백업에 대해 알아보려면 [Azure VM 백업 계획](../backup/backup-azure-vms-introduction.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="be549-176">To learn about backing up Azure VMs, refer to [Plan Azure VM backups](../backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-to-maintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="be549-177">증분 스냅숏을 사용하여 디스크의 백업을 유지 관리하는 단계</span><span class="sxs-lookup"><span data-stu-id="be549-177">Steps to maintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="be549-178">아래에 설명된 단계는 *mypremiumdisk*의 스냅숏을 만들고 *mybackupstdaccount*에서 백업을 유지 관리합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-178">The steps described below will take snapshots of *mypremiumdisk* and maintain the backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="be549-179">이 백업이 *mybackupstdpageblob*이라는 표준 페이지 Blob이 됩니다.</span><span class="sxs-lookup"><span data-stu-id="be549-179">The backup will be a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="be549-180">백업 페이지 Blob은 항상 *mypremiumdisk*의 마지막 스냅숏과 동일한 상태를 반영합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-180">The backup page blob will always reflect the same state as the last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="be549-181">먼저, 프리미엄 저장소 디스크에 대한 백업 페이지 Blob을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="be549-181">First, create the backup page blob for your premium storage disk.</span></span> <span data-ttu-id="be549-182">이렇게 하려면 *mypremiumdisk_ss1*이라는 *mypremiumdisk*의 스냅숏을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="be549-182">To do this, take a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="be549-183">이 스냅숏을 mybackupstdaccount에 *mybackupstdpageblob*이라는 페이지 Blob으로 복사합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-183">Copy this snapshot to mybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="be549-184">[스냅숏 Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx)을 사용하여 *mybackupstdpageblob_ss1*이라는 *mybackupstdpageblob*의 스냅숏을 만들고 *mybackupstdaccount*에 저장합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-184">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="be549-185">백업 창에 있는 동안 *mypremiumdisk_ss2*라는 *mypremiumdisk*의 또 다른 스냅숏을 만들고 *mypremiumaccount*에 저장합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-185">During the backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="be549-186">**prevsnapshot** 매개 변수가 *mypremiumdisk_ss1*의 타임스탬프로 설정된 *mypremiumdisk_ss2*의 [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx)를 사용하여 두 스냅숏 *mypremiumdisk_ss2*와 *mypremiumdisk_ss1* 간의 증분 변경 내용을 가져옵니다.</span><span class="sxs-lookup"><span data-stu-id="be549-186">Get the incremental changes between the two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) on *mypremiumdisk_ss2* with **prevsnapshot** parameter set to the timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="be549-187">이러한 증분 변경 내용을 *mybackupstdaccount*의 백업 페이지 Blob *mybackupstdpageblob*에 작성합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-187">Write these incremental changes to the backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="be549-188">증분 변경 내용에 삭제된 범위가 있는 경우 백업 페이지 Blob에서 지워야 합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-188">If there are deleted ranges in the incremental changes, they must be cleared from the backup page blob.</span></span> <span data-ttu-id="be549-189">[PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) 를 사용하여 증분 변경 내용을 백업 페이지 Blob에 작성합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-189">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) to write incremental changes to the backup page blob.</span></span>
6. <span data-ttu-id="be549-190">*mybackupstdpageblob_ss2*라는 백업 페이지 Blob *mybackupstdpageblob*의 스냅숏을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="be549-190">Take a snapshot of the backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="be549-191">프리미엄 저장소 계정에서 이전 스냅숏 *mypremiumdisk_ss1*을 삭제합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-191">Delete the previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="be549-192">백업 창마다 4~6단계를 반복합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-192">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="be549-193">이러한 방식으로 표준 저장소 계정에서 *mypremiumdisk* 의 백업을 유지할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="be549-193">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![증분 스냅숏을 사용하여 디스크 백업](./media/storage-incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-to-restore-a-disk-from-snapshots"></a><span data-ttu-id="be549-195">스냅숏에서 디스크를 복원하는 단계</span><span class="sxs-lookup"><span data-stu-id="be549-195">Steps to restore a disk from snapshots</span></span>
<span data-ttu-id="be549-196">아래에 설명된 단계는 프리미엄 디스크, *mypremiumdisk*를 백업 저장소 계정 *mybackupstdaccount*에서 이전 스냅숏으로 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-196">The steps described below will restore premium disk, *mypremiumdisk* to an earlier snapshot from the backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="be549-197">프리미엄 디스크를 복원하려는 시점을 식별합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-197">Identify the point in time you wish to restore the premium disk to.</span></span> <span data-ttu-id="be549-198">백업 저장소 계정 *mybackupstdaccount*에 저장되는 스냅숏 *mybackupstdpageblob_ss2*라고 가정해 봅니다.</span><span class="sxs-lookup"><span data-stu-id="be549-198">Let's say that is snapshot *mybackupstdpageblob_ss2*, which is stored in the backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="be549-199">mybackupstdaccount에서 새 백업 기본 페이지 Blob *mybackupstdpageblobrestored*로 스냅숏 *mybackupstdpageblob_ss2*를 승격합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-199">In mybackupstdaccount, promote the snapshot *mybackupstdpageblob_ss2* as the new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="be549-200">*mybackupstdpageblobrestored_ss1*이라는 이 복원된 백업 페이지 Blob의 스냅숏을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="be549-200">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="be549-201">새로운 프리미엄 디스크 *mypremiumdiskrestored*로 복원된 페이지 Blob *mybackupstdpageblobrestored*를 *mybackupstdaccount*에서 *mypremiumaccount*로 복사합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-201">Copy the restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* to *mypremiumaccount* as the new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="be549-202">향후 증분 백업을 만들기 위해 *mypremiumdiskrestored_ss1*이라는 *mypremiumdiskrestored*의 스냅숏을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="be549-202">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="be549-203">DS 시리즈 VM을 복원된 디스크 *mypremiumdiskrestored*로 가리키고 VM에서 이전 *mypremiumdisk*를 분리합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-203">Point the DS series VM to the restored disk *mypremiumdiskrestored* and detach the old *mypremiumdisk* from the VM.</span></span>
7. <span data-ttu-id="be549-204">백업 페이지 Blob으로 *mybackupstdpageblobrestored*를 사용하여 복원된 디스크 *mypremiumdiskrestored*에 대해 이전 섹션에서 설명한 백업 프로세스를 시작합니다.</span><span class="sxs-lookup"><span data-stu-id="be549-204">Begin the Backup process described in previous section for the restored disk *mypremiumdiskrestored*, using the *mybackupstdpageblobrestored* as the backup page blob.</span></span>

![스냅숏에서 디스크 복원](./media/storage-incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="be549-206">다음 단계</span><span class="sxs-lookup"><span data-stu-id="be549-206">Next Steps</span></span>
<span data-ttu-id="be549-207">Blob의 스냅숏을 만들고 아래와 같은 링크를 사용하여 VM 백업 인프라를 계획하는 방법을 알아봅니다.</span><span class="sxs-lookup"><span data-stu-id="be549-207">Learn more about creating snapshots of a blob and planning your VM backup infrastructure using the links below.</span></span>

* [<span data-ttu-id="be549-208">Blob의 스냅숏 만들기</span><span class="sxs-lookup"><span data-stu-id="be549-208">Creating a Snapshot of a Blob</span></span>](https://msdn.microsoft.com/library/azure/hh488361.aspx)
* [<span data-ttu-id="be549-209">VM 백업 인프라 계획</span><span class="sxs-lookup"><span data-stu-id="be549-209">Plan your VM Backup Infrastructure</span></span>](../backup/backup-azure-vms-introduction.md)

