---
title: "자동 크기 조정에 대한 모범 사례 | Microsoft Docs"
description: "Azure에서 웹앱, 가상 컴퓨터 확장 집합 및 Cloud Services에 대한 자동 크기 조정 패턴"
author: anirudhcavale
manager: orenr
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: 9fa2b94b-dfa5-4106-96ff-74fd1fba4657
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/07/2017
ms.author: ancav
ms.openlocfilehash: 54dad831287376db7fb2dc46e4591be1499dc072
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/03/2017
---
# <a name="best-practices-for-autoscale"></a><span data-ttu-id="099ee-103">자동 크기 조정에 대한 모범 사례</span><span class="sxs-lookup"><span data-stu-id="099ee-103">Best practices for Autoscale</span></span>
<span data-ttu-id="099ee-104">이 문서에서는 Azure에서 자동으로 크기를 조정하기 위한 모범 사례를 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-104">This article teaches best practices to autoscale in Azure.</span></span> <span data-ttu-id="099ee-105">Azure Monitor 자동 크기 조정은 [가상 컴퓨터 확장 집합](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Cloud Services](https://azure.microsoft.com/services/cloud-services/) 및 [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/)에만 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-105">Azure Monitor autoscale applies only to [Virtual Machine Scale Sets](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Cloud Services](https://azure.microsoft.com/services/cloud-services/), and [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/).</span></span> <span data-ttu-id="099ee-106">다른 Azure 서비스에는 다른 크기 조정 방법이 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-106">Other Azure services use different scaling methods.</span></span>

## <a name="autoscale-concepts"></a><span data-ttu-id="099ee-107">자동 크기 조정 개념</span><span class="sxs-lookup"><span data-stu-id="099ee-107">Autoscale concepts</span></span>
* <span data-ttu-id="099ee-108">하나의 리소스에는 *하나의* 자동 크기 조정 설정만 있을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-108">A resource can have only *one* autoscale setting</span></span>
* <span data-ttu-id="099ee-109">자동 크기 조정 설정에는 하나 이상의 프로필이 있을 수 있으며, 각 프로필에는 하나 이상의 자동 크기 조정 규칙이 있을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-109">An autoscale setting can have one or more profiles and each profile can have one or more autoscale rules.</span></span>
* <span data-ttu-id="099ee-110">자동 크기 조정 설정은 인스턴스 크기를 수평적으로 조정합니다. 즉, 인스턴스를 늘려 *규모를 확장*하고 인스턴스 수를 줄여 *규모를 감축*합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-110">An autoscale setting scales instances horizontally, which is *out* by increasing the instances and *in* by decreasing the number of instances.</span></span>
  <span data-ttu-id="099ee-111">자동 크기 조정 설정에는 최대, 최소 및 기본 인스턴스 값이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-111">An autoscale setting has a maximum, minimum, and default value of instances.</span></span>
* <span data-ttu-id="099ee-112">자동 크기 조정 작업에서는 항상 규모 확장 또는 규모 감축에 대해 구성된 임계값에 도달했는지 확인하여 크기를 조정할 연관된 메트릭을 읽습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-112">An autoscale job always reads the associated metric to scale by, checking if it has crossed the configured threshold for scale-out or scale-in.</span></span> <span data-ttu-id="099ee-113">[Azure Monitor 자동 크기 조정 공통 메트릭](insights-autoscale-common-metrics.md)에서 자동 크기 조정을 통해 크기를 조정할 수 있는 메트릭 목록을 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-113">You can view a list of metrics that autoscale can scale by at [Azure Monitor autoscaling common metrics](insights-autoscale-common-metrics.md).</span></span>
* <span data-ttu-id="099ee-114">모든 임계값은 인스턴스 수준에서 계산됩니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-114">All thresholds are calculated at an instance level.</span></span> <span data-ttu-id="099ee-115">예를 들어 "인스턴스 수가 2일 때 평균 CPU가 80%를 초과하면 1인스턴스만큼 규모 확장"은 모든 인스턴스에서 평균 CPU가 80%보다 높은 경우에 규모를 확장함을 의미합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-115">For example, "scale out by 1 instance when average CPU > 80% when instance count is 2", means scale-out when the average CPU across all instances is greater than 80%.</span></span>
* <span data-ttu-id="099ee-116">항상 메일을 통해 오류 알림이 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-116">You always receive failure notifications via email.</span></span> <span data-ttu-id="099ee-117">특히, 대상 리소스의 소유자, 참가자 및 읽기 권한자에게 메일이 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-117">Specifically, the owner, contributor, and readers of the target resource receive email.</span></span> <span data-ttu-id="099ee-118">또한 자동 크기 조정이 오류에서 복구하여 정상적으로 작동하기 시작하면 항상 *복구* 메일이 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-118">You also always receive a *recovery* email when autoscale recovers from a failure and starts functioning normally.</span></span>
* <span data-ttu-id="099ee-119">성공적인 크기 조정 작업 알림을 메일과 webhook를 통해 받도록 옵트인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-119">You can opt-in to receive a successful scale action notification via email and webhooks.</span></span>

## <a name="autoscale-best-practices"></a><span data-ttu-id="099ee-120">자동 크기 조정 모범 사례</span><span class="sxs-lookup"><span data-stu-id="099ee-120">Autoscale best practices</span></span>
<span data-ttu-id="099ee-121">자동 크기 조정을 사용할 때 다음 모범 사례를 따르세요.</span><span class="sxs-lookup"><span data-stu-id="099ee-121">Use the following best practices as you use autoscale.</span></span>

### <a name="ensure-the-maximum-and-minimum-values-are-different-and-have-an-adequate-margin-between-them"></a><span data-ttu-id="099ee-122">최대값과 최소값이 다르고 둘 사이의 간격이 적당한지 확인</span><span class="sxs-lookup"><span data-stu-id="099ee-122">Ensure the maximum and minimum values are different and have an adequate margin between them</span></span>
<span data-ttu-id="099ee-123">최소값=2, 최대값=2 및 현재 인스턴스 수가 2인 설정이 있는 경우에는 발생할 수 있는 크기 조정 동작이 없습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-123">If you have a setting that has minimum=2, maximum=2 and the current instance count is 2, no scale action can occur.</span></span> <span data-ttu-id="099ee-124">최대 인스턴스 수와 최소 인스턴스 수 간에 적당한 간격을 유지하세요(두 숫자 모두 포함).</span><span class="sxs-lookup"><span data-stu-id="099ee-124">Keep an adequate margin between the maximum and minimum instance counts, which are inclusive.</span></span> <span data-ttu-id="099ee-125">자동 크기 조정은 항상 이러한 한도 사이에서 크기를 조정합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-125">Autoscale always scales between these limits.</span></span>

### <a name="manual-scaling-is-reset-by-autoscale-min-and-max"></a><span data-ttu-id="099ee-126">수동 크기 조정이 자동 크기 조정 최소값 및 최대값으로 다시 설정됨</span><span class="sxs-lookup"><span data-stu-id="099ee-126">Manual scaling is reset by autoscale min and max</span></span>
<span data-ttu-id="099ee-127">인스턴스 수를 최대값 위 또는 아래 값으로 수동으로 업데이트하면 자동 크기 조정 엔진이 최소값(아래인 경우) 또는 최대값(위인 경우)으로 다시 자동으로 크기를 조정합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-127">If you manually update the instance count to a value above or below the maximum, the autoscale engine automatically scales back to the minimum (if below) or the maximum (if above).</span></span> <span data-ttu-id="099ee-128">예를 들어 3 및 6 사이의 범위를 설정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-128">For example, you set the range between 3 and 6.</span></span> <span data-ttu-id="099ee-129">실행 중인 인스턴스가 하나 있는 경우 자동 크기 조정 엔진은 다음 실행 시 3개 인스턴스로 확장합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-129">If you have one running instance, the autoscale engine scales to 3 instances on its next run.</span></span> <span data-ttu-id="099ee-130">마찬가지로, 다음 실행에서는 8개의 인스턴스에서 6개로 규모 감축합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-130">Likewise, it would scale-in 8 instances back to 6 on its next run.</span></span>  <span data-ttu-id="099ee-131">수동 크기 조정은 자동 크기 조정 규칙을 재설정하지 않은 경우 극히 임시적입니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-131">Manual scaling is very temporary unless you reset the autoscale rules as well.</span></span>

### <a name="always-use-a-scale-out-and-scale-in-rule-combination-that-performs-an-increase-and-decrease"></a><span data-ttu-id="099ee-132">항상 증가 및 감소를 수행하는 규모 확장 및 감축 규칙 조합 사용</span><span class="sxs-lookup"><span data-stu-id="099ee-132">Always use a scale-out and scale-in rule combination that performs an increase and decrease</span></span>
<span data-ttu-id="099ee-133">이 조합의 한 부분만 사용하는 경우에는 자동 크기 조정에서 최대값 또는 최소값에 도달할 때까지 해당 부분만 규모를 확장하거나 감축합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-133">If you use only one part of the combination, autoscale scale-in that single out, or in, until the maximum, or minimum, is reached.</span></span>

### <a name="do-not-switch-between-the-azure-portal-and-the-azure-classic-portal-when-managing-autoscale"></a><span data-ttu-id="099ee-134">자동 크기 조정을 관리할 때 Azure 포털 및 Azure 클래식 포털 간에 전환 금지</span><span class="sxs-lookup"><span data-stu-id="099ee-134">Do not switch between the Azure portal and the Azure classic portal when managing Autoscale</span></span>
<span data-ttu-id="099ee-135">Cloud Services 및 App Services(Web Apps)의 경우 Azure 포털(portal.azure.com)을 사용하여 자동 크기 조정 설정을 만들고 관리합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-135">For Cloud Services and App Services (Web Apps), use the Azure portal (portal.azure.com) to create and manage autoscale settings.</span></span> <span data-ttu-id="099ee-136">가상 컴퓨터 확장 집합의 경우 PowerShellH, CLI 또는 REST API를 사용하여 자동 크기 조정 설정을 만들고 관리합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-136">For Virtual Machine Scale Sets use PowerShell, CLI or REST API to create and manage autoscale setting.</span></span> <span data-ttu-id="099ee-137">자동 크기 조정 구성을 관리할 때 Azure 클래식 포털(manage.windowsazure.com)과 Azure 포털(portal.azure.com) 간에 전환 금지</span><span class="sxs-lookup"><span data-stu-id="099ee-137">Do not switch between the Azure classic portal (manage.windowsazure.com) and the Azure portal (portal.azure.com) when managing autoscale configurations.</span></span> <span data-ttu-id="099ee-138">Azure 클래식 포털과 해당 기본 백 엔드에는 제한이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-138">The Azure classic portal and its underlying backend has limitations.</span></span> <span data-ttu-id="099ee-139">그래픽 사용자 인터페이스를 사용하여 자동 크기 조정을 관리하려면 Azure 포털로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-139">Move to the Azure portal to manage autoscale using a graphical user interface.</span></span> <span data-ttu-id="099ee-140">Azure 리소스 탐색기를 통해 자동 크기 조정 PowerShell, CLI 또는 REST API를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-140">The options are to use the autoscale PowerShell, CLI or REST API (via Azure Resource Explorer).</span></span>

### <a name="choose-the-appropriate-statistic-for-your-diagnostics-metric"></a><span data-ttu-id="099ee-141">진단 메트릭에 적절한 통계 선택</span><span class="sxs-lookup"><span data-stu-id="099ee-141">Choose the appropriate statistic for your diagnostics metric</span></span>
<span data-ttu-id="099ee-142">진단 메트릭의 경우 크기를 조정할 메트릭으로 *평균*, *최소*, *최대* 및 *합계* 중에서 선택할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-142">For diagnostics metrics, you can choose among *Average*, *Minimum*, *Maximum* and *Total* as a metric to scale by.</span></span> <span data-ttu-id="099ee-143">가장 일반적인 통계는 *평균*입니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-143">The most common statistic is *Average*.</span></span>

### <a name="choose-the-thresholds-carefully-for-all-metric-types"></a><span data-ttu-id="099ee-144">모든 메트릭 유형에 대해 신중하게 임계값 선택</span><span class="sxs-lookup"><span data-stu-id="099ee-144">Choose the thresholds carefully for all metric types</span></span>
<span data-ttu-id="099ee-145">현실적인 상황을 기반으로 서로 다른 규모 확장 및 규모 감축 임계값을 신중하게 선택하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-145">We recommend carefully choosing different thresholds for scale-out and scale-in based on practical situations.</span></span>

<span data-ttu-id="099ee-146">아래 예와 같이 확장 및 감축 조건에 동일하거나 매우 유사한 임계값을 사용하는 자동 크기 조정 설정은 *권장되지 않습니다* .</span><span class="sxs-lookup"><span data-stu-id="099ee-146">We *do not recommend* autoscale settings like the examples below with the same or very similar threshold values for out and in conditions:</span></span>

* <span data-ttu-id="099ee-147">스레드 수가 600 이하인 경우 인스턴스 수 1개 증가</span><span class="sxs-lookup"><span data-stu-id="099ee-147">Increase instances by 1 count when Thread Count <= 600</span></span>
* <span data-ttu-id="099ee-148">스레드 수가 600 이상인 경우 인스턴스 수 1개 감소</span><span class="sxs-lookup"><span data-stu-id="099ee-148">Decrease instances by 1 count when Thread Count >= 600</span></span>

<span data-ttu-id="099ee-149">혼동스러운 동작을 초래할 수 있는 예를 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-149">Let's look at an example of what can lead to a behavior that may seem confusing.</span></span> <span data-ttu-id="099ee-150">다음과 같은 시퀀스를 고려해 보세요.</span><span class="sxs-lookup"><span data-stu-id="099ee-150">Consider the following sequence.</span></span>

1. <span data-ttu-id="099ee-151">인스턴스 2개로 시작한 다음 인스턴스당 평균 스레드 수가 625로 증가했다고 가정해 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-151">Assume there are 2 instances to begin with and then the average number of threads per instance grows to 625.</span></span>
2. <span data-ttu-id="099ee-152">자동 크기 조정에서 세 번째 인스턴스를 추가하여 규모를 확장합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-152">Autoscale scales out adding a 3rd instance.</span></span>
3. <span data-ttu-id="099ee-153">다음으로, 인스턴스 전체의 평균 스레드 수가 575로 떨어졌다고 가정해 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-153">Next, assume that the average thread count across instance falls to 575.</span></span>
4. <span data-ttu-id="099ee-154">축소하기 전에 자동 크기 조정에서 감축된 경우의 최종 상태를 예측하려고 시도합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-154">Before scaling down, autoscale tries to estimate what the final state will be if it scaled in.</span></span> <span data-ttu-id="099ee-155">예를 들어 575x3(현재 인스턴스 수) = 1,725/2(축소된 경우의 최종 인스턴스 수) = 862.5스레드입니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-155">For example, 575 x  3 (current instance count) = 1,725 / 2 (final number of instances when scaled down) = 862.5 threads.</span></span> <span data-ttu-id="099ee-156">이는 평균 스레드 수가 동일하게 유지되거나 약간만 감소한 경우 자동 크기 조정에서 규모가 감축된 후 즉시 다시 확장해야 함을 의미합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-156">This means autoscale would have to immediately scale-out again even after it scaled in, if the average thread count remains the same or even falls only a small amount.</span></span> <span data-ttu-id="099ee-157">그러나 규모가 다시 확장된 경우 전체 프로세스가 반복되므로 무한 루프가 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-157">However, if it scaled up again, the whole process would repeat, leading to an infinite loop.</span></span>
5. <span data-ttu-id="099ee-158">이 "느슨한" 상황을 방지하기 위해 자동 크기 조정에서는 규모를 축소하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-158">To avoid this situation (termed "flapping"), autoscale does not scale down at all.</span></span> <span data-ttu-id="099ee-159">대신 건너뛰고 다음에 서비스의 작업이 실행될 때 조건을 다시 평가합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-159">Instead, it skips and reevaluates the condition again the next time the service's job executes.</span></span> <span data-ttu-id="099ee-160">이는 평균 스레드 수가 575일 때 자동 크기 조정이 작동하지 않는 것처럼 보이기 때문에 많은 사용자에게 혼동을 줄 수 있었습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-160">This could confuse many people because autoscale wouldn't appear to work when the average thread count was 575.</span></span>

<span data-ttu-id="099ee-161">규모 감축 동안의 예측은 확장 및 감축 작업이 지속적으로 발생하는 "플래핑" 상황을 방지하기 위한 것입니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-161">Estimation during a scale-in is intended to avoid "flapping" situations, where scale-in and scale-out actions continually go back and forth.</span></span> <span data-ttu-id="099ee-162">규모 확장 및 감축에 대해 동일한 임계값을 선택할 때 이 동작을 염두에 두어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-162">Keep this behavior in mind when you choose the same thresholds for scale-out and in.</span></span>

<span data-ttu-id="099ee-163">규모 확장 및 감축 임계값 사이에 적당한 간격을 선택하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-163">We recommend choosing an adequate margin between the scale-out and in thresholds.</span></span> <span data-ttu-id="099ee-164">예를 들어, 다음과 같은 더 나은 규칙 조합을 고려합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-164">As an example, consider the following better rule combination.</span></span>

* <span data-ttu-id="099ee-165">CPU%가 80 이상인 경우 인스턴스 수 1개 증가</span><span class="sxs-lookup"><span data-stu-id="099ee-165">Increase instances by 1 count when CPU%  >= 80</span></span>
* <span data-ttu-id="099ee-166">CPU%가 60 이하인 경우 인스턴스 수 1개 감소</span><span class="sxs-lookup"><span data-stu-id="099ee-166">Decrease instances by 1 count when CPU% <= 60</span></span>

<span data-ttu-id="099ee-167">이 경우</span><span class="sxs-lookup"><span data-stu-id="099ee-167">In this case</span></span>  

1. <span data-ttu-id="099ee-168">두 개의 인스턴스로 시작한다고 가정합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-168">Assume there are 2 instances to start with.</span></span>
2. <span data-ttu-id="099ee-169">인스턴스의 평균 CPU%가 80이 되면 자동 크기 조정에서 세 번째 인스턴스를 추가하여 규모를 확장합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-169">If the average CPU% across instances goes to 80, autoscale scales out adding a third instance.</span></span>
3. <span data-ttu-id="099ee-170">이제 시간이 지남에 따라 CPU%가 60으로 감소했다고 가정합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-170">Now assume that over time the CPU% falls to 60.</span></span>
4. <span data-ttu-id="099ee-171">자동 크기 조정의 규모 감축 규칙에서 규모가 감축된 경우의 최종 상태를 평가합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-171">Autoscale's scale-in rule estimates the final state if it were to scale-in.</span></span> <span data-ttu-id="099ee-172">예를 들어 60x3(현재 인스턴스 수) = 180/2(축소된 경우의 최종 인스턴스 수) = 90입니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-172">For example, 60 x 3 (current instance count) = 180 / 2 (final number of instances when scaled down) = 90.</span></span> <span data-ttu-id="099ee-173">따라서 자동 크기 조정에서는 즉시 다시 확장해야 하므로 규모를 감축하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-173">So autoscale does not scale-in because it would have to scale-out again immediately.</span></span> <span data-ttu-id="099ee-174">대신, 규모 축소를 건너뜁니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-174">Instead, it skips scaling down.</span></span>
5. <span data-ttu-id="099ee-175">다음 자동 크기 조정 확인 시 CPU는 계속해서 50으로 감소합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-175">The next time autoscale checks, the CPU continues to fall to 50.</span></span> <span data-ttu-id="099ee-176">다시 평가에서 50 x 3 인스턴스 = 150/2 인스턴스 = 75이며, 이는 규모 확장 임계값 80보다 낮으므로 인스턴스 2개로 성공적으로 감축합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-176">It estimates again -  50 x 3 instance = 150 / 2 instances = 75, which is below the scale-out threshold of 80, so it scales in successfully to 2 instances.</span></span>

### <a name="considerations-for-scaling-threshold-values-for-special-metrics"></a><span data-ttu-id="099ee-177">특정 메트릭의 임계값 조정에 대한 고려 사항</span><span class="sxs-lookup"><span data-stu-id="099ee-177">Considerations for scaling threshold values for special metrics</span></span>
 <span data-ttu-id="099ee-178">저장소 또는 서비스 버스 큐 길이 메트릭과 같은 특정 메트릭의 경우 임계값은 현재 인스턴스 수당 사용 가능한 평균 메시지 수입니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-178">For special metrics such as Storage or Service Bus Queue length metric, the threshold is the average number of messages available per current number of instances.</span></span> <span data-ttu-id="099ee-179">이 메트릭에 대한 임계값을 신중하게 선택해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-179">Carefully choose the choose the threshold value for this metric.</span></span>

<span data-ttu-id="099ee-180">동작을 보다 잘 이해할 수 있도록 예를 들어 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-180">Let's illustrate it with an example to ensure you understand the behavior better.</span></span>

* <span data-ttu-id="099ee-181">저장소 큐 메시지 수가 50개 이상인 경우 인스턴스 수 1개 증가</span><span class="sxs-lookup"><span data-stu-id="099ee-181">Increase instances by 1 count when Storage Queue message count >= 50</span></span>
* <span data-ttu-id="099ee-182">저장소 큐 메시지 수가 10개 이하인 경우 인스턴스 수 1개 감소</span><span class="sxs-lookup"><span data-stu-id="099ee-182">Decrease instances by 1 count when Storage Queue message count <= 10</span></span>

<span data-ttu-id="099ee-183">다음과 같은 시퀀스를 고려해 보세요.</span><span class="sxs-lookup"><span data-stu-id="099ee-183">Consider the following sequence:</span></span>

1. <span data-ttu-id="099ee-184">2개의 저장소 큐 인스턴스가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-184">There are 2 storage queue instances.</span></span>
2. <span data-ttu-id="099ee-185">메시지가 계속 들어오고 있으며 저장소 큐를 검토했을 때 총 개수가 50개입니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-185">Messages keep coming and when you review the storage queue, the total count reads 50.</span></span> <span data-ttu-id="099ee-186">자동 크기 조정에서 규모 확장 동작을 시작해야 한다고 생각할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-186">You might assume that autoscale should start a scale-out action.</span></span> <span data-ttu-id="099ee-187">그러나 인스턴스당 메시지 수는 여전히 50/2 = 25개입니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-187">However, note that it is still 50/2 = 25 messages per instance.</span></span> <span data-ttu-id="099ee-188">따라서 규모 확장이 발생하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-188">So, scale-out does not occur.</span></span> <span data-ttu-id="099ee-189">첫 번째 규모 확장이 발생하려면 저장소 큐의 총 메시지 수가 100개여야 합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-189">For the first scale-out to happen, the total message count in the storage queue should be 100.</span></span>
3. <span data-ttu-id="099ee-190">이번에는 총 메시지 수가 100개에 도달했다고 가정합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-190">Next, assume that the total message count reaches 100.</span></span>
4. <span data-ttu-id="099ee-191">규모 확장 동작으로 인해 세 번째 저장소 큐가 추가됩니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-191">A 3rd storage queue instance is added due to a scale-out action.</span></span>  <span data-ttu-id="099ee-192">150/3 = 50이므로 큐의 총 메시지 수가 150개에 도달할 때까지 다음 규모 확장 동작이 발생하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-192">The next scale-out action will not happen until the total message count in the queue reaches 150 because 150/3 = 50.</span></span>
5. <span data-ttu-id="099ee-193">이제 큐의 메시지 수가 작아집니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-193">Now the number of messages in the queue gets smaller.</span></span> <span data-ttu-id="099ee-194">세 개의 인스턴스가 있는 경우, 인스턴스당 메시지 수는 규모 감축 임계값인 30/3 = 10개이므로 첫 번째 규모 감축 동작은 모든 큐의 총 메시지 수가 30개에 도달한 경우에 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-194">With 3 instances, the first scale-in action happens when the total messages in all queues add up to 30 because 30/3 = 10 messages per instance, which is the scale-in threshold.</span></span>

### <a name="considerations-for-scaling-when-multiple-profiles-are-configured-in-an-autoscale-setting"></a><span data-ttu-id="099ee-195">자동 크기 조정 설정에 여러 프로필이 구성된 경우 크기 조정에 대한 고려 사항</span><span class="sxs-lookup"><span data-stu-id="099ee-195">Considerations for scaling when multiple profiles are configured in an autoscale setting</span></span>
<span data-ttu-id="099ee-196">자동 크기 조정 설정에서 일정이나 시간에 종속되지 않고 항상 적용되는 기본 프로필을 선택하거나, 날짜 및 시간 범위가 있는 고정된 기간의 프로필 또는 되풀이 프로필을 선택할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-196">In an autoscale setting, you can choose a default profile, which is always applied without any dependency on schedule or time, or you can choose a recurring profile or a profile for a fixed period with a date and time range.</span></span>

<span data-ttu-id="099ee-197">자동 크기 조정 서비스는 이를 처리할 때 항상 다음 순서대로 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-197">When autoscale service processes them, it always checks in the following order:</span></span>

1. <span data-ttu-id="099ee-198">고정된 날짜 프로필</span><span class="sxs-lookup"><span data-stu-id="099ee-198">Fixed Date profile</span></span>
2. <span data-ttu-id="099ee-199">되풀이 프로필</span><span class="sxs-lookup"><span data-stu-id="099ee-199">Recurring profile</span></span>
3. <span data-ttu-id="099ee-200">기본("항상") 프로필</span><span class="sxs-lookup"><span data-stu-id="099ee-200">Default ("Always") profile</span></span>

<span data-ttu-id="099ee-201">프로필 조건이 충족된 경우 자동 크기 조정은 그 아래의 다음 프로필 조건을 확인하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-201">If a profile condition is met, autoscale does not check the next profile condition below it.</span></span> <span data-ttu-id="099ee-202">자동 크기 조정에서는 한 번에 하나의 프로필만 처리합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-202">Autoscale only processes one profile at a time.</span></span> <span data-ttu-id="099ee-203">따라서 하위 계층 프로필의 처리 조건을 포함하려는 경우 이러한 규칙을 현재 프로필에도 포함해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-203">This means if you want to also include a processing condition from a lower-tier profile, you must include those rules as well in the current profile.</span></span>

<span data-ttu-id="099ee-204">예제를 사용하여 이를 검토해 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-204">Let's review this using an example:</span></span>

<span data-ttu-id="099ee-205">아래 그림에는 최소 인스턴스 = 2이고 최대 인스턴스 = 10인 기본 프로필의 자동 크기 조정 설정을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-205">The image below shows an autoscale setting with a default profile of minimum instances = 2 and maximum instances = 10.</span></span> <span data-ttu-id="099ee-206">이 예제에서는 큐의 메시지 수가 10보다 큰 경우 규모를 확장하고, 큐의 메시지 수가 3보다 작은 경우 규모를 감축하도록 규칙이 구성되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-206">In this example, rules are configured to scale-out when the message count in the queue is greater than 10 and scale-in when the message count in the queue is less than 3.</span></span> <span data-ttu-id="099ee-207">따라서 지금은 리소스의 크기를 2에서 10 사이로 조정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-207">So now the resource can scale between 2 and 10 instances.</span></span>

<span data-ttu-id="099ee-208">또한 월요일에 설정된 되풀이 프로필이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-208">In addition, there is a recurring profile set for Monday.</span></span> <span data-ttu-id="099ee-209">이는 최소 인스턴스 = 2, 최대 인스턴스 = 12에 대해 설정되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-209">It is set for minimum instances = 2 and maximum instances = 12.</span></span> <span data-ttu-id="099ee-210">따라서 월요일에는 자동 크기 조정에서 처음이 이 조건을 확인하여 인스턴스 수가 2인 경우 새 최소값 3으로 크기를 조정합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-210">This means on Monday, the first time autoscale checks for this condition, if the instance count is 2, it scales to the new minimum of 3.</span></span> <span data-ttu-id="099ee-211">자동 크기 조정에서 일치하는 이 프로필 조건을 계속 찾는 한 이 프로필에 대해 구성된 CPU 기반 규모 확장/감축 규칙만 처리합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-211">As long as autoscale continues to find this profile condition matched (Monday), it only processes the CPU-based scale-out/in rules configured for this profile.</span></span> <span data-ttu-id="099ee-212">이 경우 큐 길이를 확인하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-212">At this time, it does not check for the queue length.</span></span> <span data-ttu-id="099ee-213">그러나 큐 길이 조건도 확인하려는 경우 기본 프로필의 이러한 규칙을 월요일 프로필에도 포함해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-213">However, if you also want the queue length condition to be checked, you should include those rules from the default profile as well in your Monday profile.</span></span>

<span data-ttu-id="099ee-214">마찬가지로, 자동 크기 조정이 다시 기본 프로필로 전환하는 경우에는 먼저 최소값 및 최대값 조건이 충족되는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-214">Similarly, when autoscale switches back to the default profile, it first checks if the minimum and maximum conditions are met.</span></span> <span data-ttu-id="099ee-215">이때 인스턴스 수가 12인 경우 기본 프로필에 허용되는 최대값인 10으로 규모를 감축합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-215">If the number of instances at the time is 12, it scales in to 10, the maximum allowed for the default profile.</span></span>

![자동 크기 조정 설정](./media/insights-autoscale-best-practices/insights-autoscale-best-practices-2.png)

### <a name="considerations-for-scaling-when-multiple-rules-are-configured-in-a-profile"></a><span data-ttu-id="099ee-217">하나의 프로필에 여러 규칙이 구성된 경우 크기 조정에 대한 고려 사항</span><span class="sxs-lookup"><span data-stu-id="099ee-217">Considerations for scaling when multiple rules are configured in a profile</span></span>
<span data-ttu-id="099ee-218">하나의 프로필에 여러 규칙을 설정해야 할 수 있는 경우가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-218">There are cases where you may have to set multiple rules in a profile.</span></span> <span data-ttu-id="099ee-219">여러 규칙이 설정된 경우 다음과 같은 자동 크기 조정 규칙 집합이 서비스에서 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-219">The following set of autoscale rules are used by services use when multiple rules are set.</span></span>

<span data-ttu-id="099ee-220">*규모 확장*의 경우 임의의 규칙이 충족되면 자동 크기 조정이 실행됩니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-220">On *scale out*, autoscale runs if any rule is met.</span></span>
<span data-ttu-id="099ee-221">*규모 감축*의 경우 모든 규칙이 충족되어야 자동 크기 조정이 실행됩니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-221">On *scale-in*, autoscale require all rules to be met.</span></span>

<span data-ttu-id="099ee-222">이를 설명하기 위해 다음 4가지 자동 크기 조정 규칙이 있다고 가정합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-222">To illustrate, assume that you have the following 4 autoscale rules:</span></span>

* <span data-ttu-id="099ee-223">CPU가 30% 미만인 경우 1만큼 규모 감축</span><span class="sxs-lookup"><span data-stu-id="099ee-223">If CPU < 30 %, scale-in by 1</span></span>
* <span data-ttu-id="099ee-224">메모리가 50% 미만인 경우 1만큼 규모 감축</span><span class="sxs-lookup"><span data-stu-id="099ee-224">If Memory < 50%, scale-in by 1</span></span>
* <span data-ttu-id="099ee-225">CPU가 75% 초과인 경우 1만큼 규모 확장</span><span class="sxs-lookup"><span data-stu-id="099ee-225">If CPU > 75%, scale-out by 1</span></span>
* <span data-ttu-id="099ee-226">메모리가 75%를 초과하는 경우 1만큼 규모 확장</span><span class="sxs-lookup"><span data-stu-id="099ee-226">If Memory > 75%, scale-out by 1</span></span>

<span data-ttu-id="099ee-227">이 경우 다음 상황이 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-227">Then the follow occurs:</span></span>

* <span data-ttu-id="099ee-228">CPU가 76%이고 메모리가 50%인 경우 규모가 확장됩니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-228">If CPU is 76% and Memory is 50%, we scale-out.</span></span>
* <span data-ttu-id="099ee-229">CPU가 50%이고 메모리가 76%인 경우 규모가 확장됩니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-229">If CPU is 50% and Memory is 76% we scale-out.</span></span>

<span data-ttu-id="099ee-230">반면, CPU가 25%이고 메모리가 51%인 경우 자동 크기 조정에서 규모를 감축하지 **않습니다**.</span><span class="sxs-lookup"><span data-stu-id="099ee-230">On the other hand, if CPU is 25% and memory is 51% autoscale does **not** scale-in.</span></span> <span data-ttu-id="099ee-231">규모를 감축하려면 CPU가 29%이고 메모리가 49%여야 합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-231">In order to scale-in, CPU must be 29% and Memory 49%.</span></span>

### <a name="always-select-a-safe-default-instance-count"></a><span data-ttu-id="099ee-232">항상 안전한 기본 인스턴스 수 선택</span><span class="sxs-lookup"><span data-stu-id="099ee-232">Always select a safe default instance count</span></span>
<span data-ttu-id="099ee-233">기본 인스턴스 수는 메트릭을 사용할 수 없을 때 자동 크기 조정에서 서비스 크기를 조정하는 인스턴스 수이므로 중요합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-233">The default instance count is important autoscale scales your service to that count when metrics are not available.</span></span> <span data-ttu-id="099ee-234">따라서 워크로드에 안전한 기본 인스턴스 수를 선택해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-234">Therefore, select a default instance count that's safe for your workloads.</span></span>

### <a name="configure-autoscale-notifications"></a><span data-ttu-id="099ee-235">자동 크기 조정 알림 구성</span><span class="sxs-lookup"><span data-stu-id="099ee-235">Configure autoscale notifications</span></span>
<span data-ttu-id="099ee-236">자동 크기 조정에서는 다음 조건 중 하나가 발생한 경우 리소스 관리자 및 참가자에게 메일로 알려 줍니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-236">Autoscale notifies the administrators and contributors of the resource by email if any of the following conditions occur:</span></span>

* <span data-ttu-id="099ee-237">자동 크기 조정 서비스에서 작업에 실패한 경우</span><span class="sxs-lookup"><span data-stu-id="099ee-237">autoscale service fails to take an action.</span></span>
* <span data-ttu-id="099ee-238">자동 크기 조정 서비스에서 크기 조정 결정을 내리는 데 메트릭을 사용할 수 없는 경우</span><span class="sxs-lookup"><span data-stu-id="099ee-238">Metrics are not available for autoscale service to make a scale decision.</span></span>
* <span data-ttu-id="099ee-239">크기 조정 결정을 내리는 데 메트릭을 다시 사용할 수 있게 된(복구) 경우</span><span class="sxs-lookup"><span data-stu-id="099ee-239">Metrics are available (recovery) again to make a scale decision.</span></span>
  <span data-ttu-id="099ee-240">위 조건 외에 성공적인 크기 조정 동작에 대한 알림을 받도록 메일 또는 webhook 알림을 구성할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-240">In addition to the conditions above, you can configure email or webhook notifications to get notified for successful scale actions.</span></span>
  
<span data-ttu-id="099ee-241">또한 활동 로그 경고를 사용하여 자동 크기 조정 엔진의 상태를 모니터링할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-241">You can also use an Activity Log alert to monitor the health of the autoscale engine.</span></span> <span data-ttu-id="099ee-242">다음은 [구독의 모든 자동 크기 조정 엔진 작업을 모니터링하기 위한 활동 로그 경고 만들기](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) 또는 [구독에서 실패한 모든 자동 크기 조정 규모 감축/규모 확장 작업을 모니터링하기 위한 활동 로그 경고 만들기](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert) 예제입니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-242">Here are examples to [create an Activity Log Alert to monitor all autoscale engine operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) or to [create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span></span>

## <a name="next-steps"></a><span data-ttu-id="099ee-243">다음 단계</span><span class="sxs-lookup"><span data-stu-id="099ee-243">Next Steps</span></span>
- [<span data-ttu-id="099ee-244">구독의 모든 자동 크기 조정 엔진 작업을 모니터링하기 위한 활동 로그 경고를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-244">Create an Activity Log Alert to monitor all autoscale engine operations on your subscription.</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert)
- [<span data-ttu-id="099ee-245">구독에서 실패한 모든 자동 크기 조정 규모 감축/규모 확장 작업을 모니터링하기 위한 활동 로그 경고를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="099ee-245">Create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert)
