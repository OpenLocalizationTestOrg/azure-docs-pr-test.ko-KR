---
title: "Azure에서 사용자 정의 경로 및 IP 전달 | Microsoft Docs"
description: "Azure에서 UDR(사용자 정의 경로) 및 IP 전달을 구성하여 네트워크 가상 어플라이언스에 트래픽을 전달하는 방법에 대해 알아봅니다."
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 6274e0101f6fb0864c8d1efaef7fcde78b8760c3
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 07/11/2017
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="40d1a-103">사용자 정의 경로 및 IP 전달</span><span class="sxs-lookup"><span data-stu-id="40d1a-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="40d1a-104">Azure에서 VNet(가상 네트워크)에 VM(가상 컴퓨터)을 추가하면 네트워크를 통해 다른 VM과 통신할 수 있는지 자동으로 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-104">When you add virtual machines (VMs) to a virtual network (VNet) in Azure, you will notice that the VMs are able to communicate with each other over the network, automatically.</span></span> <span data-ttu-id="40d1a-105">서로 다른 서브넷에 있는 VM 간에도 게이트웨이를 지정할 필요가 없습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-105">You do not need to specify a gateway, even though the VMs are in different subnets.</span></span> <span data-ttu-id="40d1a-106">VM에서 공용 인터넷에 통신하는 경우는 물론, Azure와 사용자 고유의 데이터 센터 간 하이브리드 연결이 있는 경우 사용자의 온-프레미스 네트워크에 통신하는 경우에도 마찬가지입니다 .</span><span class="sxs-lookup"><span data-stu-id="40d1a-106">The same is true for communication from the VMs to the public Internet, and even to your on-premises network when a hybrid connection from Azure to your own datacenter is present.</span></span>

<span data-ttu-id="40d1a-107">이러한 통신 전달이 가능한 이유는 Azure가 일련의 시스템 경로를 사용하여 IP 트래픽 전달 방식을 정의하기 때문입니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-107">This flow of communication is possible because Azure uses a series of system routes to define how IP traffic flows.</span></span> <span data-ttu-id="40d1a-108">다음과 같은 시나리오에서 시스템 경로가 통신 전달을 제어합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-108">System routes control the flow of communication in the following scenarios:</span></span>

* <span data-ttu-id="40d1a-109">동일한 서브넷 내의 통신</span><span class="sxs-lookup"><span data-stu-id="40d1a-109">From within the same subnet.</span></span>
* <span data-ttu-id="40d1a-110">단일 VNet 내의 서로 다른 서브넷 간 통신</span><span class="sxs-lookup"><span data-stu-id="40d1a-110">From a subnet to another within a VNet.</span></span>
* <span data-ttu-id="40d1a-111">VM에서 인터넷으로의 통신</span><span class="sxs-lookup"><span data-stu-id="40d1a-111">From VMs to the Internet.</span></span>
* <span data-ttu-id="40d1a-112">VPN Gateway를 통한 서로 다른 VNet 간 통신</span><span class="sxs-lookup"><span data-stu-id="40d1a-112">From a VNet to another VNet through a VPN gateway.</span></span>
* <span data-ttu-id="40d1a-113">Vnet 피어링(서비스 체이닝)을 통한 다른 VNet 간 통신.</span><span class="sxs-lookup"><span data-stu-id="40d1a-113">From a VNet to another VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="40d1a-114">VPN Gateway를 통한 VNet과 사용자의 온-프레미스 네트워크 간 통신.</span><span class="sxs-lookup"><span data-stu-id="40d1a-114">From a VNet to your on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="40d1a-115">아래 그림은 단일 VNet, 두 개의 서브넷, 둘 이상의 VM 간 통신과 IP 트래픽이 전달되는 시스템 경로를 간단한 모습으로 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-115">The figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with the system routes that allow IP traffic to flow.</span></span>

![Azure의 시스템 경로](./media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="40d1a-117">시스템 경로를 사용하면 자동으로 트래픽을 쉽게 배포할 수 있지만 가상 어플라이언스를 통해 패킷 라우팅을 제어하고자 하는 경우도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-117">Although the use of system routes facilitates traffic automatically for your deployment, there are cases in which you want to control the routing of packets through a virtual appliance.</span></span> <span data-ttu-id="40d1a-118">이러한 경우, 특정 서브넷으로 흐르는 패킷이 가상 어플라이언스로 가도록 한 다음 홉을 지정하는 사용자 정의 경로를 생성하고 가상 어플라이언스로 실행되는 VM에서 IP를 전달하도록 설정하면 됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-118">You can do so by creating user defined routes that specify the next hop for packets flowing to a specific subnet to go to your virtual appliance instead, and enabling IP forwarding for the VM running as the virtual appliance.</span></span>

<span data-ttu-id="40d1a-119">아래 그림에는 세 번째 서브넷의 가상 기기를 지나가도록 패킷을 한 서브넷에서 다른 서브넷으로 강제 전송하는 사용자 정의 경로와 IP 전달의 예가 나와 있습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-119">The figure below shows an example of user defined routes and IP forwarding to force packets sent to one subnet from another to go through a virtual appliance on a third subnet.</span></span>

![Azure의 시스템 경로](./media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="40d1a-121">사용자 정의 경로는 서브넷의 모든 리소스(예: VM에 연결된 네트워크 인터페이스)에서 나가는 트래픽에 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-121">User-defined routes are applied to traffic leaving a subnet from any resource (such as network interfaces attached to VMs) in the subnet.</span></span> <span data-ttu-id="40d1a-122">트래픽이 인터넷에서 서브넷으로 들어오는 방법 등을 지정하는 경로는 만들 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-122">You cannot create routes to specify how traffic enters a subnet from the Internet, for instance.</span></span> <span data-ttu-id="40d1a-123">트래픽을 전달하는 기기는 트래픽이 시작되는 위치와 동일한 서브넷에 있을 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-123">The appliance you are forwarding traffic to cannot be in the same subnet where the traffic originates.</span></span> <span data-ttu-id="40d1a-124">항상 기기를 위한 별도의 서브넷을 만드세요.</span><span class="sxs-lookup"><span data-stu-id="40d1a-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="40d1a-125">경로 리소스</span><span class="sxs-lookup"><span data-stu-id="40d1a-125">Route resource</span></span>
<span data-ttu-id="40d1a-126">패킷은 물리적 네트워크의 각 노드에 정의된 경로 테이블을 기반으로 TCP/IP 네트워크를 통해 라우팅됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-126">Packets are routed over a TCP/IP network based on a route table defined at each node on the physical network.</span></span> <span data-ttu-id="40d1a-127">경로 테이블은 대상 IP 주소에 따라 패킷을 전달할 위치를 결정하는 데 사용되는 개별 경로의 컬렉션입니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-127">A route table is a collection of individual routes used to decide where to forward packets based on the destination IP address.</span></span> <span data-ttu-id="40d1a-128">경로는 다음으로 구성됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-128">A route consists of the following:</span></span>

| <span data-ttu-id="40d1a-129">속성</span><span class="sxs-lookup"><span data-stu-id="40d1a-129">Property</span></span> | <span data-ttu-id="40d1a-130">설명</span><span class="sxs-lookup"><span data-stu-id="40d1a-130">Description</span></span> | <span data-ttu-id="40d1a-131">제약 조건</span><span class="sxs-lookup"><span data-stu-id="40d1a-131">Constraints</span></span> | <span data-ttu-id="40d1a-132">고려 사항</span><span class="sxs-lookup"><span data-stu-id="40d1a-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="40d1a-133">주소 접두사</span><span class="sxs-lookup"><span data-stu-id="40d1a-133">Address Prefix</span></span> |<span data-ttu-id="40d1a-134">경로가 적용되는 대상 CIDR(예: 10.1.0.0/16)입니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-134">The destination CIDR to which the route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="40d1a-135">공용 인터넷, Azure Virtual Network 또는 온-프레미스 데이터 센터에서 주소를 나타내는 유효한 CIDR 범위여야 합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-135">Must be a valid CIDR range representing addresses on the public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="40d1a-136">**주소 접두사**에 **다음 홉 주소**의 주소를 포함하지 않도록 하고, 그렇지 않고 포함된 경우에는 패킷이 대상에 도달하지 않고 원본에서 다음 홉으로 이동하는 루프에 입력됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-136">Make sure the **Address prefix** does not contain the address for the **Next hop address**, otherwise your packets will enter in a loop going from the source to the next hop without ever reaching the destination.</span></span> |
| <span data-ttu-id="40d1a-137">다음 홉 유형</span><span class="sxs-lookup"><span data-stu-id="40d1a-137">Next hop type</span></span> |<span data-ttu-id="40d1a-138">패킷을 전송해야 하는 대상 Azure 홉의 유형입니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-138">The type of Azure hop the packet should be sent to.</span></span> |<span data-ttu-id="40d1a-139">다음 값 중 하나여야 합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-139">Must be one of the following values:</span></span> <br/> <span data-ttu-id="40d1a-140">**Virtual Network**.</span><span class="sxs-lookup"><span data-stu-id="40d1a-140">**Virtual Network**.</span></span> <span data-ttu-id="40d1a-141">로컬 가상 네트워크를 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-141">Represents the local virtual network.</span></span> <span data-ttu-id="40d1a-142">예를 들어 10.1.0.0/16 및 10.2.0.0/16의 두 서브넷이 동일한 가상 네트워크에 있는 경우 경로 테이블에 있는 각 서브넷의 경로에는 다음 홉 값으로 *Virtual Network*가 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in the same virtual network, the route for each subnet in the route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="40d1a-143">**Virtual Network 게이트웨이**.</span><span class="sxs-lookup"><span data-stu-id="40d1a-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="40d1a-144">Azure S2S VPN Gateway를 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="40d1a-145">**인터넷**.</span><span class="sxs-lookup"><span data-stu-id="40d1a-145">**Internet**.</span></span> <span data-ttu-id="40d1a-146">Azure 인프라에서 제공하는 기본 인터넷 게이트웨이를 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-146">Represents the default Internet gateway provided by the Azure Infrastructure.</span></span> <br/> <span data-ttu-id="40d1a-147">**가상 어플라이언스**.</span><span class="sxs-lookup"><span data-stu-id="40d1a-147">**Virtual Appliance**.</span></span> <span data-ttu-id="40d1a-148">Azure Virtual Network에 추가한 가상 어플라이언스를 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-148">Represents a virtual appliance you added to your Azure virtual network.</span></span> <br/> <span data-ttu-id="40d1a-149">**없음**.</span><span class="sxs-lookup"><span data-stu-id="40d1a-149">**None**.</span></span> <span data-ttu-id="40d1a-150">블랙 홀을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-150">Represents a black hole.</span></span> <span data-ttu-id="40d1a-151">블랙 홀로 전달된 패킷은 아무 곳에도 전달되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-151">Packets forwarded to a black hole will not be forwarded at all.</span></span> |<span data-ttu-id="40d1a-152">VM 또는 Azure Load Balancer 내부 IP 주소에 트래픽을 보내는 데 **가상 어플라이언스**를 사용하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-152">Consider using **Virtual Appliance** to direct traffic to a VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="40d1a-153">이 형식은 아래에 설명된 대로 IP 주소의 사양을 허용합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-153">This type allows the specification of an IP address as described below.</span></span> <span data-ttu-id="40d1a-154">**없음** 형식을 사용하여 흐름에서 주어진 대상에 패키지를 중지하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-154">Consider using a **None** type to stop packets from flowing to a given destination.</span></span> |
| <span data-ttu-id="40d1a-155">다음 홉 주소</span><span class="sxs-lookup"><span data-stu-id="40d1a-155">Next hop address</span></span> |<span data-ttu-id="40d1a-156">다음 홉 주소에는 패킷을 전달해야 하는 IP 주소가 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-156">The next hop address contains the IP address packets should be forwarded to.</span></span> <span data-ttu-id="40d1a-157">다음 홉 값은 다음 홉 유형이 *가상 어플라이언스*인 경로에서만 허용됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-157">Next hop values are only allowed in routes where the next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="40d1a-158">**Virtual Network 게이트웨이**를 거치지 않고 사용자 정의 경로가 적용되는 Virtual Network 내에서 연결할 수 있는 IP 주소여야 합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-158">Must be an IP address that is reachable within the Virtual Network where the User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="40d1a-159">IP 주소는 동일한 Virtual Network 또는 피어링된 Virtual Network 상에 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-159">The IP address has to be on the same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="40d1a-160">IP 주소가 VM을 나타내는 경우 VM에 Azure의 [IP 전달](#IP-forwarding) 을 사용하도록 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-160">If the IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for the VM.</span></span> <span data-ttu-id="40d1a-161">IP 주소가 Azure Load Balancer의 내부 IP 주소를 나타내는 경우 부하를 분산하려는 각 포트에 대해 일치하는 부하 분산 규칙이 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-161">If the IP address represents the internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish to load balance.</span></span>|

<span data-ttu-id="40d1a-162">Azure PowerShell에서 "NextHopType" 값의 일부에는 다른 이름이 지정되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-162">In Azure PowerShell some of the "NextHopType" values have different names:</span></span>

* <span data-ttu-id="40d1a-163">가상 네트워크는 VnetLocal입니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="40d1a-164">가상 네트워크 게이트웨이는 VirtualNetworkGateway입니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="40d1a-165">가상 어플라이언스는 VirtualAppliance입니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="40d1a-166">Internet은 인터넷입니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-166">Internet is Internet</span></span>
* <span data-ttu-id="40d1a-167">None은 없음입니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="40d1a-168">시스템 경로</span><span class="sxs-lookup"><span data-stu-id="40d1a-168">System routes</span></span>
<span data-ttu-id="40d1a-169">가상 네트워크에서 생성된 모든 서브넷은 다음 시스템 경로 규칙을 포함하는 경로 테이블과 자동으로 연결됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-169">Every subnet created in a virtual network is automatically associated with a route table that contains the following system route rules:</span></span>

* <span data-ttu-id="40d1a-170">**로컬 Vnet 규칙**:이 규칙은 가상 네트워크에 있는 모든 서브넷에 대해 자동으로 생성됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="40d1a-171">VNet의 VM들이 직접 연결되어 있으며 다음 홉으로 연결되는 매개가 없음을 명시합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-171">It specifies that there is a direct link between the VMs in the VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="40d1a-172">**온-프레미스 규칙**: 이 규칙은 온-프레미스 주소 범위로 전달되는 모든 트래픽에 적용되며, VPN Gateway를 다음 홉 대상으로 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-172">**On-premises Rule**: This rule applies to all traffic destined to the on-premises address range and uses VPN gateway as the next hop destination.</span></span>
* <span data-ttu-id="40d1a-173">**인터넷 규칙**: 이 규칙은 공용 인터넷(0.0.0.0/0 주소 접두사)에 유입되는 모든 트래픽을 처리하며, 인프라 인터넷 게이트웨이를 인터넷에 유입되는 모든 트래픽의 다음 홉으로 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-173">**Internet Rule**: This rule handles all traffic destined to the public Internet (address prefix 0.0.0.0/0) and uses the infrastructure internet gateway as the next hop for all traffic destined to the Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="40d1a-174">사용자 정의 경로</span><span class="sxs-lookup"><span data-stu-id="40d1a-174">User-defined routes</span></span>
<span data-ttu-id="40d1a-175">대부분의 환경에는 Azure에서 사전 정의된 시스템 경로만 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-175">For most environments you will only need the system routes already defined by Azure.</span></span> <span data-ttu-id="40d1a-176">그러나 다음과 같은 특정한 경우에는 경로 테이블을 만들고 하나 이상의 경로를 추가해야 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-176">However, you may need to create a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="40d1a-177">온-프레미스 네트워크를 통해 인터넷으로 강제 터널링하는 경우</span><span class="sxs-lookup"><span data-stu-id="40d1a-177">Force tunneling to the Internet via your on-premises network.</span></span>
* <span data-ttu-id="40d1a-178">Azure 환경에서 가상 어플라이언스를 사용하는 경우</span><span class="sxs-lookup"><span data-stu-id="40d1a-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="40d1a-179">위 시나리오에서는 경로 테이블을 만들어 사용자 정의 경로를 추가해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-179">In the scenarios above, you will have to create a route table and add user defined routes to it.</span></span> <span data-ttu-id="40d1a-180">여러 경로 테이블을 만들 수 있으며, 동일한 경로 테이블을 하나 이상의 서브넷에 연결할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-180">You can have multiple route tables, and the same route table can be associated to one or more subnets.</span></span> <span data-ttu-id="40d1a-181">또한 각 서브넷은 단일 경로 테이블에만 연결할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-181">And each subnet can only be associated to a single route table.</span></span> <span data-ttu-id="40d1a-182">서브넷의 모든 VM 및 Cloud Services는 해당 서브넷에 연결된 경로 테이블을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-182">All VMs and cloud services in a subnet use the route table associated to that subnet.</span></span>

<span data-ttu-id="40d1a-183">경로 테이블이 서브넷에 연결될 때까지 서브넷은 시스템 경로에 의존합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-183">Subnets rely on system routes until a route table is associated to the subnet.</span></span> <span data-ttu-id="40d1a-184">연결이 설정되면 사용자 정의 경로 및 시스템 경로 간에 LPM(가장 긴 접두사 일치)을 기반으로 라우팅이 수행됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="40d1a-185">LPM 일치가 동일한 경로가 두 개 이상 있으면 다음 순서대로 해당 원점에 따라 경로가 선택됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-185">If there is more than one route with the same LPM match then a route is selected based on its origin in the following order:</span></span>

1. <span data-ttu-id="40d1a-186">사용자 정의 경로</span><span class="sxs-lookup"><span data-stu-id="40d1a-186">User defined route</span></span>
2. <span data-ttu-id="40d1a-187">BGP 경로(ExpressRoute를 사용하는 경우)</span><span class="sxs-lookup"><span data-stu-id="40d1a-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="40d1a-188">시스템 경로</span><span class="sxs-lookup"><span data-stu-id="40d1a-188">System route</span></span>

<span data-ttu-id="40d1a-189">사용자 정의 경로를 만드는 방법은 [를 만들고 IP 전달을 사용하도록 설정하는 방법](virtual-network-create-udr-arm-template.md)을 참조하십시오.</span><span class="sxs-lookup"><span data-stu-id="40d1a-189">To learn how to create user defined routes, see [How to Create Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="40d1a-190">사용자 정의 경로는 Azure VM 및 Cloud Services에만 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-190">User defined routes are only applied to Azure VMs and cloud services.</span></span> <span data-ttu-id="40d1a-191">예를 들어 온-프레미스 네트워크와 Azure 간에 방화벽 가상 어플라이언스를 추가하려면 온-프레미스 주소 공간으로 이동하는 모든 트래픽을 가상 어플라이언스로 전달하는 Azure 경로 테이블에 대한 사용자 정의 경로를 만들어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-191">For instance, if you want to add a firewall virtual appliance between your on-premises network and Azure, you will have to create a user defined route for your Azure route tables that forwards all traffic going to the on-premises address space to the virtual appliance.</span></span> <span data-ttu-id="40d1a-192">또한 GatewaySubnet에 UDR(사용자 정의 경로)를 추가하여 모든 가상 어플라이언스를 통해 온-프레미스에서 Azure로 트래픽을 전달할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-192">You can also add a user defined route (UDR) to the GatewaySubnet to forward all traffic from on-premises to Azure through the virtual appliance.</span></span> <span data-ttu-id="40d1a-193">이 기능은 최근에 추가되었습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="40d1a-194">BGP 경로</span><span class="sxs-lookup"><span data-stu-id="40d1a-194">BGP routes</span></span>
<span data-ttu-id="40d1a-195">온-프레미스 네트워크와 Azure 간에 ExpressRoute 연결이 있는 경우 BGP를 사용하도록 설정하여 온-프레미스 네트워크에서 Azure로 경로를 전파할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP to propagate routes from your on-premises network to Azure.</span></span> <span data-ttu-id="40d1a-196">이러한 BGP 경로는 각 Azure 서브넷의 사용자 정의 경로 및 시스템 경로와 동일한 방식으로 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-196">These BGP routes are used in the same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="40d1a-197">자세한 내용은 [ExpressRoute 소개](../expressroute/expressroute-introduction.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="40d1a-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="40d1a-198">VPN Gateway를 다음 홉으로 사용하는 서브넷 0.0.0.0/0에 대한 사용자 정의 경로를 만들어 온-프레미스 네트워크를 통한 강제 터널링을 사용하도록 Azure 환경을 구성할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-198">You can configure your Azure environment to use force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses the VPN gateway as the next hop.</span></span> <span data-ttu-id="40d1a-199">그러나 이 구성은 VPN Gateway를 사용하는 경우에만 작동하고 ExpressRoute를 사용하는 경우에는 작동하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="40d1a-200">ExpressRoute의 경우 강제 터널링은 BGP를 통해 구성됩니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="40d1a-201">IP 전달</span><span class="sxs-lookup"><span data-stu-id="40d1a-201">IP forwarding</span></span>
<span data-ttu-id="40d1a-202">위에서 설명한 것처럼 사용자 정의 경로를 만드는 주된 이유 중 하나는 트래픽을 가상 어플라이언스로 전달하기 위한 것입니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-202">As described above, one of the main reasons to create a user defined route is to forward traffic to a virtual appliance.</span></span> <span data-ttu-id="40d1a-203">가상 어플라이언스는 방화벽이나 NAT 장치와 같이 네트워크 트래픽을 처리하는 데 사용되는 응용 프로그램을 실행하는 VM일 뿐입니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-203">A virtual appliance is nothing more than a VM that runs an application used to handle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="40d1a-204">이 가상 어플라이언스 VM은 주소가 자신으로 지정되지 않은 들어오는 트래픽을 받을 수 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-204">This virtual appliance VM must be able to receive incoming traffic that is not addressed to itself.</span></span> <span data-ttu-id="40d1a-205">VM이 다른 대상으로 주소가 지정된 트래픽을 받을 수 있도록 하려면 해당 VM에서 IP 전달을 사용하도록 설정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-205">To allow a VM to receive traffic addressed to other destinations, you must enable IP Forwarding for the VM.</span></span> <span data-ttu-id="40d1a-206">이것은 Azure 설정으로 게스트 운영 체제에서 설정할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-206">This is an Azure setting, not a setting in the guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="40d1a-207">다음 단계</span><span class="sxs-lookup"><span data-stu-id="40d1a-207">Next steps</span></span>
* <span data-ttu-id="40d1a-208">[Resource Manager 배포 모델에서 경로를 만들어](virtual-network-create-udr-arm-template.md) 서브넷에 연결하는 방법에 대해 알아봅니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-208">Learn how to [create routes in the Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them to subnets.</span></span> 
* <span data-ttu-id="40d1a-209">[클래식 배포 모델에서 경로를 만들어](virtual-network-create-udr-classic-ps.md) 서브넷에 연결하는 방법에 대해 알아봅니다.</span><span class="sxs-lookup"><span data-stu-id="40d1a-209">Learn how to [create routes in the classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them to subnets.</span></span>

