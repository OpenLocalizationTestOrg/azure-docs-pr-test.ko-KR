---
title: "다중 DRM 및 Access Control이 포함된 CENC: Azure 및 Azure Media Services에서 참조 설계 및 구현 | Microsoft 문서"
description: "Microsoft® 부드러운 스트리밍 클라이언트 이식 키트 라이선스를 얻는 방법에 대해 알아보세요."
services: media-services
documentationcenter: 
author: willzhan
manager: cfowler
editor: 
ms.assetid: 7814739b-cea9-4b9b-8370-538702e5c615
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: willzhan;kilroyh;yanmf;juliako
ms.openlocfilehash: 730917b6859f8dbd800ef2cb141062f45d7779ac
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/29/2017
---
# <a name="cenc-with-multi-drm-and-access-control-a-reference-design-and-implementation-on-azure-and-azure-media-services"></a><span data-ttu-id="76361-103">다중 DRM 및 액세스 제어가 포함된 CENC: Azure 및 Azure 미디어 서비스에서 참조 디자인 및 구현</span><span class="sxs-lookup"><span data-stu-id="76361-103">CENC with Multi-DRM and Access Control: A Reference Design and Implementation on Azure and Azure Media Services</span></span>
 
## <a name="introduction"></a><span data-ttu-id="76361-104">소개</span><span class="sxs-lookup"><span data-stu-id="76361-104">Introduction</span></span>
<span data-ttu-id="76361-105">잘 알다시피 OTT 또는 온라인 스트리밍 솔루션을 위한 DRM 하위 시스템을 디자인하고 구축하는 것은 복잡한 작업입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-105">It is well known that it is a complex task to design and build a DRM subsystem for an OTT or online streaming solution.</span></span> <span data-ttu-id="76361-106">일반적으로 운영자/온라인 비디오 공급자는 이러한 부분을 전문화된 DRM 서비스 공급자에게 아웃소싱합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-106">And it is a common practice for operators/online video providers to outsource this part to specialized DRM service providers.</span></span> <span data-ttu-id="76361-107">이 문서의 목표는 OTT 또는 온라인 스트리밍 솔루션에서 종단 간 DRM 하위 시스템의 참조 디자인 및 구현을 제공하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-107">The goal of this document is to present a reference design and implementation of end-to-end DRM subsystem in OTT or online streaming solution.</span></span>

<span data-ttu-id="76361-108">이 문서는 OTT 또는 온라인 스트리밍/멀티 스크린 솔루션의 DRM 하위 시스템에서 작업 중인 엔지니어 또는 DRM 하위 시스템에 관심이 있는 모든 독자를 대상으로 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-108">The targeted readers of this document are engineers working in DRM subsystem of OTT or online streaming/multi-screen solutions, or any readers interested in DRM subsystem.</span></span> <span data-ttu-id="76361-109">독자는 PlayReady, Widevine, FairPlay 또는 Adobe Access 등 한 가지 이상의 DRM 기술에 대해 잘 알고 있다고 가정합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-109">The assumption is that readers are familiar with at least one of the DRM technologies on the market, such as PlayReady, Widevine, FairPlay or Adobe Access.</span></span>

<span data-ttu-id="76361-110">DRM에는 포함 다중 DRM의 CENC(일반적인 암호화)도 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-110">By DRM, we also include CENC (Common Encryption) with multi-DRM.</span></span> <span data-ttu-id="76361-111">온라인 스트리밍 및 OTT 업계에서 주요 추세는 다양한 클라이언트 플랫폼에서 다중 기본 DRM의 CENC를 사용하는 것이며 이것은 다양한 클라이언트 플랫폼에서 단일 DRM과 해당 클라이언트 SDK를 사용하는 이전 추세로부터 변화된 것입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-111">A major trend in online streaming and OTT industry is to use CENC with multi-native-DRM on various client platforms, which is a shift from the previous trend of using a single DRM and its client SDK for various client platforms.</span></span> <span data-ttu-id="76361-112">다중 기본 DRM의 CENC를 사용할 때 PlayReady와 Widevine 모두 [일반적인 암호화(ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) 사양에 따라 암호화됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-112">When using CENC with multi-native-DRM, both PlayReady and Widevine are encrypted per the [Common Encryption (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) specification.</span></span>

<span data-ttu-id="76361-113">다중 DRM의 CENC 이점은 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-113">The benefits of CENC with multi-DRM are as follows:</span></span>

1. <span data-ttu-id="76361-114">기본 DRM을 포함하는 다양한 플랫폼을 대상으로 단일 암호화 처리가 사용되므로 암호화 비용이 절감됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-114">Reduces encryption cost since a single encryption processing is used targeting different platforms with its native DRMs;</span></span>
2. <span data-ttu-id="76361-115">암호화된 자산의 복사본이 하나만 필요하므로 암호화된 자산의 관리 비용이 절감됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-115">Reduces the cost of managing encrypted assets since only a single copy of encrypted assets is needed;</span></span>
3. <span data-ttu-id="76361-116">기본 플랫폼에서 기본 DRM 클라이언트는 일반적으로 무료로 제공되므로 DRM 클라이언트 라이선스 비용이 없습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-116">Eliminates DRM client licensing cost since the native DRM client is usually free on its native platform.</span></span>

<span data-ttu-id="76361-117">Microsoft는 몇몇 주요 기업들과 더불어 DASH 및 CENC의 적극적인 프로모터로 활동해왔습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-117">Microsoft has been an active promoter of DASH and CENC together with some major industry players.</span></span> <span data-ttu-id="76361-118">Microsoft Azure 미디어 서비스에서 DASH 및CENC 지원을 제공하고 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-118">Microsoft Azure Media Services has been providing support of DASH and CENC.</span></span> <span data-ttu-id="76361-119">Mingfei의 블로그의 [Azure Media Services에서 Google Widevine 라이선스 전달 서비스 발표](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/) 및 [다중 DRM 스트림을 배달하기 위해 Azure Media Services에서 Google Widevine 패키징 추가](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/)에서 최근 소식을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="76361-119">For recent announcements, please see Mingfei’s blogs: [Announcing Google Widevine license delivery services in Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/), and [Azure Media Services adds Google Widevine packaging for delivering multi-DRM stream](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/).</span></span>  

### <a name="overview-of-this-article"></a><span data-ttu-id="76361-120">이 문서의 개요</span><span class="sxs-lookup"><span data-stu-id="76361-120">Overview of this article</span></span>
<span data-ttu-id="76361-121">이 문서의 목표는 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-121">The goal of this article includes the following:</span></span>

1. <span data-ttu-id="76361-122">다중 DRM의 CENC를 사용하는 DRM 하위 시스템에 대한 참조 디자인을 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-122">Provides a reference design of DRM subsystem using CENC with multi-DRM;</span></span>
2. <span data-ttu-id="76361-123">Microsoft Azure/Azure 미디어 서비스 플랫폼에 대한 참조 구현을 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-123">Provides a reference implementation on Microsoft Azure/Azure Media Services platform;</span></span>
3. <span data-ttu-id="76361-124">몇 가지 디자인 및 구현 토픽에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-124">Discusses some design and implementation topics.</span></span>

<span data-ttu-id="76361-125">이 문서에서 "다중 DRM"은 다음을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="76361-125">In the article, “multi-DRM” covers the following:</span></span>

1. <span data-ttu-id="76361-126">Microsoft PlayReady</span><span class="sxs-lookup"><span data-stu-id="76361-126">Microsoft PlayReady</span></span>
2. <span data-ttu-id="76361-127">Google Widevine</span><span class="sxs-lookup"><span data-stu-id="76361-127">Google Widevine</span></span>
3. <span data-ttu-id="76361-128">Apple FairPlay</span><span class="sxs-lookup"><span data-stu-id="76361-128">Apple FairPlay</span></span> 

<span data-ttu-id="76361-129">다음 표에서는 각 DRM에서 기본 플랫폼/기본 앱 및 지원되는 브라우저를 요약합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-129">The following table summarizes the native platform/native app, and browsers supported by each DRM.</span></span>

| <span data-ttu-id="76361-130">**클라이언트 플랫폼**</span><span class="sxs-lookup"><span data-stu-id="76361-130">**Client Platform**</span></span> | <span data-ttu-id="76361-131">**네이티브 DRM 지원**</span><span class="sxs-lookup"><span data-stu-id="76361-131">**Native DRM Support**</span></span> | <span data-ttu-id="76361-132">**브라우저/앱**</span><span class="sxs-lookup"><span data-stu-id="76361-132">**Browser/App**</span></span> | <span data-ttu-id="76361-133">**스트리밍 형식**</span><span class="sxs-lookup"><span data-stu-id="76361-133">**Streaming Formats**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="76361-134">**스마트 TV, 연산자 STB, OTT STB**</span><span class="sxs-lookup"><span data-stu-id="76361-134">**Smart TVs, operator STBs, OTT STBs**</span></span> |<span data-ttu-id="76361-135">주로 PlayReady 및/또는 Widevine 및/또는 기타</span><span class="sxs-lookup"><span data-stu-id="76361-135">PlayReady primarily, and/or Widevine, and/or other</span></span> |<span data-ttu-id="76361-136">Linux, Opera, WebKit, 기타</span><span class="sxs-lookup"><span data-stu-id="76361-136">Linux, Opera, WebKit, Other</span></span> |<span data-ttu-id="76361-137">다양한 형식</span><span class="sxs-lookup"><span data-stu-id="76361-137">Various formats</span></span> |
| <span data-ttu-id="76361-138">**Windows 10 장치(Windows PC, Windows 태블릿, Windows Phone, Xbox)**</span><span class="sxs-lookup"><span data-stu-id="76361-138">**Windows 10 devices (Windows PC, Windows Tablets, Windows Phone, Xbox)**</span></span> |<span data-ttu-id="76361-139">PlayReady</span><span class="sxs-lookup"><span data-stu-id="76361-139">PlayReady</span></span> |<span data-ttu-id="76361-140">MS Edge/IE11/EME</span><span class="sxs-lookup"><span data-stu-id="76361-140">MS Edge/IE11/EME</span></span><br/><br/><br/><span data-ttu-id="76361-141">UWP</span><span class="sxs-lookup"><span data-stu-id="76361-141">UWP</span></span> |<span data-ttu-id="76361-142">DASH(HLS의 경우 PlayReady는 지원되지 않음)</span><span class="sxs-lookup"><span data-stu-id="76361-142">DASH (For HLS, PlayReady is not supported)</span></span><br/><br/><span data-ttu-id="76361-143">DASH, 부드러운 스트리밍(HLS의 경우 PlayReady는 지원되지 않음)</span><span class="sxs-lookup"><span data-stu-id="76361-143">DASH, Smooth Streaming (For HLS, PlayReady is not supported)</span></span> |
| <span data-ttu-id="76361-144">**Android 장치(전화, 태블릿, TV)**</span><span class="sxs-lookup"><span data-stu-id="76361-144">**Android devices (Phone, Tablet, TV)**</span></span> |<span data-ttu-id="76361-145">Widevine</span><span class="sxs-lookup"><span data-stu-id="76361-145">Widevine</span></span> |<span data-ttu-id="76361-146">크롬/EME</span><span class="sxs-lookup"><span data-stu-id="76361-146">Chrome/EME</span></span> |<span data-ttu-id="76361-147">DASH,HLS</span><span class="sxs-lookup"><span data-stu-id="76361-147">DASH,HLS</span></span> |
| <span data-ttu-id="76361-148">**iOS(iPhone, iPad), OS X 클라이언트 및 Apple TV**</span><span class="sxs-lookup"><span data-stu-id="76361-148">**iOS (iPhone, iPad), OS X clients and Apple TV**</span></span> |<span data-ttu-id="76361-149">FairPlay</span><span class="sxs-lookup"><span data-stu-id="76361-149">FairPlay</span></span> |<span data-ttu-id="76361-150">Safari 8+/EME</span><span class="sxs-lookup"><span data-stu-id="76361-150">Safari 8+/EME</span></span> |<span data-ttu-id="76361-151">HLS</span><span class="sxs-lookup"><span data-stu-id="76361-151">HLS</span></span> |


<span data-ttu-id="76361-152">각 DRM에 대한 배포의 현재 상태를 고려하면 서비스는 일반적으로 가장 좋은 방법으로 모든 유형의 끝점을 해결하도록 2 또는 3DRM을 구현해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-152">Considering the current state of deployment for each DRM, a service will typically want to implement 2 or 3 DRMs to make sure you address all the types of endpoints in the best way.</span></span>

<span data-ttu-id="76361-153">다양한 클라이언트에서 사용자 환경의 특정 수준에 도달하는 데 서비스 논리의 복잡성과 클라이언트 쪽의 복잡성 사이의 장단점이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-153">There is a tradeoff between the complexity of the service logic and the complexity on the client side to reach a certain level of user experience on the various clients.</span></span>

<span data-ttu-id="76361-154">선택을 하려면 이러한 사실에 유의하세요.</span><span class="sxs-lookup"><span data-stu-id="76361-154">To make your selection, keep in mind these facts:</span></span>

* <span data-ttu-id="76361-155">PlayReady는 모든 Windows 장치와 일부 Android 장치에서 고유하게 구현되며 거의 모든 플랫폼에서 소프트웨어 SDK를 통해 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-155">PlayReady is natively implemented in every Windows device, on some Android devices, and available through software SDKs on virtually any platform</span></span>
* <span data-ttu-id="76361-156">Widevine은 모든 Android 장치, Chrome 및 일부 다른 장치에서 고유하게 구현됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-156">Widevine is natively implemented in every Android device, in Chrome, and in some other devices</span></span>
* <span data-ttu-id="76361-157">FairPlay는 iOS 및 Mac OS 클라이언트 또는 iTunes를 통해 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-157">FairPlay is available only on iOS and Mac OS clients or through iTunes.</span></span>

<span data-ttu-id="76361-158">따라서 일반적인 다중 DRM은 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-158">So a typical multi-DRM would be:</span></span>

* <span data-ttu-id="76361-159">옵션 1: PlayReady 및 Widevine</span><span class="sxs-lookup"><span data-stu-id="76361-159">Option 1: PlayReady and Widevine</span></span>
* <span data-ttu-id="76361-160">옵션 2: PlayReady, Widevine 및 FairPlay</span><span class="sxs-lookup"><span data-stu-id="76361-160">Option 2: PlayReady, Widevine and FairPlay</span></span>

## <a name="a-reference-design"></a><span data-ttu-id="76361-161">참조 디자인</span><span class="sxs-lookup"><span data-stu-id="76361-161">A reference design</span></span>
<span data-ttu-id="76361-162">이 섹션에서는 구현에 사용되는 기술과 관계 없이 적용할 수 있는 참조 디자인을 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-162">In this section, we will present a reference design which is agnostic to technologies used to implement it.</span></span>

<span data-ttu-id="76361-163">DRM 하위 시스템은 다음 구성 요소를 포함할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-163">A DRM subsystem may contain the following components:</span></span>

1. <span data-ttu-id="76361-164">키 관리</span><span class="sxs-lookup"><span data-stu-id="76361-164">Key management</span></span>
2. <span data-ttu-id="76361-165">DRM 패키징</span><span class="sxs-lookup"><span data-stu-id="76361-165">DRM packaging</span></span>
3. <span data-ttu-id="76361-166">DRM 라이선스 배달</span><span class="sxs-lookup"><span data-stu-id="76361-166">DRM license delivery</span></span>
4. <span data-ttu-id="76361-167">자격 확인</span><span class="sxs-lookup"><span data-stu-id="76361-167">Entitlement check</span></span>
5. <span data-ttu-id="76361-168">인증/권한 부여</span><span class="sxs-lookup"><span data-stu-id="76361-168">Authentication/authorization</span></span>
6. <span data-ttu-id="76361-169">플레이어</span><span class="sxs-lookup"><span data-stu-id="76361-169">Player</span></span>
7. <span data-ttu-id="76361-170">원본/CDN</span><span class="sxs-lookup"><span data-stu-id="76361-170">Origin/CDN</span></span>

<span data-ttu-id="76361-171">다음 다이어그램에서는 DRM 하위 시스템에서 구성 요소 간의 상호 작용을 에 개략적으로 보여줍니다.</span><span class="sxs-lookup"><span data-stu-id="76361-171">The following diagram illustrates the high level interaction among the components in a DRM subsystem.</span></span>

![CENC를 사용하는 DRM 하위 시스템](./media/media-services-cenc-with-multidrm-access-control/media-services-generic-drm-subsystem-with-cenc.png)

<span data-ttu-id="76361-173">이 디자인에는 세 개의 기본 "계층"이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-173">There are three basic “layers” in the design:</span></span>

1. <span data-ttu-id="76361-174">외부적으로 노출되지 않는 백오피스 계층(검은색)</span><span class="sxs-lookup"><span data-stu-id="76361-174">Back office layer (in black) which are not exposed externally;</span></span>
2. <span data-ttu-id="76361-175">공용으로 연결되는 모든 끝점을 포함하는 "DMZ" 계층(파란색)</span><span class="sxs-lookup"><span data-stu-id="76361-175">“DMZ” layer (blue) containing all the endpoints facing public;</span></span>
3. <span data-ttu-id="76361-176">공용 인터넷을 통과하는 트래픽과 CDN 및 플레이어를 포함하는 공용 인터넷 계층(옅은 파란색)</span><span class="sxs-lookup"><span data-stu-id="76361-176">Public Internet layer (light blue) containing CDN and players with traffic across public Internet.</span></span>

<span data-ttu-id="76361-177">정적 또는 동적 암호화에 관계 없이 DRM 보호를 제어하기 위한 콘텐츠 관리 도구가 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-177">There should be a content management tool for controlling DRM protection, regardless it is static or dynamic encryption.</span></span> <span data-ttu-id="76361-178">DRM 암호화에 대한 입력은 다음을 포함해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-178">The inputs for DRM encryption should include:</span></span>

1. <span data-ttu-id="76361-179">MBR 비디오 콘텐츠</span><span class="sxs-lookup"><span data-stu-id="76361-179">MBR video content;</span></span>
2. <span data-ttu-id="76361-180">콘텐츠 키</span><span class="sxs-lookup"><span data-stu-id="76361-180">Content key;</span></span>
3. <span data-ttu-id="76361-181">라이선스 획득 URL</span><span class="sxs-lookup"><span data-stu-id="76361-181">License acquisition URLs.</span></span>

<span data-ttu-id="76361-182">재생 시간 동안 개략적인 흐름은 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-182">During playback time, the high level flow is:</span></span>

1. <span data-ttu-id="76361-183">사용자가 인증됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-183">User is authenticated;</span></span>
2. <span data-ttu-id="76361-184">사용자에 대한 권한 부여 토큰이 만들어집니다.</span><span class="sxs-lookup"><span data-stu-id="76361-184">Authorization token is created for the user;</span></span>
3. <span data-ttu-id="76361-185">DRM으로 보호된 콘텐츠(매니페스트)가 플레이어로 다운로드됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-185">DRM protected content (manifest) is downloaded to player;</span></span>
4. <span data-ttu-id="76361-186">플레이어는 라이선스 서버에 키 ID 및 권한 부여 토큰과 함께 라이선스 획득 요청을 제출합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-186">Player submits license acquisition request to license servers together with key ID and authorization token.</span></span>

<span data-ttu-id="76361-187">다음 토픽으로 이동하기 전에 키 관리의 디자인에 대한 몇 가지 단어에 대해 알아봅니다.</span><span class="sxs-lookup"><span data-stu-id="76361-187">Before moving to the next topic, a few words about the design of key management.</span></span>

| <span data-ttu-id="76361-188">**콘텐츠 키 대 자산(ContentKey–to-Asset)**</span><span class="sxs-lookup"><span data-stu-id="76361-188">**ContentKey–to-Asset**</span></span> | <span data-ttu-id="76361-189">**시나리오**</span><span class="sxs-lookup"><span data-stu-id="76361-189">**Scenario**</span></span> |
| --- | --- |
| <span data-ttu-id="76361-190">일대일(1–to-1)</span><span class="sxs-lookup"><span data-stu-id="76361-190">1–to-1</span></span> |<span data-ttu-id="76361-191">가장 간단한 경우입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-191">The simplest case.</span></span> <span data-ttu-id="76361-192">가장 미세한 제어를 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-192">It provides the finest control.</span></span> <span data-ttu-id="76361-193">하지만 일반적으로 이렇게 가장 높은 라이선스 배달 비용이 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-193">But this generally results in the highest license delivery cost.</span></span> <span data-ttu-id="76361-194">보호된 각 자산에 대해 최소 하나의 라이선스 요청이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-194">At minimum one license request is required for each protected asset.</span></span> |
| <span data-ttu-id="76361-195">일대다(1–to-Many)</span><span class="sxs-lookup"><span data-stu-id="76361-195">1–to-Many</span></span> |<span data-ttu-id="76361-196">여러 자산에 대해 동일한 콘텐츠 키를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-196">You could use the same content key for multiple assets.</span></span> <span data-ttu-id="76361-197">예를 들어 장르 또는 장르의 하위 집합(또는 영화 유전자)과 같은 논리적 그룹의 모든 자산에 대해 단일 콘텐츠 키를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-197">For example, for all the assets in a logical group such as a genre or subset of genre (or Movie Gene), you could use a single content key.</span></span> |
| <span data-ttu-id="76361-198">다대일(Many–to-1)</span><span class="sxs-lookup"><span data-stu-id="76361-198">Many–to-1</span></span> |<span data-ttu-id="76361-199">각 자산에 대해 여러 콘텐츠 키가 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-199">Multiple content keys are needed for each asset.</span></span> <br/><br/><span data-ttu-id="76361-200">예를 들어 MPEG DASH에 대해 다중 DRM의 동적 CENC 보호를 적용하고 HLS에 대해 AES-128 암호화를 적용해야 하는 경우 각각 고유한 ContentKeyType을 포함하는 두 가지 별도의 콘텐츠 키가 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-200">For example, if you need to apply dynamic CENC protection with multi-DRM for MPEG-DASH, and dynamic AES-128 encryption for HLS, you need two separate content keys, each with its own ContentKeyType.</span></span> <span data-ttu-id="76361-201">(동적 CENC 보호에 사용된 콘텐츠 키의 경우, ContentKeyType.CommonEncryption을 사용해야 하는 반면 동적 AES-128 암호화에 사용되는 콘텐츠 키의 경우, ContentKeyType.EnvelopeEncryption을 사용해야 합니다.)</span><span class="sxs-lookup"><span data-stu-id="76361-201">(For the content key used for dynamic CENC protection, ContentKeyType.CommonEncryption should be used, while for the content key used for dynamic AES-128 encryption, ContentKeyType.EnvelopeEncryption should be used.)</span></span><br/><br/><span data-ttu-id="76361-202">또 다른 예로 DASH 콘텐츠의 CENC 보호에서는 이론적으로 비디오 스트림을 보호하는 데 하나의 콘텐츠 키를 사용할 수 있으며 오디오 스트림을 보호하는 데는 다른 콘텐츠 키를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-202">Another example, in CENC protection of DASH content, in theory, one content key can be used to protect video stream and another content key to protect audio stream.</span></span> |
| <span data-ttu-id="76361-203">다대다(Many–to–Many)</span><span class="sxs-lookup"><span data-stu-id="76361-203">Many – to - Many</span></span> |<span data-ttu-id="76361-204">위의 두 가지 시나리오를 조합한 것입니다. 동일한 자산 "그룹"의 여러 자산 각각에 대해 한 집합의 콘텐츠 키를 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-204">Combination of the above two scenarios: one set of content keys are used for each of the multiple assets in the same asset “group”.</span></span> |

<span data-ttu-id="76361-205">또 다른 중요한 고려 사항은 영구 및 비영구 라이선스의 사용에 관한 것입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-205">Another important factor to consider is the use of persistent and non-persistent licenses.</span></span>

<span data-ttu-id="76361-206">이러한 고려 사항이 중요한 이유는 무엇인가요?</span><span class="sxs-lookup"><span data-stu-id="76361-206">Why are these considerations important?</span></span>

<span data-ttu-id="76361-207">라이선스 배달에 공용 클라우드를 사용하는 경우 라이선스 배달 비용에 직접적인 영향이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-207">They have direct impact to license delivery cost if you use public cloud for license delivery.</span></span> <span data-ttu-id="76361-208">이를 설명하기 위해 다음 두 가지 다른 디자인 사례를 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-208">Let’s consider the following two different design cases to illustrate:</span></span>

1. <span data-ttu-id="76361-209">월간 구독: 영구 라이선스와 일대다(1–to-Many) 콘텐츠 키 대 자산 매핑을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-209">Monthly subscription: Use persistent license, and 1-to-many content key-to-asset mapping.</span></span> <span data-ttu-id="76361-210">예:</span><span class="sxs-lookup"><span data-stu-id="76361-210">E.g.</span></span> <span data-ttu-id="76361-211">예를 들어 모든 어린이용 영화의 경우 암호화에 단일 콘텐츠 키를 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-211">for all the kids movies, we use a single content key for encryption.</span></span> <span data-ttu-id="76361-212">이 경우 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-212">In this case:</span></span>

    <span data-ttu-id="76361-213">모든 어린이용 영화에 요청된 전체 라이선스 수/장치 = 1</span><span class="sxs-lookup"><span data-stu-id="76361-213">Total # licenses requested for all kids movies/device = 1</span></span>
2. <span data-ttu-id="76361-214">월간 구독: 비영구 라이선스와 콘텐츠 키 및 자산 간에 일대일(1–to-1) 매핑을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-214">Monthly subscription: Use non-persistent license, and 1-to-1 mapping between content key and asset.</span></span> <span data-ttu-id="76361-215">이 경우 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-215">In this case:</span></span>

    <span data-ttu-id="76361-216">모든 어린이용 영화에 요청된 전체 라이선스 수/장치 = [본 영화 수] x [세션 수]</span><span class="sxs-lookup"><span data-stu-id="76361-216">Total # licenses requested for all kids movies/device = [# movies watched] x [# sessions]</span></span>

<span data-ttu-id="76361-217">쉽게 확인할 수 있듯이 두 가지 서로 다른 디자인으로 인해 라이선스 요청 패턴이 매우 달라지므로 라이선스 배달 서비스가 Azure 미디어 서비스와 같은 공용 클라우드에서 제공되는 경우 라이선스 배달 비용이 달라집니다.</span><span class="sxs-lookup"><span data-stu-id="76361-217">As you can easily see, the two different designs result in very different license request patterns hence license delivery cost if license delivery service is provided by a public cloud such as Azure Media Services.</span></span>

## <a name="mapping-design-to-technology-for-implementation"></a><span data-ttu-id="76361-218">디자인을 구현 기술에 매핑</span><span class="sxs-lookup"><span data-stu-id="76361-218">Mapping design to technology for implementation</span></span>
<span data-ttu-id="76361-219">다음으로, 각 구성 요소에 사용할 기술을 지정하여 일반적인 디자인을 Microsoft Azure/Azure 미디어 서비스 플랫폼의 기술에 매핑합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-219">Next, we map our generic design to technologies on Microsoft Azure/Azure Media Services platform, by specifying which technology to use for each building block.</span></span>

<span data-ttu-id="76361-220">다음 표에서 이러한 매핑을 보여줍니다.</span><span class="sxs-lookup"><span data-stu-id="76361-220">The following table shows the mapping:</span></span>

| <span data-ttu-id="76361-221">**구성 요소**</span><span class="sxs-lookup"><span data-stu-id="76361-221">**Building Block**</span></span> | <span data-ttu-id="76361-222">**Technology**</span><span class="sxs-lookup"><span data-stu-id="76361-222">**Technology**</span></span> |
| --- | --- |
| <span data-ttu-id="76361-223">**플레이어**</span><span class="sxs-lookup"><span data-stu-id="76361-223">**Player**</span></span> |[<span data-ttu-id="76361-224">Azure 미디어 플레이어</span><span class="sxs-lookup"><span data-stu-id="76361-224">Azure Media Player</span></span>](https://azure.microsoft.com/services/media-services/media-player/) |
| <span data-ttu-id="76361-225">**IDP(ID 공급자)**</span><span class="sxs-lookup"><span data-stu-id="76361-225">**Identity Provider (IDP)**</span></span> |<span data-ttu-id="76361-226">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="76361-226">Azure Active Directory</span></span> |
| <span data-ttu-id="76361-227">**STS(보안 토큰 서비스)**</span><span class="sxs-lookup"><span data-stu-id="76361-227">**Secure Token Service (STS)**</span></span> |<span data-ttu-id="76361-228">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="76361-228">Azure Active Directory</span></span> |
| <span data-ttu-id="76361-229">**DRM 보호 워크플로**</span><span class="sxs-lookup"><span data-stu-id="76361-229">**DRM Protection Workflow**</span></span> |<span data-ttu-id="76361-230">Azure 미디어 서비스 동적 보호</span><span class="sxs-lookup"><span data-stu-id="76361-230">Azure Media Services Dynamic Protection</span></span> |
| <span data-ttu-id="76361-231">**DRM 라이선스 배달**</span><span class="sxs-lookup"><span data-stu-id="76361-231">**DRM License Delivery**</span></span> |<span data-ttu-id="76361-232">1. Azure Media Services 라이선스 배달(PlayReady, Widevine, FairPlay) 또는</span><span class="sxs-lookup"><span data-stu-id="76361-232">1. Azure Media Services License Delivery (PlayReady, Widevine, FairPlay), or</span></span> <br/><span data-ttu-id="76361-233">2. Axinom License Server,</span><span class="sxs-lookup"><span data-stu-id="76361-233">2. Axinom License Server,</span></span> <br/><span data-ttu-id="76361-234">3. 사용자 지정 PlayReady 라이선스 서버</span><span class="sxs-lookup"><span data-stu-id="76361-234">3. Custom PlayReady License Server</span></span> |
| <span data-ttu-id="76361-235">**원본**</span><span class="sxs-lookup"><span data-stu-id="76361-235">**Origin**</span></span> |<span data-ttu-id="76361-236">Azure 미디어 서비스 스트리밍 끝점</span><span class="sxs-lookup"><span data-stu-id="76361-236">Azure Media Services Streaming Endpoint</span></span> |
| <span data-ttu-id="76361-237">**키 관리**</span><span class="sxs-lookup"><span data-stu-id="76361-237">**Key Management**</span></span> |<span data-ttu-id="76361-238">참조 구현에는 필요하지 않음</span><span class="sxs-lookup"><span data-stu-id="76361-238">Not needed for reference implementation</span></span> |
| <span data-ttu-id="76361-239">**콘텐츠 관리**</span><span class="sxs-lookup"><span data-stu-id="76361-239">**Content Management**</span></span> |<span data-ttu-id="76361-240">C# 콘솔 응용 프로그램</span><span class="sxs-lookup"><span data-stu-id="76361-240">A C# console application</span></span> |

<span data-ttu-id="76361-241">즉, IDP(ID 공급자) 및 STS(보안 토큰 서비스) 모두 Azure AD입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-241">In other words, both Identity Provider (IDP) and Secure Token Service (STS) will be Azure AD.</span></span> <span data-ttu-id="76361-242">플레이어로는 [Azure 미디어 플레이어 API](http://amp.azure.net/libs/amp/latest/docs/)를 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-242">For player, we will use [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="76361-243">Azure 미디어 서비스와 Azure 미디어 플레이어는 모두 다중 DRM의 DASH 및 CENC를 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-243">Both Azure Media Services and Azure Media Player support DASH and CENC with multi-DRM.</span></span>

<span data-ttu-id="76361-244">다음 다이어그램에서는 위의 기술 매핑을 사용하는 전체적인 구조 및 흐름을 보여줍니다.</span><span class="sxs-lookup"><span data-stu-id="76361-244">The following diagram shows the overall structure and flow with the above technology mapping.</span></span>

![AMS에서 CENC](./media/media-services-cenc-with-multidrm-access-control/media-services-cenc-subsystem-on-AMS-platform.png)

<span data-ttu-id="76361-246">동적 CENC 암호화를 설정하기 위해 콘텐츠 관리 도구는 다음 입력을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-246">In order to set up dynamic CENC encryption, the content management tool will use the following inputs:</span></span>

1. <span data-ttu-id="76361-247">개방 콘텐츠</span><span class="sxs-lookup"><span data-stu-id="76361-247">Open content;</span></span>
2. <span data-ttu-id="76361-248">키 생성/관리에서 콘텐츠 키</span><span class="sxs-lookup"><span data-stu-id="76361-248">Content key from key generation/management;</span></span>
3. <span data-ttu-id="76361-249">라이선스 획득 URL</span><span class="sxs-lookup"><span data-stu-id="76361-249">License acquisition URLs;</span></span>
4. <span data-ttu-id="76361-250">Azure AD의 정보 목록</span><span class="sxs-lookup"><span data-stu-id="76361-250">A list of information from Azure AD.</span></span>

<span data-ttu-id="76361-251">콘텐츠 관리 도구의 출력은 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-251">The output of the content management tool will be:</span></span>

1. <span data-ttu-id="76361-252">ContentKeyAuthorizationPolicy - 라이선스 배달에서 JWT 토큰 및 DRM 라이선스 사양을 확인하는 방법에 대한 사양 포함</span><span class="sxs-lookup"><span data-stu-id="76361-252">ContentKeyAuthorizationPolicy containing the specification on how license delivery verifies a JWT token and DRM license specifications;</span></span>
2. <span data-ttu-id="76361-253">AssetDeliveryPolicy - 스트리밍 형식, DRM 보호 및 라이선스 획득 URL에 대한 사양 포함</span><span class="sxs-lookup"><span data-stu-id="76361-253">AssetDeliveryPolicy containing specifications on streaming format, DRM protection and license acquisition URLs.</span></span>

<span data-ttu-id="76361-254">런타임 중에 흐름은 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-254">During runtime, the flow is as below:</span></span>

1. <span data-ttu-id="76361-255">사용자 인증 시 JWT 토큰이 생성됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-255">Upon user authentication, a JWT token is generated;</span></span>
2. <span data-ttu-id="76361-256">JWT 토큰에 포함된 클레임 중 하나는 "EntitledUserGroup"의 그룹 개체 ID를 포함하는 "groups" 클레임입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-256">One of the claims contained in the JWT token is “groups” claim containing the group object ID of “EntitledUserGroup”.</span></span> <span data-ttu-id="76361-257">이 클레임은 "자격 확인"을 전달하는 데 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-257">This claim will be used for passing “entitlement check”.</span></span>
3. <span data-ttu-id="76361-258">플레이어는 CENC로 보호된 콘텐츠의 클라이언트 매니페스트를 다운로드하고 다음을 "확인"합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-258">Player downloads client manifest of a CENC protected content and “sees” the following:</span></span>

   1. <span data-ttu-id="76361-259">키 ID</span><span class="sxs-lookup"><span data-stu-id="76361-259">key ID,</span></span>
   2. <span data-ttu-id="76361-260">콘텐츠가 CENC로 보호되는지</span><span class="sxs-lookup"><span data-stu-id="76361-260">the content is CENC protected,</span></span>
   3. <span data-ttu-id="76361-261">라이선스 획득 URL</span><span class="sxs-lookup"><span data-stu-id="76361-261">License acquisition URLs.</span></span>
4. <span data-ttu-id="76361-262">플레이어는 브라우저/DRM 지원에 따라 라이선스 획득 요청을 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-262">Player makes a license acquisition request based on the browser/DRM supported.</span></span> <span data-ttu-id="76361-263">라이선스 획득 요청에서 키 ID 및 JWT 토큰도 제출됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-263">In the license acquisition request, key ID and the JWT token will also be submitted.</span></span> <span data-ttu-id="76361-264">라이선스 배달 서비스는 필요한 라이선스를 발급하기 전에 포함된 JWT 토큰 및 클레임을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-264">License delivery service will verify the JWT token and the claims contained before issuing the needed license.</span></span>

## <a name="implementation"></a><span data-ttu-id="76361-265">구현</span><span class="sxs-lookup"><span data-stu-id="76361-265">Implementation</span></span>
### <a name="implementation-procedures"></a><span data-ttu-id="76361-266">구현 절차</span><span class="sxs-lookup"><span data-stu-id="76361-266">Implementation procedures</span></span>
<span data-ttu-id="76361-267">구현에는 다음 단계가 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-267">The implementation will include the following steps:</span></span>

1. <span data-ttu-id="76361-268">테스트 자산 준비: Azure 미디어 서비스에서 테스트 비디오를 다중 비트 전송률 조각화된 MP4로 인코딩/패키지합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-268">Prepare test asset(s): encode/package a test video to multi-bitrate fragmented MP4 in Azure Media Services.</span></span> <span data-ttu-id="76361-269">이 자산은 DRM으로 보호되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-269">This asset is NOT DRM protected.</span></span> <span data-ttu-id="76361-270">DRM 보호는 나중에 동적 보호로 수행됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-270">DRM protection will be done by dynamic protection later.</span></span>
2. <span data-ttu-id="76361-271">키 ID 및 콘텐츠 키(필요한 경우 키 시드에서)를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="76361-271">Create key ID and content key (optionally from key seed).</span></span> <span data-ttu-id="76361-272">여기서는 여러 테스트 자산에 대해 단일 집합의 키 ID 및 콘텐츠 키만 다루므로 키 관리 시스템이 필요하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-272">For our purpose, key management system is not needed since we are dealing with only a single set of key ID and content key for a couple of test assets;</span></span>
3. <span data-ttu-id="76361-273">AMS API를 사용하여 테스트 자산에 대한 다중 DRM 라이선스 배달 서비스를 구성합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-273">Use AMS API to configure multi-DRM license delivery services for the test asset.</span></span> <span data-ttu-id="76361-274">회사 또는 회사의 공급업체에서 Azure 미디어 서비스의 라이선스 서비스 대신 사용자 지정 라이선스 서버를 사용하는 경우 이 단계를 건너뛰고 라이선스 배달 구성 단계에 라이선스 획득 URL을 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-274">If you are using custom license servers by your company or your company’s vendors instead of license services in Azure Media Services, you can skip this step and specify license acquisition URLs in the step for configuring license delivery.</span></span> <span data-ttu-id="76361-275">AMS API는 권한 부여 정책 제한, 다양한 DRM 라이선스 서비스에 대한 라이선스 응답 템플릿 등과 같은 일부 세부적인 구성을 지정하는 데 필요합니다. 현재는 Azure 포털에서 이 구성에 필요한 UI를 제공하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-275">AMS API is needed to specify some detailed configurations, such as authorization policy restriction, license response templates for different DRM license services, etc. At this time, the Azure portal does not yet provide the needed UI for this configuration.</span></span> <span data-ttu-id="76361-276">Julia Kornich의 문서 [PlayReady 및/또는 Widevine 동적 일반 암호화 사용](media-services-protect-with-drm.md)에서 API 수준 정보 및 샘플 코드를 찾을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-276">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
4. <span data-ttu-id="76361-277">AMS API를 사용하여 테스트 자산에 대한 자산 배달 정책을 구성합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-277">Use AMS API to configure asset delivery policy for the test asset.</span></span> <span data-ttu-id="76361-278">Julia Kornich의 문서 [PlayReady 및/또는 Widevine 동적 일반 암호화 사용](media-services-protect-with-drm.md)에서 API 수준 정보 및 샘플 코드를 찾을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-278">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
5. <span data-ttu-id="76361-279">Azure에서 Azure Active Directory 테넌트를 만들고 구성합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-279">Create and configure an Azure Active Directory tenant in Azure;</span></span>
6. <span data-ttu-id="76361-280">Azure Active Directory 테넌트에서 몇 가지 사용자 계정 및 그룹 만들기: "EntitledUser" 그룹 이상을 만들고 사용자를 이 그룹에 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-280">Create a few user accounts and groups in your Azure Active Directory tenant: you should create at least “EntitledUser” group and add a user to this group.</span></span> <span data-ttu-id="76361-281">이 그룹의 사용자는 라이선스 획득 시 자격 확인을 전달하고 이 그룹에 없는 사용자는 인증 확인 전달에 실패하며 라이선스를 획득할 수 없게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-281">Users in this group will pass entitlement check in license acquisition and users not in this group will fail to pass authentication check and will not be able to acquire any license.</span></span> <span data-ttu-id="76361-282">이 "EntitledUser" 그룹의 멤버가 되려면 Azure AD에서 발급한 JWT 토큰의 필수 "groups" 클레임이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-282">Being a member of this “EntitledUser” group is a required “groups” claim in the JWT token issued by Azure AD.</span></span> <span data-ttu-id="76361-283">이 클레임 요구 사항은 다중 DRM 라이선스 배달 서비스 단계를 구성하는 데 지정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-283">This claim requirement should be specified in configuring multi-DRM license delivery services step.</span></span>
7. <span data-ttu-id="76361-284">비디오 플레이어를 호스팅할 ASP.NET MVC 앱을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="76361-284">Create an ASP.NET MVC app which will be hosting your video player.</span></span> <span data-ttu-id="76361-285">이 ASP.NET 앱은 Azure Active Directory 테넌트에 대한 사용자 인증으로 보호됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-285">This ASP.NET app will be protected with user authentication against the Azure Active Directory tenant.</span></span> <span data-ttu-id="76361-286">적절한 클레임이 사용자 인증 후 얻은 액세스 토큰에 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-286">Proper claims will be included in the access tokens obtained after user authentication.</span></span> <span data-ttu-id="76361-287">이 단계에는 OpenID Connect API가 권장됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-287">OpenID Connect API is recommended for this step.</span></span> <span data-ttu-id="76361-288">다음 NuGet 패키지를 설치해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-288">You need to install the following NuGet packages:</span></span>
   * <span data-ttu-id="76361-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span><span class="sxs-lookup"><span data-stu-id="76361-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span></span>
   * <span data-ttu-id="76361-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span><span class="sxs-lookup"><span data-stu-id="76361-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span></span>
   * <span data-ttu-id="76361-291">Install-Package Microsoft.Owin.Security.Cookies</span><span class="sxs-lookup"><span data-stu-id="76361-291">Install-Package Microsoft.Owin.Security.Cookies</span></span>
   * <span data-ttu-id="76361-292">Install-Package Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="76361-292">Install-Package Microsoft.Owin.Host.SystemWeb</span></span>
   * <span data-ttu-id="76361-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span><span class="sxs-lookup"><span data-stu-id="76361-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span></span>
8. <span data-ttu-id="76361-294">[Azure 미디어 플레이어 API](http://amp.azure.net/libs/amp/latest/docs/)를 사용하여 플레이어를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="76361-294">Create a player using [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="76361-295">[Azure 미디어 플레이어의 ProtectionInfo API](http://amp.azure.net/libs/amp/latest/docs/) 를 통해 다양한 DRM 플랫폼에 사용할 DRM 기술을 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-295">[Azure Media Player’s ProtectionInfo API](http://amp.azure.net/libs/amp/latest/docs/) allows you to specify which DRM technology to use on different DRM platform.</span></span>
9. <span data-ttu-id="76361-296">테스트 매트릭스:</span><span class="sxs-lookup"><span data-stu-id="76361-296">Test matrix:</span></span>

| <span data-ttu-id="76361-297">**DRM**</span><span class="sxs-lookup"><span data-stu-id="76361-297">**DRM**</span></span> | <span data-ttu-id="76361-298">**브라우저**</span><span class="sxs-lookup"><span data-stu-id="76361-298">**Browser**</span></span> | <span data-ttu-id="76361-299">**자격이 있는 사용자에 대한 결과**</span><span class="sxs-lookup"><span data-stu-id="76361-299">**Result for Entitled User**</span></span> | <span data-ttu-id="76361-300">**자격이 없는 사용자에 대한 결과**</span><span class="sxs-lookup"><span data-stu-id="76361-300">**Result for Un-entitled User**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="76361-301">**PlayReady**</span><span class="sxs-lookup"><span data-stu-id="76361-301">**PlayReady**</span></span> |<span data-ttu-id="76361-302">Windows 10의 MS Edge 또는 IE11</span><span class="sxs-lookup"><span data-stu-id="76361-302">MS Edge or IE11 on Windows 10</span></span> |<span data-ttu-id="76361-303">합격</span><span class="sxs-lookup"><span data-stu-id="76361-303">Succeed</span></span> |<span data-ttu-id="76361-304">불합격</span><span class="sxs-lookup"><span data-stu-id="76361-304">Fail</span></span> |
| <span data-ttu-id="76361-305">**Widevine**</span><span class="sxs-lookup"><span data-stu-id="76361-305">**Widevine**</span></span> |<span data-ttu-id="76361-306">Windows 10의 Chrome</span><span class="sxs-lookup"><span data-stu-id="76361-306">Chrome on Windows 10</span></span> |<span data-ttu-id="76361-307">합격</span><span class="sxs-lookup"><span data-stu-id="76361-307">Succeed</span></span> |<span data-ttu-id="76361-308">불합격</span><span class="sxs-lookup"><span data-stu-id="76361-308">Fail</span></span> |
| <span data-ttu-id="76361-309">**FairPlay**</span><span class="sxs-lookup"><span data-stu-id="76361-309">**FairPlay**</span></span> |<span data-ttu-id="76361-310">TBD</span><span class="sxs-lookup"><span data-stu-id="76361-310">TBD</span></span> | | |

<span data-ttu-id="76361-311">Azure 미디어 서비스 팀의 George Trifonov는 ASP.NET MVC 플레이어 앱에 대한 Azure Active Directory를 설정하는 자세한 단계를 제공하는 블로그, [Azure Active Directory와 Azure 미디어 서비스 OWIN MVC 기반 앱을 Azure Active Directory와 통합 및 JWT 클레임을 기반으로 하는 콘텐츠 키 배달 제한](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/)을 작성했습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-311">George Trifonov of Azure Media Services Team has written a blog providing detailed steps in setting up Azure Active Directory for an ASP.NET MVC player app: [Integrate Azure Media Services OWIN MVC based app with Azure Active Directory and restrict content key delivery based on JWT claims](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span></span>

<span data-ttu-id="76361-312">또한 [Azure 미디어 서비스 및 동적 암호화의 JWT 토큰 인증](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/)에 대한 블로그도 작성했습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-312">George has also written a blog on [JWT token Authentication in Azure Media Services and Dynamic Encryption](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span> <span data-ttu-id="76361-313">그리고 그의 [Azure 미디어 서비스 키 배달을 사용한 Azure AD 통합 샘플](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/)을 여기에서 다룹니다.</span><span class="sxs-lookup"><span data-stu-id="76361-313">And here is his [sample on Azure AD integration with Azure Media Services key delivery](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span></span>

<span data-ttu-id="76361-314">Azure Active Directory에 대한 자세한 내용은 다음을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="76361-314">For information on Azure Active Directory:</span></span>

* <span data-ttu-id="76361-315">[Azure Active Directory 개발자 가이드](../active-directory/active-directory-developers-guide.md)에서 개발자 정보를 찾을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-315">You can find developer information in [Azure Active Directory Developer’s Guide](../active-directory/active-directory-developers-guide.md).</span></span>
* <span data-ttu-id="76361-316">[Azure AD 디렉터리 관리](../active-directory/active-directory-administer.md)에서 관리자 정보를 찾을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-316">You can find administrator information in [Administer Your Azure AD Directory](../active-directory/active-directory-administer.md).</span></span>

### <a name="some-gotchas-in-implementation"></a><span data-ttu-id="76361-317">구현에 대해 몇 가지 알려진 문제</span><span class="sxs-lookup"><span data-stu-id="76361-317">Some gotchas in implementation</span></span>
<span data-ttu-id="76361-318">구현에 대해 몇 가지 "알려진 문제"가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-318">There are some “gotchas” in the implementation.</span></span> <span data-ttu-id="76361-319">다행히 다음 "알려진 문제" 목록을 통해 문제가 발생하는 문제를 해결할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-319">Hopefully the following list of “gotchas” can help you troubleshooting in case you run into issues.</span></span>

1. <span data-ttu-id="76361-320">**발급자** URL은 **"/"**로 끝나야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-320">**Issuer** URL should end with **"/"**.</span></span>  

    <span data-ttu-id="76361-321">**대상**은 플레이어 응용 프로그램 클라이언트 ID여야 하며 발급자 URL 끝에 **"/"**를 추가해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-321">**Audience** should be the player application client ID and you should also add **"/"** at the end of the issuer URL.</span></span>

        <add key="ida:audience" value="[Application Client ID GUID]" />
        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/" />

    <span data-ttu-id="76361-322">[JWT 디코더](http://jwt.calebb.net/)에서 JWT 토큰에 다음과 같이 **aud** 및 **iss**가 나타납니다.</span><span class="sxs-lookup"><span data-stu-id="76361-322">In [JWT Decoder](http://jwt.calebb.net/), you should see **aud** and **iss** as below in the JWT token:</span></span>

    ![첫 번째 알려진 문제](./media/media-services-cenc-with-multidrm-access-control/media-services-1st-gotcha.png)
2. <span data-ttu-id="76361-324">AAD의 응용 프로그램에 권한을 추가합니다(응용 프로그램의 구성 탭).</span><span class="sxs-lookup"><span data-stu-id="76361-324">Add Permissions to the application in AAD (on Configure tab of the application).</span></span> <span data-ttu-id="76361-325">각 응용 프로그램(로컬 및 배포된 버전)에 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-325">This is required for each application (local and deployed versions).</span></span>

    ![두 번째 알려진 문제](./media/media-services-cenc-with-multidrm-access-control/media-services-perms-to-other-apps.png)
3. <span data-ttu-id="76361-327">동적 CENC 보호 설정에 올바른 발급자를 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-327">Use the right issuer in setting up dynamic CENC protection:</span></span>

        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/"/>

    <span data-ttu-id="76361-328">다음은 작동하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-328">The following will not work:</span></span>

        <add key="ida:issuer" value="https://willzhanad.onmicrosoft.com/" />

    <span data-ttu-id="76361-329">GUID는 AAD 테넌트 ID입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-329">The GUID is the AAD tenant ID.</span></span> <span data-ttu-id="76361-330">Azure 포털의 끝점 팝업 창에서 GUID를 찾을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-330">The GUID can be found in Endpoints popup in Azure portal.</span></span>
4. <span data-ttu-id="76361-331">그룹 멤버 자격 클레임 권한을 부여합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-331">Grant group membership claims privileges.</span></span> <span data-ttu-id="76361-332">AAD 응용 프로그램 매니페스트 파일에서 다음이 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-332">Make sure in AAD application manifest file, we have the following</span></span>

    <span data-ttu-id="76361-333">"groupMembershipClaims": "All", (기본값은 null)</span><span class="sxs-lookup"><span data-stu-id="76361-333">"groupMembershipClaims": "All",    (the default value is null)</span></span>
5. <span data-ttu-id="76361-334">제한 사항 요구 사항을 만들 때 적절한 TokenType을 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-334">Setting proper TokenType when creating restriction requirements.</span></span>

        objTokenRestrictionTemplate.TokenType = TokenType.JWT;

    <span data-ttu-id="76361-335">SWT(ACS) 외에도 JWT(AAD)의 지원이 추가되었으므로 기본 TokenType은 TokenType.JWT입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-335">Since adding support of JWT (AAD) in addition to SWT (ACS), the default TokenType is TokenType.JWT.</span></span> <span data-ttu-id="76361-336">SWT/ACS를 사용하는 경우 TokenType.SWT로 설정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-336">If you use SWT/ACS, you must set to TokenType.SWT.</span></span>

## <a name="additional-topics-for-implementation"></a><span data-ttu-id="76361-337">구현에 대한 추가 토픽</span><span class="sxs-lookup"><span data-stu-id="76361-337">Additional Topics for Implementation</span></span>
<span data-ttu-id="76361-338">다음으로 디자인 및 구현에 대한 몇 가지 추가 토픽에 대해서 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-338">Next we will disc uss some additional topics in our design and implementation.</span></span>

### <a name="http-or-https"></a><span data-ttu-id="76361-339">HTTP 또는 HTTPS</span><span class="sxs-lookup"><span data-stu-id="76361-339">HTTP or HTTPS?</span></span>
<span data-ttu-id="76361-340">구축한 ASP.NET MVC 플레이어 응용 프로그램은 다음을 지원해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-340">The ASP.NET MVC player application we built must support the following:</span></span>

1. <span data-ttu-id="76361-341">Azure AD를 통한 사용자 인증이 HTTPS를 사용해야 함</span><span class="sxs-lookup"><span data-stu-id="76361-341">User authentication through Azure AD which needs to be under HTTPS;</span></span>
2. <span data-ttu-id="76361-342">클라이언트 및 Azure AD 간 JWT 토큰 교환이 HTTPS를 사용해야 함</span><span class="sxs-lookup"><span data-stu-id="76361-342">JWT token exchange between client and Azure AD which needs to be under HTTPS;</span></span>
3. <span data-ttu-id="76361-343">Azure 미디어 서비스에서 라이선스 배달이 제공된 경우 클라이언트에 의한 DRM 라이선스 획득 시 HTTPS를 사용해야 함.</span><span class="sxs-lookup"><span data-stu-id="76361-343">DRM license acquisition by the client which is required to be under HTTPS if license delivery is provided by Azure Media Services.</span></span> <span data-ttu-id="76361-344">물론 PlayReady 제품군은 라이선스 배달에 대한 HTTPS를 위임하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-344">Of course, PlayReady product suite does not mandate HTTPS for license delivery.</span></span> <span data-ttu-id="76361-345">PlayReady 라이선스 서버가 Azure 미디어 서비스 외부에 있는 경우 HTTP 또는 HTTPS를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-345">If your PlayReady license server is outside of Azure Media Services, either HTTP or HTTPS could be used.</span></span>

<span data-ttu-id="76361-346">따라서 ASP.NET 플레이어 응용 프로그램은 HTTPS를 사용하는 것이 가장 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-346">Therefore, the ASP.NET player application will use HTTPS as a best practice.</span></span> <span data-ttu-id="76361-347">즉, Azure 미디어 플레이어는 HTTPS를 사용하는 페이지에 있게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-347">This means the Azure Media Player will be on a page under HTTPS.</span></span> <span data-ttu-id="76361-348">그러나 스트리밍의 경우 HTTP를 선호하므로 콘텐츠 혼합 문제를 고려해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-348">However, for streaming we prefer HTTP, hence we need to consider mixed content issue.</span></span>

1. <span data-ttu-id="76361-349">브라우저에서는 혼합 콘텐츠를 허용하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-349">Browser does not allow mixed content.</span></span> <span data-ttu-id="76361-350">하지만 Silverlight과 같은 플러그인, 부드러운 스트리밍을 위한 OSMF 플러그인 및 DASH는 허용합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-350">But plugins like Silverlight and OSMF plugin for smooth and DASH allow.</span></span> <span data-ttu-id="76361-351">혼합 콘텐츠는 보안 문제가 발생할 수 있습니다. 악성 JS를 주입할 수 있는 위협으로 인해 고객 데이터가 위험할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-351">Mixed content is a security concern - This is due to the threat of the ability to inject malicious JS which can cause the customer data to be at risk.</span></span>  <span data-ttu-id="76361-352">브라우저는 기본적으로 이를 차단하며 지금까지는 이 문제를 해결하는 유일한 방법이 서버(원본) 쪽에서 https 또는 http에 관계 없이 모든 도메인을 허용하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-352">Browsers block this by default and so far the only way to work around it is on the server (origin) side, to allow all domains (regardless https or http).</span></span> <span data-ttu-id="76361-353">하지만 좋은 방법은 아닙니다.</span><span class="sxs-lookup"><span data-stu-id="76361-353">This is probably not a good idea either.</span></span>
2. <span data-ttu-id="76361-354">둘 다 HTTP를 사용하거나 둘 다 HTTPS를 사용해서 혼합 콘텐츠를 피해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-354">We should avoid mixed content: either both use HTTP or both use HTTPS.</span></span> <span data-ttu-id="76361-355">혼합된 콘텐츠를 재생할 때 silverlightSS 기술은 혼합된 콘텐츠 경고를 지워야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-355">When playing mixed content, silverlightSS tech requires clearing a mixed content warning.</span></span> <span data-ttu-id="76361-356">flashSS 기술은 혼합된 콘텐츠 경고 없이 혼합된 콘텐츠를 처리합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-356">flashSS tech handles mixed content without mixed content warning.</span></span>
3. <span data-ttu-id="76361-357">스트리밍 끝점이 2014년 8월 전에 만들어진 경우 HTTPS를 지원하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-357">If your streaming endpoint was created before August 2014, it will not support HTTPS.</span></span> <span data-ttu-id="76361-358">이 경우 HTTPS에 대한 새 스트리밍 끝점을 만들어 사용하세요.</span><span class="sxs-lookup"><span data-stu-id="76361-358">In this case, please create and use a new streaming endpoint for HTTPS.</span></span>

<span data-ttu-id="76361-359">참조 구현에서 DRM으로 보호된 콘텐츠에서는 응용 프로그램 및 스트리밍이 모두 HTTTPS를 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-359">In the reference implementation, for DRM protected contents, both application and streaming will be under HTTTPS.</span></span> <span data-ttu-id="76361-360">개방 콘텐츠의 경우 플레이어에서 인증 또는 라이선스가 필요하지 않으므로 HTTP 또는 HTTPS 중에 원하는 것을 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-360">For open contents, the player does not need authentication or license, so you have the liberty to use either HTTP or HTTPS.</span></span>

### <a name="azure-active-directory-signing-key-rollover"></a><span data-ttu-id="76361-361">Azure Active Directory 서명 키 롤오버</span><span class="sxs-lookup"><span data-stu-id="76361-361">Azure Active Directory signing key rollover</span></span>
<span data-ttu-id="76361-362">구현 시 중요한 고려 사항입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-362">This is an important point to take into consideration of your implementation.</span></span> <span data-ttu-id="76361-363">구현 시 이를 고려하지 않으면 완료된 시스템은 결국 6주 이내에 완전히 중지됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-363">If you do not consider this in your implementation, the completed system will eventually stop working completely within at most 6 weeks.</span></span>

<span data-ttu-id="76361-364">Azure AD에서는 업계 표준을 사용하여 Azure AD 자체와 Azure AD를 사용하는 응용 프로그램 간에 신뢰를 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-364">Azure AD uses industry standard to establish trust between itself and applications using Azure AD.</span></span> <span data-ttu-id="76361-365">특히, Azure AD는 공개 및 개인 키 쌍으로 구성된 서명 키를 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-365">Specifically, Azure AD uses a signing key that consists of a public and private key pair.</span></span> <span data-ttu-id="76361-366">Azure AD에서 사용자에 대한 정보가 포함된 보안 토큰을 만드는 경우 이 토큰은 응용 프로그램으로 다시 전송되기 전에 Azure AD에 의해 개인 키를 사용하여 서명됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-366">When Azure AD creates a security token that contains information about the user, this token is signed by Azure AD using its private key before it is sent back to the application.</span></span> <span data-ttu-id="76361-367">해당 토큰이 유효하고 실제로 Azure AD에서 발생한 것인지 확인하기 위해 응용 프로그램은 테넌트의 페더레이션 메타데이터 문서에 포함된 Azure AD가 노출한 공개 키를 사용하여 토큰의 서명을 유효성 검사해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-367">To verify that the token is valid and actually originated from Azure AD, the application must validate the token’s signature using the public key exposed by Azure AD that is contained in the tenant’s federation metadata document.</span></span> <span data-ttu-id="76361-368">이 공개 키와 이로부터 파생된 서명 키는 Azure AD의 모든 테넌트에 사용된 것과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-368">This public key – and the signing key from which it derives – is the same one used for all tenants in Azure AD.</span></span>

<span data-ttu-id="76361-369">Azure AD 키 롤오버에 대한 자세한 정보는 [Azure AD의 서명 키 롤오버에 대한 중요한 정보](../active-directory/active-directory-signing-key-rollover.md)에서 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-369">Detailed info on Azure AD key rollover can be found in the document: [Important Information about Signing Key Rollover in Azure AD](../active-directory/active-directory-signing-key-rollover.md).</span></span>

<span data-ttu-id="76361-370">[공개-개인 키 쌍](https://login.microsoftonline.com/common/discovery/keys/)중에서,</span><span class="sxs-lookup"><span data-stu-id="76361-370">Between the [public-private key pair](https://login.microsoftonline.com/common/discovery/keys/),</span></span>

* <span data-ttu-id="76361-371">Azure Active Directory가 JWT 토큰을 생성하는 데 개인 키가 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-371">The private key is used by Azure Active Directory to generate a JWT token;</span></span>
* <span data-ttu-id="76361-372">AMS의 DRM 라이선스 배달 서비스와 같은 응용 프로그램에서 JWT 토큰을 확인하는 데 공개 키가 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-372">The public key is used by an application such as DRM License Delivery Services in AMS to verify the JWT token;</span></span>

<span data-ttu-id="76361-373">보안을 위해 Azure Active Directory는 이 인증서를 주기적(6주마다)으로 바꿉니다.</span><span class="sxs-lookup"><span data-stu-id="76361-373">For security purpose, Azure Active Directory rotates this certificate periodically (every 6 weeks).</span></span> <span data-ttu-id="76361-374">보안 침해가 발생하는 경우에는 언제든지 키 롤오버가 발생할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-374">In case of security breaches, the key rollover can occur any time.</span></span> <span data-ttu-id="76361-375">따라서 AMS의 라이선스 배달 서비스는 Azure AD에서 키 쌍을 바꾸므로 사용된 공개 키를 업데이트해야 하며 그렇지 않으면 AMS의 토큰 인증이 실패하고 라이선스가 발급되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-375">Therefore, the license delivery services in AMS need to update the public key used as Azure AD rotates the key pair, otherwise token authentication in AMS will fail and no license will be issued.</span></span>

<span data-ttu-id="76361-376">이 작업은 DRM 라이선스 배달 서비스를 구성할 때 TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument를 설정하여 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-376">This is achieved by setting TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument when configuring DRM license delivery services.</span></span>

<span data-ttu-id="76361-377">JWT 토큰 흐름은 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-377">The JWT token flow is as below:</span></span>

1. <span data-ttu-id="76361-378">Azure AD가 인증된 사용자에 대한 최신 개인 키로 JWT 토큰을 발급합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-378">Azure AD will issue the JWT token with the current private key for an authenticated user;</span></span>
2. <span data-ttu-id="76361-379">플레이어가 다중 DRM으로 보호된 콘텐츠와 함께 CENC를 인식하면 먼저 Azure AD에서 발급한 JWT 토큰을 찾습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-379">When a player sees a CENC with multi-DRM protected content, it will first locate the JWT token issued by Azure AD.</span></span>
3. <span data-ttu-id="76361-380">플레이어는 JWT 토큰과 함께 라이선스 획득 요청을 AMS의 라이선스 배달 서비스로 보냅니다.</span><span class="sxs-lookup"><span data-stu-id="76361-380">The player sends license acquisition request with the JWT token to license delivery services in AMS;</span></span>
4. <span data-ttu-id="76361-381">AMS의 라이선스 배달 서비스는 라이선스를 발급하기 전에 Azure AD의 최신/유효한 공개 키를 사용하여 JWT 토큰을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-381">The license delivery services in AMS will use the current/valid public key from Azure AD to verify the JWT token, before issuing licenses.</span></span>

<span data-ttu-id="76361-382">DRM 라이선스 배달 서비스는 항상 Azure AD에서 최신/유효한 공개 키를 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-382">DRM license delivery services will always be checking for the current/valid public key from Azure AD.</span></span> <span data-ttu-id="76361-383">Azure AD에서 제공되는 공개 키는 Azure AD에서 발급한 JWT 토큰을 확인하는 데 사용되는 키가 됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-383">The public key presented by Azure AD will be the key used for verifying a JWT token issued by Azure AD.</span></span>

<span data-ttu-id="76361-384">AAD가 JWT 토큰을 생성한 후, 플레이어가 확인을 위해 JWT 토큰을 AMS의 DRM 라이선스 배달 서비스로 보내기 전에 키 롤오버가 발생한다면 어떻게 되나요?</span><span class="sxs-lookup"><span data-stu-id="76361-384">What if the key rollover happens after AAD generates a JWT token but before the JWT token is sent by players to DRM license delivery services in AMS for verification?</span></span>

<span data-ttu-id="76361-385">키는 언제든지 롤오버될 수 있으므로 페더레이션 메타데이터 문서에는 사용 가능한 공개 키가 항상 두 개 이상 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-385">Because a key may be rolled at any moment, there is always more than one valid public key available in the federation metadata document.</span></span> <span data-ttu-id="76361-386">Azure 미디어 서비스 라이선스 배달에서는 하나의 키가 곧 롤오버되고 다른 키가 대체되는 방식으로 문서에 지정된 키를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-386">Azure Media Services license delivery can use any of the keys specified in the document, since one key may be rolled soon, another may be its replacement, and so forth.</span></span>

### <a name="where-is-the-access-token"></a><span data-ttu-id="76361-387">액세스 토큰 위치</span><span class="sxs-lookup"><span data-stu-id="76361-387">Where is the Access Token?</span></span>
<span data-ttu-id="76361-388">웹앱에서 [OAuth 2.0 클라이언트 자격 증명 권한을 사용한 응용 프로그램 ID](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api)로 API 앱을 호출하는 방식을 살펴보면 인증 흐름은 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-388">If you look at how a web app calls an API app under [Application Identity with OAuth 2.0 Client Credentials Grant](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), the authentication flow is as below:</span></span>

1. <span data-ttu-id="76361-389">사용자가 웹 응용 프로그램에서 Azure AD에 로그인합니다( [웹 브라우저-웹 응용 프로그램](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application)참조).</span><span class="sxs-lookup"><span data-stu-id="76361-389">A user is signed in to Azure AD in the web application (see the [Web Browser to Web Application](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application).</span></span>
2. <span data-ttu-id="76361-390">Azure AD 권한 부여 끝점은 사용자 에이전트를 인증 코드와 함께 클라이언트 응용 프로그램으로 리디렉션합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-390">The Azure AD authorization endpoint redirects the user agent back to the client application with an authorization code.</span></span> <span data-ttu-id="76361-391">사용자 에이전트는 인증 코드를 클라이언트 응용 프로그램의 리디렉션 URI로 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-391">The user agent returns authorization code to the client application’s redirect URI.</span></span>
3. <span data-ttu-id="76361-392">웹 응용 프로그램이 웹 API에 인증하고 원하는 리소스를 검색할 수 있도록 액세스 토큰을 획득해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-392">The web application needs to acquire an access token so that it can authenticate to the web API and retrieve the desired resource.</span></span> <span data-ttu-id="76361-393">Azure AD의 토큰 끝점에 요청하여 자격 증명, 클라이언트 ID, 웹 API의 응용 프로그램 ID URI를 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-393">It makes a request to Azure AD’s token endpoint, providing the credential, client ID, and web API’s application ID URI.</span></span> <span data-ttu-id="76361-394">사용자가 동의했음을 증명하는 인증 코드를 표시합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-394">It presents the authorization code to prove that the user has consented.</span></span>
4. <span data-ttu-id="76361-395">Azure AD가 응용 프로그램을 인증하고 웹 API를 호출하는 데 사용되는 JWT 액세스 토큰을 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-395">Azure AD authenticates the application and returns a JWT access token that is used to call the web API.</span></span>
5. <span data-ttu-id="76361-396">HTTPS를 통해 웹 응용 프로그램이 반환된 JWT 액세스 토큰을 사용해서 웹 API에 대한 요청의 권한 부여 헤더에 “전달자”를 지정한 JWT 문자열을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-396">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="76361-397">그러면 웹 API에서 JWT 토큰의 유효성을 검사하여 유효성 검사가 성공하면 원하는 리소스를 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-397">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

<span data-ttu-id="76361-398">이 "응용 프로그램 ID" 흐름에서 웹 API는 웹 응용 프로그램이 해당 사용자를 인증했음을 신뢰합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-398">In this “application identity” flow, the web API trusts that the web application authenticated the user.</span></span> <span data-ttu-id="76361-399">이런 이유로, 이 패턴을 신뢰할 수 있는 하위 시스템이라고 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-399">For this reason, this pattern is called a trusted subsystem.</span></span> <span data-ttu-id="76361-400">[이 페이지의 다이어그램](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) 은 인증 코드 부여 흐름이 어떻게 작동하는지를 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-400">The [diagram on this page](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) describes how authorization code grant flow works.</span></span>

<span data-ttu-id="76361-401">토큰 제한으로 라이선스 획득 시 동일한 신뢰할 수 있는 하위 시스템 패턴을 따릅니다.</span><span class="sxs-lookup"><span data-stu-id="76361-401">In license acquisition with token restriction, we are following the same trusted subsystem pattern.</span></span> <span data-ttu-id="76361-402">Azure 미디어 서비스의 라이선스 배달 서비스가 웹 API 리소스이고 웹 응용 프로그램이 액세스해야 하는 "백 엔드 리소스"입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-402">And the license delivery service in Azure Media Services is the web API resource, the “backend resource” a web application needs to access.</span></span> <span data-ttu-id="76361-403">그렇다면 액세스 토큰은 어디에 있을까요?</span><span class="sxs-lookup"><span data-stu-id="76361-403">So where is the access token?</span></span>

<span data-ttu-id="76361-404">실제로, Azure AD에서 액세스 토큰을 가져옵니다.</span><span class="sxs-lookup"><span data-stu-id="76361-404">Indeed, we are obtaining access token from Azure AD.</span></span> <span data-ttu-id="76361-405">사용자 인증에 성공하면 인증 코드가 반환됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-405">After successful user authentication, authorization code is returned.</span></span> <span data-ttu-id="76361-406">그런 다음 액세스 토큰 교환을 위해 인증 코드가 클라이언트 ID 및 앱 키와 함께 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-406">The authorization code is then used, together with client ID and app key, to exchange for access token.</span></span> <span data-ttu-id="76361-407">액세스 토큰은 Azure 미디어 서비스 라이선스 배달 서비스를 가리키거나 나타내는 "포인터" 응용 프로그램을 액세스하기 위한 것입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-407">And the access token is for accessing a “pointer” application pointing or representing Azure Media Services license delivery service.</span></span>

<span data-ttu-id="76361-408">다음 단계에 따라 Azure AD에서 "포인터" 앱을 등록 및 구성해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-408">We need to register and configure the “pointer” app in Azure AD by following the steps below:</span></span>

1. <span data-ttu-id="76361-409">Azure AD 테넌트에서</span><span class="sxs-lookup"><span data-stu-id="76361-409">In the Azure AD tenant</span></span>

   * <span data-ttu-id="76361-410">로그온 URL과 함께 응용 프로그램(리소스)을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-410">add an application (resource) with sign-on URL:</span></span>

   <span data-ttu-id="76361-411">https://[resource_name].azurewebsites.net/ 및</span><span class="sxs-lookup"><span data-stu-id="76361-411">https://[resource_name].azurewebsites.net/ and</span></span>

   * <span data-ttu-id="76361-412">앱 ID URL:</span><span class="sxs-lookup"><span data-stu-id="76361-412">app ID URL:</span></span>

   <span data-ttu-id="76361-413">https://[aad_tenant_name].onmicrosoft.com/[resource_name];</span><span class="sxs-lookup"><span data-stu-id="76361-413">https://[aad_tenant_name].onmicrosoft.com/[resource_name];</span></span>
2. <span data-ttu-id="76361-414">리소스 앱에 대한 새 키를 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-414">Add a new key for the resource app;</span></span>
3. <span data-ttu-id="76361-415">groupMembershipClaims 속성이 "groupMembershipClaims": "All"을 포함하도록 앱 매니페스트 파일을 업데이트합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-415">Update the app manifest file so that the groupMembershipClaims property has the following value: "groupMembershipClaims": "All",</span></span>  
4. <span data-ttu-id="76361-416">플레이어 웹앱을 가리키는 Azure AD 앱의 "다른 응용 프로그램에 대한 권한" 섹션에서 위의 1단계에서 추가한 리소스 앱을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-416">In the Azure AD app pointing to the player web app, in the section “permissions to other applications”, add the resource app which was added in step 1 above.</span></span> <span data-ttu-id="76361-417">"위임된 권한"에서 "[resource_name] 액세스" 확인 표시를 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-417">Under “delegated permissions” check “Access [resource_name]” checkmark.</span></span> <span data-ttu-id="76361-418">그러면 리소스 앱에 액세스하기 위한 액세스 토큰을 만드는 웹앱 권한이 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-418">This gives the web app permission to create access tokens for accessing the resource app.</span></span> <span data-ttu-id="76361-419">Visual Studio 및 Azure 웹앱으로 개발 중이라면 웹앱의 로컬 및 배포된 버전 모두에 대해 이 작업을 수행해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-419">You should do this for both local and deployed version of the web app if you are developing with Visual Studio and Azure web app.</span></span>

<span data-ttu-id="76361-420">따라서 Azure AD에서 발급한 JWT 토큰이 실제로 이 "포인터" 리소스에 액세스하기 위한 액세스 토큰입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-420">Therefore, the JWT token issued by Azure AD is indeed the access token for accessing this “pointer” resource.</span></span>

### <a name="what-about-live-streaming"></a><span data-ttu-id="76361-421">라이브 스트리밍의 경우는 어떨까요?</span><span class="sxs-lookup"><span data-stu-id="76361-421">What about Live Streaming?</span></span>
<span data-ttu-id="76361-422">위의 설명에서는 주문형 자산에 초점을 두었습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-422">In the above, our discussion has been focusing on on-demand assets.</span></span> <span data-ttu-id="76361-423">라이브 스트리밍의 경우는 어떨까요?</span><span class="sxs-lookup"><span data-stu-id="76361-423">What about live streaming?</span></span>

<span data-ttu-id="76361-424">좋은 소식은 프로그램과 연결된 자산을 "VOD 자산"으로 처리하여 Azure 미디어 서비스에서 라이브 스트리밍을 보호하는 데 정확히 동일한 디자인 및 구현을 사용할 수 있다는 점입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-424">The good news is that you can use exactly the same design and implementation for protecting live streaming in Azure Media Services, by treating the asset associated with a program as a “VOD asset”.</span></span>

<span data-ttu-id="76361-425">특히 잘 알려진 것처럼 Azure 미디어 서비스에서 라이브 스트리밍할 경우 채널을 만든 후 해당 채널 아래 프로그램을 만들어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-425">Specifically, it is well known that to do live streaming in Azure Media Services, you need to create a channel, then a program under the channel.</span></span> <span data-ttu-id="76361-426">프로그램을 만들려면 프로그램에 대한 라이브 아카이브를 포함할 자산을 만들어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-426">To create the program, you need to create an asset which will contain the live archive for the program.</span></span> <span data-ttu-id="76361-427">라이브 콘텐츠의 다중 DRM 보호로 CENC를 제공하려면 프로그램 시작 전에, "VOD 자산"이었던 것처럼 자산에 동일한 설정/처리를 적용하기만 하면 됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-427">In order to provide CENC with multi-DRM protection of the live content, all you need to do, is to apply the same setup/processing to the asset as if it was a “VOD asset” before you start the program.</span></span>

### <a name="what-about-license-servers-outside-of-azure-media-services"></a><span data-ttu-id="76361-428">Azure 미디어 서비스 외부에서 라이선스 서버는 어떨까요?</span><span class="sxs-lookup"><span data-stu-id="76361-428">What about license servers outside of Azure Media Services?</span></span>
<span data-ttu-id="76361-429">고객들은 대체로 고유한 데이터 센터 또는 DRM 서비스 공급자가 호스팅하는 형태로 라이선스 서버 팜에 투자할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-429">Often, customers may have invested in license server farm either in their own data center or hosted by DRM service providers.</span></span> <span data-ttu-id="76361-430">다행스럽게도 Azure 미디어 서비스 콘텐츠 보호를 사용하면 Azure 미디어 서비스에서 호스팅 및 동적으로 보호되는 콘텐츠를 하이브리드 모드로 작업할 수 있습니다. 반면 DRM 라이선스는 Azure 미디어 서비스 외부 서버에서 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-430">Fortunately, Azure Media Services Content Protection allows you to operate in hybrid mode: contents hosted and dynamically protected in Azure Media Services, while DRM licenses are delivered by servers outside Azure Media Services.</span></span> <span data-ttu-id="76361-431">이 경우 변경에 대한 다음 고려 사항이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-431">In this case, there are the following considerations of changes:</span></span>

1. <span data-ttu-id="76361-432">보안 토큰 서비스는 라이선스 서버 팜에서 허용되고 확인할 수 있는 토큰을 발급해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-432">The Secure Token Service needs to issue tokens which are acceptable and can be verified by the license server farm.</span></span> <span data-ttu-id="76361-433">예를 들어 Axinom에서 제공하는 Widevine 라이선스 서버에는 "자격 메시지"를 포함하는 특정 JWT 토큰이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-433">For example, the Widevine license servers provided by Axinom requires a specific JWT token which contains “entitlement message”.</span></span> <span data-ttu-id="76361-434">따라서 이러한 JWT 토큰을 발급하는 STS가 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-434">Therefore, you need to have an STS to issue such JWT token.</span></span> <span data-ttu-id="76361-435">저자는 이러한 구현을 완료했으며 이에 대한 세부 사항은 [Azure 설명서 센터](https://azure.microsoft.com/documentation/): [Axinom을 사용하여 Azure Media Services에 Widevine 라이선스 제공](media-services-axinom-integration.md)에서 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-435">The authors have completed such an implementation and you can find the details in the following document in [Azure Documentation Center](https://azure.microsoft.com/documentation/): [Using Axinom to deliver Widevine licenses to Azure Media Services](media-services-axinom-integration.md).</span></span>
2. <span data-ttu-id="76361-436">더 이상 Azure 미디어 서비스에서 라이선스 배달 서비스(ContentKeyAuthorizationPolicy)를 구성하지 않아도 됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-436">You no longer need to configure license delivery service (ContentKeyAuthorizationPolicy) in Azure Media Services.</span></span> <span data-ttu-id="76361-437">수행해야 하는 작업은 다중 DRM으로 CENC 설정에서 AssetDeliveryPolicy를 구성할 때 라이선스 획득 URL(PlayReady, Widevine 및 FairPlay에 대해)을 제공하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-437">What you need to do is to provide the license acquisition URLs (for PlayReady, Widevine and FairPlay) when you configure AssetDeliveryPolicy in setting up CENC with multi-DRM.</span></span>

### <a name="what-if-i-want-to-use-a-custom-sts"></a><span data-ttu-id="76361-438">사용자 지정 STS를 사용하려면 어떻게 하나요?</span><span class="sxs-lookup"><span data-stu-id="76361-438">What if I want to use a custom STS?</span></span>
<span data-ttu-id="76361-439">고객이 JWT 토큰을 제공하는 데 사용자 지정 STS(보안 토큰 서비스)를 사용하기로 선택하는 데는 몇 가지 이유가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-439">There could be a few reasons that a customer may choose to use a custom STS (Secure Token Service) for providing JWT tokens.</span></span> <span data-ttu-id="76361-440">다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-440">Some of them are:</span></span>

1. <span data-ttu-id="76361-441">고객이 사용한 IDP(ID 공급자)에서 STS를 지원하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-441">The Identity Provider (IDP) used by the customer does not support STS.</span></span> <span data-ttu-id="76361-442">이 경우 사용자 지정 STS가 옵션일 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-442">In this case a custom STS may be an option.</span></span>
2. <span data-ttu-id="76361-443">고객은 STS를 고객의 구독자 청구 시스템과 통합하는 데 보다 유연하고 긴밀한 제어가 필요할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-443">The customer may need more flexible or tighter control in integrating STS with customer’s subscriber billing system.</span></span> <span data-ttu-id="76361-444">예를 들어 MVPD 작업자는 프리미엄, 기본, 스포츠 등과 같은 여러 OTT 구독자 패키지를 제공할 수 있습니다. 이 작업자는 토큰의 클레임을 구독자의 패키지와 일치시켜 올바른 패키지의 콘텐츠만 제공되도록 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-444">For example, an MVPD operator may offer multiple OTT subscriber packages such as premium, basic, sports, etc. The operator may want to match the claims in a token with a subscriber’s package so that only contents in the right package is made available.</span></span> <span data-ttu-id="76361-445">이 경우 사용자 지정 STS가 필요한 유연성 및 제어를 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-445">In this case, a custom STS provides the needed flexibility and control.</span></span>

<span data-ttu-id="76361-446">사용자 지정 STS를 사용할 때는 두 가지를 변경해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-446">Two changes need to be made when using a custom STS:</span></span>

1. <span data-ttu-id="76361-447">자산에 대한 라이선스 배달 서비스를 구성할 때 Azure Active Directory의 현재 키 대신 사용자 지정 STS(자세한 내용은 아래 참조)에서 확인에 사용한 보안 키를 지정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-447">When configuring license delivery service for an asset, you need to specify the security key used for verification by the custom STS (more details below) instead of the current key from Azure Active Directory.</span></span>
2. <span data-ttu-id="76361-448">JWT 토큰이 생성되면 Azure Active Directory의 현재 X509 인증서의 개인 키 대신 보안 키가 지정됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-448">When a JTW token is generated, a security key is specified instead of the private key of the current X509 certificate in Azure Active Directory.</span></span>

<span data-ttu-id="76361-449">두 가지 유형의 보안 키가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-449">There are two types of security keys:</span></span>

1. <span data-ttu-id="76361-450">대칭 키: JWT 토큰을 생성 및 확인하는 데 동일한 키가 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-450">Symmetric key: the same key is used for both generating and verifying a JWT token;</span></span>
2. <span data-ttu-id="76361-451">비대칭 키: JWT 토큰을 암호화/생성하는 데는 개인 키가, 토큰을 확인하는 데는 공개 키가 사용되는 방식으로 X509 인증서에 공개-개인 키 쌍이 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-451">Asymmetric key: a public-private key pair in an X509 certificate is used with private key for encrypting/generating a JWT token and the public key for verifying the token.</span></span>

#### <a name="tech-note"></a><span data-ttu-id="76361-452">기술 참고 사항</span><span class="sxs-lookup"><span data-stu-id="76361-452">Tech note</span></span>
<span data-ttu-id="76361-453">개발 플랫폼으로 .NET Framework/C#을 사용하는 경우 비공개 보안 키에 사용된 X509 인증서에는 키 길이가 2048 이상이어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-453">If you use .NET Framework/C# as your development platform, the X509 certificate used for asymmetric security key must have key length at least 2048.</span></span> <span data-ttu-id="76361-454">이는 .NET Framework에서 System.IdentityModel.Tokens.X509AsymmetricSecurityKey 클래스의 요구 사항입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-454">This is a requirement of the class System.IdentityModel.Tokens.X509AsymmetricSecurityKey in .NET Framework.</span></span> <span data-ttu-id="76361-455">그렇지 않으면 다음 예외가 throw됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-455">Otherwise, the following exception will be thrown:</span></span>

<span data-ttu-id="76361-456">IDX10630: 서명을 위한 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey'는 '2048'비트 이상이어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-456">IDX10630: The 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' for signing cannot be smaller than '2048' bits.</span></span>

## <a name="the-completed-system-and-test"></a><span data-ttu-id="76361-457">완료된 시스템 및 테스트</span><span class="sxs-lookup"><span data-stu-id="76361-457">The completed system and test</span></span>
<span data-ttu-id="76361-458">이 문서의 독자가 로그인 계정을 얻기 전 동작에 대한 기본적인 "그림"을 그려볼 수 있도록 완료된 종단 간 시스템에 대한 몇 가지 시나리오를 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-458">We will walk through a few scenarios in the completed end-to-end system so that readers can have a basic “picture” of the behavior before getting a login account.</span></span>

<span data-ttu-id="76361-459">플레이어 웹 응용 프로그램 및 해당 로그인은 [여기](https://openidconnectweb.azurewebsites.net/)에서 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-459">The player web application and its login can be found [here](https://openidconnectweb.azurewebsites.net/).</span></span>

<span data-ttu-id="76361-460">비디오 자산이 보호되지 않거나 토큰 인증 없이 DRM으로 보호되는(필요로 하는 모든 대상에 라이선스 발급) Azure 미디어 서비스에서 호스트되는 "통합되지 않은" 시나리오가 필요한 경우 로그인 없이(비디오 스트리밍이 HTTP를 통해 이루어지는 경우 HTTP로 전환) 테스트할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-460">If what you need is “non-integrated” scenario: video assets hosted in Azure Media Services which are either unprotected, or DRM protected but without token authentication (issuing a license to whoever requesting it), you can test it without login (by switching to HTTP if your video streaming is over HTTP).</span></span>

<span data-ttu-id="76361-461">비디오 자산이 Azure 미디어 서비스에서 동적 DRM 보호 하에 있고 토큰 인증 및 Azure AD가 생성하는 JWT 토큰이 있는 종단 간 통합된 시나리오가 필요한 경우 로그인해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-461">If what you need is end-to-end integrated scenario: video assets is under dynamic DRM protection in Azure Media Services, with token authentication and JWT token being generated by Azure AD, you need to login.</span></span>

### <a name="user-login"></a><span data-ttu-id="76361-462">사용자 로그인</span><span class="sxs-lookup"><span data-stu-id="76361-462">User login</span></span>
<span data-ttu-id="76361-463">종단 간 통합된 DRM 시스템을 테스트하려면 "계정"을 만들거나 추가해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-463">In order to test the end-to-end integrated DRM system, you need to have an “account” created or added.</span></span>

<span data-ttu-id="76361-464">계정이란?</span><span class="sxs-lookup"><span data-stu-id="76361-464">What account?</span></span>

<span data-ttu-id="76361-465">원래 Microsoft 계정 사용자만 Azure에 액세스할 수 있었으나 이제는 이 두 가지 시스템의 사용자도 액세스할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-465">Although Azure originally allowed access only by Microsoft account users, it now allows access by users from both systems.</span></span> <span data-ttu-id="76361-466">이렇게 하기 위해 모든 Azure 속성이 인증을 위해 Azure AD를 신뢰하도록 하고, Azure AD가 조직 사용자를 인증하도록 하며, 소비자 사용자를 인증하는 Microsoft 계정 소비자 ID 시스템을 Azure AD가 신뢰하는 위치에 페더레이션 관계를 만들었습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-466">This was done by having all the Azure properties trust Azure AD for authentication, having Azure AD authenticate organizational users, and by creating a federation relationship where Azure AD trusts the Microsoft account consumer identity system to authenticate consumer users.</span></span> <span data-ttu-id="76361-467">그 결과, Azure AD가 "기본" Azure AD 계정 뿐만 아니라 "게스트" Microsoft 계정도 인증할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-467">As a result, Azure AD is able to authenticate “guest” Microsoft accounts as well as “native” Azure AD accounts.</span></span>

<span data-ttu-id="76361-468">Azure AD는 Microsoft 계정(MSA) 도메인을 신뢰하므로 다음 도메인에서 사용자 지정 Azure AD 테넌트로 어떤 계정이든 추가하여 로그인에 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-468">Since Azure AD trusts Microsoft Account (MSA) domain, you can add any accounts from any of the following domains to the custom Azure AD tenant and use the account to login:</span></span>

| <span data-ttu-id="76361-469">**도메인 이름**</span><span class="sxs-lookup"><span data-stu-id="76361-469">**Domain Name**</span></span> | <span data-ttu-id="76361-470">**도메인**</span><span class="sxs-lookup"><span data-stu-id="76361-470">**Domain**</span></span> |
| --- | --- |
| <span data-ttu-id="76361-471">**사용자 지정 Azure AD 테넌트 도메인**</span><span class="sxs-lookup"><span data-stu-id="76361-471">**Custom Azure AD tenant domain**</span></span> |<span data-ttu-id="76361-472">somename.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="76361-472">somename.onmicrosoft.com</span></span> |
| <span data-ttu-id="76361-473">**회사 도메인**</span><span class="sxs-lookup"><span data-stu-id="76361-473">**Corporate domain**</span></span> |<span data-ttu-id="76361-474">microsoft.com</span><span class="sxs-lookup"><span data-stu-id="76361-474">microsoft.com</span></span> |
| <span data-ttu-id="76361-475">**Microsoft 계정(MSA) 도메인**</span><span class="sxs-lookup"><span data-stu-id="76361-475">**Microsoft Account (MSA) domain**</span></span> |<span data-ttu-id="76361-476">outlook.com, live.com, hotmail.com</span><span class="sxs-lookup"><span data-stu-id="76361-476">outlook.com, live.com, hotmail.com</span></span> |

<span data-ttu-id="76361-477">사용자를 위한 계정을 만들거나 추가한 작성자에게 연락할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-477">You may contact any of the authors to have an account created or added for you.</span></span>

<span data-ttu-id="76361-478">다음은 다양한 도메인 계정에서 사용하는 다양한 로그인 페이지의 스크린샷입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-478">Below are the screenshots of different login pages used by different domain accounts.</span></span>

<span data-ttu-id="76361-479">**사용자 지정 Azure AD 테넌트 도메인 계정**: 이 경우 사용자 지정 Azure AD 테넌트 도메인의 사용자 지정된 로그인 페이지가 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-479">**Custom Azure AD tenant domain account**: In this case, you see the customized login page of the custom Azure AD tenant domain.</span></span>

![사용자 지정 Azure AD 테넌트 도메인 계정](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain1.png)

<span data-ttu-id="76361-481">**스마트 카드를 사용한 Microsoft 도메인 계정**: 이 경우 Microsoft 회사 IT에서 2단계 인증으로 사용자 지정한 로그인 페이지가 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-481">**Microsoft domain account with smart card**: In this case you see the login page customized by Microsoft corporate IT with two-factor authentication.</span></span>

![사용자 지정 Azure AD 테넌트 도메인 계정](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain2.png)

<span data-ttu-id="76361-483">**Microsoft 계정(MSA)**: 이 경우 소비자를 위한 Microsoft 계정의 로그인 페이지가 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-483">**Microsoft Account (MSA)**: In this case, you see the login page of Microsoft Account for consumers.</span></span>

![사용자 지정 Azure AD 테넌트 도메인 계정](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain3.png)

### <a name="using-encrypted-media-extensions-for-playready"></a><span data-ttu-id="76361-485">PlayReady에 암호화된 미디어 확장 사용</span><span class="sxs-lookup"><span data-stu-id="76361-485">Using Encrypted Media Extensions for PlayReady</span></span>
<span data-ttu-id="76361-486">Windows 8.1 이상의 IE 11, Windows 10의 Microsoft Edge 브라우저와 같이 PlayReady 지원에 대한 EME(암호화된 미디어 확장)를 지원하는 최신 브라우저에서는 PlayReady가 EME를 위한 기본 DRM이 됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-486">On a modern browser with Encrypted Media Extensions (EME) for PlayReady support, such as IE 11 on Windows 8.1 and up, and Microsoft Edge browser on Windows 10, PlayReady will be the underlying DRM for EME.</span></span>

![PlayReady에 EME 사용](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready1.png)

<span data-ttu-id="76361-488">플레이어 영역에서 어두운 부분은 PlayReady 보호 기능이 보호된 비디오의 화면 캡처를 차단하기 때문입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-488">The dark player area is due to the fact that PlayReady protection prevents one from making screen capture of protected video.</span></span>

<span data-ttu-id="76361-489">다음 화면에는 플레이어 플러그인 및 MSE/EME 지원을 보여줍니다.</span><span class="sxs-lookup"><span data-stu-id="76361-489">The following screen shows the player plugins and MSE/EME support.</span></span>

![PlayReady에 EME 사용](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready2.png)

<span data-ttu-id="76361-491">Windows 10의 Microsoft Edge 및 IE 11에 있는 EME를 통해 이를 지원하는 Windows 10 장치에서 [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/)을 호출할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-491">EME in Microsoft Edge and IE 11 on Windows 10 allows invoking of [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) on Windows 10 devices which support it.</span></span> <span data-ttu-id="76361-492">PlayReady SL3000은 향상된 프리미엄 콘텐츠(4K, HDR 등) 흐름 및 새 콘텐츠 배달 모델(향상된 콘텐츠에 대한 초기 창)의 잠금을 해제합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-492">PlayReady SL3000 unlocks the flow of enhanced premium content (4K, HDR, etc.) and new content delivery models (early window for Enhanced Content).</span></span>

<span data-ttu-id="76361-493">Windows 장치에 집중: PlayReady는 Windows 장치(PlayReady SL3000)에서 사용 가능한 HW의 유일한 DRM입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-493">Focus on the Windows devices: PlayReady is the only DRM in the HW available on Windows devices (PlayReady SL3000).</span></span> <span data-ttu-id="76361-494">스트리밍 서비스는 EME 또는 UWP 응용 프로그램을 통해 PlayReady를 사용하고 PlayReady SL3000을 사용하여 다른 DRM보다 더 높은 화질을 제공할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-494">A streaming service can use PlayReady through EME or through a UWP application and offer a higher video quality using PlayReady SL3000 than another DRM.</span></span> <span data-ttu-id="76361-495">일반적으로 2K 콘텐츠는 Chrome 또는 Firefox를 통해 이동하고 4K 콘텐츠는 동일한 장치의 Microsoft Edge/IE11 또는 UWP 응용 프로그램을 통해 이동합니다(서비스 설정 및 구현에 따라).</span><span class="sxs-lookup"><span data-stu-id="76361-495">Typically, 2K content will flow through Chrome or Firefox, and 4K content through Microsoft Edge/IE11 or a UWP application on the same device (depending on service settings and implementation).</span></span>

#### <a name="using-eme-for-widevine"></a><span data-ttu-id="76361-496">Widevine에 EME 사용</span><span class="sxs-lookup"><span data-stu-id="76361-496">Using EME for Widevine</span></span>
<span data-ttu-id="76361-497">Windows 10, Windows 8.1, Mac OSX Yosemite의 Chrome 41 이상, Android 4.4.4의 Chrome과 같이 EME/Widevine을 지원하는 최신 브라우저에서는 Google Widevine이 EME 뒤의 DRM입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-497">On a modern browser with EME/Widevine support, such as Chrome 41+ on Windows 10, Windows 8.1, Mac OSX Yosemite, and Chrome on Android 4.4.4, Google Widevine is the DRM behind EME.</span></span>

![Widevine에 EME 사용](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine1.png)

<span data-ttu-id="76361-499">Widevine은 보호된 비디오의 화면 캡처 만들기를 차단하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-499">Notice that Widevine does not prevent one from making screen capture of protected video.</span></span>

![Widevine에 EME 사용](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine2.png)

### <a name="not-entitled-users"></a><span data-ttu-id="76361-501">자격이 없는 사용자</span><span class="sxs-lookup"><span data-stu-id="76361-501">Not entitled users</span></span>
<span data-ttu-id="76361-502">사용자가 "자격이 있는 사용자" 그룹의 멤버가 아닌 경우 사용자는 "자격 확인"을 전달할 수 없고 다중 DRM 라이선스 서비스가 아래 표시된 것처럼 요청된 라이선스의 발급을 거부합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-502">If a user is not a member of "Entitled Users" group, the user will not be able to pass “entitlement check” and the multi-DRM license service will refuse to issue the requested license as shown below.</span></span> <span data-ttu-id="76361-503">자세한 설명은 설계된 대로 "라이선스 획득 실패"입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-503">The detailed description is “License acquire failed”, which is as designed.</span></span>

![자격이 없는 사용자](./media/media-services-cenc-with-multidrm-access-control/media-services-unentitledusers.png)

### <a name="running-custom-secure-token-service"></a><span data-ttu-id="76361-505">사용자 지정 보안 토큰 서비스 실행</span><span class="sxs-lookup"><span data-stu-id="76361-505">Running custom Secure Token Service</span></span>
<span data-ttu-id="76361-506">사용자 지정 STS(보안 토큰 서비스)를 실행하는 시나리오에서는 사용자 지정 STS에서 대칭 또는 비대칭 키를 사용하여 JWT 토큰을 발급합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-506">For the scenario of running custom Secure Token Service (STS), the JWT token will be issued by the custom STS using either symmetric or asymmetric key.</span></span>

<span data-ttu-id="76361-507">대칭 키를 사용하는 경우(Chrome 사용):</span><span class="sxs-lookup"><span data-stu-id="76361-507">The case of using symmetric key (using Chrome):</span></span>

![사용자 지정 STS 실행](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts1.png)

<span data-ttu-id="76361-509">X509 인증서를 통해 비대칭 키를 사용하는 경우(Microsoft 최신 브라우저 사용)</span><span class="sxs-lookup"><span data-stu-id="76361-509">The case of using asymmetric key via an X509 certificate (using Microsoft modern browser).</span></span>

![사용자 지정 STS 실행](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts2.png)

<span data-ttu-id="76361-511">위의 두 경우 모두 Azure AD를 통한다는 점에서 사용자 인증은 동일하게 유지됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-511">In both of the above cases, user authentication stays the same – through Azure AD.</span></span> <span data-ttu-id="76361-512">유일한 차이점은 JWT 토큰이 Azure AD 대신 사용자 지정 STS에 의해 발급된다는 점입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-512">The only difference is that JWT tokens are issued by the custom STS instead of Azure AD.</span></span> <span data-ttu-id="76361-513">물론, 동적 CENC 보호를 구성할 때 라이선스 배달 서비스 제한으로 JWT 토큰 유형을 대칭 또는 비대칭 키로 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-513">Of course, when configuring dynamic CENC protection, the restriction of license delivery service specifies the type of JWT token, either symmetric or asymmetric key.</span></span>

## <a name="summary"></a><span data-ttu-id="76361-514">요약</span><span class="sxs-lookup"><span data-stu-id="76361-514">Summary</span></span>
<span data-ttu-id="76361-515">이 문서에서는 다중 원시 DRM 및 토큰 인증을 통한 액세스 제어가 포함된 CENC와 Azure, Azure 미디어 서비스 및 Azure 미디어 플레이어를 사용한 디자인 및 구현에 대해 설명했습니다.</span><span class="sxs-lookup"><span data-stu-id="76361-515">In this document, we discussed CENC with multi-native-DRM and access control via token authentication: its design and its implementation using Azure, Azure Media Services and Azure Media Player.</span></span>

* <span data-ttu-id="76361-516">DRM/CENC 하위 시스템에 필요한 모든 구성 요소를 포함하는 참조 디자인이 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="76361-516">A reference design is presented which contains all the necessary components in a DRM/CENC subsystem;</span></span>
* <span data-ttu-id="76361-517">Azure, Azure 미디어 서비스 및 Azure 미디어 플레이어에 대한 참조 구현입니다.</span><span class="sxs-lookup"><span data-stu-id="76361-517">A reference implementation on Azure, Azure Media Services and Azure Media Player.</span></span>
* <span data-ttu-id="76361-518">디자인 및 구현에 직접 관련된 몇 가지 토픽도 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="76361-518">Some topics directly involved in the design and implementation are also discussed.</span></span>

## <a name="media-services-learning-paths"></a><span data-ttu-id="76361-519">미디어 서비스 학습 경로</span><span class="sxs-lookup"><span data-stu-id="76361-519">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="76361-520">피드백 제공</span><span class="sxs-lookup"><span data-stu-id="76361-520">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]
 
