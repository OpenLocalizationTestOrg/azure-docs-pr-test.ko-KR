---
title: "Azure Backup 오류 문제 해결: 게스트 에이전트 상태 사용할 수 없음 | Microsoft Docs"
description: "오류: VM 에이전트와 통신할 수 없음과 관련된 Azure Backup 오류의 증상, 원인 및 해결 방법"
services: backup
documentationcenter: 
author: genlin
manager: cshepard
editor: 
keywords: "Azure 백업; VM 에이전트; 네트워크 연결;"
ms.assetid: 4b02ffa4-c48e-45f6-8363-73d536be4639
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: genli;markgal;
ms.openlocfilehash: 6ed651bb8caafd18cec93e68ac70e27f92133e5c
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/18/2017
---
# <a name="troubleshoot-azure-backup-failure-issues-with-agent-andor-extension"></a><span data-ttu-id="15194-104">Azure Backup 오류 문제 해결: 에이전트 및/또는 확장 관련 문제</span><span class="sxs-lookup"><span data-stu-id="15194-104">Troubleshoot Azure Backup failure: Issues with agent and/or extension</span></span>

<span data-ttu-id="15194-105">이 문서에서는 VM 에이전트와 통신 및 확장의 문제와 관련된 백업 실패를 해결하는 데 도움이 되는 문제 해결 단계를 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-105">This article provides troubleshooting steps to help you resolve Backup failures related to problems in communication with VM agent and extension.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

## <a name="vm-agent-unable-to-communicate-with-azure-backup"></a><span data-ttu-id="15194-106">VM 에이전트를 Azure Backup과 통신할 수 없음</span><span class="sxs-lookup"><span data-stu-id="15194-106">VM Agent unable to communicate with Azure Backup</span></span>
<span data-ttu-id="15194-107">Azure Backup 서비스에 대한 VM을 등록하고 예약하면 Backup은 VM 에이전트와 통신함으로써 작업을 시작하여 지정 시간 스냅숏을 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-107">After you register and schedule a VM for the Azure Backup service, Backup initiates the job by communicating with the VM agent to take a point-in-time snapshot.</span></span> <span data-ttu-id="15194-108">다음 조건 중 하나라도 충족되지 못하면 스냅숏이 트리거되지 않아 결국 Backup 실패로 이어질 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-108">Any of the following conditions might prevent the snapshot from being triggered, which in turn can lead to Backup failure.</span></span> <span data-ttu-id="15194-109">아래 문제 해결 단계를 지정된 순서대로 따르고 작업을 다시 시도합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-109">Follow below troubleshooting steps in the given order and retry your operation.</span></span>
##### <a name="cause-1-the-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="15194-110">원인 1: [VM이 인터넷에 연결되어 있지 않습니다.](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="15194-110">Cause 1: [The VM has no Internet access](#the-vm-has-no-internet-access)</span></span>
##### <a name="cause-2-the-agent-is-installed-in-the-vm-but-is-unresponsive-for-windows-vmsthe-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="15194-111">원인 2: [에이전트가 VM에 설치되어 있지만 응답하지 않습니다(Windows VM의 경우).](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span><span class="sxs-lookup"><span data-stu-id="15194-111">Cause 2: [The agent is installed in the VM but is unresponsive (for Windows VMs)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span></span>
##### <a name="cause-3-the-agent-installed-in-the-vm-is-out-of-date-for-linux-vmsthe-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="15194-112">원인 3: [VM에 설치된 에이전트가 최신이 아닙니다(Linux VM의 경우).](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span><span class="sxs-lookup"><span data-stu-id="15194-112">Cause 3: [The agent installed in the VM is out of date (for Linux VMs)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span></span>
##### <a name="cause-4-the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-takenthe-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="15194-113">원인 4: [스냅숏 상태를 검색할 수 없거나 스냅숏을 만들 수 없습니다.](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span><span class="sxs-lookup"><span data-stu-id="15194-113">Cause 4: [The snapshot status cannot be retrieved or a snapshot cannot be taken](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span></span>
##### <a name="cause-5-the-backup-extension-fails-to-update-or-loadthe-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="15194-114">원인 5: [백업 확장을 업데이트 또는 로드할 수 없습니다.](#the-backup-extension-fails-to-update-or-load)</span><span class="sxs-lookup"><span data-stu-id="15194-114">Cause 5: [The backup extension fails to update or load](#the-backup-extension-fails-to-update-or-load)</span></span>

## <a name="snapshot-operation-failed-due-to-no-network-connectivity-on-the-virtual-machine"></a><span data-ttu-id="15194-115">가상 컴퓨터에 네트워크 연결이 없으므로 스냅숏 작업이 실패했습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-115">Snapshot operation failed due to no network connectivity on the virtual machine</span></span>
<span data-ttu-id="15194-116">Azure Backup 서비스에 대한 VM을 등록하고 예약하면 백업은 VM 백업 확장과 통신함으로써 작업을 시작하여 지정 시간 스냅숏을 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-116">After you register and schedule a VM for the Azure Backup service, Backup initiates the job by communicating with the VM backup extension to take a point-in-time snapshot.</span></span> <span data-ttu-id="15194-117">다음 조건 중 하나라도 충족되지 못하면 스냅숏이 트리거되지 않아 결국 Backup 실패로 이어질 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-117">Any of the following conditions might prevent the snapshot from being triggered, which in turn can lead to Backup failure.</span></span> <span data-ttu-id="15194-118">아래 문제 해결 단계를 지정된 순서대로 따르고 작업을 다시 시도합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-118">Follow below troubleshooting steps in the given order and retry your operation.</span></span>
##### <a name="cause-1-the-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="15194-119">원인 1: [VM이 인터넷에 연결되어 있지 않습니다.](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="15194-119">Cause 1: [The VM has no Internet access](#the-vm-has-no-internet-access)</span></span>
##### <a name="cause-2-the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-takenthe-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="15194-120">원인 2: [스냅숏 상태를 검색할 수 없거나 스냅숏을 만들 수 없습니다.](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span><span class="sxs-lookup"><span data-stu-id="15194-120">Cause 2: [The snapshot status cannot be retrieved or a snapshot cannot be taken](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span></span>
##### <a name="cause-3-the-backup-extension-fails-to-update-or-loadthe-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="15194-121">원인 3: [백업 확장을 업데이트 또는 로드할 수 없습니다.](#the-backup-extension-fails-to-update-or-load)</span><span class="sxs-lookup"><span data-stu-id="15194-121">Cause 3: [The backup extension fails to update or load](#the-backup-extension-fails-to-update-or-load)</span></span>

## <a name="vmsnapshot-extension-operation-failed"></a><span data-ttu-id="15194-122">VMSnapshot 확장 작업이 실패했습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-122">VMSnapshot extension operation failed</span></span>

<span data-ttu-id="15194-123">Azure Backup 서비스에 대한 VM을 등록하고 예약하면 백업은 VM 백업 확장과 통신함으로써 작업을 시작하여 지정 시간 스냅숏을 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-123">After you register and schedule a VM for the Azure Backup service, Backup initiates the job by communicating with the VM backup extension to take a point-in-time snapshot.</span></span> <span data-ttu-id="15194-124">다음 조건 중 하나라도 충족되지 못하면 스냅숏이 트리거되지 않아 결국 Backup 실패로 이어질 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-124">Any of the following conditions might prevent the snapshot from being triggered, which in turn can lead to Backup failure.</span></span> <span data-ttu-id="15194-125">아래 문제 해결 단계를 지정된 순서대로 따르고 작업을 다시 시도합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-125">Follow below troubleshooting steps in the given order and retry your operation.</span></span>
##### <a name="cause-1-the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-takenthe-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="15194-126">원인 1: [스냅숏 상태를 검색할 수 없거나 스냅숏을 만들 수 없습니다.](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span><span class="sxs-lookup"><span data-stu-id="15194-126">Cause 1: [The snapshot status cannot be retrieved or a snapshot cannot be taken](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span></span>
##### <a name="cause-2-the-backup-extension-fails-to-update-or-loadthe-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="15194-127">원인 2: [백업 확장을 업데이트 또는 로드할 수 없습니다.](#the-backup-extension-fails-to-update-or-load)</span><span class="sxs-lookup"><span data-stu-id="15194-127">Cause 2: [The backup extension fails to update or load](#the-backup-extension-fails-to-update-or-load)</span></span>
##### <a name="cause-3-the-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="15194-128">원인 3: [VM이 인터넷에 연결되어 있지 않습니다.](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="15194-128">Cause 3: [The VM has no Internet access](#the-vm-has-no-internet-access)</span></span>
##### <a name="cause-4-the-agent-is-installed-in-the-vm-but-is-unresponsive-for-windows-vmsthe-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="15194-129">원인 4: [에이전트가 VM에 설치되어 있지만 응답하지 않습니다(Windows VM의 경우).](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span><span class="sxs-lookup"><span data-stu-id="15194-129">Cause 4: [The agent is installed in the VM but is unresponsive (for Windows VMs)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span></span>
##### <a name="cause-5-the-agent-installed-in-the-vm-is-out-of-date-for-linux-vmsthe-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="15194-130">원인 5: [VM에 설치된 에이전트가 최신이 아닙니다(Linux VM의 경우).](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span><span class="sxs-lookup"><span data-stu-id="15194-130">Cause 5: [The agent installed in the VM is out of date (for Linux VMs)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span></span>

## <a name="unable-to-perform-the-operation-as-the-vm-agent-is-not-responsive"></a><span data-ttu-id="15194-131">VM 에이전트가 응답하지 않으므로 작업을 수행할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-131">Unable to perform the operation as the VM Agent is not responsive</span></span>

<span data-ttu-id="15194-132">Azure Backup 서비스에 대한 VM을 등록하고 예약하면 백업은 VM 백업 확장과 통신함으로써 작업을 시작하여 지정 시간 스냅숏을 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-132">After you register and schedule a VM for the Azure Backup service, Backup initiates the job by communicating with the VM backup extension to take a point-in-time snapshot.</span></span> <span data-ttu-id="15194-133">다음 조건 중 하나라도 충족되지 못하면 스냅숏이 트리거되지 않아 결국 Backup 실패로 이어질 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-133">Any of the following conditions might prevent the snapshot from being triggered, which in turn can lead to Backup failure.</span></span> <span data-ttu-id="15194-134">아래 문제 해결 단계를 지정된 순서대로 따르고 작업을 다시 시도합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-134">Follow below troubleshooting steps in the given order and retry your operation.</span></span>
##### <a name="cause-1-the-agent-is-installed-in-the-vm-but-is-unresponsive-for-windows-vmsthe-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="15194-135">원인 1: [에이전트가 VM에 설치되어 있지만 응답하지 않습니다(Windows VM의 경우).](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span><span class="sxs-lookup"><span data-stu-id="15194-135">Cause 1: [The agent is installed in the VM but is unresponsive (for Windows VMs)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span></span>
##### <a name="cause-2-the-agent-installed-in-the-vm-is-out-of-date-for-linux-vmsthe-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="15194-136">원인 2: [VM에 설치된 에이전트가 최신이 아닙니다(Linux VM의 경우).](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span><span class="sxs-lookup"><span data-stu-id="15194-136">Cause 2: [The agent installed in the VM is out of date (for Linux VMs)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span></span>
##### <a name="cause-3-the-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="15194-137">원인 3: [VM이 인터넷에 연결되어 있지 않습니다.](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="15194-137">Cause 3: [The VM has no Internet access](#the-vm-has-no-internet-access)</span></span>

## <a name="backup-failed-with-an-internal-error---please-retry-the-operation-in-a-few-minutes"></a><span data-ttu-id="15194-138">내부 오류가 발생하여 백업하지 못했습니다. 몇 분 후에 작업을 다시 시도하세요.</span><span class="sxs-lookup"><span data-stu-id="15194-138">Backup failed with an internal error - Please retry the operation in a few minutes</span></span>

<span data-ttu-id="15194-139">Azure Backup 서비스에 대한 VM을 등록하고 예약하면 백업은 VM 백업 확장과 통신함으로써 작업을 시작하여 지정 시간 스냅숏을 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-139">After you register and schedule a VM for the Azure Backup service, Backup initiates the job by communicating with the VM backup extension to take a point-in-time snapshot.</span></span> <span data-ttu-id="15194-140">다음 조건 중 하나라도 충족되지 못하면 스냅숏이 트리거되지 않아 결국 Backup 실패로 이어질 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-140">Any of the following conditions might prevent the snapshot from being triggered, which in turn can lead to Backup failure.</span></span> <span data-ttu-id="15194-141">아래 문제 해결 단계를 지정된 순서대로 따르고 작업을 다시 시도합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-141">Follow below troubleshooting steps in the given order and retry your operation.</span></span>
##### <a name="cause-1-the-vm-has-no-internet-accessthe-vm-has-no-internet-access"></a><span data-ttu-id="15194-142">원인 1: [VM이 인터넷에 연결되어 있지 않습니다.](#the-vm-has-no-internet-access)</span><span class="sxs-lookup"><span data-stu-id="15194-142">Cause 1: [The VM has no Internet access](#the-vm-has-no-internet-access)</span></span>
##### <a name="cause-2-the-agent-installed-in-the-vm-but-unresponsive-for-windows-vmsthe-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="15194-143">원인 2: [에이전트가 VM에 설치되어 있지만 응답하지 않습니다(Windows VM의 경우).](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span><span class="sxs-lookup"><span data-stu-id="15194-143">Cause 2: [The agent installed in the VM but unresponsive (for Windows VMs)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)</span></span>
##### <a name="cause-3-the-agent-installed-in-the-vm-is-out-of-date-for-linux-vmsthe-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="15194-144">원인 3: [VM에 설치된 에이전트가 최신이 아닙니다(Linux VM의 경우).](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span><span class="sxs-lookup"><span data-stu-id="15194-144">Cause 3: [The agent installed in the VM is out of date (for Linux VMs)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)</span></span>
##### <a name="cause-4-the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-takenthe-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="15194-145">원인 4: [스냅숏 상태를 검색할 수 없거나 스냅숏을 만들 수 없습니다.](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span><span class="sxs-lookup"><span data-stu-id="15194-145">Cause 4: [The snapshot status cannot be retrieved or a snapshot cannot be taken](#the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken)</span></span>
##### <a name="cause-5-the-backup-extension-fails-to-update-or-loadthe-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="15194-146">원인 5: [백업 확장을 업데이트 또는 로드할 수 없습니다.](#the-backup-extension-fails-to-update-or-load)</span><span class="sxs-lookup"><span data-stu-id="15194-146">Cause 5: [The backup extension fails to update or load](#the-backup-extension-fails-to-update-or-load)</span></span>


## <a name="causes-and-solutions"></a><span data-ttu-id="15194-147">원인 및 해결 방법</span><span class="sxs-lookup"><span data-stu-id="15194-147">Causes and Solutions</span></span>

### <a name="the-vm-has-no-internet-access"></a><span data-ttu-id="15194-148">VM이 인터넷에 연결되어 있지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-148">The VM has no Internet access</span></span>
<span data-ttu-id="15194-149">배포 요구 사항에 따라 VM이 인터넷에 연결되어 있지 않거나 Azure 인프라에 대한 액세스를 차단하는 위치에 제한 사항이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-149">Per the deployment requirement, the VM has no Internet access, or it has restrictions in place that prevent access to the Azure infrastructure.</span></span>

<span data-ttu-id="15194-150">제대로 작동하려면 백업 확장이 Azure 공용 IP 주소에 연결되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-150">To function correctly, the backup extension requires connectivity to the Azure public IP addresses.</span></span> <span data-ttu-id="15194-151">확장이 Azure Storage 끝점(HTTP URL)에 명령을 보내 VM의 스냅숏을 관리합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-151">The extension sends commands to an Azure Storage endpoint (HTTP URL) to manage the snapshots of the VM.</span></span> <span data-ttu-id="15194-152">확장이 공용 인터넷에 액세스할 수 없는 경우 백업은 결국 실패합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-152">If the extension has no access to the public Internet, Backup eventually fails.</span></span>

####  <a name="solution"></a><span data-ttu-id="15194-153">해결 방법</span><span class="sxs-lookup"><span data-stu-id="15194-153">Solution</span></span>
<span data-ttu-id="15194-154">문제를 해결하려면 다음 방법 중 하나를 사용해 보세요.</span><span class="sxs-lookup"><span data-stu-id="15194-154">To resolve the issue, try one of the methods listed here.</span></span>
##### <a name="allow-access-to-the-azure-datacenter-ip-ranges"></a><span data-ttu-id="15194-155">Azure 데이터 센터 IP 범위에 대한 액세스 허용</span><span class="sxs-lookup"><span data-stu-id="15194-155">Allow access to the Azure datacenter IP ranges</span></span>

1. <span data-ttu-id="15194-156">[Azure 데이터 센터 IP 목록](https://www.microsoft.com/download/details.aspx?id=41653)을 가져와서 액세스를 허용합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-156">Obtain the [list of Azure datacenter IPs](https://www.microsoft.com/download/details.aspx?id=41653) to allow access to.</span></span>
2. <span data-ttu-id="15194-157">표시된 PowerShell 창의 Azure VM에서 **New-NetRoute** cmdlet을 실행하여 IP를 차단 해제합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-157">Unblock the IPs by running the **New-NetRoute** cmdlet in the Azure VM in an elevated PowerShell window.</span></span> <span data-ttu-id="15194-158">관리자 권한으로 cmdlet을 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-158">Run the cmdlet as an administrator.</span></span>
3. <span data-ttu-id="15194-159">IP에 대한 액세스를 허용하려면 네트워크 보안 그룹이 있는 경우 규칙을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-159">To allow access to the IPs, add rules to the network security group, if you have one.</span></span>

##### <a name="create-a-path-for-http-traffic-to-flow"></a><span data-ttu-id="15194-160">HTTP 트래픽을 보내는 경로 만들기</span><span class="sxs-lookup"><span data-stu-id="15194-160">Create a path for HTTP traffic to flow</span></span>

1. <span data-ttu-id="15194-161">네트워크 제한이 있는 경우(예를 들어 네트워크 보안 그룹) 트래픽을 라우트하도록 HTTP 프록시 서버를 배포합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-161">If you have network restrictions in place (for example, a network security group), deploy an HTTP proxy server to route the traffic.</span></span>
2. <span data-ttu-id="15194-162">HTTP 프록시 서버에서 인터넷에 액세스하도록 허용하려면 네트워크 보안 그룹이 있는 경우 규칙을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-162">To allow access to the Internet from the HTTP proxy server, add rules to the network security group, if you have one.</span></span>

<span data-ttu-id="15194-163">VM 백업에 대한 HTTP 프록시를 설정하는 방법을 알아보려면 [Azure Virtual Machines를 백업하기 위한 환경 준비](backup-azure-vms-prepare.md#using-an-http-proxy-for-vm-backups)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="15194-163">To learn how to set up an HTTP proxy for VM backups, see [Prepare your environment to back up Azure virtual machines](backup-azure-vms-prepare.md#using-an-http-proxy-for-vm-backups).</span></span>

<span data-ttu-id="15194-164">Managed Disks를 사용하고 있는 경우 방화벽에서 열리는 추가 포트(8443)가 필요할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-164">In case you are using Managed Disks, you may need an additional port (8443) opening up on the firewalls.</span></span>

### <a name="the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a><span data-ttu-id="15194-165">에이전트가 VM에 설치되어 있지만 응답하지 않습니다(Windows VM의 경우).</span><span class="sxs-lookup"><span data-stu-id="15194-165">The agent installed in the VM but unresponsive (for Windows VMs)</span></span>

#### <a name="solution"></a><span data-ttu-id="15194-166">해결 방법</span><span class="sxs-lookup"><span data-stu-id="15194-166">Solution</span></span>
<span data-ttu-id="15194-167">VM 에이전트가 손상되었거나 서비스가 중지되었습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-167">The VM Agent might have been corrupted or the service might have been stopped.</span></span> <span data-ttu-id="15194-168">VM 에이전트를 다시 설치하는 것이 최신 버전을 가져오고 통신을 다시 시작하는 데 도움이 됩니다.</span><span class="sxs-lookup"><span data-stu-id="15194-168">Re-installing the VM agent would help get the latest version and restart the communication.</span></span>

1. <span data-ttu-id="15194-169">컴퓨터의 서비스(services.msc)에서 Windows 게스트 에이전트 서비스가 실행되는지 여부를 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-169">Verify whether Windows Guest Agent service running in services (services.msc) of the Virtual Machine.</span></span> <span data-ttu-id="15194-170">Windows 게스트 에이전트 서비스를 다시 시작하고 Backup을 시작해 보세요.</span><span class="sxs-lookup"><span data-stu-id="15194-170">Try restart the Windows Guest Agent service and initiate the Backup</span></span><br>
2. <span data-ttu-id="15194-171">서비스에서 확인할 수 없는 경우 프로그램 및 기능에서 Windows 게스트 에이전트 서비스가 설치되었는지 여부를 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-171">if it is not visible in services, verify in Programs and Features whether Windows Guest agent service is installed.</span></span>
4. <span data-ttu-id="15194-172">프로그램 및 기능에서 볼 수 있는 경우 Windows 게스트 에이전트를 제거합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-172">If you are able to view in programs and features uninstall the Windows Guest Agent.</span></span>
5. <span data-ttu-id="15194-173">[최신 버전의 에이전트 MSI](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409)를 다운로드하고 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-173">Download and install the [latest version of agent MSI](http://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409).</span></span> <span data-ttu-id="15194-174">설치를 완료하려면 관리자 권한이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-174">You need Administrator privileges to complete the installation.</span></span>
6. <span data-ttu-id="15194-175">그런 다음 서비스에서 Windows 게스트 에이전트 서비스를 볼 수 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-175">Then you should be able to view Windows Guest Agent services in services</span></span>
7. <span data-ttu-id="15194-176">포털에서 "지금 백업"을 클릭하여 요청 시/임시 백업을 실행해 봅니다.</span><span class="sxs-lookup"><span data-stu-id="15194-176">Try running an on-demand/adhoc backup by clicking "Backup Now" in the portal.</span></span>

<span data-ttu-id="15194-177">또한 가상 컴퓨터가 **[시스템에 .NET 4.5를 설치](https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed)**했는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-177">Also verify your Virtual Machine has **[.NET 4.5 installed in the system](https://docs.microsoft.com/en-us/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed)**.</span></span> <span data-ttu-id="15194-178">VM 에이전트가 서비스와 통신하는 데 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-178">It is required for the VM agent to communicate with the service</span></span>

### <a name="the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a><span data-ttu-id="15194-179">VM에 설치된 에이전트가 최신이 아닙니다(Linux VM의 경우).</span><span class="sxs-lookup"><span data-stu-id="15194-179">The agent installed in the VM is out of date (for Linux VMs)</span></span>

#### <a name="solution"></a><span data-ttu-id="15194-180">해결 방법</span><span class="sxs-lookup"><span data-stu-id="15194-180">Solution</span></span>
<span data-ttu-id="15194-181">Linux VM에 대부분의 에이전트 관련 또는 확장 관련 오류는 이전 VM 에이전트에 영향을 주는 문제로 인해 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-181">Most agent-related or extension-related failures for Linux VMs are caused by issues that affect an outdated VM agent.</span></span> <span data-ttu-id="15194-182">이 문제를 해결하려면 다음과 같은 일반 지침을 수행하세요.</span><span class="sxs-lookup"><span data-stu-id="15194-182">To troubleshoot this issue, follow these general guidelines:</span></span>

1. <span data-ttu-id="15194-183">[Linux VM 에이전트 업데이트](../virtual-machines/linux/update-agent.md)의 지침을 따르세요.</span><span class="sxs-lookup"><span data-stu-id="15194-183">Follow the instructions for [updating the Linux VM agent](../virtual-machines/linux/update-agent.md).</span></span>

 >[!NOTE]
 ><span data-ttu-id="15194-184">배포 리포지토리를 사용할 때만 에이전트를 업데이트할 것을 *강력히 권장*합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-184">We *strongly recommend* that you update the agent only through a distribution repository.</span></span> <span data-ttu-id="15194-185">GitHub에서 에이전트 코드를 직접 다운로드한 후 업데이트하는 것은 바람직하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-185">We do not recommend downloading the agent code directly from GitHub and updating it.</span></span> <span data-ttu-id="15194-186">최신 에이전트를 배포할 수 없는 경우 배포 지원에 문의하여 설치 방법에 대한 지침을 얻으세요.</span><span class="sxs-lookup"><span data-stu-id="15194-186">If the latest agent is unavailable for your distribution, contact distribution support for instructions on how to install it.</span></span> <span data-ttu-id="15194-187">최신 에이전트를 확인하려면 GitHub 리포지토리의 [Microsoft Azure Linux 에이전트](https://github.com/Azure/WALinuxAgent/releases) 페이지로 이동하세요.</span><span class="sxs-lookup"><span data-stu-id="15194-187">To check for the most recent agent, go to the [Windows Azure Linux agent](https://github.com/Azure/WALinuxAgent/releases) page in the GitHub repository.</span></span>

2. <span data-ttu-id="15194-188">다음 명령을 실행하여 VM에 Azure 에이전트가 실행 중인지 확인합니다. `ps -e`</span><span class="sxs-lookup"><span data-stu-id="15194-188">Make sure that the Azure agent is running on the VM by running the following command: `ps -e`</span></span>

 <span data-ttu-id="15194-189">이 프로세스가 실행되고 있지 않으면 다음 명령을 사용하여 다시 시작합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-189">If the process is not running, restart it by using the following commands:</span></span>

 * <span data-ttu-id="15194-190">Ubuntu의 경우: `service walinuxagent start`</span><span class="sxs-lookup"><span data-stu-id="15194-190">For Ubuntu: `service walinuxagent start`</span></span>
 * <span data-ttu-id="15194-191">기타 배포의 경우: `service waagent start`</span><span class="sxs-lookup"><span data-stu-id="15194-191">For other distributions: `service waagent start`</span></span>

3. <span data-ttu-id="15194-192">[에이전트 자동 다시 시작을 구성합니다](https://github.com/Azure/WALinuxAgent/wiki/Known-Issues#mitigate_agent_crash).</span><span class="sxs-lookup"><span data-stu-id="15194-192">[Configure the auto restart agent](https://github.com/Azure/WALinuxAgent/wiki/Known-Issues#mitigate_agent_crash).</span></span>
4. <span data-ttu-id="15194-193">새 테스트 백업을 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-193">Run a new test backup.</span></span> <span data-ttu-id="15194-194">오류가 계속되면 고객의 VM에서 다음 로그를 수집하십시오.</span><span class="sxs-lookup"><span data-stu-id="15194-194">If the failure persists, please collect the following logs from the customer’s VM:</span></span>

   * <span data-ttu-id="15194-195">/var/lib/waagent/*.xml</span><span class="sxs-lookup"><span data-stu-id="15194-195">/var/lib/waagent/*.xml</span></span>
   * <span data-ttu-id="15194-196">/var/log/waagent.log</span><span class="sxs-lookup"><span data-stu-id="15194-196">/var/log/waagent.log</span></span>
   * <span data-ttu-id="15194-197">/var/log/azure/*</span><span class="sxs-lookup"><span data-stu-id="15194-197">/var/log/azure/*</span></span>

<span data-ttu-id="15194-198">waagent의 자세한 로깅이 필요한 경우 다음 단계를 따르세요.</span><span class="sxs-lookup"><span data-stu-id="15194-198">If we require verbose logging for waagent, follow these steps:</span></span>

1. <span data-ttu-id="15194-199">/etc/waagent.conf 파일에서 다음 줄을 찾습니다. **자세한 정보 로깅 사용(y|n)**</span><span class="sxs-lookup"><span data-stu-id="15194-199">In the /etc/waagent.conf file, locate the following line: **Enable verbose logging (y|n)**</span></span>
2. <span data-ttu-id="15194-200">**Logs.Verbose** 값을 *n*에서 *y*로 변경합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-200">Change the **Logs.Verbose** value from *n* to *y*.</span></span>
3. <span data-ttu-id="15194-201">변경 내용을 저장하고 이 섹션의 이전 단계를 수행하여 waagent를 다시 시작합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-201">Save the change, and then restart waagent by following the previous steps in this section.</span></span>

### <a name="the-snapshot-status-cannot-be-retrieved-or-a-snapshot-cannot-be-taken"></a><span data-ttu-id="15194-202">스냅숏 상태를 검색할 수 없거나 스냅숏을 만들 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-202">The snapshot status cannot be retrieved or a snapshot cannot be taken</span></span>
<span data-ttu-id="15194-203">VM 백업은 기본 저장소 계정에 대한 스냅숏 명령 실행을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-203">The VM backup relies on issuing a snapshot command to the underlying storage account.</span></span> <span data-ttu-id="15194-204">저장소 계정에 액세스할 수 없거나 스냅숏 작업의 실행이 지연되기 때문에 백업이 실패할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-204">Backup can fail either because it has no access to the storage account or because the execution of the snapshot task is delayed.</span></span>

#### <a name="solution"></a><span data-ttu-id="15194-205">해결 방법</span><span class="sxs-lookup"><span data-stu-id="15194-205">Solution</span></span>
<span data-ttu-id="15194-206">다음 조건으로 인해 스냅숏 작업 오류가 발생할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-206">The following conditions can cause snapshot task failure:</span></span>

| <span data-ttu-id="15194-207">원인</span><span class="sxs-lookup"><span data-stu-id="15194-207">Cause</span></span> | <span data-ttu-id="15194-208">해결 방법</span><span class="sxs-lookup"><span data-stu-id="15194-208">Solution</span></span> |
| --- | --- |
| <span data-ttu-id="15194-209">VM에 구성된 SQL Server 백업이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-209">The VM has SQL Server backup configured.</span></span> | <span data-ttu-id="15194-210">기본적으로 VM 백업은 Windows VM에서 VSS 전체 백업을 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-210">By default, the VM backup runs a VSS full backup on Windows VMs.</span></span> <span data-ttu-id="15194-211">SQL Server 기반 서버를 실행하고 SQL Server 백업이 구성된 VM에서 스냅숏 실행이 지연될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-211">On VMs that are running SQL Server-based servers and on which SQL Server backup is configured, snapshot execution delays may occur.</span></span><br><br><span data-ttu-id="15194-212">스냅숏 문제로 인해 백업이 실패한 경우 다음 레지스트리 키를 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-212">If you are experiencing a Backup failure because of a snapshot issue, set the following registry key:</span></span><br><br><span data-ttu-id="15194-213">**[HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT] "USEVSSCOPYBACKUP"="TRUE"**</span><span class="sxs-lookup"><span data-stu-id="15194-213">**[HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT] "USEVSSCOPYBACKUP"="TRUE"**</span></span> |
| <span data-ttu-id="15194-214">VM이 RDP에서 종료되므로 VM 상태가 잘못 보고됩니다.</span><span class="sxs-lookup"><span data-stu-id="15194-214">The VM status is reported incorrectly because the VM is shut down in RDP.</span></span> | <span data-ttu-id="15194-215">RDP(원격 데스크톱 프로토콜)에서 VM을 종료하는 경우 VM 상태가 올바른지 여부를 확인하려면 포털을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-215">If you shut down the VM in Remote Desktop Protocol (RDP), check the portal to determine whether the VM status is correct.</span></span> <span data-ttu-id="15194-216">올바르지 않으면 VM 대시보드의 **종료** 옵션을 사용하여 포털에서 VM을 종료합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-216">If it’s not correct, shut down the VM in the portal by using the **Shutdown** option on the VM dashboard.</span></span> |
| <span data-ttu-id="15194-217">동일한 클라우드 서비스에서 여러 VM이 동시에 백업하도록 구성됩니다.</span><span class="sxs-lookup"><span data-stu-id="15194-217">Many VMs from the same cloud service are configured to back up at the same time.</span></span> | <span data-ttu-id="15194-218">동일한 클라우드 서비스에서 VM의 백업 일정을 분산하는 것이 모범 사례입니다.</span><span class="sxs-lookup"><span data-stu-id="15194-218">It’s a best practice to spread out the backup schedules for VMs from the same cloud service.</span></span> |
| <span data-ttu-id="15194-219">VM이 사용량이 높은 CPU 또는 메모리에서 실행 중입니다.</span><span class="sxs-lookup"><span data-stu-id="15194-219">The VM is running at high CPU or memory usage.</span></span> | <span data-ttu-id="15194-220">VM이 사용량이 높은 CPU(90% 이상) 또는 메모리에서 실행 중인 경우 스냅숏 작업이 큐에 대기 및 지연되어 결국 시간 초과됩니다. 이 상황에서는 주문형 백업을 시도하세요.</span><span class="sxs-lookup"><span data-stu-id="15194-220">If the VM is running at high CPU usage (more than 90 percent) or high memory usage, the snapshot task is queued and delayed, and it eventually times out. In this situation, try an on-demand backup.</span></span> |
| <span data-ttu-id="15194-221">VM이 DHCP에서 호스트/패브릭 주소를 가져올 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-221">The VM cannot get the host/fabric address from DHCP.</span></span> | <span data-ttu-id="15194-222">IaaS VM 백업이 작동하려면 게스트 내에 DHCP를 사용하도록 설정되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-222">DHCP must be enabled inside the guest for the IaaS VM backup to work.</span></span>  <span data-ttu-id="15194-223">VM이 DHCP 응답 245에서 호스트/패브릭 주소를 가져올 수 없는 경우에는 어떠한 확장도 다운로드하거나 실행할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-223">If the VM cannot get the host/fabric address from DHCP response 245, it cannot download or run any extensions.</span></span> <span data-ttu-id="15194-224">고정 개인 IP가 필요한 경우 플랫폼을 통해 구성해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-224">If you need a static private IP, you should configure it through the platform.</span></span> <span data-ttu-id="15194-225">VM 내 DHCP 옵션은 사용 가능한 상태로 두어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-225">The DHCP option inside the VM should be left enabled.</span></span> <span data-ttu-id="15194-226">자세한 내용은 [고정 내부 개인 IP 설정](../virtual-network/virtual-networks-reserved-private-ip.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="15194-226">For more information, see [Setting a Static Internal Private IP](../virtual-network/virtual-networks-reserved-private-ip.md).</span></span> |

### <a name="the-backup-extension-fails-to-update-or-load"></a><span data-ttu-id="15194-227">백업 확장을 업데이트 또는 로드할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-227">The backup extension fails to update or load</span></span>
<span data-ttu-id="15194-228">확장을 로드할 수 없는 경우 스냅숏을 만들 수 없기 때문에 백업이 실패합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-228">If extensions cannot be loaded, Backup fails because a snapshot cannot be taken.</span></span>

#### <a name="solution"></a><span data-ttu-id="15194-229">해결 방법</span><span class="sxs-lookup"><span data-stu-id="15194-229">Solution</span></span>

<span data-ttu-id="15194-230">**Windows 게스트의 경우:** iaasvmprovider 서비스가 사용하도록 설정되어 있는지, *자동* 시작 유형인지를 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-230">**For Windows guests:** Verify that the iaasvmprovider service is enabled and has a startup type of *automatic*.</span></span> <span data-ttu-id="15194-231">서비스가 이렇게 구성되어 있지 않으면 서비스를 사용하도록 설정하여 다음 백업 성공 여부를 결정합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-231">If the service is not configured in this way, enable it to determine whether the next backup succeeds.</span></span>

<span data-ttu-id="15194-232">**Linux 게스트의 경우:** VMSnapshot Linux 최신 버전(Backup에 사용되는 확장)은 1.0.91.0입니다.</span><span class="sxs-lookup"><span data-stu-id="15194-232">**For Linux guests:** Verify the latest version of VMSnapshot for Linux (the extension used by Backup) is 1.0.91.0.</span></span><br>


<span data-ttu-id="15194-233">백업 확장을 여전히 업데이트 또는 로드할 수 없는 경우 확장을 제거하여 VMSnapshot 확장이 다시 로드되도록 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-233">If the backup extension still fails to update or load, you can force the VMSnapshot extension to be reloaded by uninstalling the extension.</span></span> <span data-ttu-id="15194-234">다음 백업 시도 시 확장이 다시 로드됩니다.</span><span class="sxs-lookup"><span data-stu-id="15194-234">The next backup attempt will reload the extension.</span></span>

<span data-ttu-id="15194-235">확장을 제거하려면 다음을 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-235">To uninstall the extension, do the following:</span></span>

1. <span data-ttu-id="15194-236">[Azure 포털](https://portal.azure.com/)로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-236">Go to the [Azure portal](https://portal.azure.com/).</span></span>
2. <span data-ttu-id="15194-237">백업 문제가 있는 VM을 찾습니다.</span><span class="sxs-lookup"><span data-stu-id="15194-237">Locate the VM that has backup problems.</span></span>
3. <span data-ttu-id="15194-238">**설정**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-238">Click **Settings**.</span></span>
4. <span data-ttu-id="15194-239">**확장**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-239">Click **Extensions**.</span></span>
5. <span data-ttu-id="15194-240">**Vmsnapshot 확장**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-240">Click **Vmsnapshot Extension**.</span></span>
6. <span data-ttu-id="15194-241">**제거**를 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-241">Click **Uninstall**.</span></span>

<span data-ttu-id="15194-242">이렇게 하면 다음 백업 동안 확장을 다시 설치해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="15194-242">This procedure causes the extension to be reinstalled during the next backup.</span></span>

